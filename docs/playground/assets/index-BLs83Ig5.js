!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(e,t=60){this.fn=e,this.timeout=null,this.running=!1,this.previousTimestamp=null,this.unprocessedTime=null,this.UPDATE_CAP=1e3/t}setUpdateCap(e){this.UPDATE_CAP=1e3/e}start(){this.running||(this.running=!0,this.previousTimestamp=null,this.unprocessedTime=null,this.run())}stop(){this.running=!1,this.previousTimestamp=null,this.unprocessedTime=null}run(){if(this.running){this.previousTimestamp||(this.previousTimestamp=Date.now()),this.unprocessedTime||(this.unprocessedTime=0),this.unprocessedTime>10*this.UPDATE_CAP&&(this.unprocessedTime=this.UPDATE_CAP);const e=Date.now(),t=e-this.previousTimestamp;this.previousTimestamp=e,this.unprocessedTime+=t,this.unprocessedTime>=this.UPDATE_CAP&&(this.unprocessedTime-=this.UPDATE_CAP,this.fn()),this.timeout=setTimeout((()=>{this.run()}),0)}}}class t{constructor(e=[]){this.isMassComputed=!1,this.isLargestRadiusComputed=!1,this.entities=[],this.quadrants=new Array(4),this.bounds={xStart:0,yStart:0,xEnd:1,yEnd:1},this.initialize(e)}initialize(e=[]){this.isMassComputed=!1,this.isLargestRadiusComputed=!1,this.entities=e,this.bounds=this.getBounds(),this.quadrants=new Array(4);for(let t=0;t<e.length;t++)this.addEntity(e[t])}update(){this.initialize(this.entities)}getBounds(){let e=0,t=0,i=1,r=1;for(let o=0;o<this.entities.length;o++){const s=this.entities[o];s.x-1<e&&(e=Math.floor(s.x-1)),s.x+1>i&&(i=Math.ceil(s.x+1)),s.y-1<t&&(t=Math.floor(s.y-1)),s.y+1>r&&(r=Math.ceil(s.y+1))}const s=i-e,n=r-t;if(s>n){const e=s-n;t-=e/2,r+=e/2}else if(n>s){const t=n-s;e-=t/2,i+=t/2}return{xStart:e,yStart:t,xEnd:i,yEnd:r}}addEntity(e){let t,i=this.quadrants;const r={entity:e,next:null};let s,n,o,a,l,h,d=this.bounds.xStart,u=this.bounds.yStart,c=this.bounds.xEnd,p=this.bounds.yEnd;for(;i.length;)if(s=(d+c)/2,n=(u+p)/2,o=e.x>=s,a=e.y>=n,o?d=s:c=s,a?u=n:p=n,t=i,l=a<<1|o,i=i[l],!i)return void(t[l]=r);const g=i.entity.x,f=i.entity.y;if(e.x===g&&e.y===f)return r.next=i,void(t[l]=r);let m,_,y=!0;for(;y;)t[l]=new Array(4),t=t[l],s=(d+c)/2,n=(u+p)/2,o=e.x>=s,a=e.y>=n,m=g>=s,_=f>=n,l=a<<1|o,h=_<<1|m,y=l===h,y&&(o?d=s:c=s,a?u=n:p=n);t[h]=i,t[l]=r}traverseTopBottom(e){const t=[];let i,r,s,n,o,a,l,h,d={quadNode:this.quadrants,xStart:this.bounds.xStart,xEnd:this.bounds.xEnd,yStart:this.bounds.yStart,yEnd:this.bounds.yEnd};for(;d;)i=d.quadNode,s=d.xStart,n=d.yStart,o=d.xEnd,a=d.yEnd,!e(i,s,n,o,a)&&i.length&&(l=(s+o)/2,h=(n+a)/2,(r=i[0])&&t.push({quadNode:r,xStart:s,yStart:n,xEnd:l,yEnd:h}),(r=i[1])&&t.push({quadNode:r,xStart:l,yStart:n,xEnd:o,yEnd:h}),(r=i[2])&&t.push({quadNode:r,xStart:s,yStart:h,xEnd:l,yEnd:a}),(r=i[3])&&t.push({quadNode:r,xStart:l,yStart:h,xEnd:o,yEnd:a})),d=t.pop()}traverseBottomTop(e){const t=[],i=[];let r,s,n,o,a,l,h,d,u={quadNode:this.quadrants,xStart:this.bounds.xStart,xEnd:this.bounds.xEnd,yStart:this.bounds.yStart,yEnd:this.bounds.yEnd};for(;u;)d=u.quadNode,d.length&&(s=u.xStart,n=u.yStart,o=u.xEnd,a=u.yEnd,l=(s+o)/2,h=(n+a)/2,(r=d[0])&&t.push({quadNode:r,xStart:s,yStart:n,xEnd:l,yEnd:h}),(r=d[1])&&t.push({quadNode:r,xStart:l,yStart:n,xEnd:o,yEnd:h}),(r=d[2])&&t.push({quadNode:r,xStart:s,yStart:h,xEnd:l,yEnd:a}),(r=d[3])&&t.push({quadNode:r,xStart:l,yStart:h,xEnd:o,yEnd:a})),i.push(u),u=t.pop();for(;u=i.pop();)e(u.quadNode,u.xStart,u.yStart,u.xEnd,u.yEnd)}computeMass(){this.isMassComputed||(this.traverseBottomTop((e=>{if(e.length){let t=0,i=0,r=0;for(let s=0;s<4;s++){const n=e[s];n&&(r+=n.mass,t+=n.mass*n.x,i+=n.mass*n.y)}e.x=t/r,e.y=i/r,e.mass=r}else{let t=0,i=e;do{t+=i.entity.mass}while(i=i.next);e.x=e.entity.x,e.y=e.entity.y,e.mass=t}})),this.isMassComputed=!0)}computeLargestRadius(e=0){this.isLargestRadiusComputed||(this.traverseBottomTop((t=>{if(t.entity)t.radius=t.entity.shape.radius+e;else{t.radius=0;for(let e=0;e<4;e++)t[e]&&t[e].radius>t.radius&&(t.radius=t[e].radius)}})),this.isLargestRadiusComputed=!0)}}const i=Object.freeze({DEFAULT_EDGE_STRENGTH:.7,DEFAULT_NODE_MASS:2e3,DEFAULT_NODE_RADIUS:50,DEFAULT_VISIBLE_EDGE_DISTANCE:350,DEFAULT_EDGE_WEIGHT:1,NODE_COUNT_INIT_BREAKPOINT:500,DEFAULT_START_ALPHA:1,DEFAULT_ALPHA_MIN:.001,DEFAULT_ALPHA_DECAY:1-Math.pow(.001,1/300),DEFAULT_ALPHA_TARGET:0,DEFAULT_VELOCITY_DECAY:.6,RENDERER_LINE_MARGIN:10,RENDERER_SCENE_SIZE:5e4,RENDERER_RESOLUTION:2,RENDERER_MAX_SCALE:4,RENDERER_MIN_SCALE:.03,RENDERER_ZOOM_SENSITIVITY:2e3,RENDERER_ZOOM_TO_FIT_PADDING:350,DEFAULT_RENDERER_PRIMARY_COLOR:3312098,DEFAULT_RENDERER_BACKGROUND_COLOR:15132648,DEFAULT_RENDERER_ROTATE_EDGE_LABELS:!0,DEFAULT_RENDERER_NODE_FILL:16777215,DEFAULT_RENDERER_NODE_STROKE:16777215,DEFAULT_RENDERER_NODE_TEXT_COLOR:0,DEFAULT_RENDERER_NODE_STROKE_WIDTH:1,RENDERER_NODE_MIN_FONT_SIZE:12,RENDERER_EDGE_TEXT_RESOLUTION:3,RENDERER_NODE_MIN_ICON_SIZE:16,RENDERER_NODE_MAX_ICON_SIZE:50,RENDERER_NODE_FONT_FAMILY:"Arial",RENDERER_NODE_TEXT_RESOLUTION:3,RENDERER_EDGE_MARKER_SIZE:16,RENDERER_EDGE_FONT_FAMILY:"Arial",RENDERER_EDGE_FONT_SIZE:12,RENDERER_EDGE_LABEL_WIDTH:60,RENDERER_EDGE_LABEL_BLOCK_PADDING:10,RENDERER_EDGE_LABEL_INLINE_PADDING:16,RENDERER_EDGE_WIDTH:1,DEFAULT_RENDERER_EDGE_COLOR:0,DEFAULT_RENDERER_EDGE_TEXT_COLOR:0,DEFAULT_RENDERER_EDGE_LABEL_FILL:16777215,DEFAULT_RENDERER_EDGE_LABEL_STROKE:16777215,DEFAULT_RENDERER_EDGE_LABEL_STROKE_WIDTH:2});class r{constructor(r=[],s=[],n={}){this.nodes=r,this.edges=s,this.alpha=n.alpha||i.DEFAULT_START_ALPHA,this.alphaMin=n.alphaMin||i.DEFAULT_ALPHA_MIN,this.alphaDecay=n.alphaDecay||i.DEFAULT_ALPHA_DECAY,this.alphaTarget=n.alphaTarget||i.DEFAULT_ALPHA_TARGET,this.velocityDecay=n.velocityDecay||i.DEFAULT_VELOCITY_DECAY,this.components=new Map,this.listeners=new Map([["layoutloopstart",new Set],["layoutupdate",new Set],["layoutloopend",new Set]]),this.loop=new e(this.runLoop.bind(this),n.updateCap?n.updateCap:60),this.updateQuadTree(),this.quadtree=new t(this.nodes),this.isAnimating=!1}on(e,t){this.listeners.has(e)||console.error(`No such event name: ${e}`),this.listeners.get(e).add(t)}triggerEvent(e){this.listeners.get(e).forEach((e=>e()))}runLoop(){this.update(),this.alpha<this.alphaMin&&(this.loop.stop(),this.triggerEvent("layoutloopend"))}updateNodesAndEdges(e,t){this.nodes=e,this.edges=t,this.updateQuadTree(),this.components.forEach((e=>this.initializeComponent(e)))}updateQuadTree(){this.quadtree=new t(this.nodes)}initializeComponent(e){let t=this.nodes,i=this.edges;return e.nodeBindings&&(t=this.nodes.filter((t=>e.nodeBindings(t)))),e.edgeBindings&&(i=this.edges.filter((t=>e.edgeBindings(t)))),e.instance.initialize(t,i,{quadtree:this.quadtree,remove:()=>this.removeComponent(e.id)}),e}start(){this.triggerEvent("layoutloopstart"),this.loop.start()}stop(){this.loop.stop(),this.triggerEvent("layoutloopend")}setUpdateCap(e){this.loop.setUpdateCap(e)}addLayoutComponent(e,t,i=null,r=null){if(this.components.has(e))throw new Error("Component already exists: "+e);const s={id:e,instance:t,nodeBindings:i,edgeBindings:r};return this.initializeComponent(s),this.components.set(e,s),this}removeComponent(e){this.components.has(e)&&(this.components.get(e).instance.dismount(),this.components.delete(e))}clearAllLayoutComponents(){this.components.clear()}hasLayoutComponent(e){return this.components.has(e)}findClosestNodeByCoordinates(e,t){let i,r=1/0;for(let s=0;s<this.nodes.length;++s){const n=this.nodes[s],o=e-n.x,a=t-n.y,l=o*o+a*a;l<r&&(i=n,r=l)}return i}animateState(t=[],i=300,r=!1){if(!t.length)return;this.nodeMap=this.nodes.reduce(((e,t)=>(e[t.id]=t,e)),{}),t.forEach((e=>{e.sourceX=isNaN(e.sourceX)?this.nodeMap[e.id].x:e.sourceX,e.sourceY=isNaN(e.sourceY)?this.nodeMap[e.id].y:e.sourceY}));const s=Date.now(),n=new e((()=>{const e=Date.now()-s,o=Math.min(e/i,100);t.forEach((e=>{const t=this.nodeMap[e.id];t.x=e.sourceX+(e.targetX-e.sourceX)*o,t.y=e.sourceY+(e.targetY-e.sourceY)*o})),e>i&&(n.stop(),this.isAnimating=!1,r&&t.forEach((e=>{const t=this.nodeMap[e.id];t.fx=t.x,t.fy=t.y}))),this.triggerEvent("layoutupdate")}),1/0);this.isAnimating=!0,n.start()}update(e=!0){if(!this.isAnimating){this.alpha+=(this.alphaTarget-this.alpha)*this.alphaDecay;for(const[,e]of this.components.entries())e.instance.execute(this.alpha);for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];null==t.fx?(t.vx*=this.velocityDecay,t.x+=t.vx):(t.x=t.fx,t.vx=0),null==t.fy?(t.vy*=this.velocityDecay,t.y+=t.vy):(t.y=t.fy,t.vy=0)}this.iteration=this.iteration?this.iteration+1:1,this.quadtree.update(),e&&this.triggerEvent("layoutupdate")}}}class s{constructor(e=[],t=[]){this.allNodes=[],this.allEdges=[],this.onlineNodes=new Set,this.nodeLookupMap=new Map,this.sourceToTargetMap=new Map,this.targetToSourceMap=new Map,this.nodeToNeighborsMap=new Map,this.edgeIndexes=new Map,this.offlineEdgeCounter=new Map,this.updateNodesAndEdges(e,t)}updateNodesAndEdges(e,t){e.forEach((e=>{!this.nodeLookupMap.has(e.id)&&this.onlineNodes.add(e.id)})),this.nodeLookupMap=new Map(e.map((e=>[e.id,e]))),this.allNodes.forEach((e=>{!this.nodeLookupMap.has(e)&&this.onlineNodes.delete(e)})),this.allNodes=e.map((e=>e.id)),this.allEdges=[...t];const i=new Map(this.allNodes.map((e=>[e,new Map]))),r=new Map(this.allNodes.map((e=>[e,new Map]))),s=new Map(this.allNodes.map((e=>[e,new Map]))),n=(e,t,i,r)=>{e.get(t).has(i)||e.get(t).set(i,{id:i,edges:[],weight:0});const s=e.get(t).get(i);s.edges.push(r),s.weight+=r.weight?r.weight:1};this.allEdges.forEach((e=>{n(i,e.sourceNode,e.targetNode,e),n(r,e.targetNode,e.sourceNode,e),n(s,e.sourceNode,e.targetNode,e),e.sourceNode!==e.targetNode&&n(s,e.targetNode,e.sourceNode,e)})),this.sourceToTargetMap=new Map(this.allNodes.map((e=>[e,[]]))),this.targetToSourceMap=new Map(this.allNodes.map((e=>[e,[]]))),this.nodeToNeighborsMap=new Map(this.allNodes.map((e=>[e,[]])));const o=(e,t)=>{for(const[i,r]of t)e.set(i,Array.from(r.values()))};o(this.sourceToTargetMap,i),o(this.targetToSourceMap,r),o(this.nodeToNeighborsMap,s),this.updateMetaData()}updateMetaData(){this.edgeIndexes=new Map;const e=new Map;let t;const i=this.getOnlineEdges();for(let s=0;s<i.length;s++){t=i[s];const r=t.sourceNode>t.targetNode?`${t.sourceNode}${t.targetNode}`:`${t.targetNode}${t.sourceNode}`;e.has(r)?e.get(r).push(t):e.set(r,[t])}for(const[,s]of e)for(let e=0;e<s.length;e++)t=s[e],this.edgeIndexes.set(t,{total:s.length,index:e});this.offlineEdgeCounter=new Map(this.allNodes.map((e=>[e,{sourceNode:0,targetNode:0,internal:0}])));const r=this.getOfflineEdges();for(let s=0;s<r.length;s++)t=r[s],t.sourceNode===t.targetNode?this.offlineEdgeCounter.get(t.sourceNode).internal++:(this.offlineEdgeCounter.get(t.sourceNode).sourceNode++,this.offlineEdgeCounter.get(t.targetNode).targetNode++)}getOnlineNodes(){return this.allNodes.filter((e=>this.onlineNodes.has(e))).map((e=>this.nodeLookupMap.get(e)))}getOfflineNodes(){return this.allNodes.filter((e=>!this.onlineNodes.has(e))).map((e=>this.nodeLookupMap.get(e)))}getOnlineEdges(){return this.allEdges.filter((e=>this.isEdgeOnline(e)))}getOfflineEdges(){return this.allEdges.filter((e=>!this.isEdgeOnline(e)))}isEdgeOnline(e){return this.onlineNodes.has(e.sourceNode)&&this.onlineNodes.has(e.targetNode)}isNodeOnline(e){return this.onlineNodes.has(e)}bringNodesOffline(e){e.forEach((e=>{this.onlineNodes.delete(e)})),this.updateMetaData()}bringNodesOnline(e){e.forEach((e=>{if(!this.nodeLookupMap.has(e))throw new Error(`No such node exists: ${e}`);this.onlineNodes.add(e)})),this.updateMetaData()}bringAllNodesOffline(){this.onlineNodes=new Set,this.updateMetaData()}bringAllNodesOnline(){this.onlineNodes=new Set(this.allNodes),this.updateMetaData()}getNeighbors(e,{isDirected:t=!1,useOnlyOnline:i=!0,ignoreInternalEdges:r=!0}={}){let s;return s=t?this.sourceToTargetMap.get(e).map((e=>e.id)):this.nodeToNeighborsMap.get(e).map((e=>e.id)),i&&(s=s.filter((e=>this.onlineNodes.has(e)))),r&&(s=s.filter((t=>t!==e))),Array.from(new Set(s))}computeImplodeOrExplodeNode(e,{isBringOnline:t=!1,isDirected:i=!0,mode:r="single"}={}){if(!this.nodeLookupMap.has(e))throw new Error(`No such node exists: ${e}`);if(!this.onlineNodes.has(e))throw new Error(`Input node is offline: ${e}`);const s=new Map,n=e=>{if(s.has(e))return s.get(e);const r=this.getNeighbors(e,{isDirected:i,isBringOnline:!t,ignoreInternalEdges:!0});return s.set(e,r),r},o=[],a=new Set,l=new Map([[e,0]]);let h,d=[e];for(;h=d.pop();){if(a.has(h))continue;if(a.add(h),"single"===r&&l.get(h)>1)continue;h!==e&&o.push(h);const t=n(h);for(let e=0;e<t.length;e++){const i=t[e];l.has(i)||l.set(i,l.get(h)+1)}if("leafs"===r)for(let e=0;e<t.length;e++){const i=t[e];0===n(i).filter((e=>e!==h)).length&&d.push(i)}else d=d.concat(t)}return o.filter((e=>t&&!this.onlineNodes.has(e)||!t&&this.onlineNodes.has(e)))}stageNodePositions(e=[],t=300,i=0,r=0){if(!e.length)return[];const s=[],n=e.filter((e=>this.getNeighbors(e,{isDirected:!1,useOnlyOnline:!0,ignoreInternalEdges:!0}).length<2)).length;return e.map((e=>{const o=this.getNeighbors(e,{isDirected:!1,useOnlyOnline:!0,ignoreInternalEdges:!0});if(o.length<2){s.push(e);const o=s.length,a=n,l=Math.floor(359/a*o);return{id:e,x:i+1+t*Math.cos(l*Math.PI/180),y:r+1+t*Math.sin(l*Math.PI/180)}}{let t=0,i=0;for(let e=0;e<o.length;e++){const r=this.nodeLookupMap.get(o[e]);t+=r.x,i+=r.y}return t/=o.length,i/=o.length,{id:e,x:t,y:i}}}))}findShortestPathUnweighted(e,t,{useOnlyOnline:i=!0,isDirected:r=!0}={}){if(i&&(!this.onlineNodes.has(e)||!this.onlineNodes.has(t)))throw new Error("Start node or end node is not live.");if(e===t)return[e];const s=[e],n=new Map;let o;for(;(o=s.pop())&&o!==t;){const e=this.getNeighbors(o,{isDirected:r,useOnlyOnline:i});let t;for(let r=0;r<e.length;r++)t=e[r],i&&!this.onlineNodes.has(t)||n.has(t)||(n.set(t,o),s.push(t))}if(o!==t)return null;let a=o;const l=[a];for(;a=n.get(a);)l.push(a);return l.reverse()}findShortestPathWeighted(e,t,{useOnlyOnline:i=!0,isDirected:r=!0,aggregateEdgeWeights:s=!1}={}){if(i&&(!this.onlineNodes.has(e)||!this.onlineNodes.has(t)))throw new Error("Start node or end node is not live.");if(e===t)return[{id:e,cost:0}];const n=e=>{let t=r?this.sourceToTargetMap.get(e):this.nodeToNeighborsMap.get(e);return i&&(t=t.filter((e=>this.onlineNodes.has(e.id)))),t=t.filter((t=>t.id!==e)),s||(t=t.map((e=>{const t=e.edges.reduce(((e,t)=>(t.weight?t.weight:1)<e.weight?t:e),{id:null,edges:[],weight:1/0});return{id:e.id,edges:[t],weight:t.weight?t.weight:1}}))),t},o=new Map,a=new Map([[e,0]]),l=[e],h=new Set;let d=null,u=null;for(;u=l.pop();){if(h.has(u))continue;h.add(u);const e=a.get(u),i=n(u);for(let r=0;r<i.length;r++){const s=i[r],n=a.has(s.id)?a.get(s.id):1/0,c=e+s.weight;d&&c>d||(c<n&&(a.set(s.id,c),o.set(s.id,u)),s.id!==t?h.has(s.id)||l.push(s.id):d=a.get(t))}}if(null===d)return null;let c=t;const p=[{id:t,weight:d}];for(;c=o.get(c);)p.push({id:c,weight:a.get(c)});return p.reverse()}computeStronglyConnectedComponents({useOnlyOnline:e=!0}={}){const t=e?Array.from(this.onlineNodes):[...this.allNodes],i=[],r=new Set,s=new Map,n=new Map;let o=0;const a=t=>{if(r.has(t))return;r.add(t);const n=this.getNeighbors(t,{isDirected:!0,useOnlyOnline:e,ignoreInternalEdges:!0});for(let e=0;e<n.length;e++){const i=n[e];s.has(i)||s.set(i,[]),s.get(i).push(t),a(i)}i.push(t)},l=e=>{if(r.add(e),n.has(o)||n.set(o,[]),n.get(o).push(e),s.has(e)){const t=s.get(e);for(let e=0;e<t.length;e++){const i=t[e];r.has(i)||l(i)}}};for(let h=0;h<t.length;h++){const e=t[h];a(e)}for(r.clear();i.length;){const e=i.pop();r.has(e)||(l(e),o++)}return Array.from(n.values())}BFS(e,t,{useOnlyOnline:i=!0,isDirected:r=!0}={}){if(!this.nodeLookupMap.has(e))throw new Error(`No such node exists: ${e}`);if(i&&!this.onlineNodes.has(e))throw new Error(`Input node is offline: ${e}`);const s=new Set;let n=[e],o=[],a=null;do{for(o=n.reverse(),n=[];a=o.pop();){if(s.has(a))continue;if(s.add(a),t(a))continue;let e;e=r?this.sourceToTargetMap.get(a).map((e=>e.id)):this.nodeToNeighborsMap.get(a).map((e=>e.id)),n=n.concat(i?e.filter((e=>this.onlineNodes.has(e))):e)}}while(n.length)}DFS(e,t,{useOnlyOnline:i=!0,isDirected:r=!0}={}){if(!this.nodeLookupMap.has(e))throw new Error(`No such node exists: ${e}`);if(i&&!this.onlineNodes.has(e))throw new Error(`Input node is offline: ${e}`);const s=new Set;let n=[],o=e;do{if(s.has(o))continue;if(s.add(o),t(o))continue;let e;e=r?this.sourceToTargetMap.get(o).map((e=>e.id)):this.nodeToNeighborsMap.get(o).map((e=>e.id)),n=n.concat(i?e.filter((e=>this.onlineNodes.has(e))).reverse():e.reverse())}while(o=n.pop())}}const n=e=>{if(null===e)return e;if(e instanceof Array){const t=[];for(const i in e){const r=e[i];t[i]="object"==typeof r&&null!==r?n(r):r}return t}if("object"==typeof e&&Object.keys(e).length>0){const t={};for(const i in e){const r=e[i];t[i]="object"==typeof r&&null!==r?n(r):r}return t}return e instanceof Date?new Date(e.getTime()):e},o=(e,t,i=!0)=>(Object.keys(t).forEach((r=>{const s=e[r],a=t[r];if("object"!=typeof s||"object"!=typeof a||null===s||null===a||Array.isArray(s)||Array.isArray(a)){if(void 0!==s&&!i)return 0;e[r]=a instanceof Array||"object"==typeof a&&null!==a?n(a):a}else o(s,a,i)})),e),a=(e=[],t=[],r={})=>{const s=Array.isArray(r.nodes)?r.nodes:[],n=Array.isArray(r.edges)?r.edges:[];for(let a=0;a<e.length;a++){const t=e[a];if(t.template){const e=s.find((e=>e.id===t.template));e&&o(t,e.template)}if(t.index=a,t.shape?t.shape.radius||(t.shape.radius=t.shape.width?Math.max(t.shape.width,t.shape.height)/2:i.DEFAULT_NODE_RADIUS):t.shape={id:"circle",radius:i.DEFAULT_NODE_RADIUS},t.mass=t.mass?t.mass:i.DEFAULT_NODE_MASS,t.fx&&(t.x=t.fx),t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){const r=(e.length>i.NODE_COUNT_INIT_BREAKPOINT?t.shape.radius:10)*Math.sqrt(.5+a),s=a*(Math.PI*(3-Math.sqrt(5)));t.x=r*Math.cos(s),t.y=r*Math.sin(s)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=0,t.vy=0)}for(let a=0;a<t.length;a++){const r=t[a];if(r.template){const e=n.find((e=>e.id===r.template));e&&o(r,e.template)}if(r.index=a,r.strength||(r.strength=i.DEFAULT_EDGE_STRENGTH),r.source=e.find((e=>e.id===r.sourceNode)),r.target=e.find((e=>e.id===r.targetNode)),!r.source||!r.target)throw new Error(`Broken Edge ${r.sourceNode} -> ${r.targetNode}`);if(!r.distance){const e=r.target.shape.radius+r.source.shape.radius;r.distance=e+(r.visibleDistance?r.visibleDistance:i.DEFAULT_VISIBLE_EDGE_DISTANCE)}r.visibleDistance||(r.visibleDistance=r.distance-r.target.shape.radius-r.source.shape.radius),isNaN(r.weight)&&(r.weight=i.DEFAULT_EDGE_WEIGHT)}return{nodes:e,edges:t}};class l{constructor(e=[],t=[],i={}){const n=a(e,t,null==i?void 0:i.templates);this.nodes=n.nodes,this.edges=n.edges,this.options=i,this.layout=new r(e,t,null==i?void 0:i.layout),this.dataManager=new s(e,t)}getNodes(){return this.nodes}getEdges(){return this.edges}setLayoutAlpha(e){return this.layout.alpha=e,this}setLayoutAlphaMin(e){return this.layout.alphaMin=e,this}setLayoutAlphaDecay(e){return this.layout.alphaDecay=e,this}setLayoutAlphaTarget(e){return this.layout.alphaTarget=e,this}setLayoutVelocityDecay(e){return this.layout.velocityDecay=e,this}setLayoutUpdateCap(e){this.layout.setUpdateCap(e)}computeCommunities(){return this.louvain()}louvain(){return function(e,t){function i(e){return Array.from(new Set(e))}function r(e,t,i){return e.associationMatrix[t]?e.associationMatrix[t][i]:void 0}function s(e){if(null===e||"object"!=typeof e)return e;const t=e.constructor();for(const i in e)t[i]=s(e[i]);return t}function n(e){return i(Object.values(e.nodesToCommunity)).reduce(((t,i)=>{const r=e.totalCommunityWeights[i]||0,s=e.degrees[i]||0;return e.totalWeight>0&&(t=t+r/e.totalWeight-Math.pow(s/(2*e.totalWeight),2)),t}),0)}function o(e){let t=0;const i=s(e),r={};return Object.keys(e).forEach((s=>{const n=e[s];let o=void 0===r[n]?-1:r[n];-1===o&&(r[n]=t,o=t,t+=1),i[s]=o})),i}function a(e,t){let i,r=n(t),s=!0;for(;s&&(i=r,s=!1,e.nodes.forEach((i=>{const r=t.nodesToCommunity[i],n=(t.gdegrees[i]||0)/(2*t.totalWeight),o={};(void 0===e.associationMatrix[i]?[]:Object.keys(e.associationMatrix[i])).forEach((r=>{if(r!==i){const s=e.associationMatrix[i][r],n=t.nodesToCommunity[r];o[n]=(o[n]||0)+s}}));const a=o[r]||0;t.degrees[r]=(t.degrees[r]||0)-(t.gdegrees[i]||0),t.totalCommunityWeights[r]=(t.totalCommunityWeights[r]||0)-a-(t.nodesLoopWeight[i]||0),t.nodesToCommunity[i]=-1;let l=r,h=0;Object.keys(o).forEach((e=>{const i=o[e]-(t.degrees[e]||0)*n;i>h&&(h=i,l=e)})),t.nodesToCommunity[i]=+l,t.degrees[l]=(t.degrees[l]||0)+(t.gdegrees[i]||0),t.totalCommunityWeights[l]=(t.totalCommunityWeights[l]||0)+(o[l]||0)+(t.nodesLoopWeight[i]||0),l!==r&&(s=!0)})),r=n(t),!(r-i<1e-7)););}function l(e,t){const s={nodes:i(Object.values(e)),edges:[],associationMatrix:{}},n={};return t.edges.forEach((t=>{const i=t.weight,o=e[t.sourceNode],a=e[t.targetNode],l={sourceNode:o,targetNode:a,weight:(r(s,o,a)||0)+i};!s.associationMatrix[l.sourceNode]&&(s.associationMatrix[l.sourceNode]={}),s.associationMatrix[l.sourceNode][l.targetNode]=l.weight,!s.associationMatrix[l.targetNode]&&(s.associationMatrix[l.targetNode]={}),s.associationMatrix[l.targetNode][l.sourceNode]=l.weight,n[l.sourceNode+":"+l.targetNode]?s.edges[n[l.sourceNode+":"+l.targetNode]].weight=l.weight:(s.edges.push(l),n[l.sourceNode+":"+l.targetNode]=s.edges.length-1)})),s}function h(e){const t={nodesToCommunity:{},totalCommunityWeights:{},degrees:{},gdegrees:{},nodesLoopWeight:{}};return t.totalWeight=e.edges.reduce(((e,t)=>e+t.weight),0),e.nodes.forEach(((i,s)=>{t.nodesToCommunity[i]=s;const n=(e.associationMatrix[i]?Object.keys(e.associationMatrix[i]):[]).reduce(((t,r)=>{let s=e.associationMatrix[i][r];return i===r&&(s*=2),t+s}),0);if(n<0)throw new Error("Communities cannot be computed with negative weights.");t.degrees[s]=n,t.gdegrees[i]=n,t.nodesLoopWeight[i]=r(e,i,i)||0,t.totalCommunityWeights[s]=t.nodesLoopWeight[i]})),t}const d={nodes:e.map((e=>e.id)),edges:t,associationMatrix:t.reduce(((e,t)=>(!e[t.sourceNode]&&(e[t.sourceNode]={}),e[t.sourceNode][t.targetNode]=t.weight,!e[t.targetNode]&&(e[t.targetNode]={}),e[t.targetNode][t.sourceNode]=t.weight,e)),{})};if(0===d.edges.length)return{communities:d.nodes.map((e=>[e.id])),communityTable:d.nodes.reduce(((e,t)=>(e[t.id]=t,e)),{})};const u=[];let c=-1/0,p=d;for(;;){const e=h(p);a(p,e);const t=n(e);if(t-c<1e-7)break;const i=o(e.nodesToCommunity);u.push(i),c=t,p=l(i,p)}const g=s(u[0]);for(let f=1;f<u.length;f++)Object.keys(g).forEach((e=>{const t=e,i=g[e];g[t]=u[f][i]}));return{communities:function(e){const t={};return Object.keys(e).forEach((i=>{const r=e[i];!t[r]&&(t[r]=[]),t[r].push(i)})),Object.values(t)}(g),communityTable:g}}(this.nodes,this.edges)}updateNodesAndEdges(e,t,i){const r=a(e,t,i);return this.nodes=r.nodes,this.edges=r.edges,this.layout.updateNodesAndEdges(this.nodes,this.edges),this.dataManager.updateNodesAndEdges(this.nodes,this.edges),this}startLayoutLoop(){return this.layout.start(),this}stopLayoutLoop(){return this.layout.stop(),this}updateLayout(e=!0){return this.layout.update(e),this}on(e,t){return this.layout.on(e,t),this}animateLayoutState(e=[],t=300,i=!1){this.layout.animateState(e,t,i)}addLayoutComponent(e,t,i=null,r=null){return this.layout.addLayoutComponent(e,t,i,r),this}clearAllLayoutComponents(){this.layout.clearAllLayoutComponents()}hasLayoutComponent(e){return this.layout.hasLayoutComponent(e)}removeLayoutComponent(e){return this.layout.removeComponent(e),this}findClosestNodeByCoordinates(e,t){return this.layout.findClosestNodeByCoordinates(e,t)}getOnlineNodes(){return this.dataManager.getOnlineNodes()}getOfflineNodes(){return this.dataManager.getOfflineNodes()}getOnlineEdges(){this.dataManager.getOnlineEdges()}getOfflineEdges(){this.dataManager.getOfflineEdges()}isEdgeOnline(e){return this.dataManager.isEdgeOnline(e)}isNodeOnline(e){return this.dataManager.isNodeOnline(e)}bringNodesOffline(e){this.dataManager.bringNodesOffline(e),this.nodes=this.dataManager.getOnlineNodes(),this.edges=this.dataManager.getOnlineEdges(),this.layout.updateNodesAndEdges(this.nodes,this.edges)}bringNodesOnline(e){this.dataManager.bringNodesOnline(e),this.nodes=this.dataManager.getOnlineNodes(),this.edges=this.dataManager.getOnlineEdges(),this.layout.updateNodesAndEdges(this.nodes,this.edges)}bringAllNodesOffline(){this.dataManager.bringAllNodesOffline(),this.nodes=[],this.edges=[],this.layout.updateNodesAndEdges(this.nodes,this.edges)}bringAllNodesOnline(){this.dataManager.bringAllNodesOnline(),this.nodes=this.dataManager.getOnlineNodes(),this.edges=this.dataManager.getOnlineEdges(),this.layout.updateNodesAndEdges(this.nodes,this.edges)}getNeighbors(e,t){return this.dataManager.getNeighbors(e,t)}computeImplodeOrExplodeNode(e,t){return this.dataManager.computeImplodeOrExplodeNode(e,t)}stageNodePositions(e=[],t=300,i=0,r=0){return this.dataManager.stageNodePositions(e,t,i,r)}findShortestPathUnweighted(e,t,i){return this.dataManager.findShortestPathUnweighted(e,t,i)}findShortestPathWeighted(e,t,i){return this.dataManager.findShortestPathWeighted(e,t,i)}computeStronglyConnectedComponents(e){return this.dataManager.computeStronglyConnectedComponents(e)}BFS(e,t,i){this.dataManager.BFS(e,t,i)}DFS(e,t,i){this.dataManager.DFS(e,t,i)}}const h=4294967296;class d{constructor(){this.nodes=[],this.edges=[],this.random=function(){let e=1;return()=>(e=(1664525*e+1013904223)%h)/h}(),this.utils={quadtree:new t,remove:()=>{}}}randomize(){return 1e-6*(this.random()-.5)}getCenterCoordinates(){let e,t=1/0,i=-1/0,r=1/0,s=-1/0;for(let n=0;n<this.nodes.length;n++)e=this.nodes[n],e.x<t&&(t=e.x),e.y<r&&(r=e.y),e.x>i&&(i=e.x),e.y>s&&(s=e.y);return[(i-t)/2,(s-r)/2]}getAverageCoordinates(){return[this.nodes.reduce(((e,t)=>e+t.x),0)/this.nodes.length,this.nodes.reduce(((e,t)=>e+t.y),0)/this.nodes.length]}initialize(e,t,i){this.nodes=e,this.edges=t,this.utils=i}dismount(){}execute(){}}class u extends d{constructor({isHorizontal:e=!0,coordinate:t=0,strength:i=.05}={}){super(),this.isHorizontal=e,this.coordinate=t,this.strength=i}initialize(...e){super.initialize(...e)}execute(e){let t;for(let i=0;i<this.nodes.length;i++)t=this.nodes[i],t[this.isHorizontal?"vx":"vy"]+=(this.coordinate-t[this.isHorizontal?"x":"y"])*this.strength*e}}class c extends d{constructor({width:e=null,height:t=null}={}){super(),this.width=e,this.height=t,this.computedWidth=e,this.computedHeight=t,this.multiplier=5}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){if(super.initialize(...e),this.width&&this.height)this.computedWidth=this.width,this.computedHeight=this.height;else{let e,t=0;for(let i=0;i<this.nodes.length;i++)e=this.nodes[i],t+=Math.max(t,this.getWidth(e)*this.multiplier,this.getHeight(e)*this.multiplier);this.width||this.height?this.width?this.height||(this.computedHeight=t-this.width>0?t-this.width:100):this.computedWidth=t-this.height>0?t-this.height:100:(this.computedWidth=t/2,this.computedHeight=t/2)}this.computedWidth=this.computedWidth/2,this.computedHeight=this.computedHeight/2}execute(){let e;for(let t=0;t<this.nodes.length;t++)e=this.nodes[t],e.x<-this.computedWidth?e.x=-this.computedWidth:e.x>this.computedWidth&&(e.x=this.computedWidth),e.y<-this.computedHeight?e.y=-this.computedHeight:e.y>this.computedHeight&&(e.y=this.computedHeight)}}class p extends d{constructor({x:e=0,y:t=0,strength:i=1}={}){super(),this.x=e,this.y=t,this.strength=i}initialize(...e){super.initialize(...e)}execute(){let e=0,t=0;for(let s=0;s<this.nodes.length;s++){const i=this.nodes[s];e+=i.x,t+=i.y}const i=(e/this.nodes.length-this.x)*this.strength,r=(t/this.nodes.length-this.y)*this.strength;for(let s=0;s<this.nodes.length;s++){const e=this.nodes[s];e.x-=i,e.y-=r}}}class g extends d{constructor({strength:e=.7}={}){super(),this.strength=e}initialize(...e){super.initialize(...e)}execute(e){let t,i=0,r=0,s=0;for(let l=0;l<this.nodes.length;l++){t=this.nodes[l];const e=t.mass**2;i+=t.x*e,r+=t.y*e,s+=e}const n=i/s,o=r/s,a=e*this.strength;for(let l=0;l<this.nodes.length;l++)t=this.nodes[l],t.vx-=(t.x-n)*a,t.vy-=(t.y-o)*a}}class f extends d{constructor({strength:e=1,radiusPadding:t=5}={}){super(),this.strength=e,this.radiusPadding=t}initialize(...e){super.initialize(...e)}execute(){let e,t;this.utils.quadtree.computeLargestRadius(this.radiusPadding);for(let i=0;i<this.nodes.length;i++)e=this.nodes[i],t=e.shape.radius+this.radiusPadding,this.utils.quadtree.traverseTopBottom(((i,r,s,n,o)=>{const a=i.entity,l=i.radius+this.radiusPadding,h=t+l;if(!a)return r>e.x+h||n<e.x-h||s>e.y+h||o<e.y-h;{if(a.index>=e.index)return;let i=e.x-a.x,r=e.y-a.y,s=i*i+r*r;if(s<h*h){0===i&&(i=this.randomize(),s+=i*i),0===r&&(r=this.randomize(),s+=r*r);const n=Math.sqrt(s),o=(h-n)/n*this.strength,d=i*o,u=r*o,c=l*l,p=c/(t*t+c);e.vx+=d*p,e.vy+=u*p;const g=1-p;a.vx-=d*g,a.vy-=u*g}}}))}}class m extends d{constructor({computeGroup:e=e=>e.template,strength:t=.9,space:i=300,centerX:r=null,centerY:s=null}={}){super(),this.computeGroup=e,this.strength=t,this.positionMap=new Map,this.centerX=r,this.centerY=s,this.space=i}initialize(...e){super.initialize(...e);const t=this.getAverageCoordinates();null===this.centerX&&(this.centerX=t[0]),null===this.centerY&&(this.centerY=t[1]),this.positionMap.clear();const i=new Map;this.nodes.forEach((e=>{const t=this.computeGroup(e);i.has(t)?i.get(t).push(e):i.set(t,[e])}));const r=Math.floor(360/i.size);Array.from(i.keys()).forEach(((e,t)=>{const s=(e=>{(e%=360)<0&&(e+=360);let t=2*Math.PI*e/360;return t<0&&(t+=2*Math.PI),t})(r*t),n=Math.cos(s),o=Math.sin(s);let a=[this.centerX+this.space*n,this.centerY+this.space*o];i.get(e).forEach((e=>{const t=2*e.shape.radius,i=t*n+a[0],r=t*o+a[1];this.positionMap.set(e.id,[i,r]);a=[t*n+i,t*o+r]}))}))}execute(){let e;for(let t=0;t<this.nodes.length;t++){e=this.nodes[t];const i=this.positionMap.get(e.id);e.fx=i[0],e.fy=i[1]}}dismount(){this.nodes.forEach((e=>{delete e.fx,delete e.fy}))}}let _=class extends d{constructor({useX:e=!0,useY:t=!0,strength:i=.6,size:r,offsetMultiplier:s=3}={}){super(),this.useX=e,this.useY=t,this.strength=i,this.size=r,this.offsetMultiplier=s,this.maxSizeX=0,this.maxSizeY=0}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){if(super.initialize(...e),this.size)return;let t;this.maxSizeX=0,this.maxSizeY=0;for(let i=0;i<this.nodes.length;i++)t=this.nodes[i],this.maxSizeX=Math.max(this.maxSizeX,this.getWidth(t)*this.offsetMultiplier),this.maxSizeY=Math.max(this.maxSizeY,this.getHeight(t)*this.offsetMultiplier);if(this.useY&&this.useX){const e=Math.max(this.maxSizeX,this.maxSizeY);this.maxSizeX=e,this.maxSizeY=e}}execute(e){const t=e*this.strength;for(let i=0;i<this.nodes.length;i++){const e=this.nodes[i];if(this.useY){const i=Math.round(e.y/this.maxSizeY)*this.maxSizeY;e.vy-=(e.y-i)*t}if(this.useX){const i=Math.round(e.x/this.maxSizeX)*this.maxSizeX;e.vx-=(e.x-i)*t}}}};const y=(e,t)=>{const i=new Map(e.map((e=>[e.id,t.filter((t=>t.targetNode===e.id))]))),r=new Map(e.map((e=>[e.id,t.filter((t=>t.sourceNode===e.id))]))),s=e.filter((e=>!i.get(e.id).length&&r.get(e.id).length)),n=e.filter((e=>!i.get(e.id).length&&!r.get(e.id).length)),o=new Map([...n.map((e=>[e.id,0])),...s.map((e=>[e.id,1]))]),a=e=>{if(!o.has(e)){const t=Math.max(...i.get(e).map((e=>a(e.sourceNode))));o.set(e,t+1)}return o.get(e)},l=new Map;for(let p=0;p<e.length;p++){const t=a(e[p].id);l.has(t)||l.set(t,[]),l.get(t).push(e[p])}const h=Array.from(l.keys()).sort(((e,t)=>e-t)).map((e=>l.get(e))),d=h.map((()=>[])),u=[],c=new Set;for(let p=0;p<e.length;p++){const t=e[p].id,r=a(t),s=i.get(t).map((e=>e.sourceNode));for(let e=0;e<s.length;e++){const i=s[e],n=a(i);if(r-n>1){let e=i;for(let i=n+1;i<r;i++){const r="__FAKE_NODE__"+i+t+e;if(!c.has(r)){c.add(r);const e={id:r};d[i-1].push(e)}u.push({sourceNode:e,targetNode:r}),e=r}u.push({sourceNode:e,targetNode:t})}}}return{hierarchy:h,fakeNodesHierarchy:d,fakeEdges:u}},x=(e,t)=>{const i=new Set,r=new Map,s=(e,n)=>{if(i.has(e))return;let o;i.add(e),n?(o=n,r.get(o).push(e)):(o=e,r.set(e,[e])),t.filter((t=>t.sourceNode!==t.targetNode&&(t.sourceNode===e||t.targetNode===e))).reduce(((e,t)=>(e.push(t.targetNode),e.push(t.sourceNode),e)),[]).forEach((e=>{s(e,o)}))};return e.forEach((e=>{s(e.id)})),[...r.values()].map((t=>t.map((t=>e.find((e=>e.id===t))))))},v=(e,t)=>{let i=e.reduce(((e,t)=>(e.push([...t]),e)),[]);if(1===i.length)return i;const r=new Map,s=new Map;i.forEach(((e,t)=>{e.forEach(((e,i)=>{r.set(e.id,t),s.set(e.id,i)}))}));const n=t.filter((e=>r.get(e.sourceNode)===r.get(e.targetNode)-1)),o=e=>s.get(e),a=(e,t)=>{let i=e,r=0;for(;;){const e=t.map((e=>e.sum[i]>0?e.sum[i]:0)),s=e.indexOf(Math.max(...e));if(0===e[s])break;if(i=s,r++,r>9999)break}return i},l=(e,t=!1)=>(e.forEach(((i,r)=>{const l=new Map(i.map((e=>[e.id,[]])));n.forEach((e=>{!t&&l.has(e.targetNode)?l.get(e.targetNode).push(o(e.sourceNode)):t&&l.has(e.sourceNode)&&l.get(e.sourceNode).push(o(e.targetNode))}));const h=i.map((e=>{const t=l.get(e.id);return{node:e,sum:i.map((i=>{if(i.id===e.id)return 0;const r=l.get(i.id);let s=0,n=0;return t.forEach((e=>{r.forEach((t=>{e<t&&n++,e>t&&s++}))})),n-s}))}})),d=[],u=h.length;for(let e=0;e<u;e++){const e=h.map((e=>e.sum.reduce(((e,t)=>e+t),0))),t=a(e.indexOf(Math.max(...e)),h);d.push(h[t].node),h.forEach((e=>{e.sum.splice(t,1)})),h.splice(t,1)}(e=>{e.forEach(((e,t)=>{s.set(e.id,t)}))})(d),e[r]=d})),e);for(let h=0;h<1;h++)i=l(l(i).reverse(),!0).reverse();return i=l(i),i},b=(e,t)=>{const i=[...e],r=t.filter((e=>e.targetNode!==e.sourceNode)),s=new Map(i.map((e=>[e.id,0]))),n=new Map(i.map((e=>[e.id,0])));r.forEach((e=>{s.set(e.targetNode,s.get(e.targetNode)+1),n.set(e.sourceNode,n.get(e.sourceNode)+1)}));const o=[],a=[],l=(e=!1)=>{for(;;){let t=!1;for(let l=0;l<i.length;l++){const h=i[l];if(!e&&!n.get(h.id)&&s.get(h.id)||e&&n.get(h.id)&&!s.get(h.id)){t=!0,o.push(i.splice(l,1)[0]),l--;for(let t=0;t<r.length;t++){const i=r[t];(!e&&i.targetNode===h.id||e&&i.sourceNode===h.id)&&(n.set(i.sourceNode,n.get(i.sourceNode)-1),s.set(i.targetNode,s.get(i.targetNode)-1),a.push(r.splice(t,1)[0]),t--)}}}if(!t)break}};for(;i.length;){l(!1);for(let e=0;e<i.length;e++){const t=i[e];s.get(t.id)||n.get(t.id)||(i.splice(e,1),o.push(t),e--)}if(l(!0),i.length){const e=i.reduce(((e,t,i)=>{const r=n.get(t.id)-s.get(t.id);return r>e[1]&&(e=[t,r,i]),e}),[null,0,-1]);null===e[0]&&(e[0]=i[0],e[2]=0);for(let t=0;t<r.length;t++){const l=r[t];l.sourceNode===e[0].id&&(s.set(l.targetNode,s.get(l.targetNode)-1),a.push(l),r.splice(t,1),t--),l.targetNode===e[0].id&&(n.set(l.sourceNode,n.get(l.sourceNode)-1),r.splice(t,1),t--),o.push(i.splice(e[2],1)[0])}}}return a},w=(e,t)=>{const i=e.reduce(((e,t)=>(e.push([...t]),e)),[]),r=new Map;i.forEach(((e,t)=>{e.forEach((e=>{r.set(e.id,t)}))}));const s=new Map,n=e=>{i[e].forEach(((e,t)=>{null!==e&&s.set(e.id,t)}))},o=t.filter((e=>r.get(e.sourceNode)===r.get(e.targetNode)-1)),a=new Map,l=Math.max(...i.map((e=>e.length)));i.forEach(((e,t)=>{if(a.set(t,e.length),e.length<l){let t=!1;for(let i=e.length;i<l;i++)t?e.push(null):e.unshift(null),t=!t}}));const h=(e,t)=>{const i=new Map;return e.forEach((e=>{if(null===e)return;const r=t?"sourceNode":"targetNode",n=t?"targetNode":"sourceNode";let a=[0,0];o.forEach((t=>{var i;t[r]===e.id&&(a[0]+=(i=t[n],s.get(i)),a[1]+=1)})),a=Math.floor(a[0]/a[1]),i.set(e.id,isNaN(a)?0:a)})),i};return i.forEach(((e,t)=>{if(a.get(t)===l)return;if(1===i.length)return;let r;r=0===t||t!==i.length-1&&a.get(t)>a.get(t-1),n(t),n(r?t+1:t-1);const s=h(e,r);let o=!0;for(;!0===o;){o=!1;for(let t=0;t<e.length;t++){const i=e[t];if(null===i)continue;const r=s.get(i.id),n=0!==t&&null===e[t-1],a=t!==e.length-1&&null===e[t+1];r>t&&a?(e[t+1]=i,e[t]=null,t-2>-1&&(t-=2),o=!0):r<t&&n&&(e[t-1]=i,e[t]=null,t--,o=!0)}}})),i.map((e=>e.map((e=>e&&!`${e.id}`.toUpperCase().includes("FAKE")?e:null))))};class T extends d{constructor({computeGroup:e=null,useY:t=!0,distance:i,useLine:r=!0,centerX:s=null,centerY:n=null}={}){super(),this.computeGroup=e,this.useY=t,this.distance=i,this.useLine=r,this.centerX=s,this.centerY=n,this.groups=[],this.offsetDistance=0,this.halfSize=0,this.halfWidth=0,this.orderMeasurement=0,this.offsetSizeMultiplier=4}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){super.initialize(...e);const t=this.useY?this.getHeight:this.getWidth,i=this.useY?this.getWidth:this.getHeight;this.orderMeasurement=0;let r=this.distance?this.distance:0;if(this.nodes.forEach((e=>{this.distance||(r=Math.max(r,t(e))),this.orderMeasurement=Math.max(this.orderMeasurement,i(e))})),this.offsetDistance=r*this.offsetSizeMultiplier,this.offsetDistance<250&&(this.offsetDistance=250),this.orderMeasurement*=1.5,this.computeGroup){const e={};if(this.nodes.forEach((t=>{let i=this.computeGroup(t);null==i&&(i=0),e[i]?e[i].push(t):e[i]=[t]})),this.groups=Object.keys(e).sort(((e,t)=>{const i=parseInt(e),r=parseInt(t),s=isNaN(i)?e:i,n=isNaN(r)?e:r;return s<n?-1:s>n?1:0})).map((t=>e[t])),this.useLine){const e=b(this.nodes,this.edges);this.groups=v(this.groups,e),this.groups=w(this.groups,e)}}else{let e=x(this.nodes,this.edges).map((e=>{const t=b(e,this.edges),{hierarchy:i,fakeNodesHierarchy:r,fakeEdges:s}=y(e,t);if(this.useLine){const e=i.map(((e,t)=>[...e,...r[t]])),n=[...t,...s];let o=v(e,n);return o=w(o,[...t,...s]),o}return i}));if(this.useLine){const t=e.reduce(((e,t)=>Math.max(e,t.length)),0);e.forEach((e=>{const i=Math.max(...e.map((e=>e.length)));if(e.length<t)for(let r=e.length;r<t;r++)e.push(new Array(i).fill(null))}))}e=e.reduce(((e,t)=>(t.forEach(((t,i)=>{e[i]?e[i]=[...e[i],...t]:e[i]=t})),e)),[]),this.groups=e,this.halfSize=(this.groups.length-1)*this.offsetDistance/2,this.halfWidth=Math.max(...e.map((e=>e.length)))*this.orderMeasurement/2;const t=this.getAverageCoordinates();null===this.centerX&&(this.centerX=t[0]),null===this.centerY&&(this.centerY=t[1])}}execute(){const e=this.useY?"y":"x",t=this.useY?"x":"y",i=this.useY?this.centerY:this.centerX,r=this.useY?this.centerX:this.centerY;let s,n;for(let o=0;o<this.groups.length;o++){s=this.groups[o];const a=o*this.offsetDistance-this.halfSize;for(let o=0;o<s.length;o++)n=s[o],n&&(n["f"+e]=a+i,this.useLine&&(n["f"+t]=o*this.orderMeasurement-this.halfWidth+r))}}dismount(){this.nodes.forEach((e=>{delete e.fx,delete e.fy}))}}class E extends d{constructor({useRelativeStrength:e=!1}={}){super(),this.useRelativeStrength=e,this.strengths=[],this.count=[],this.bias=[]}initialize(...e){super.initialize(...e),this.count=new Array(this.edges.length),this.bias=new Array(this.edges.length);for(let t=0;t<this.edges.length;t++){const e=this.edges[t];this.count[e.source.index]=(this.count[e.source.index]||0)+1,this.count[e.target.index]=(this.count[e.target.index]||0)+1}for(let t=0;t<this.edges.length;t++){const e=this.edges[t];this.bias[t]=this.count[e.source.index]/(this.count[e.source.index]+this.count[e.target.index]),this.strengths[t]=1/Math.min(this.count[e.source.index],this.count[e.target.index])}}execute(e){let t,i,r,s,n,o,a,l;for(let h=0;h<this.edges.length;h++)l=this.edges[h],t=l.target.x+l.target.vx-l.source.x-l.source.vx||this.randomize(),i=l.target.y+l.target.vy-l.source.y-l.source.vy||this.randomize(),r=Math.sqrt(t*t+i*i),s=(r-l.distance)/r*e*(this.useRelativeStrength?this.strengths[h]:l.strength),n=t*s,o=i*s,a=this.bias[h],l.target.vx-=n*a,l.target.vy-=o*a,a=1-a,l.source.vx+=n*a,l.source.vy+=o*a}}let C=class extends d{constructor({centerX:e=null,centerY:t=null}={}){super(),this.centerX=e,this.centerY=t,this.maxSize=0,this.numberOfRowsAndColumns=0,this.halfSize=0,this.multiplier=2}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){let t;super.initialize(...e),this.nodes=((e,t)=>{const i=new Map;return e.forEach((e=>i.set(e.id,[]))),t.forEach((t=>{t.sourceNode!==t.targetNode&&(i.get(t.sourceNode).push(e.findIndex((e=>e.id===t.targetNode))),i.get(t.targetNode).push(e.findIndex((e=>e.id===t.sourceNode))))})),x(e,t).map((e=>{const t=e.map(((e,t)=>({average:0,index:t}))),r=e=>t.findIndex((t=>t.index===e));for(let s=0;s<e.length+1;s++)e.forEach(((e,s)=>{const n=r(s);let o=n;i.get(e.id).forEach((e=>{const t=r(e);o+=t})),t[n].average=o/i.get(e.id).length+1})),t.sort(((e,t)=>e.average-t.average));return t.map((t=>e[t.index]))})).flat()})(this.nodes,this.edges),this.maxSize=0;for(let r=0;r<this.nodes.length;r++)t=this.nodes[r],this.maxSize=Math.max(this.maxSize,this.getWidth(t)*this.multiplier,this.getHeight(t)*this.multiplier);this.numberOfRowsAndColumns=Math.ceil(Math.sqrt(this.nodes.length)),this.halfSize=(this.numberOfRowsAndColumns-1)*this.maxSize/2;const i=this.getAverageCoordinates();null===this.centerX&&(this.centerX=i[0]),null===this.centerY&&(this.centerY=i[1])}execute(){let e=0,t=0;for(let i=0;i<this.nodes.length;i++){t===this.numberOfRowsAndColumns&&(t=0,e+=1),t+=1;const r=this.nodes[i];r.fx=(t-1)*this.maxSize-this.halfSize+this.centerX+r.shape.radius,r.fy=e*this.maxSize-this.halfSize+this.centerY+r.shape.radius}}dismount(){this.nodes.forEach((e=>{delete e.fx,delete e.fy}))}};class S extends d{constructor({theta:e=1.1,distanceMax:t=1/0,distanceMin:i=1,isRepulse:r=!0}={}){super(),this.theta=e,this.distanceMax=t,this.distanceMin=i,this.isRepulse=r}initialize(...e){super.initialize(...e)}execute(e){let t;this.utils.quadtree.computeMass();for(let i=0;i<this.nodes.length;i++)t=this.nodes[i],this.utils.quadtree.traverseTopBottom(((i,r,s,n)=>{if(!i.mass)return!0;let o=i.x-t.x,a=i.y-t.y;const l=n-r;let h=o*o+a*a;if(l*l/this.theta<h){if(h<this.distanceMax){0===o&&(o=this.randomize(),h+=o*o),0===a&&(a=this.randomize(),h+=a*a),h<this.distanceMin&&(h=Math.sqrt(this.distanceMin*h));const r=(this.isRepulse?-i.mass*e:i.mass*e)/h;t.vx+=o*r,t.vy+=a*r}return!0}if(i.length||h>=this.distanceMax)return!1;if(i.entity!==t||i.next){0===o&&(o=this.randomize(),h+=o*o),0===a&&(a=this.randomize(),h+=a*a),h<this.distanceMin&&(h=Math.sqrt(this.distanceMin*h));do{if(i.entity!==t){const r=(this.isRepulse?-i.mass*e:i.mass*e)/h;t.vx+=o*r,t.vy+=a*r}}while(i=i.next)}}))}}class N extends d{constructor({strength:e=.9,centerX:t=null,centerY:i=null,sizeMultiplier:r=1.2,diameter:s=null}={}){super(),this.strength=e,this.centerX=t,this.centerY=i,this.sizeMultiplier=r,this.userProvidedDiameter=s,this.diameter=0}initialize(...e){super.initialize(...e),this.diameter=this.userProvidedDiameter?this.userProvidedDiameter:this.nodes.reduce(((e,t)=>e+2*t.shape.radius),0)/3.14*this.sizeMultiplier;const t=this.getAverageCoordinates();null===this.centerX&&(this.centerX=t[0]),null===this.centerY&&(this.centerY=t[1])}execute(e){for(let t=0;t<this.nodes.length;t++){const i=this.nodes[t],r=i.x-this.centerX||1e-6,s=i.y-this.centerY||1e-6,n=Math.sqrt(r*r+s*s),o=(this.diameter-n)*this.strength*e/n;i.vx+=r*o,i.vy+=s*o}}}class A extends d{constructor({isVerticalLayout:e=!0,padding:t=100,centerX:i=null,centerY:r=null}={}){super(),this.isVerticalLayout=e,this.PADDING_PX=t,this.centerX=i,this.centerY=r,this.nodePositions=new Map}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){super.initialize(...e);const t=b(this.nodes,this.edges),{hierarchy:i}=y([...this.nodes,{id:"FAKE__ISLAND"}],t);i[0]=i[0].filter((e=>"FAKE__ISLAND"!==e.id)),i[0].length?i[0]=[...i[0],...i.splice(1,1)[0]]:i.splice(0,1);let r=0;const s=i.map((e=>{const t=Math.max(...e.map((e=>this.isVerticalLayout?this.getHeight(e):this.getWidth(e)))),i=r+t/2;return r=i+t/2+this.PADDING_PX,i})),n=new Map(this.nodes.map((e=>[e.id,new Set])));t.forEach((e=>{n.get(e.targetNode).add(e.sourceNode)}));const o=[];let a=[],l=[],h=-1;do{h++;let e=null,t=null;const r=i.splice(0,1)[0].map((i=>{const r=l.find((e=>n.get(i.id).has(e.node.id))),a=this.isVerticalLayout?this.getWidth(i):this.getHeight(i),d={node:i,children:[],size:a,parent:r,previousSibling:t===r?e:null,levelOffset:s[h],orderOffset:null,modifier:null};return r?(t=r,r.children.push(d)):o.push(d),e=d,d}));a=a.concat(...r),l=r}while(i.length);const d=e=>{if(e.children&&e.children.forEach((e=>d(e))),e.previousSibling?e.orderOffset=e.previousSibling.orderOffset+e.previousSibling.size/2+this.PADDING_PX+e.size/2:e.orderOffset=0,1==e.children.length)e.modifier=e.orderOffset;else if(e.children.length>=2){let t=1/0,i=-t;for(let r=0;r<e.children.length;r++)t=Math.min(t,e.children[r].orderOffset),i=Math.max(i,e.children[r].orderOffset);e.modifier=e.orderOffset-(i-t)/2}};o.forEach((e=>d(e)));const u=(e,t)=>{e.orderOffset=e.orderOffset+t;for(let i=0;i<e.children.length;i++)u(e.children[i],e.modifier+t)};o.forEach((e=>u(e,0)));const c=e=>{const t=[];let i=[e];do{t.push(i),i=[],t[t.length-1].forEach((e=>i=i.concat(e.children)))}while(i.length);return t.map((e=>{const t={left:1/0,right:-1/0};return e.forEach((e=>{t.left=Math.min(t.left,e.orderOffset-(this.isVerticalLayout?this.getWidth(e.node):this.getHeight(e.node))),t.right=Math.max(t.right,e.orderOffset+(this.isVerticalLayout?this.getWidth(e.node):this.getHeight(e.node)))})),t}))},p=(e,t)=>{let i=[e];for(;i.length;){const e=i.shift();i=i.concat(e.children),e.orderOffset+=t}},g=e=>{for(let t=0;t<e.children.length;t++)g(e.children[t]);for(let t=0;t<e.children.length-1;t++){const i=e.children[t],r=c(i);for(let s=t+1;s<e.children.length;s++){const t=e.children[s],i=c(t);let n=0;for(let e=0;e<Math.min(r.length,i.length);e++){const s=r[e].right,o=i[e].left+n;if(s>=o){const e=s-o+this.PADDING_PX;p(t,e),n+=e}}}}if(e.children.length){let t=0;e.children.forEach((e=>{t+=e.orderOffset})),e.orderOffset=t/e.children.length}};g({children:o}),a.forEach((e=>{this.nodePositions.set(e.node,{y:this.isVerticalLayout?e.levelOffset:e.orderOffset,x:this.isVerticalLayout?e.orderOffset:e.levelOffset})}));const f=this.getAverageCoordinates();null===this.centerX&&(this.centerX=f[0]),null===this.centerY&&(this.centerY=f[1]);let m=0,_=0;this.nodePositions.forEach((e=>{m+=e.x,_+=e.y}));const x=m/this.nodePositions.size,v=_/this.nodePositions.size,w=this.centerX-x,T=this.centerY-v;this.nodePositions.forEach((e=>{e.x=w+e.x,e.y=T+e.y}))}execute(){let e,t;for(let i=0;i<this.nodes.length;i++)e=this.nodes[i],t=this.nodePositions.get(e),e.fx=t.x,e.x=t.x,e.fy=t.y,e.y=t.y}dismount(){this.nodes.forEach((e=>{delete e.fx,delete e.fy}))}}class P extends d{constructor({size:e=null,speed:t=.2,gravity:i=.75}={}){super(),this.size=e,this.gravity=i,this.speed=t,this.nodeDisplacementMap=new Map}initialize(...e){super.initialize(...e),this.nodeDisplacementMap=new Map(this.nodes.map((e=>[e,{dx:0,dy:0}])))}execute(e){const t=this.nodes.length,i=this.edges.length,r=this.size?this.size:2e4*t,s=Math.sqrt(r)/10,n=Math.sqrt(r/(1+t));let o,a,l;for(let h=0;h<t;h++){o=this.nodes[h];const e=this.nodeDisplacementMap.get(o);for(let i=0;i<t;i++)if(a=this.nodes[i],o.id!=a.id){const t=o.x-a.x,i=o.y-a.y,r=Math.sqrt(t*t+i*i)+.01;if(r>0){const s=n*n/r;e.dx+=t/r*s,e.dy+=i/r*s}}}for(let h=0;h<i;h++){l=this.edges[h];const e=l.source.x-l.target.x,t=l.source.y-l.target.y,i=Math.sqrt(e*e+t*t)+.01,r=i*i/n,s=this.nodeDisplacementMap.get(l.source),o=this.nodeDisplacementMap.get(l.target);i>0&&(s.dx-=e/i*r,s.dy-=t/i*r,o.dx+=e/i*r,o.dy+=t/i*r)}for(let h=0;h<t;h++){o=this.nodes[h];const t=this.nodeDisplacementMap.get(o),i=Math.sqrt(o.x*o.x+o.y*o.y),r=.01*n*this.gravity*i;t.dx-=r*o.x/i,t.dy-=r*o.y/i,t.dx*=this.speed,t.dy*=this.speed;const a=Math.sqrt(t.dx*t.dx+t.dy*t.dy);if(a>0){const i=Math.min(s*this.speed,a);o.vx+=t.dx/a*i*e,o.vy+=t.dy/a*i*e}}}}class M extends d{constructor({groupBy:e=null,isVerticalLayout:t=!0,padding:i=100,centerX:r=null,centerY:s=null}={}){super(),this.groupBy=e,this.isVerticalLayout=t,this.PADDING_PX=i,this.centerX=r,this.centerY=s,this.nodePositions=new Map}getWidth(e){return e.shape.width?e.shape.width:2*e.shape.radius}getHeight(e){return e.shape.height?e.shape.height:2*e.shape.radius}initialize(...e){super.initialize(...e);let t=[];const i=b(this.nodes,this.edges);if(this.groupBy){const e={};this.nodes.forEach((t=>{const i=this.groupBy(t);e[i]||(e[i]=[]),e[i].push(t)})),Object.keys(e).sort().forEach((i=>{t.push(e[i])}))}else t=y([...this.nodes,{id:"FAKE__ISLAND"}],i).hierarchy,t[0]=t[0].filter((e=>"FAKE__ISLAND"!==e.id)),t[0].length?t[0]=[...t[0],...t.splice(1,1)[0]]:t.splice(0,1);let r=0;const s=t.map((e=>{const t=Math.max(...e.map((e=>this.isVerticalLayout?this.getHeight(e):this.getWidth(e)))),i=r+t/2;return r=i+t/2+this.PADDING_PX,i})),n=t.reduce(((e,t)=>{const i=t.reduce(((e,t)=>e+=this.isVerticalLayout?this.getWidth(t):this.getHeight(t)),0)+this.PADDING_PX*(t.length-1);return i>e?i:e}),1),o=new Map(this.nodes.map((e=>[e.id,new Set])));i.forEach((e=>{o.get(e.targetNode).add(e.sourceNode)}));let a=null;t.map((e=>{if(null===a)return void(a=e);const t=new Map,i=e=>{if(t.has(e))return t.get(e);const i=a.findIndex((t=>o.get(e).has(t.id)));return t.set(e,"number"==typeof i?i:-1),i};e.sort(((e,t)=>{const r=i(e.id),s=i(t.id);return r>s?1:r<s?-1:0})),a=e})),this.nodePositions=new Map;const l=new Map(this.nodes.map((e=>[e.id,this.isVerticalLayout?this.getWidth(e):this.getHeight(e)])));t.forEach(((e,t)=>{const i=e.reduce(((e,t)=>e+=l.get(t.id)),0),r=(n-i)/(e.length-1);let o=0;if(1===e.length){const i=e[0],r=n/2;this.nodePositions.set(i,{y:this.isVerticalLayout?r:s[t],x:this.isVerticalLayout?s[t]:r})}else e.forEach((e=>{const i=l.get(e.id),n=o+i/2;o=n+r+i/2,this.nodePositions.set(e,{y:this.isVerticalLayout?n:s[t],x:this.isVerticalLayout?s[t]:n})}))}));const h=this.getAverageCoordinates();null===this.centerX&&(this.centerX=h[0]),null===this.centerY&&(this.centerY=h[1]);let d=0,u=0;this.nodePositions.forEach((e=>{d+=e.x,u+=e.y}));const c=d/this.nodePositions.size,p=u/this.nodePositions.size,g=this.centerX-c,f=this.centerY-p;this.nodePositions.forEach((e=>{e.x=g+e.x,e.y=f+e.y}))}execute(){let e,t;for(let i=0;i<this.nodes.length;i++)e=this.nodes[i],t=this.nodePositions.get(e),e.fx=t.x,e.x=t.x,e.fy=t.y,e.y=t.y}dismount(){this.nodes.forEach((e=>{delete e.fx,delete e.fy}))}}const R=Object.freeze(Object.defineProperty({__proto__:null,Animation:class extends d{constructor({xDestination:e=0,yDestination:t=0,strength:i=1,removeForceOnDestination:r=!0}={}){super(),this.xDestination=e,this.yDestination=t,this.strength=i,this.removeForceOnDestination=r}initialize(...e){super.initialize(...e)}execute(e){let t,i,r,s=0;for(let n=0;n<this.nodes.length;n++){t=this.nodes[n],i=t.targetX?t.targetX:this.xDestination,r=t.targetY?t.targetY:this.yDestination,!t.fx&&(t.fx=t.x),!t.fy&&(t.fy=t.y);const o=(i-t.x)*this.strength*e/2,a=(r-t.y)*this.strength*e/2;o>1?t.fx+=o:t.fx=i,a>1?t.fy+=a:t.fy=r,t.fx===i&&t.fy===r&&s++}if(this.removeForceOnDestination&&s===this.nodes.length){for(let e=0;e<this.nodes.length;e++)t=this.nodes[e],t.x=t.fx,t.y=t.fy,t.vx=0,t.vy=0,t.fx=void 0,t.fy=void 0;this.utils.remove()}}},Attraction:u,BoundingBox:c,Center:p,Cluster:g,Collision:f,Connections:M,D3Adapter:class extends d{constructor(e){super(),this.d3force=e}initialize(e,t,i){super.initialize(e,t,i),this.d3force.links&&"function"==typeof this.d3force.links&&this.d3force.links(t),this.d3force.initialize&&"function"==typeof this.d3force.initialize&&this.d3force.initialize(e,this.random)}execute(e){this.d3force(e)}},Fan:m,Force:P,Grid:_,Hierarchy:T,LayoutComponent:d,Link:E,Matrix:C,NBody:S,Radial:N,Tree:A},Symbol.toStringTag,{value:"Module"})),k={},B=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),n=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));r=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,i),t in k)return;k[t]=!0;const r=t.endsWith(".css"),s=r?'[rel="stylesheet"]':"";if(!!i)for(let i=e.length-1;i>=0;i--){const s=e[i];if(s.href===t&&(!r||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${t}"]${s}`))return;const o=document.createElement("link");return o.rel=r?"stylesheet":"modulepreload",r||(o.as="script"),o.crossOrigin="",o.href=t,n&&o.setAttribute("nonce",n),document.head.appendChild(o),r?new Promise(((e,i)=>{o.addEventListener("load",e),o.addEventListener("error",(()=>i(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))};var I=(e=>(e.Application="application",e.WebGLPipes="webgl-pipes",e.WebGLPipesAdaptor="webgl-pipes-adaptor",e.WebGLSystem="webgl-system",e.WebGPUPipes="webgpu-pipes",e.WebGPUPipesAdaptor="webgpu-pipes-adaptor",e.WebGPUSystem="webgpu-system",e.CanvasSystem="canvas-system",e.CanvasPipesAdaptor="canvas-pipes-adaptor",e.CanvasPipes="canvas-pipes",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e.MaskEffect="mask-effect",e.BlendMode="blend-mode",e.TextureSource="texture-source",e.Environment="environment",e.ShapeBuilder="shape-builder",e.Batcher="batcher",e))(I||{});const O=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"!=typeof e)throw new Error("Invalid extension type");return"string"==typeof(e={...e}).type&&(e.type=[e.type]),e},D=(e,t)=>O(e).priority??t,G={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(O).forEach((e=>{e.type.forEach((t=>{var i,r;return null==(r=(i=this._removeHandlers)[t])?void 0:r.call(i,e)}))})),this},add(...e){return e.map(O).forEach((e=>{e.type.forEach((t=>{var i,r;const s=this._addHandlers,n=this._queue;s[t]?null==(r=s[t])||r.call(s,e):(n[t]=n[t]||[],null==(i=n[t])||i.push(e))}))})),this},handle(e,t,i){var r;const s=this._addHandlers,n=this._removeHandlers;if(s[e]||n[e])throw new Error(`Extension type ${e} already has a handler`);s[e]=t,n[e]=i;const o=this._queue;return o[e]&&(null==(r=o[e])||r.forEach((e=>t(e))),delete o[e]),this},handleByMap(e,t){return this.handle(e,(e=>{e.name&&(t[e.name]=e.ref)}),(e=>{e.name&&delete t[e.name]}))},handleByNamedList(e,t,i=-1){return this.handle(e,(e=>{t.findIndex((t=>t.name===e.name))>=0||(t.push({name:e.name,value:e.ref}),t.sort(((e,t)=>D(t.value,i)-D(e.value,i))))}),(e=>{const i=t.findIndex((t=>t.name===e.name));-1!==i&&t.splice(i,1)}))},handleByList(e,t,i=-1){return this.handle(e,(e=>{t.includes(e.ref)||(t.push(e.ref),t.sort(((e,t)=>D(t,i)-D(e,i))))}),(e=>{const i=t.indexOf(e.ref);-1!==i&&t.splice(i,1)}))},mixin(e,...t){for(const i of t)Object.defineProperties(e.prototype,Object.getOwnPropertyDescriptors(i))}},L={extension:{type:I.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await B((()=>Promise.resolve().then((()=>rp))),void 0,import.meta.url)}},F={extension:{type:I.Environment,name:"webworker",priority:0},test:()=>"undefined"!=typeof self&&void 0!==self.WorkerGlobalScope,load:async()=>{await B((()=>Promise.resolve().then((()=>sp))),void 0,import.meta.url)}};class U{constructor(e,t,i){this._x=t||0,this._y=i||0,this._observer=e}clone(e){return new U(e??this._observer,this._x,this._y)}set(e=0,t=e){return this._x===e&&this._y===t||(this._x=e,this._y=t,this._observer._onUpdate(this)),this}copyFrom(e){return this._x===e.x&&this._y===e.y||(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=0 y=0 scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}function z(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var H,W={exports:{}};const V=z((H||(H=1,function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||e,o),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,o=new Array(n);s<n;s++)o[s]=r[s].fn;return o},a.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,s,n,o){var a=i?i+e:e;if(!this._events[a])return!1;var l,h,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,s),!0;case 5:return d.fn.call(d.context,t,r,s,n),!0;case 6:return d.fn.call(d.context,t,r,s,n,o),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];d.fn.apply(d.context,l)}else{var c,p=d.length;for(h=0;h<p;h++)switch(d[h].once&&this.removeListener(e,d[h].fn,void 0,!0),u){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,t);break;case 3:d[h].fn.call(d[h].context,t,r);break;case 4:d[h].fn.call(d[h].context,t,r,s);break;default:if(!l)for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d[h].fn.apply(d[h].context,l)}}return!0},a.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,r,s){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||s&&!a.once||r&&a.context!==r||o(this,n);else{for(var l=0,h=[],d=a.length;l<d;l++)(a[l].fn!==t||s&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:o(this,n)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(W)),W.exports)),X=2*Math.PI,Y=180/Math.PI,j=Math.PI/180;class K{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new K(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return $.x=0,$.y=0,$}}const $=new K;class q{constructor(e=1,t=0,i=0,r=1,s=0,n=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=r,this.tx=s,this.ty=n}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,r,s,n){return this.a=e,this.b=t,this.c=i,this.d=r,this.tx=s,this.ty=n,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new K;const i=e.x,r=e.y;return t.x=this.a*i+this.c*r+this.tx,t.y=this.b*i+this.d*r+this.ty,t}applyInverse(e,t){t=t||new K;const i=this.a,r=this.b,s=this.c,n=this.d,o=this.tx,a=this.ty,l=1/(i*n+s*-r),h=e.x,d=e.y;return t.x=n*l*h+-s*l*d+(a*s-o*n)*l,t.y=i*l*d+-r*l*h+(-a*i+o*r)*l,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.a,s=this.c,n=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=s*t-this.d*i,this.d=s*i+this.d*t,this.tx=n*t-this.ty*i,this.ty=n*i+this.ty*t,this}append(e){const t=this.a,i=this.b,r=this.c,s=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*i+e.b*s,this.c=e.c*t+e.d*r,this.d=e.c*i+e.d*s,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*i+e.ty*s+this.ty,this}appendFrom(e,t){const i=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=t.a,h=t.b,d=t.c,u=t.d;return this.a=i*l+r*d,this.b=i*h+r*u,this.c=s*l+n*d,this.d=s*h+n*u,this.tx=o*l+a*d+t.tx,this.ty=o*h+a*u+t.ty,this}setTransform(e,t,i,r,s,n,o,a,l){return this.a=Math.cos(o+l)*s,this.b=Math.sin(o+l)*s,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=e-(i*this.a+r*this.c),this.ty=t-(i*this.b+r*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,i=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,r=this.c,s=this.d,n=e.pivot,o=-Math.atan2(-r,s),a=Math.atan2(i,t),l=Math.abs(o+a);return l<1e-5||Math.abs(X-l)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(r*r+s*s),e.position.x=this.tx+(n.x*t+n.y*r),e.position.y=this.ty+(n.x*i+n.y*s),e}invert(){const e=this.a,t=this.b,i=this.c,r=this.d,s=this.tx,n=e*r-t*i;return this.a=r/n,this.b=-t/n,this.c=-i/n,this.d=e/n,this.tx=(i*this.ty-r*s)/n,this.ty=-(e*this.ty-t*s)/n,this}isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new q;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return J.identity()}static get shared(){return Z.identity()}}const Z=new q,J=new q,Q=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ee=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],te=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ie=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],re=[],se=[],ne=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];re.push(t);for(let i=0;i<16;i++){const r=ne(Q[e]*Q[i]+te[e]*ee[i]),s=ne(ee[e]*Q[i]+ie[e]*ee[i]),n=ne(Q[e]*te[i]+te[e]*ie[i]),o=ne(ee[e]*te[i]+ie[e]*ie[i]);for(let e=0;e<16;e++)if(Q[e]===r&&ee[e]===s&&te[e]===n&&ie[e]===o){t.push(e);break}}}for(let e=0;e<16;e++){const t=new q;t.set(Q[e],ee[e],te[e],ie[e],0,0),se.push(t)}}();const oe={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Q[e],uY:e=>ee[e],vX:e=>te[e],vY:e=>ie[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>re[e][t],sub:(e,t)=>re[e][oe.inv(t)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?oe.S:oe.N:2*Math.abs(t)<=Math.abs(e)?e>0?oe.E:oe.W:t>0?e>0?oe.SE:oe.SW:e>0?oe.NE:oe.NW,matrixAppendRotationInv:(e,t,i=0,r=0)=>{const s=se[oe.inv(t)];s.tx=i,s.ty=r,e.append(s)}},ae=[new K,new K,new K,new K];let le=class e{constructor(e=0,t=0,i=0,r=0){this.type="rectangle",this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new e(0,0,0,0)}clone(){return new e(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height)}strokeContains(e,t,i,r=.5){const{width:s,height:n}=this;if(s<=0||n<=0)return!1;const o=this.x,a=this.y,l=i*(1-r),h=i-l;return e>=o-l&&e<=o+s+l&&t>=a-l&&t<=a+n+l&&!(e>o+h&&e<o+s-h&&t>a+h&&t<a+n-h)}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const i=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>i}const i=this.left,r=this.right,s=this.top,n=this.bottom;if(r<=i||n<=s)return!1;const o=ae[0].set(e.left,e.top),a=ae[1].set(e.left,e.bottom),l=ae[2].set(e.right,e.top),h=ae[3].set(e.right,e.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const d=Math.sign(t.a*t.d-t.b*t.c);if(0===d)return!1;if(t.apply(o,o),t.apply(a,a),t.apply(l,l),t.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=i||Math.min(o.x,a.x,l.x,h.x)>=r||Math.max(o.y,a.y,l.y,h.y)<=s||Math.min(o.y,a.y,l.y,h.y)>=n)return!1;const u=d*(a.y-o.y),c=d*(o.x-a.x),p=u*i+c*s,g=u*r+c*s,f=u*i+c*n,m=u*r+c*n;if(Math.max(p,g,f,m)<=u*o.x+c*o.y||Math.min(p,g,f,m)>=u*h.x+c*h.y)return!1;const _=d*(o.y-l.y),y=d*(l.x-o.x),x=_*i+y*s,v=_*r+y*s,b=_*i+y*n,w=_*r+y*n;return!(Math.max(x,v,b,w)<=_*o.x+y*o.y||Math.min(x,v,b,w)>=_*h.x+y*h.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=r,this.height=Math.max(s-r,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=r-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=r,this.height=s-r,this}getBounds(t){return t||(t=new e),t.copyFrom(this),t}containsRect(e){if(this.width<=0||this.height<=0)return!1;const t=e.x,i=e.y,r=e.x+e.width,s=e.y+e.height;return t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height&&r>=this.x&&r<this.x+this.width&&s>=this.y&&s<this.y+this.height}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};const he={default:-1};function de(e="default"){return void 0===he[e]&&(he[e]=-1),++he[e]}const ue={},ce="8.0.0";function pe(e,t,i=3){if(ue[t])return;let r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}\nDeprecated since v${e}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}\nDeprecated since v${e}`),console.warn(r))),ue[t]=!0}const ge=()=>{};function fe(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function me(e){return!(e&e-1||!e)}function _e(e){const t={};for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}const ye=Object.create(null);const xe=class e extends V{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...e.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){pe(ce,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=function(e){const t=ye[e];return void 0===t&&(ye[e]=de("resource")),t}(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};xe.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ve=xe;const be=class e extends V{constructor(t={}){super(),this.options=t,this.uid=de("textureSource"),this._resourceType="textureSource",this._resourceId=de("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...e.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new ve(_e(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){var t,i;this.style!==e&&(null==(t=this._style)||t.off("change",this._onStyleChange,this),this._style=e,null==(i=this._style)||i.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=de("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,t,i){i||(i=this._resolution),e||(e=this.width),t||(t=this.height);const r=Math.round(e*i),s=Math.round(t*i);return this.width=r/i,this.height=s/i,this._resolution=i,(this.pixelWidth!==r||this.pixelHeight!==s)&&(this._refreshPOT(),this.pixelWidth=r,this.pixelHeight=s,this.emit("resize",this),this._resourceId=de("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=me(this.pixelWidth)&&me(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};be.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let we=be;class Te extends we{constructor(e){const t=e.resource||new Float32Array(e.width*e.height*4);let i=e.format;i||(i=t instanceof Float32Array?"rgba32float":t instanceof Int32Array||t instanceof Uint32Array?"rgba32uint":t instanceof Int16Array||t instanceof Uint16Array?"rgba16uint":(Int8Array,"bgra8unorm")),super({...e,resource:t,format:i}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}Te.extension=I.TextureSource;const Ee=new q;class Ce{constructor(e,t){this.mapCoord=new q,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===t?e.width<10?0:.5:t,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){var t;this.texture!==e&&(null==(t=this._texture)||t.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,t){void 0===t&&(t=e);const i=this.mapCoord;for(let r=0;r<e.length;r+=2){const s=e[r],n=e[r+1];t[r]=s*i.a+n*i.c+i.tx,t[r+1]=s*i.b+n*i.d+i.ty}return t}update(){const e=this._texture;this._updateID++;const t=e.uvs;this.mapCoord.set(t.x1-t.x0,t.y1-t.y0,t.x3-t.x0,t.y3-t.y0,t.x0,t.y0);const i=e.orig,r=e.trim;r&&(Ee.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Ee));const s=e.source,n=this.uClampFrame,o=this.clampMargin/s._resolution,a=this.clampOffset/s._resolution;return n[0]=(e.frame.x+o+a)/s.width,n[1]=(e.frame.y+o+a)/s.height,n[2]=(e.frame.x+e.frame.width-o+a)/s.width,n[3]=(e.frame.y+e.frame.height-o+a)/s.height,this.uClampOffset[0]=this.clampOffset/s.pixelWidth,this.uClampOffset[1]=this.clampOffset/s.pixelHeight,this.isSimple=e.frame.width===s.width&&e.frame.height===s.height&&0===e.rotate,!0}}class Se extends V{constructor({source:e,label:t,frame:i,orig:r,trim:s,defaultAnchor:n,defaultBorders:o,rotate:a,dynamic:l}={}){if(super(),this.uid=de("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new le,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=t,this.source=(null==e?void 0:e.source)??new we,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:e,height:t}=this._source;this.frame.width=e,this.frame.height=t}this.orig=r||this.frame,this.trim=s,this.rotate=a??0,this.defaultAnchor=n,this.defaultBorders=o,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ce(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:t}=this,{width:i,height:r}=this._source,s=t.x/i,n=t.y/r,o=t.width/i,a=t.height/r;let l=this.rotate;if(l){const t=o/2,i=a/2,r=s+t,h=n+i;l=oe.add(l,oe.NW),e.x0=r+t*oe.uX(l),e.y0=h+i*oe.uY(l),l=oe.add(l,2),e.x1=r+t*oe.uX(l),e.y1=h+i*oe.uY(l),l=oe.add(l,2),e.x2=r+t*oe.uX(l),e.y2=h+i*oe.uY(l),l=oe.add(l,2),e.x3=r+t*oe.uX(l),e.y3=h+i*oe.uY(l)}else e.x0=s,e.y0=n,e.x1=s+o,e.y1=n,e.x2=s+o,e.y2=n+a,e.x3=s,e.y3=n+a}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return pe(ce,"Texture.baseTexture is now Texture.source"),this._source}}function Ne(e,t,i){const{width:r,height:s}=i.orig,n=i.trim;if(n){const i=n.width,o=n.height;e.minX=n.x-t._x*r,e.maxX=e.minX+i,e.minY=n.y-t._y*s,e.maxY=e.minY+o}else e.minX=-t._x*r,e.maxX=e.minX+r,e.minY=-t._y*s,e.maxY=e.minY+s}Se.EMPTY=new Se({label:"EMPTY",source:new we({label:"EMPTY"})}),Se.EMPTY.destroy=ge,Se.WHITE=new Se({source:new Te({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"}),Se.WHITE.destroy=ge;const Ae=new q;class Pe{constructor(e=1/0,t=1/0,i=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ae,this.minX=e,this.minY=t,this.maxX=i,this.maxY=r}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new le);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ae,this}set(e,t,i,r){this.minX=e,this.minY=t,this.maxX=i,this.maxY=r}addFrame(e,t,i,r,s){s||(s=this.matrix);const n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,d=s.ty;let u=this.minX,c=this.minY,p=this.maxX,g=this.maxY,f=n*e+a*t+h,m=o*e+l*t+d;f<u&&(u=f),m<c&&(c=m),f>p&&(p=f),m>g&&(g=m),f=n*i+a*t+h,m=o*i+l*t+d,f<u&&(u=f),m<c&&(c=m),f>p&&(p=f),m>g&&(g=m),f=n*e+a*r+h,m=o*e+l*r+d,f<u&&(u=f),m<c&&(c=m),f>p&&(p=f),m>g&&(g=m),f=n*i+a*r+h,m=o*i+l*r+d,f<u&&(u=f),m<c&&(c=m),f>p&&(p=f),m>g&&(g=m),this.minX=u,this.minY=c,this.maxX=p,this.maxY=g}addRect(e,t){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,t)}addBounds(e,t){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,t)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const t=this.minX,i=this.minY,r=this.maxX,s=this.maxY,{a:n,b:o,c:a,d:l,tx:h,ty:d}=e;let u=n*t+a*i+h,c=o*t+l*i+d;this.minX=u,this.minY=c,this.maxX=u,this.maxY=c,u=n*r+a*i+h,c=o*r+l*i+d,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY,u=n*t+a*s+h,c=o*t+l*s+d,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY,u=n*r+a*s+h,c=o*r+l*s+d,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,t,i,r){return this.minX<e&&(this.minX=e),this.maxX>t&&(this.maxX=t),this.minY<i&&(this.minY=i),this.maxY>r&&(this.maxY=r),this}pad(e,t=e){return this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Pe(this.minX,this.minY,this.maxX,this.maxY)}scale(e,t=e){return this.minX*=e,this.minY*=t,this.maxX*=e,this.maxY*=t,this}get x(){return this.minX}set x(e){const t=this.maxX-this.minX;this.minX=e,this.maxX=e+t}get y(){return this.minY}set y(e){const t=this.maxY-this.minY;this.minY=e,this.maxY=e+t}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,t,i,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;r||(r=this.matrix);const l=r.a,h=r.b,d=r.c,u=r.d,c=r.tx,p=r.ty;for(let g=t;g<i;g+=2){const t=e[g],i=e[g+1],r=l*t+d*i+c,f=h*t+u*i+p;s=r<s?r:s,n=f<n?f:n,o=r>o?r:o,a=f>a?f:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}containsPoint(e,t){return this.minX<=e&&this.minY<=t&&this.maxX>=e&&this.maxY>=t}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var Me={grad:.9,turn:360,rad:360/(2*Math.PI)},Re=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},ke=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},Be=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},Ie=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},Oe=function(e){return{r:Be(e.r,0,255),g:Be(e.g,0,255),b:Be(e.b,0,255),a:Be(e.a)}},De=function(e){return{r:ke(e.r),g:ke(e.g),b:ke(e.b),a:ke(e.a,3)}},Ge=/^#([0-9a-f]{3,8})$/i,Le=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Fe=function(e){var t=e.r,i=e.g,r=e.b,s=e.a,n=Math.max(t,i,r),o=n-Math.min(t,i,r),a=o?n===t?(i-r)/o:n===i?2+(r-t)/o:4+(t-i)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},Ue=function(e){var t=e.h,i=e.s,r=e.v,s=e.a;t=t/360*6,i/=100,r/=100;var n=Math.floor(t),o=r*(1-i),a=r*(1-(t-n)*i),l=r*(1-(1-t+n)*i),h=n%6;return{r:255*[r,a,o,o,l,r][h],g:255*[l,r,r,a,o,o][h],b:255*[o,o,l,r,r,a][h],a:s}},ze=function(e){return{h:Ie(e.h),s:Be(e.s,0,100),l:Be(e.l,0,100),a:Be(e.a)}},He=function(e){return{h:ke(e.h),s:ke(e.s),l:ke(e.l),a:ke(e.a,3)}},We=function(e){return Ue((i=(t=e).s,{h:t.h,s:(i*=((r=t.l)<50?r:100-r)/100)>0?2*i/(r+i)*100:0,v:r+i,a:t.a}));var t,i,r},Ve=function(e){return{h:(t=Fe(e)).h,s:(s=(200-(i=t.s))*(r=t.v)/100)>0&&s<200?i*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,i,r,s},Xe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ye=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,je=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ke=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$e={string:[[function(e){var t=Ge.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?ke(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?ke(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=je.exec(e)||Ke.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:Oe({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Xe.exec(e)||Ye.exec(e);if(!t)return null;var i,r,s=ze({h:(i=t[1],r=t[2],void 0===r&&(r="deg"),Number(i)*(Me[r]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return We(s)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,r=e.b,s=e.a,n=void 0===s?1:s;return Re(t)&&Re(i)&&Re(r)?Oe({r:Number(t),g:Number(i),b:Number(r),a:Number(n)}):null},"rgb"],[function(e){var t=e.h,i=e.s,r=e.l,s=e.a,n=void 0===s?1:s;if(!Re(t)||!Re(i)||!Re(r))return null;var o=ze({h:Number(t),s:Number(i),l:Number(r),a:Number(n)});return We(o)},"hsl"],[function(e){var t=e.h,i=e.s,r=e.v,s=e.a,n=void 0===s?1:s;if(!Re(t)||!Re(i)||!Re(r))return null;var o,a=(o={h:Number(t),s:Number(i),v:Number(r),a:Number(n)},{h:Ie(o.h),s:Be(o.s,0,100),v:Be(o.v,0,100),a:Be(o.a)});return Ue(a)},"hsv"]]},qe=function(e,t){for(var i=0;i<t.length;i++){var r=t[i][0](e);if(r)return[r,t[i][1]]}return[null,void 0]},Ze=function(e,t){var i=Ve(e);return{h:i.h,s:Be(i.s+100*t,0,100),l:i.l,a:i.a}},Je=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},Qe=function(e,t){var i=Ve(e);return{h:i.h,s:i.s,l:Be(i.l+100*t,0,100),a:i.a}},et=function(){function e(e){this.parsed=function(e){return"string"==typeof e?qe(e.trim(),$e.string):"object"==typeof e&&null!==e?qe(e,$e.object):[null,void 0]}(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return ke(Je(this.rgba),2)},e.prototype.isDark=function(){return Je(this.rgba)<.5},e.prototype.isLight=function(){return Je(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=De(this.rgba)).r,i=e.g,r=e.b,n=(s=e.a)<1?Le(ke(255*s)):"","#"+Le(t)+Le(i)+Le(r)+n;var e,t,i,r,s,n},e.prototype.toRgb=function(){return De(this.rgba)},e.prototype.toRgbString=function(){return t=(e=De(this.rgba)).r,i=e.g,r=e.b,(s=e.a)<1?"rgba("+t+", "+i+", "+r+", "+s+")":"rgb("+t+", "+i+", "+r+")";var e,t,i,r,s},e.prototype.toHsl=function(){return He(Ve(this.rgba))},e.prototype.toHslString=function(){return t=(e=He(Ve(this.rgba))).h,i=e.s,r=e.l,(s=e.a)<1?"hsla("+t+", "+i+"%, "+r+"%, "+s+")":"hsl("+t+", "+i+"%, "+r+"%)";var e,t,i,r,s},e.prototype.toHsv=function(){return e=Fe(this.rgba),{h:ke(e.h),s:ke(e.s),v:ke(e.v),a:ke(e.a,3)};var e},e.prototype.invert=function(){return tt({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),tt(Ze(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),tt(Ze(this.rgba,-e))},e.prototype.grayscale=function(){return tt(Ze(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),tt(Qe(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),tt(Qe(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?tt({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):ke(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=Ve(this.rgba);return"number"==typeof e?tt({h:e,s:t.s,l:t.l,a:t.a}):ke(t.h)},e.prototype.isEqual=function(e){return this.toHex()===tt(e).toHex()},e}(),tt=function(e){return e instanceof et?e:new et(e)},it=[];[function(e,t){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in i)r[i[s]]=s;var n={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=r[this.toHex()];if(a)return a;if(null==t?void 0:t.closest){var l=this.toRgb(),h=1/0,d="black";if(!n.length)for(var u in i)n[u]=new e(i[u]).toRgb();for(var c in i){var p=(s=l,o=n[c],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));p<h&&(h=p,d=c)}return d}},t.string.push([function(t){var r=t.toLowerCase(),s="transparent"===r?"#0000":i[r];return s?new e(s).toRgb():null},"name"])}].forEach((function(e){it.indexOf(e)<0&&(e(et,$e),it.push(e))}));const rt=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set Color#value to null");null!==this._value&&this._isSourceEqual(this._value,t)||(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}_isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if("number"===i||"string"===i||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every(((e,i)=>e===t[i]));if(null!==e&&null!==t){const i=Object.keys(e),r=Object.keys(t);return i.length===r.length&&i.every((i=>e[i]===t[i]))}return e===t}toRgba(){const[e,t,i,r]=this._components;return{r:e,g:t,b:i,a:r}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,r]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(255*t),e[1]=Math.round(255*i),e[2]=Math.round(255*r),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[t,i,r,s]=this._components;return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[t,i,r]=this._components;return e[0]=t,e[1]=i,e[2]=r,e}toNumber(){return this._int}toBgrNumber(){const[e,t,i]=this.toUint8RgbArray();return(i<<16)+(t<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){const[i,r,s,n]=e._temp.setValue(t)._components;return this._components[0]*=i,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return(255<<24)+this._int;if(0===e)return t?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,s=255&this._int;return t&&(i=i*e+.5|0,r=r*e+.5|0,s=s*e+.5|0),(255*e<<24)+(i<<16)+(r<<8)+s}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(t){let i,r,s,n;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){i=(t>>16&255)/255,r=(t>>8&255)/255,s=(255&t)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[i,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[i,r,s,n=255]=t,i/=255,r/=255,s/=255,n/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const i=e.HEX_PATTERN.exec(t);i&&(t=`#${i[2]}`)}const o=tt(t);o.isValid()&&(({r:i,g:r,b:s,a:n}=o.rgba),i/=255,r/=255,s/=255)}if(void 0===i)throw new Error(`Unable to convert color ${t}`);this._components[0]=i,this._components[1]=r,this._components[2]=s,this._components[3]=n,this._refreshInt()}_refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*i|0)}_clamp(e,t=0,i=1){return"number"==typeof e?Math.min(Math.max(e,t),i):(e.forEach(((r,s)=>{e[s]=Math.min(Math.max(r,t),i)})),e)}static isColorLike(t){return"number"==typeof t||"string"==typeof t||t instanceof Number||t instanceof e||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||void 0!==t.r&&void 0!==t.g&&void 0!==t.b||void 0!==t.r&&void 0!==t.g&&void 0!==t.b&&void 0!==t.a||void 0!==t.h&&void 0!==t.s&&void 0!==t.l||void 0!==t.h&&void 0!==t.s&&void 0!==t.l&&void 0!==t.a||void 0!==t.h&&void 0!==t.s&&void 0!==t.v||void 0!==t.h&&void 0!==t.s&&void 0!==t.v&&void 0!==t.a}};rt.shared=new rt,rt._temp=new rt,rt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let st=rt;class nt{constructor(e,t){this._pool=[],this._count=0,this._index=0,this._classType=e,t&&this.prepopulate(t)}prepopulate(e){for(let t=0;t<e;t++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){var t;let i;return i=this._index>0?this._pool[--this._index]:new this._classType,null==(t=i.init)||t.call(i,e),i}return(e){var t;null==(t=e.reset)||t.call(e),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}const ot=new class{constructor(){this._poolsByClass=new Map}prepopulate(e,t){this.getPool(e).prepopulate(t)}get(e,t){return this.getPool(e).get(t)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new nt(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach((t=>{const i=e[t._classType.name]?t._classType.name+t._classType.ID:t._classType.name;e[i]={free:t.totalFree,used:t.totalUsed,size:t.totalSize}})),e}},at={get isCachedAsTexture(){var e;return!!(null==(e=this.renderGroup)?void 0:e.isCachedAsTexture)},cacheAsTexture(e){"boolean"==typeof e&&!1===e?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(!0===e?{}:e))},updateCacheTexture(){var e;null==(e=this.renderGroup)||e.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(e){pe("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(e)}};function lt(e,t,i){const r=e.length;let s;if(t>=r||0===i)return;const n=r-(i=t+i>r?r-t:i);for(s=t;s<n;++s)e[s]=e[s+i];e.length=n}const ht={allowChildren:!0,removeChildren(e=0,t){const i=t??this.children.length,r=i-e,s=[];if(r>0&&r<=i){for(let r=i-1;r>=e;r--){const e=this.children[r];e&&(s.push(e),e.parent=null)}lt(this.children,e,i);const t=this.renderGroup||this.parentRenderGroup;t&&t.removeChildren(s);for(let e=0;e<s.length;++e)this.emit("childRemoved",s[e],this,e),s[e].emit("removed",this);return s.length>0&&this._didViewChangeTick++,s}if(0===r&&0===this.children.length)return s;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(e){const t=this.getChildAt(e);return this.removeChild(t)},getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]},setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(e),this.addChildAt(e,t)},getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(e,t){this.allowChildren||pe(ce,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:i}=this;if(t<0||t>i.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${i.length}`);if(e.parent){const i=e.parent.children.indexOf(e);if(e.parent===this&&i===t)return e;-1!==i&&e.parent.children.splice(i,1)}t===i.length?i.push(e):i.splice(t,0,e),e.parent=this,e.didChange=!0,e._updateFlags=15;const r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(e),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",e,this,t),e.emit("added",this),e},swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var e;null==(e=this.parent)||e.removeChild(this)},reparentChild(...e){return 1===e.length?this.reparentChildAt(e[0],this.children.length):(e.forEach((e=>this.reparentChildAt(e,this.children.length))),e[0])},reparentChildAt(e,t){if(e.parent===this)return this.setChildIndex(e,t),e;const i=e.worldTransform.clone();e.removeFromParent(),this.addChildAt(e,t);const r=this.worldTransform.clone();return r.invert(),i.prepend(r),e.setFromMatrix(i),e}},dt={collectRenderables(e,t,i){this.parentRenderLayer&&this.parentRenderLayer!==i||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(e,t,i):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,e):this.collectRenderablesWithEffects(e,t,i))},collectRenderablesSimple(e,t,i){const r=this.children,s=r.length;for(let n=0;n<s;n++)r[n].collectRenderables(e,t,i)},collectRenderablesWithEffects(e,t,i){const{renderPipes:r}=t;for(let s=0;s<this.effects.length;s++){const t=this.effects[s];r[t.pipe].push(t,this,e)}this.collectRenderablesSimple(e,t,i);for(let s=this.effects.length-1;s>=0;s--){const t=this.effects[s];r[t.pipe].pop(t,this,e)}}};class ut{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}const ct=new class{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach((e=>{this.add({test:e.test,maskClass:e})})))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let t=0;t<this._tests.length;t++){const i=this._tests[t];if(i.test(e))return ot.get(i.maskClass,e)}return e}returnMaskEffect(e){ot.return(e)}};G.handleByList(I.MaskEffect,ct._effectClasses);const pt={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const e=this.renderGroup||this.parentRenderGroup;e&&(e.structureDidChange=!0)},addEffect(e){-1===this.effects.indexOf(e)&&(this.effects.push(e),this.effects.sort(((e,t)=>e.priority-t.priority)),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(e){const t=this.effects.indexOf(e);-1!==t&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(e){const t=this._maskEffect;(null==t?void 0:t.mask)!==e&&(t&&(this.removeEffect(t),ct.returnMaskEffect(t),this._maskEffect=null),null!=e&&(this._maskEffect=ct.getMaskEffect(e),this.addEffect(this._maskEffect)))},setMask(e){this._maskOptions={...this._maskOptions,...e},e.mask&&(this.mask=e.mask),this._markStructureAsChanged()},get mask(){var e;return null==(e=this._maskEffect)?void 0:e.mask},set filters(e){var t;!Array.isArray(e)&&e&&(e=[e]);const i=this._filterEffect||(this._filterEffect=new ut),r=(null==e?void 0:e.length)>0,s=r!==(null==(t=i.filters)?void 0:t.length)>0;e=Array.isArray(e)?e.slice(0):e,i.filters=Object.freeze(e),s&&(r?this.addEffect(i):(this.removeEffect(i),i.filters=e??null))},get filters(){var e;return null==(e=this._filterEffect)?void 0:e.filters},set filterArea(e){this._filterEffect||(this._filterEffect=new ut),this._filterEffect.filterArea=e},get filterArea(){var e;return null==(e=this._filterEffect)?void 0:e.filterArea}},gt={label:null,get name(){return pe(ce,"Container.name property has been removed, use Container.label instead"),this.label},set name(e){pe(ce,"Container.name property has been removed, use Container.label instead"),this.label=e},getChildByName(e,t=!1){return this.getChildByLabel(e,t)},getChildByLabel(e,t=!1){const i=this.children;for(let r=0;r<i.length;r++){const t=i[r];if(t.label===e||e instanceof RegExp&&e.test(t.label))return t}if(t)for(let r=0;r<i.length;r++){const t=i[r].getChildByLabel(e,!0);if(t)return t}return null},getChildrenByLabel(e,t=!1,i=[]){const r=this.children;for(let s=0;s<r.length;s++){const t=r[s];(t.label===e||e instanceof RegExp&&e.test(t.label))&&i.push(t)}if(t)for(let s=0;s<r.length;s++)r[s].getChildrenByLabel(e,!0,i);return i}},ft=new nt(q),mt=new nt(Pe),_t=new q,yt={getFastGlobalBounds(e,t){t||(t=new Pe),t.clear(),this._getGlobalBoundsRecursive(!!e,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const i=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(i.worldTransform),t},_getGlobalBoundsRecursive(e,t,i){let r=t;if(e&&this.parentRenderLayer&&this.parentRenderLayer!==i)return;if(7!==this.localDisplayStatus||!this.measurable)return;const s=!!this.effects.length;if((this.renderGroup||s)&&(r=mt.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const e=this.bounds;r.addFrame(e.minX,e.minY,e.maxX,e.maxY,this.groupTransform)}const t=this.children;for(let s=0;s<t.length;s++)t[s]._getGlobalBoundsRecursive(e,r,i)}if(s){let e=!1;const i=this.renderGroup||this.parentRenderGroup;for(let t=0;t<this.effects.length;t++)this.effects[t].addBounds&&(e||(e=!0,r.applyMatrix(i.worldTransform)),this.effects[t].addBounds(r,!0));e&&(r.applyMatrix(i.worldTransform.copyTo(_t).invert()),t.addBounds(r,this.relativeGroupTransform)),t.addBounds(r),mt.return(r)}else this.renderGroup&&(t.addBounds(r,this.relativeGroupTransform),mt.return(r))}};function xt(e,t,i){let r,s;return i.clear(),e.parent?t?r=e.parent.worldTransform:(s=ft.get().identity(),r=bt(e,s)):r=q.IDENTITY,vt(e,i,r,t),s&&ft.return(s),i.isValid||i.set(0,0,0,0),i}function vt(e,t,i,r){var s,n;if(!e.visible||!e.measurable)return;let o;r?o=e.worldTransform:(e.updateLocalTransform(),o=ft.get(),o.appendFrom(e.localTransform,i));const a=t,l=!!e.effects.length;if(l&&(t=mt.get().clear()),e.boundsArea)t.addRect(e.boundsArea,o);else{e.bounds&&(t.matrix=o,t.addBounds(e.bounds));for(let i=0;i<e.children.length;i++)vt(e.children[i],t,o,r)}if(l){for(let i=0;i<e.effects.length;i++)null==(n=(s=e.effects[i]).addBounds)||n.call(s,t);a.addBounds(t,q.IDENTITY),mt.return(t)}r||ft.return(o)}function bt(e,t){const i=e.parent;return i&&(bt(i,t),i.updateLocalTransform(),t.append(i.localTransform)),t}function wt(e,t){if(16777215===e||!t)return t;if(16777215===t||!e)return e;return(((e>>16&255)*(t>>16&255)/255|0)<<16)+(((e>>8&255)*(t>>8&255)/255|0)<<8)+((255&e)*(255&t)/255|0)}const Tt=16777215;function Et(e,t){return e===Tt?t:t===Tt?e:wt(e,t)}function Ct(e){return((255&e)<<16)+(65280&e)+(e>>16&255)}const St={getGlobalAlpha(e){if(e)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,i=this.parent;for(;i;)t*=i.alpha,i=i.parent;return t},getGlobalTransform(e,t){if(t)return e.copyFrom(this.worldTransform);this.updateLocalTransform();const i=bt(this,ft.get().identity());return e.appendFrom(this.localTransform,i),ft.return(i),e},getGlobalTint(e){if(e)return this.renderGroup?Ct(this.renderGroup.worldColor):this.parentRenderGroup?Ct(Et(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,i=this.parent;for(;i;)t=Et(t,i.localColor),i=i.parent;return Ct(t)}};let Nt=0;function At(...e){500!==Nt&&(Nt++,500===Nt?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...e))}function Pt(e,t,i){return t.clear(),i||(i=q.IDENTITY),Mt(e,t,i,e,!0),t.isValid||t.set(0,0,0,0),t}function Mt(e,t,i,r,s){var n,o;let a;if(s)a=ft.get(),a=i.copyTo(a);else{if(!e.visible||!e.measurable)return;e.updateLocalTransform();const t=e.localTransform;a=ft.get(),a.appendFrom(t,i)}const l=t,h=!!e.effects.length;if(h&&(t=mt.get().clear()),e.boundsArea)t.addRect(e.boundsArea,a);else{e.renderPipeId&&(t.matrix=a,t.addBounds(e.bounds));const i=e.children;for(let e=0;e<i.length;e++)Mt(i[e],t,a,r,!1)}if(h){for(let i=0;i<e.effects.length;i++)null==(o=(n=e.effects[i]).addLocalBounds)||o.call(n,t,r);l.addBounds(t,q.IDENTITY),mt.return(t)}ft.return(a)}function Rt(e,t){const i=e.children;for(let r=0;r<i.length;r++){const e=i[r],s=e.uid,n=(65535&e._didViewChangeTick)<<16|65535&e._didContainerChangeTick,o=t.index;t.data[o]===s&&t.data[o+1]===n||(t.data[t.index]=s,t.data[t.index+1]=n,t.didChange=!0),t.index=o+2,e.children.length&&Rt(e,t)}return t.didChange}const kt=new q,Bt={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(e,t){const i=Math.sign(this.scale.x)||1;this.scale.x=0!==t?e/t*i:i},_setHeight(e,t){const i=Math.sign(this.scale.y)||1;this.scale.y=0!==t?e/t*i:i},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Pe});const e=this._localBoundsCacheData;return e.index=1,e.didChange=!1,e.data[0]!==this._didViewChangeTick&&(e.didChange=!0,e.data[0]=this._didViewChangeTick),Rt(this,e),e.didChange&&Pt(this,e.localBounds,kt),e.localBounds},getBounds(e,t){return xt(this,e,t||new Pe)}},It={_onRender:null,set onRender(e){const t=this.renderGroup||this.parentRenderGroup;if(!e)return this._onRender&&(null==t||t.removeOnRender(this)),void(this._onRender=null);this._onRender||null==t||t.addOnRender(this),this._onRender=e},get onRender(){return this._onRender}},Ot={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Dt))}};function Dt(e,t){return e._zIndex-t._zIndex}const Gt={getGlobalPosition(e=new K,t=!1){return this.parent?this.parent.toGlobal(this._position,e,t):(e.x=this._position.x,e.y=this._position.y),e},toGlobal(e,t,i=!1){const r=this.getGlobalTransform(ft.get(),i);return t=r.apply(e,t),ft.return(r),t},toLocal(e,t,i,r){t&&(e=t.toGlobal(e,i,r));const s=this.getGlobalTransform(ft.get(),r);return i=s.applyInverse(e,i),ft.return(s),i}};class Lt{constructor(){this.uid=de("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Ft=0;const Ut=new class{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,t,i){const r=new we({...this.textureOptions,width:e,height:t,resolution:1,antialias:i,autoGarbageCollect:!1});return new Se({source:r,label:"texturePool_"+Ft++})}getOptimalTexture(e,t,i=1,r){let s=Math.ceil(e*i-1e-6),n=Math.ceil(t*i-1e-6);s=fe(s),n=fe(n);const o=(s<<17)+(n<<1)+(r?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let a=this._texturePool[o].pop();return a||(a=this.createTexture(s,n,r)),a.source._resolution=i,a.source.width=s/i,a.source.height=n/i,a.source.pixelWidth=s,a.source.pixelHeight=n,a.frame.x=0,a.frame.y=0,a.frame.width=e,a.frame.height=t,a.updateUvs(),this._poolKeyHash[a.uid]=o,a}getSameSizeTexture(e,t=!1){const i=e.source;return this.getOptimalTexture(e.width,e.height,i._resolution,t)}returnTexture(e){const t=this._poolKeyHash[e.uid];this._texturePool[t].push(e)}clear(e){if(e=!1!==e)for(const t in this._texturePool){const e=this._texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this._texturePool={}}};class zt{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new q,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Lt,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const t=e.children;for(let i=0;i<t.length;i++){const e=t[i];e._updateFlags=15,this.addChild(e)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(Ut.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const t=this.childrenToUpdate[e];t.list.fill(null),t.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const t=this.renderGroupChildren.indexOf(e);t>-1&&this.renderGroupChildren.splice(t,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup)return void this.addRenderGroupChild(e.renderGroup);e._onRender&&this.addOnRender(e);const t=e.children;for(let i=0;i<t.length;i++)this.addChild(t[i])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup)return void this._removeRenderGroupChild(e.renderGroup);const t=e.children;for(let i=0;i<t.length;i++)this.removeChild(t[i])}removeChildren(e){for(let t=0;t<e.length;t++)this.removeChild(e[t])}onChildUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];t||(t=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),t.list[t.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let t=0;t<this._onRenderContainers.length;t++)this._onRenderContainers[t]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const t=this.root.children;for(let i=0;i<t.length;i++)this._getChildren(t[i],e);return e}_getChildren(e,t=[]){if(t.push(e),e.renderGroup)return t;const i=e.children;for(let r=0;r<i.length;r++)this._getChildren(i[r],t);return t}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return 1&this._matrixDirty?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new q),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return 2&this._matrixDirty?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new q),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(4&this._matrixDirty))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new q),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}const Ht=new U(null),Wt=new U(null),Vt=new U(null,1,1);class Xt extends V{constructor(e={}){var t,i;super(),this.uid=de("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new q,this.relativeGroupTransform=new q,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new U(this,0,0),this._scale=Vt,this._pivot=Wt,this._skew=Ht,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],function(e,t,i={}){for(const r in t)i[r]||void 0===t[r]||(e[r]=t[r])}(this,e,{children:!0,parent:!0,effects:!0}),null==(t=e.children)||t.forEach((e=>this.addChild(e))),null==(i=e.parent)||i.addChild(this)}static mixin(e){pe("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),G.mixin(Xt,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=4095&e}get _didChangeId(){return 4095&this._didContainerChangeTick|(4095&this._didViewChangeTick)<<12}addChild(...e){if(this.allowChildren||pe(ce,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let t=0;t<e.length;t++)this.addChild(e[t]);return e[0]}const t=e[0],i=this.renderGroup||this.parentRenderGroup;return t.parent===this?(this.children.splice(this.children.indexOf(t),1),this.children.push(t),i&&(i.structureDidChange=!0),t):(t.parent&&t.parent.removeChild(t),this.children.push(t),this.sortableChildren&&(this.sortDirty=!0),t.parent=this,t.didChange=!0,t._updateFlags=15,i&&i.addChild(t),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this),this._didViewChangeTick++,0!==t._zIndex&&t.depthOfChildModified(),t)}removeChild(...e){if(e.length>1){for(let t=0;t<e.length;t++)this.removeChild(e[t]);return e[0]}const t=e[0],i=this.children.indexOf(t);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(t):this.parentRenderGroup&&this.parentRenderGroup.removeChild(t),t.parentRenderLayer&&t.parentRenderLayer.detach(t),t.parent=null,this.emit("childRemoved",t,this,i),t.emit("removed",this)),t}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,this.didChange||(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;null==e||e.removeChild(this),this.renderGroup=ot.get(zt,this),this.groupTransform=q.IDENTITY,null==e||e.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;null==e||e.removeChild(this),ot.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,null==e||e.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&0===this.effects.length}get worldTransform(){return this._worldTransform||(this._worldTransform=new q),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*Y}set angle(e){this.rotation=e*j}get pivot(){return this._pivot===Wt&&(this._pivot=new U(this,0,0)),this._pivot}set pivot(e){this._pivot===Wt&&(this._pivot=new U(this,0,0)),"number"==typeof e?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===Ht&&(this._skew=new U(this,0,0)),this._skew}set skew(e){this._skew===Ht&&(this._skew=new U(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===Vt&&(this._scale=new U(this,1,1)),this._scale}set scale(e){this._scale===Vt&&(this._scale=new U(this,0,0)),"number"==typeof e?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const t=this.getLocalBounds().width;this._setWidth(e,t)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const t=this.getLocalBounds().height;this._setHeight(e,t)}getSize(e){e||(e={});const t=this.getLocalBounds();return e.width=Math.abs(this.scale.x*t.width),e.height=Math.abs(this.scale.y*t.height),e}setSize(e,t){const i=this.getLocalBounds();"object"==typeof e?(t=e.height??e.width,e=e.width):t??(t=e),void 0!==e&&this._setWidth(e,i.width),void 0!==t&&this._setHeight(t,i.height)}_updateSkew(){const e=this._rotation,t=this._skew;this._cx=Math.cos(e+t._y),this._sx=Math.sin(e+t._y),this._cy=-Math.sin(e-t._x),this._sy=Math.cos(e-t._x)}updateTransform(e){return this.position.set("number"==typeof e.x?e.x:this.position.x,"number"==typeof e.y?e.y:this.position.y),this.scale.set("number"==typeof e.scaleX?e.scaleX||1:this.scale.x,"number"==typeof e.scaleY?e.scaleY||1:this.scale.y),this.rotation="number"==typeof e.rotation?e.rotation:this.rotation,this.skew.set("number"==typeof e.skewX?e.skewX:this.skew.x,"number"==typeof e.skewY?e.skewY:this.skew.y),this.pivot.set("number"==typeof e.pivotX?e.pivotX:this.pivot.x,"number"==typeof e.pivotY?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const t=this.localTransform,i=this._scale,r=this._pivot,s=this._position,n=i._x,o=i._y,a=r._x,l=r._y;t.a=this._cx*n,t.b=this._sx*n,t.c=this._cy*o,t.d=this._sy*o,t.tx=s._x-(a*t.a+l*t.c),t.ty=s._y-(a*t.b+l*t.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=1,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const t=st.shared.setValue(e??16777215).toBgrNumber();t!==this.localColor&&(this.localColor=t,this._updateFlags|=1,this._onUpdate())}get tint(){return Ct(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=2,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(e){const t=e?2:0;(2&this.localDisplayStatus)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(4&this.localDisplayStatus)}set culled(e){const t=e?0:4;(4&this.localDisplayStatus)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(e){const t=e?1:0;(1&this.localDisplayStatus)!==t&&(this._updateFlags|=4,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(e=!1){var t;if(this.destroyed)return;let i;this.destroyed=!0,this.children.length&&(i=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners();if(("boolean"==typeof e?e:null==e?void 0:e.children)&&i)for(let r=0;r<i.length;++r)i[r].destroy(e);null==(t=this.renderGroup)||t.destroy(),this.renderGroup=null}}G.mixin(Xt,ht,yt,Gt,It,Bt,pt,gt,Ot,{cullArea:null,cullable:!1,cullableChildren:!0},at,St,dt);class Yt extends Xt{constructor(e){super(e),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._bounds=new Pe(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const t=this.bounds,{x:i,y:r}=e;return i>=t.minX&&i<=t.maxX&&r>=t.minY&&r<=t.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}destroy(e){super.destroy(e),this._bounds=null}collectRenderablesSimple(e,t,i){const{renderPipes:r,renderableGC:s}=t;r.blendMode.setBlendMode(this,this.groupBlendMode,e);r[this.renderPipeId].addRenderable(this,e),s.addRenderable(this),this.didViewUpdate=!1;const n=this.children,o=n.length;for(let a=0;a<o;a++)n[a].collectRenderables(e,t,i)}}class jt extends Yt{constructor(e=Se.EMPTY){e instanceof Se&&(e={texture:e});const{texture:t=Se.EMPTY,anchor:i,roundPixels:r,width:s,height:n,...o}=e;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new U({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:t.defaultAnchor&&(this.anchor=t.defaultAnchor),this.texture=t,this.allowChildren=!1,this.roundPixels=r??!1,void 0!==s&&(this.width=s),void 0!==n&&(this.height=n)}static from(e,t=!1){return new jt(e instanceof Se?e:Se.from(e,t))}set texture(e){e||(e=Se.EMPTY);const t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Ne(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return pe("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,t=this._texture,i=this._bounds,{width:r,height:s}=t.orig;i.minX=-e._x*r,i.maxX=i.minX+r,i.minY=-e._y*s,i.maxY=i.minY+s}destroy(e=!1){super.destroy(e);if("boolean"==typeof e?e:null==e?void 0:e.texture){const t="boolean"==typeof e?e:null==e?void 0:e.textureSource;this._texture.destroy(t)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,t){"object"==typeof e?(t=e.height??e.width,e=e.width):t??(t=e),void 0!==e&&this._setWidth(e,this._texture.orig.width),void 0!==t&&this._setHeight(t,this._texture.orig.height)}}const Kt=new Pe;function $t(e,t,i){const r=Kt;e.measurable=!0,xt(e,i,r),t.addBoundsMask(r),e.measurable=!1}function qt(e,t,i){const r=mt.get();e.measurable=!0;const s=ft.get().identity();Pt(e,r,Zt(e,i,s)),e.measurable=!1,t.addBoundsMask(r),ft.return(s),mt.return(r)}function Zt(e,t,i){return e?(e!==t&&(Zt(e.parent,t,i),e.updateLocalTransform(),i.append(e.localTransform)),i):(At("Mask bounds, renderable is not inside the root container"),i)}class Jt{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",(null==e?void 0:e.mask)&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof jt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,t){this.inverse||$t(this.mask,e,t)}addLocalBounds(e,t){qt(this.mask,e,t)}containsPoint(e,t){return t(this.mask,e)}destroy(){this.reset()}static test(e){return e instanceof jt}}Jt.extension=I.MaskEffect;class Qt{constructor(e){this.priority=0,this.pipe="colorMask",(null==e?void 0:e.mask)&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return"number"==typeof e}}Qt.extension=I.MaskEffect;class ei{constructor(e){this.priority=0,this.pipe="stencilMask",(null==e?void 0:e.mask)&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,t){$t(this.mask,e,t)}addLocalBounds(e,t){qt(this.mask,e,t)}containsPoint(e,t){return t(this.mask,e)}destroy(){this.reset()}static test(e){return e instanceof Xt}}ei.extension=I.MaskEffect;let ti={createCanvas:(e,t)=>{const i=document.createElement("canvas");return i.width=e,i.height=t,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")};const ii={get:()=>ti,set(e){ti=e}};class ri extends we{constructor(e){e.resource||(e.resource=ii.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),this.resource.width===this.pixelWidth&&this.resource.height===this.pixelHeight||(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,t=this.height,i=this._resolution){const r=super.resize(e,t,i);return r&&this.resizeCanvas(),r}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}ri.extension=I.TextureSource;class si extends we{constructor(e){if(e.resource&&globalThis.HTMLImageElement&&e.resource instanceof HTMLImageElement){const t=ii.get().createCanvas(e.resource.width,e.resource.height);t.getContext("2d").drawImage(e.resource,0,0,e.resource.width,e.resource.height),e.resource=t,At("ImageSource: Image element passed, converting to canvas. Use CanvasSource instead.")}super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}si.extension=I.TextureSource;var ni=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(ni||{});class oi{constructor(e,t=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=t,this.priority=i,this._once=r}match(e,t=null){return this._fn===e&&this._context===t}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const t=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const ai=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new oi(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=ni.NORMAL){return this._addListener(new oi(e,t,i))}addOnce(e,t,i=ni.NORMAL){return this._addListener(new oi(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}else e.connect(i);return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i=i.match(e,t)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let i;if(t>this.lastTime){if(i=this.elapsedMS=t-this.lastTime,i>this._maxElapsedMS&&(i=this._maxElapsedMS),i*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=i,this.deltaTime=this.deltaMS*e.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const i=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,i)/1e3,e.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){const t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){const t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};ai.targetFPMS=.06;let li,hi=ai;async function di(){return li??(li=(async()=>{var e;const t=document.createElement("canvas").getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const i=await new Promise((e=>{const t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()}));if(!i)return"premultiply-alpha-on-upload";const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(s),t.deleteTexture(r),null==(e=t.getExtension("WEBGL_lose_context"))||e.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),li}const ui=class e extends we{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...e.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==t.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=hi.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,t=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(t.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await di(),this._load=new Promise(((i,r)=>{this.isValid?i(this):(this._resolve=i,this._reject=r,void 0!==t.preloadTimeoutMs&&(this._preloadTimeout=setTimeout((()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${t.preloadTimeoutMs}ms`))}))),e.load())})),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(hi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(hi.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(hi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};ui.extension=I.TextureSource,ui.defaultOptions={...we.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1},ui.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ci=ui;const pi=(e,t,i=!1)=>(Array.isArray(e)||(e=[e]),t?e.map((e=>"string"==typeof e||i?t(e):e)):e);const gi=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||At(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=pi(e);let r;for(let a=0;a<this.parsers.length;a++){const e=this.parsers[a];if(e.test(t)){r=e.getCacheableAssets(i,t);break}}const s=new Map(Object.entries(r||{}));r||i.forEach((e=>{s.set(e,t)}));const n=[...s.keys()],o={cacheKeys:n,keys:i};i.forEach((e=>{this._cacheMap.set(e,o)})),n.forEach((e=>{const i=r?r[e]:t;this._cache.has(e)&&this._cache.get(e)!==i&&At("[Cache] already has key:",e),this._cache.set(e,s.get(e))}))}remove(e){if(!this._cacheMap.has(e))return void At(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach((e=>{this._cache.delete(e)})),t.keys.forEach((e=>{this._cacheMap.delete(e)}))}get parsers(){return this._parsers}},fi=[];function mi(e={}){const t=e&&e.resource,i=t?e.resource:e,r=t?e:{resource:e};for(let s=0;s<fi.length;s++){const e=fi[s];if(e.test(i))return new e(r)}throw new Error(`Could not find a source type for resource: ${r.resource}`)}G.handleByList(I.TextureSource,fi),Se.from=function(e,t=!1){return"string"==typeof e?gi.get(e):e instanceof we?new Se({source:e}):function(e={},t=!1){const i=e&&e.resource,r=i?e.resource:e,s=i?e:{resource:e};if(!t&&gi.has(r))return gi.get(r);const n=new Se({source:mi(s)});return n.on("destroy",(()=>{gi.has(r)&&gi.remove(r)})),t||gi.set(r,n),n}(e,t)},we.from=mi,G.add(Jt,Qt,ei,ci,si,ri,Te);var _i=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(_i||{});function yi(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function xi(e){return e.split("?")[0].split("#")[0]}const vi={toPosix(e){return t="\\",i="/",e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),i);var t,i},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){yi(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const i=/^[^/:]+:\/{0,2}/.exec(e);return i?i[0]:""},toAbsolute(e,t,i){if(yi(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const r=xi(this.toPosix(t??ii.get().getBaseUrl())),s=xi(this.toPosix(i??this.rootname(r)));if((e=this.toPosix(e)).startsWith("/"))return vi.join(s,e.slice(1));return this.isAbsolute(e)?e:this.join(r,e)},normalize(e){if(yi(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let t="";const i=(e=this.toPosix(e)).startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const r=e.endsWith("/");return(e=function(e){let t="",i=0,r=-1,s=0,n=-1;for(let o=0;o<=e.length;++o){if(o<e.length)n=e.charCodeAt(o);else{if(47===n)break;n=47}if(47===n){if(r===o-1||1===s);else if(r!==o-1&&2===s){if(t.length<2||2!==i||46!==t.charCodeAt(t.length-1)||46!==t.charCodeAt(t.length-2))if(t.length>2){const e=t.lastIndexOf("/");if(e!==t.length-1){-1===e?(t="",i=0):(t=t.slice(0,e),i=t.length-1-t.lastIndexOf("/")),r=o,s=0;continue}}else if(2===t.length||1===t.length){t="",i=0,r=o,s=0;continue}}else t.length>0?t+=`/${e.slice(r+1,o)}`:t=e.slice(r+1,o),i=o-r-1;r=o,s=0}else 46===n&&-1!==s?++s:s=-1}return t}(e)).length>0&&r&&(e+="/"),i?`/${e}`:t+e},isAbsolute(e){return yi(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){if(0===e.length)return".";let t;for(let i=0;i<e.length;++i){const r=e[i];if(yi(r),r.length>0)if(void 0===t)t=r;else{const s=e[i-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return void 0===t?".":this.normalize(t)},dirname(e){if(yi(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0);const i=47===t;let r=-1,s=!0;const n=this.getProtocol(e),o=e;for(let a=(e=e.slice(n.length)).length-1;a>=1;--a)if(t=e.charCodeAt(a),47===t){if(!s){r=a;break}}else s=!1;return-1===r?i?"/":this.isUrl(o)?n+e:n:i&&1===r?"//":n+e.slice(0,r)},rootname(e){yi(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){const i=e.indexOf("/",t.length);t=-1!==i?e.slice(0,i):e,t.endsWith("/")||(t+="/")}return t},basename(e,t){yi(e),t&&yi(t),e=xi(this.toPosix(e));let i,r=0,s=-1,n=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(i=e.length-1;i>=0;--i){const l=e.charCodeAt(i);if(47===l){if(!n){r=i+1;break}}else-1===a&&(n=!1,a=i+1),o>=0&&(l===t.charCodeAt(o)?-1==--o&&(s=i):(o=-1,s=a))}return r===s?s=a:-1===s&&(s=e.length),e.slice(r,s)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!n){r=i+1;break}}else-1===s&&(n=!1,s=i+1);return-1===s?"":e.slice(r,s)},extname(e){yi(e);let t=-1,i=0,r=-1,s=!0,n=0;for(let o=(e=xi(this.toPosix(e))).length-1;o>=0;--o){const a=e.charCodeAt(o);if(47!==a)-1===r&&(s=!1,r=o+1),46===a?-1===t?t=o:1!==n&&(n=1):-1!==t&&(n=-1);else if(!s){i=o+1;break}}return-1===t||-1===r||0===n||1===n&&t===r-1&&t===i+1?"":e.slice(t,r)},parse(e){yi(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;let i=(e=xi(this.toPosix(e))).charCodeAt(0);const r=this.isAbsolute(e);let s;t.root=this.rootname(e),s=r||this.hasProtocol(e)?1:0;let n=-1,o=0,a=-1,l=!0,h=e.length-1,d=0;for(;h>=s;--h)if(i=e.charCodeAt(h),47!==i)-1===a&&(l=!1,a=h+1),46===i?-1===n?n=h:1!==d&&(d=1):-1!==n&&(d=-1);else if(!l){o=h+1;break}return-1===n||-1===a||0===d||1===d&&n===a-1&&n===o+1?-1!==a&&(t.base=t.name=0===o&&r?e.slice(1,a):e.slice(o,a)):(0===o&&r?(t.name=e.slice(1,n),t.base=e.slice(1,a)):(t.name=e.slice(o,n),t.base=e.slice(o,a)),t.ext=e.slice(n,a)),t.dir=this.dirname(e),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function bi(e,t,i,r,s){const n=t[i];for(let o=0;o<n.length;o++){const a=n[o];i<t.length-1?bi(e.replace(r[i],a),t,i+1,r,s):s.push(e.replace(r[i],a))}}function wi(e){const t=e.match(/\{(.*?)\}/g),i=[];if(t){const r=[];t.forEach((e=>{const t=e.substring(1,e.length-1).split(",");r.push(t)})),bi(e,r,0,t,i)}else i.push(e);return i}const Ti=e=>!Array.isArray(e);class Ei{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach((e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))})),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if("string"==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}}getAlias(e){const{alias:t,src:i}=e;return pi(t||i,(e=>"string"==typeof e?e:Array.isArray(e)?e.map((e=>(null==e?void 0:e.src)??e)):(null==e?void 0:e.src)?e.src:e),!0)}addManifest(e){this._manifest&&At("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach((e=>{this.addBundle(e.name,e.assets)}))}addBundle(e,t){const i=[];let r=t;Array.isArray(t)||(r=Object.entries(t).map((([e,t])=>"string"==typeof t||Array.isArray(t)?{alias:e,src:t}:{alias:e,...t}))),r.forEach((t=>{const r=t.src,s=t.alias;let n;if("string"==typeof s){const t=this._createBundleAssetId(e,s);i.push(t),n=[s,t]}else{const t=s.map((t=>this._createBundleAssetId(e,t)));i.push(...t),n=[...s,...t]}this.add({...t,alias:n,src:r})})),this._bundles[e]=i}add(e){const t=[];let i;Array.isArray(e)?t.push(...e):t.push(e),i=e=>{this.hasKey(e)&&At(`[Resolver] already has key: ${e} overwriting`)};pi(t).forEach((e=>{const{src:t}=e;let{data:r,format:s,loadParser:n}=e;const o=pi(t).map((e=>"string"==typeof e?wi(e):Array.isArray(e)?e:[e])),a=this.getAlias(e);Array.isArray(a)?a.forEach(i):i(a);const l=[];o.forEach((e=>{e.forEach((e=>{let t={};if("object"!=typeof e){t.src=e;for(let i=0;i<this._parsers.length;i++){const r=this._parsers[i];if(r.test(e)){t=r.parse(e);break}}}else r=e.data??r,s=e.format??s,n=e.loadParser??n,t={...t,...e};if(!a)throw new Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this._buildResolvedAsset(t,{aliases:a,data:r,format:s,loadParser:n}),l.push(t)}))})),a.forEach((e=>{this._assetMap[e]=l}))}))}resolveBundle(e){const t=Ti(e);e=pi(e);const i={};return e.forEach((e=>{const t=this._bundles[e];if(t){const r=this.resolve(t),s={};for(const t in r){const i=r[t];s[this._extractAssetIdFromBundle(e,t)]=i}i[e]=s}})),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if("string"!=typeof e){const e={};for(const i in t)e[i]=t[i].src;return e}return t.src}resolve(e){const t=Ti(e);e=pi(e);const i={};return e.forEach((e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const i=this._getPreferredOrder(t);null==i||i.priority.forEach((e=>{i.params[e].forEach((i=>{const r=t.filter((t=>!!t[e]&&t[e]===i));r.length&&(t=r)}))})),this._resolverHash[e]=t[0]}else this._resolverHash[e]=this._buildResolvedAsset({alias:[e],src:e},{});i[e]=this._resolverHash[e]})),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[t],r=this._preferredOrder.find((e=>e.params.format.includes(i.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;return`${e}${/\?/.test(e)?"&":"?"}${this._defaultSearchParams}`}_buildResolvedAsset(e,t){const{aliases:i,data:r,loadParser:s,format:n}=t;return(this._basePath||this._rootPath)&&(e.src=vi.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...r||{},...e.data},e.loadParser=s??e.loadParser,e.format=n??e.format??e.src.split(".").pop().split("?").shift().split("#").shift(),e}}Ei.RETINA_PREFIX=/@([0-9\.]+)x/;const Ci=(e,t)=>{const i=t.split("?")[1];return i&&(e+=`?${i}`),e},Si=class e{constructor(e,t){this.linkedSheets=[],this._texture=e instanceof Se?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=t;const i=parseFloat(t.meta.scale);i?(this.resolution=i,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let i=t;const r=e.BATCH_SIZE;for(;i-t<r&&i<this._frameKeys.length;){const e=this._frameKeys[i],t=this._frames[e],r=t.frame;if(r){let i=null,s=null;const n=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,o=new le(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);i=t.rotated?new le(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new le(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(s=new le(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[e]=new Se({source:this.textureSource,frame:i,orig:o,trim:s,rotate:t.rotated?2:0,defaultAnchor:t.anchor,defaultBorders:t.borders,label:e.toString()})}i++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const r=e[t][i];this.animations[t].push(this.textures[r])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(null==(t=this._texture)||t.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Si.BATCH_SIZE=1e3;let Ni=Si;const Ai=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Pi(e,t,i){const r={};if(e.forEach((e=>{r[e]=t})),Object.keys(t.textures).forEach((e=>{r[e]=t.textures[e]})),!i){const i=vi.dirname(e[0]);t.linkedSheets.forEach(((e,s)=>{const n=Pi([`${i}/${t.data.meta.related_multi_packs[s]}`],e,!0);Object.assign(r,n)}))}return r}const Mi={extension:I.Asset,cache:{test:e=>e instanceof Ni,getCacheableAssets:(e,t)=>Pi(e,t,!1)},resolver:{extension:{type:I.ResolveParser,name:"resolveSpritesheet"},test:e=>{const t=e.split("?")[0].split("."),i=t.pop(),r=t.pop();return"json"===i&&Ai.includes(r)},parse:e=>{var t;const i=e.split(".");return{resolution:parseFloat((null==(t=Ei.RETINA_PREFIX.exec(e))?void 0:t[1])??"1"),format:i[i.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:I.LoadParser,priority:_i.Normal,name:"spritesheetLoader"},testParse:async(e,t)=>".json"===vi.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,i){var r,s;const{texture:n,imageFilename:o,textureOptions:a}=(null==t?void 0:t.data)??{};let l,h=vi.dirname(t.src);if(h&&h.lastIndexOf("/")!==h.length-1&&(h+="/"),n instanceof Se)l=n;else{const r=Ci(h+(o??e.meta.image),t.src);l=(await i.load([{src:r,data:a}]))[r]}const d=new Ni(l.source,e);await d.parse();const u=null==(r=null==e?void 0:e.meta)?void 0:r.related_multi_packs;if(Array.isArray(u)){const e=[];for(const n of u){if("string"!=typeof n)continue;let r=h+n;(null==(s=t.data)?void 0:s.ignoreMultiPack)||(r=Ci(r,t.src),e.push(i.load({src:r,data:{textureOptions:a,ignoreMultiPack:!0}})))}const r=await Promise.all(e);d.linkedSheets=r,r.forEach((e=>{e.linkedSheets=[d].concat(d.linkedSheets.filter((t=>t!==e)))}))}return d},async unload(e,t,i){await i.unload(e.textureSource._sourceOrigin),e.destroy(!1)}}};G.add(Mi);class Ri{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Ri.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new K,this.page=new K,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,r,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var ki=/iPhone/i,Bi=/iPod/i,Ii=/iPad/i,Oi=/\biOS-universal(?:.+)Mac\b/i,Di=/\bAndroid(?:.+)Mobile\b/i,Gi=/Android/i,Li=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Fi=/Silk/i,Ui=/Windows Phone/i,zi=/\bWindows(?:.+)ARM\b/i,Hi=/BlackBerry/i,Wi=/BB10/i,Vi=/Opera Mini/i,Xi=/\b(CriOS|Chrome)(?:.+)Mobile/i,Yi=/Mobile(?:.+)Firefox\b/i,ji=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function Ki(e){var t={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=t.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var s=function(e){return function(t){return t.test(e)}}(i),n={apple:{phone:s(ki)&&!s(Ui),ipod:s(Bi),tablet:!s(ki)&&(s(Ii)||ji(t))&&!s(Ui),universal:s(Oi),device:(s(ki)||s(Bi)||s(Ii)||s(Oi)||ji(t))&&!s(Ui)},amazon:{phone:s(Li),tablet:!s(Li)&&s(Fi),device:s(Li)||s(Fi)},android:{phone:!s(Ui)&&s(Li)||!s(Ui)&&s(Di),tablet:!s(Ui)&&!s(Li)&&!s(Di)&&(s(Fi)||s(Gi)),device:!s(Ui)&&(s(Li)||s(Fi)||s(Di)||s(Gi))||s(/\bokhttp\b/i)},windows:{phone:s(Ui),tablet:s(zi),device:s(Ui)||s(zi)},other:{blackberry:s(Hi),blackberry10:s(Wi),opera:s(Vi),firefox:s(Yi),chrome:s(Xi),device:s(Hi)||s(Wi)||s(Vi)||s(Yi)||s(Xi)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const $i=(Ki.default??Ki)(globalThis.navigator),qi=class e{constructor(e,t=$i){this._mobileInfo=t,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(t.tablet||t.phone)&&this._createTouchHook(),this._renderer=e}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width="100px",this._div.style.height="100px",this._div.style.position="absolute",this._div.style.top="0px",this._div.style.left="0px",this._div.style.zIndex=2..toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const e=this._renderer.view.canvas;if(e.parentNode)e.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const t=new MutationObserver((()=>{e.parentNode&&(e.parentNode.appendChild(this._div),t.disconnect(),this._initAccessibilitySetup())}));t.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(this._isActive&&!this._isMobileAccessibility){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const e of this._children)e._accessibleDiv&&e._accessibleDiv.parentNode&&(e._accessibleDiv.parentNode.removeChild(e._accessibleDiv),e._accessibleDiv=null),e._accessibleActive=!1;this._pool.forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&(e._accessibleActive||this._addChild(e),e._renderId=this._renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this._updateAccessibleObjects(t[i])}init(t){const i={accessibilityOptions:{...e.defaultOptions,...(null==t?void 0:t.accessibilityOptions)||{}}};this.debug=i.accessibilityOptions.debug,this._activateOnTab=i.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=i.accessibilityOptions.deactivateOnMouseMove,i.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const e=performance.now();if(this._mobileInfo.android.device&&e<this._androidUpdateCount)return;if(this._androidUpdateCount=e+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas)return;const t=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const e of this._children)e._renderId===this._renderId&&t.add(this._children.indexOf(e))}for(let i=this._children.length-1;i>=0;i--){const e=this._children[i];t.has(i)||(e._accessibleDiv&&e._accessibleDiv.parentNode&&(e._accessibleDiv.parentNode.removeChild(e._accessibleDiv),this._pool.push(e._accessibleDiv),e._accessibleDiv=null),e._accessibleActive=!1,lt(this._children,i,1))}if(this._renderer.renderingToScreen){const{x:e,y:t,width:i,height:r}=this._renderer.screen,s=this._div;s.style.left=`${e}px`,s.style.top=`${t}px`,s.style.width=`${i}px`,s.style.height=`${r}px`}for(let i=0;i<this._children.length;i++){const e=this._children[i];if(!e._accessibleActive||!e._accessibleDiv)continue;const t=e._accessibleDiv,r=e.hitArea||e.getBounds().rectangle;if(e.hitArea){const i=e.worldTransform,s=this._renderer.resolution,n=this._renderer.resolution;t.style.left=(i.tx+r.x*i.a)*s+"px",t.style.top=(i.ty+r.y*i.d)*n+"px",t.style.width=r.width*i.a*s+"px",t.style.height=r.height*i.d*n+"px"}else{this._capHitArea(r);const e=this._renderer.resolution,i=this._renderer.resolution;t.style.left=r.x*e+"px",t.style.top=r.y*i+"px",t.style.width=r.width*e+"px",t.style.height=r.height*i+"px"}}this._renderId++}_updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}_capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this._renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}_addChild(e){let t=this._pool.pop();t||("button"===e.accessibleType?t=document.createElement("button"):(t=document.createElement(e.accessibleType),t.style.cssText="\n                        color: transparent;\n                        pointer-events: none;\n                        padding: 0;\n                        margin: 0;\n                        border: 0;\n                        outline: 0;\n                        background: transparent;\n                        box-sizing: border-box;\n                        user-select: none;\n                        -webkit-user-select: none;\n                        -moz-user-select: none;\n                        -ms-user-select: none;\n                    ",e.accessibleText&&(t.innerText=e.accessibleText)),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title=`container ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this._updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e.interactive&&(e._accessibleDiv.tabIndex=e.tabIndex)}_dispatchEvent(e,t){const{container:i}=e.target,r=this._renderer.events.rootBoundary,s=Object.assign(new Ri(r),{target:i});r.rootTarget=this._renderer.lastObjectRendered,t.forEach((e=>r.dispatchEvent(s,e)))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this._activateOnTab&&this._activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(e){e?this._activate():this._deactivate()}};qi.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"accessibility"},qi.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let Zi=qi;const Ji=Object.create(null),Qi=Object.create(null);function er(e,t){let i=Qi[e];return void 0===i&&(void 0===Ji[t]&&(Ji[t]=1),Qi[e]=i=Ji[t]++),i}let tr,ir;function rr(){if(!tr||(null==tr?void 0:tr.isContextLost())){const e=ii.get().createCanvas();tr=e.getContext("webgl",{})}return tr}function sr(){if(!ir){ir="mediump";const e=rr();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);ir=t.precision?"highp":"mediump"}}return ir}const nr={},or={};const ar={stripVersion:function(e,t){return t?e.replace("#version 300 es",""):e},ensurePrecision:function(e,t,i){const r=i?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if("precision"!==e.substring(0,9)){let s=i?t.requestedFragmentPrecision:t.requestedVertexPrecision;return"highp"===s&&"highp"!==r&&(s="mediump"),`precision ${s} float;\n${e}`}return"highp"!==r&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e},addProgramDefines:function(e,t,i){return t?e:i?`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${e=e.replace("out vec4 finalColor;","")}\n        `:`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${e}\n        `},setProgramName:function(e,{name:t="pixi-program"},i=!0){t=t.replace(/\s+/g,"-");const r=i?nr:or;return r[t+=i?"-fragment":"-vertex"]?(r[t]++,t+=`-${r[t]}`):r[t]=1,-1!==e.indexOf("#define SHADER_NAME")?e:`${`#define SHADER_NAME ${t}`}\n${e}`},insertVersion:function(e,t){return t?`#version 300 es\n${e}`:e}},lr=Object.create(null),hr=class e{constructor(t){const i=-1!==(t={...e.defaultOptions,...t}).fragment.indexOf("#version 300 es"),r={stripVersion:i,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:sr()},setProgramName:{name:t.name},addProgramDefines:i,insertVersion:i};let s=t.fragment,n=t.vertex;Object.keys(ar).forEach((e=>{const t=r[e];s=ar[e](s,t,!0),n=ar[e](n,t,!1)})),this.fragment=s,this.vertex=n,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=er(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(t){const i=`${t.vertex}:${t.fragment}`;return lr[i]||(lr[i]=new e(t)),lr[i]}};hr.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let dr=hr;const ur={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function cr(e){return ur[e]??ur.float32}const pr={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function gr(e){var t,i;const r=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,o=/:\s*(\w+)/,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,h=null==(t=e.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g))?void 0:t.map((e=>({group:parseInt(e.match(r)[1],10),binding:parseInt(e.match(s)[1],10),name:e.match(n)[2],isUniform:"<uniform>"===e.match(n)[1],type:e.match(o)[1]})));if(!h)return{groups:[],structs:[]};const d=(null==(i=e.match(/struct\s+(\w+)\s*{([^}]+)}/g))?void 0:i.map((e=>{const t=e.match(l)[1],i=e.match(a).reduce(((e,t)=>{const[i,r]=t.split(":");return e[i.trim()]=r.trim(),e}),{});return i?{name:t,members:i}:null})).filter((({name:e})=>h.some((t=>t.type===e)))))??[];return{groups:h,structs:d}}var fr=(e=>(e[e.VERTEX=1]="VERTEX",e[e.FRAGMENT=2]="FRAGMENT",e[e.COMPUTE=4]="COMPUTE",e))(fr||{});const mr=Object.create(null);class _r{constructor(e){var t,i;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:r,vertex:s,layout:n,gpuLayout:o,name:a}=e;if(this.name=a,this.fragment=r,this.vertex=s,r.source===s.source){const e=gr(r.source);this.structsAndGroups=e}else{const e=gr(s.source),t=gr(r.source);this.structsAndGroups=function(e,t){const i=new Set,r=new Set;return{structs:[...e.structs,...t.structs].filter((e=>!i.has(e.name)&&(i.add(e.name),!0))),groups:[...e.groups,...t.groups].filter((e=>{const t=`${e.name}-${e.binding}`;return!r.has(t)&&(r.add(t),!0)}))}}(e,t)}this.layout=n??function({groups:e}){const t=[];for(let i=0;i<e.length;i++){const r=e[i];t[r.group]||(t[r.group]={}),t[r.group][r.name]=r.binding}return t}(this.structsAndGroups),this.gpuLayout=o??function({groups:e}){const t=[];for(let i=0;i<e.length;i++){const r=e[i];t[r.group]||(t[r.group]=[]),r.isUniform?t[r.group].push({binding:r.binding,visibility:fr.VERTEX|fr.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===r.type?t[r.group].push({binding:r.binding,visibility:fr.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===r.type&&t[r.group].push({binding:r.binding,visibility:fr.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===(null==(t=this.layout[0])?void 0:t.globalUniforms)),this.autoAssignLocalUniforms=!(void 0===(null==(i=this.layout[1])?void 0:i.localUniforms)),this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:t}=this,i=e.source+t.source+e.entryPoint+t.entryPoint;this._layoutKey=er(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=function({source:e,entryPoint:t}){const i={},r=e.indexOf(`fn ${t}`);if(-1!==r){const t=e.indexOf("->",r);if(-1!==t){const s=e.substring(r,t),n=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;null!==(o=n.exec(s));){const e=pr[o[3]]??"float32";i[o[2]]={location:parseInt(o[1],10),format:e,stride:cr(e).stride,offset:0,instance:!1,start:0}}}}return i}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){const t=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return mr[t]||(mr[t]=new _r(e)),mr[t]}}const yr=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],xr=yr.reduce(((e,t)=>(e[t]=!0,e)),{});function vr(e,t){switch(e){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const br=class e{constructor(t,i){this._touched=0,this.uid=de("uniform"),this._resourceType="uniformGroup",this._resourceId=de("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,i={...e.defaultOptions,...i},this.uniformStructures=t;const r={};for(const e in t){const i=t[e];if(i.name=e,i.size=i.size??1,!xr[i.type])throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${yr.join(", ")}`);i.value??(i.value=vr(i.type,i.size)),r[e]=i.value}this.uniforms=r,this._dirtyId=1,this.ubo=i.ubo,this.isStatic=i.isStatic,this._signature=er(Object.keys(r).map((e=>`${e}-${t[e].type}`)).join("-"),"uniform-group")}update(){this._dirtyId++}};br.defaultOptions={ubo:!1,isStatic:!1};let wr=br;class Tr{constructor(e){this.resources=Object.create(null),this._dirty=!0;let t=0;for(const i in e){const r=e[i];this.setResource(r,t++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let t=0;for(const i in this.resources)e[t++]=this.resources[i]._resourceId;this._key=e.join("|")}setResource(e,t){var i,r;const s=this.resources[t];e!==s&&(s&&(null==(i=e.off)||i.call(e,"change",this.onResourceChange,this)),null==(r=e.on)||r.call(e,"change",this.onResourceChange,this),this.resources[t]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){const t=this.resources;for(const i in t)t[i]._touched=e}destroy(){var e;const t=this.resources;for(const i in t){const r=t[i];null==(e=r.off)||e.call(r,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const t=this.resources;for(const i in t)t[i]===e&&(t[i]=null)}else this._updateKey()}}var Er=(e=>(e[e.WEBGL=1]="WEBGL",e[e.WEBGPU=2]="WEBGPU",e[e.BOTH=3]="BOTH",e))(Er||{});class Cr extends V{constructor(e){super(),this.uid=de("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:t,glProgram:i,groups:r,resources:s,compatibleRenderers:n,groupMap:o}=e;this.gpuProgram=t,this.glProgram=i,void 0===n&&(n=0,t&&(n|=Er.WEBGPU),i&&(n|=Er.WEBGL)),this.compatibleRenderers=n;const a={};if(s||r||(s={}),s&&r)throw new Error("[Shader] Cannot have both resources and groups");if(!t&&r&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!t&&r&&o)for(const l in o)for(const e in o[l]){const t=o[l][e];a[t]={group:l,binding:e,name:t}}else if(t&&r&&!o){const e=t.structsAndGroups.groups;o={},e.forEach((e=>{o[e.group]=o[e.group]||{},o[e.group][e.binding]=e.name,a[e.name]=e}))}else if(s){if(r={},o={},t){t.structsAndGroups.groups.forEach((e=>{o[e.group]=o[e.group]||{},o[e.group][e.binding]=e.name,a[e.name]=e}))}let e=0;for(const t in s)a[t]||(r[99]||(r[99]=new Tr,this._ownedBindGroups.push(r[99])),a[t]={group:99,binding:e,name:t},o[99]=o[99]||{},o[99][e]=t,e++);for(const t in s){const e=t;let i=s[t];i.source||i._resourceType||(i=new wr(i));const n=a[e];n&&(r[n.group]||(r[n.group]=new Tr,this._ownedBindGroups.push(r[n.group])),r[n.group].setResource(i,n.binding))}}this.groups=r,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(r,a)}addResource(e,t,i){var r,s;(r=this._uniformBindMap)[t]||(r[t]={}),(s=this._uniformBindMap[t])[i]||(s[i]=e),this.groups[t]||(this.groups[t]=new Tr,this._ownedBindGroups.push(this.groups[t]))}_buildResourceAccessor(e,t){const i={};for(const r in t){const s=t[r];Object.defineProperty(i,s.name,{get:()=>e[s.group].getResource(s.binding),set(t){e[s.group].setResource(t,s.binding)}})}return i}destroy(e=!1){var t,i;this.emit("destroy",this),e&&(null==(t=this.gpuProgram)||t.destroy(),null==(i=this.glProgram)||i.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((e=>{e.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){const{gpu:t,gl:i,...r}=e;let s,n;return t&&(s=_r.from(t)),i&&(n=dr.from(i)),new Cr({gpuProgram:s,glProgram:n,...r})}}const Sr={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},Nr=class e{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}set cullMode(e){"none"!==e?(this.culling=!0,this.clockwiseFrontFace="front"===e):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend="none"!==e,this._blendMode=e,this._blendModeId=Sr[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new e;return t.depthTest=!1,t.blend=!0,t}};Nr.default2d=Nr.for2d();let Ar=Nr;const Pr=class e extends Cr{constructor(t){super(t={...e.defaultOptions,...t}),this.enabled=!0,this._state=Ar.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,"boolean"==typeof t.antialias?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1)}apply(e,t,i,r){e.applyFilter(this,t,i,r)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(t){const{gpu:i,gl:r,...s}=t;let n,o;return i&&(n=_r.from(i)),r&&(o=dr.from(r)),new e({gpuProgram:n,glProgram:o,...s})}};Pr.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Mr=Pr;const Rr=[];let kr;function Br(){if("boolean"==typeof kr)return kr;try{const e=new Function("param1","param2","param3","return param1[param2] === param3;");kr=!0===e({a:"b"},"a","b")}catch(e){kr=!1}return kr}G.handleByNamedList(I.Environment,Rr);var Ir,Or={exports:{}};var Dr=function(){if(Ir)return Or.exports;function e(e,i,s){s=s||2;var n,o,a,d,u,p,g,f=i&&i.length,m=f?i[0]*s:e.length,_=t(e,0,m,s,!0),y=[];if(!_||_.next===_.prev)return y;if(f&&(_=function(e,i,r,s){var n,o,a,d=[];for(n=0,o=i.length;n<o;n++)(a=t(e,i[n]*s,n<o-1?i[n+1]*s:e.length,s,!1))===a.next&&(a.steiner=!0),d.push(c(a));for(d.sort(l),n=0;n<d.length;n++)r=h(d[n],r);return r}(e,i,_,s)),e.length>80*s){n=a=e[0],o=d=e[1];for(var x=s;x<m;x+=s)(u=e[x])<n&&(n=u),(p=e[x+1])<o&&(o=p),u>a&&(a=u),p>d&&(d=p);g=0!==(g=Math.max(a-n,d-o))?32767/g:0}return r(_,y,s,n,o,g,0),y}function t(e,t,i,r,s){var n,o;if(s===C(e,t,i,r)>0)for(n=t;n<i;n+=r)o=w(n,e[n],e[n+1],o);else for(n=i-r;n>=t;n-=r)o=w(n,e[n],e[n+1],o);return o&&m(o,o.next)&&(T(o),o=o.next),o}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!m(r,r.next)&&0!==f(r.prev,r,r.next))r=r.next;else{if(T(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,l,h,d,c,p){if(e){!p&&c&&function(e,t,i,r){var s=e;do{0===s.z&&(s.z=u(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,r,s,n,o,a,l,h=1;do{for(i=e,e=null,n=null,o=0;i;){for(o++,r=i,a=0,t=0;t<h&&(a++,r=r.nextZ);t++);for(l=h;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,h*=2}while(o>1)}(s)}(e,h,d,c);for(var g,f,m=e;e.prev!==e.next;)if(g=e.prev,f=e.next,c?n(e,h,d,c):s(e))t.push(g.i/l|0),t.push(e.i/l|0),t.push(f.i/l|0),T(e),e=f.next,m=f.next;else if((e=f)===m){p?1===p?r(e=o(i(e),t,l),t,l,h,d,c,2):2===p&&a(e,t,l,h,d,c):r(i(e),t,l,h,d,c,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(f(t,i,r)>=0)return!1;for(var s=t.x,n=i.x,o=r.x,a=t.y,l=i.y,h=r.y,d=s<n?s<o?s:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,c=s>n?s>o?s:o:n>o?n:o,g=a>l?a>h?a:h:l>h?l:h,m=r.next;m!==t;){if(m.x>=d&&m.x<=c&&m.y>=u&&m.y<=g&&p(s,a,n,l,o,h,m.x,m.y)&&f(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function n(e,t,i,r){var s=e.prev,n=e,o=e.next;if(f(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,d=s.y,c=n.y,g=o.y,m=a<l?a<h?a:h:l<h?l:h,_=d<c?d<g?d:g:c<g?c:g,y=a>l?a>h?a:h:l>h?l:h,x=d>c?d>g?d:g:c>g?c:g,v=u(m,_,t,i,r),b=u(y,x,t,i,r),w=e.prevZ,T=e.nextZ;w&&w.z>=v&&T&&T.z<=b;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=x&&w!==s&&w!==o&&p(a,d,l,c,h,g,w.x,w.y)&&f(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,T.x>=m&&T.x<=y&&T.y>=_&&T.y<=x&&T!==s&&T!==o&&p(a,d,l,c,h,g,T.x,T.y)&&f(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;w&&w.z>=v;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=x&&w!==s&&w!==o&&p(a,d,l,c,h,g,w.x,w.y)&&f(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=b;){if(T.x>=m&&T.x<=y&&T.y>=_&&T.y<=x&&T!==s&&T!==o&&p(a,d,l,c,h,g,T.x,T.y)&&f(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function o(e,t,r){var s=e;do{var n=s.prev,o=s.next.next;!m(n,o)&&_(n,s,s.next,o)&&v(n,o)&&v(o,n)&&(t.push(n.i/r|0),t.push(s.i/r|0),t.push(o.i/r|0),T(s),T(s.next),s=e=o),s=s.next}while(s!==e);return i(s)}function a(e,t,s,n,o,a){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&g(l,h)){var d=b(l,h);return l=i(l,l.next),d=i(d,d.next),r(l,t,s,n,o,a,0),void r(d,t,s,n,o,a,0)}h=h.next}l=l.next}while(l!==e)}function l(e,t){return e.x-t.x}function h(e,t){var r=function(e,t){var i,r=t,s=e.x,n=e.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o&&(o=a,i=r.x<r.next.x?r:r.next,a===s))return i}r=r.next}while(r!==t);if(!i)return null;var l,h=i,u=i.x,c=i.y,g=1/0;r=i;do{s>=r.x&&r.x>=u&&s!==r.x&&p(n<c?s:o,n,u,c,n<c?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),v(r,e)&&(l<g||l===g&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,g=l)),r=r.next}while(r!==h);return i}(e,t);if(!r)return t;var s=b(r,e);return i(s,s.next),i(r,r.next)}function d(e,t){return f(e.prev,e,t.prev)<0&&f(t.next,e,e.next)<0}function u(e,t,i,r,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function c(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function p(e,t,i,r,s,n,o,a){return(s-o)*(t-a)>=(e-o)*(n-a)&&(e-o)*(r-a)>=(i-o)*(t-a)&&(i-o)*(n-a)>=(s-o)*(r-a)}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(v(e,t)&&v(t,e)&&function(e,t){var i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(f(e.prev,e,t.prev)||f(e,t.prev,t))||m(e,t)&&f(e.prev,e,e.next)>0&&f(t.prev,t,t.next)>0)}function f(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,i,r){var s=x(f(e,t,i)),n=x(f(e,t,r)),o=x(f(i,r,e)),a=x(f(i,r,t));return s!==n&&o!==a||(!(0!==s||!y(e,i,t))||(!(0!==n||!y(e,r,t))||(!(0!==o||!y(i,e,r))||!(0!==a||!y(i,t,r)))))}function y(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function x(e){return e>0?1:e<0?-1:0}function v(e,t){return f(e.prev,e,e.next)<0?f(e,t,e.next)>=0&&f(e,e.prev,t)>=0:f(e,t,e.prev)<0||f(e,e.next,t)<0}function b(e,t){var i=new E(e.i,e.x,e.y),r=new E(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function w(e,t,i,r){var s=new E(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,i,r){for(var s=0,n=t,o=i-r;n<i;n+=r)s+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return s}return Ir=1,Or.exports=e,Or.exports.default=e,e.deviation=function(e,t,i,r){var s=t&&t.length,n=s?t[0]*i:e.length,o=Math.abs(C(e,0,n,i));if(s)for(var a=0,l=t.length;a<l;a++){var h=t[a]*i,d=a<l-1?t[a+1]*i:e.length;o-=Math.abs(C(e,h,d,i))}var u=0;for(a=0;a<r.length;a+=3){var c=r[a]*i,p=r[a+1]*i,g=r[a+2]*i;u+=Math.abs((e[c]-e[g])*(e[p+1]-e[c+1])-(e[c]-e[p])*(e[g+1]-e[c+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var o=0;o<t;o++)i.vertices.push(e[s][n][o]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i},Or.exports}();const Gr=z(Dr);var Lr=(e=>(e[e.NONE=0]="NONE",e[e.COLOR=16384]="COLOR",e[e.STENCIL=1024]="STENCIL",e[e.DEPTH=256]="DEPTH",e[e.COLOR_DEPTH=16640]="COLOR_DEPTH",e[e.COLOR_STENCIL=17408]="COLOR_STENCIL",e[e.DEPTH_STENCIL=1280]="DEPTH_STENCIL",e[e.ALL=17664]="ALL",e))(Lr||{});class Fr{constructor(e){this.items=[],this._name=e}emit(e,t,i,r,s,n,o,a){const{name:l,items:h}=this;for(let d=0,u=h.length;d<u;d++)h[d][l](e,t,i,r,s,n,o,a);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&this.items.splice(t,1),this}contains(e){return-1!==this.items.indexOf(e)}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}const Ur=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],zr=class e extends V{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const t=[...Ur,...this.config.runners??[]];this._addRunners(...t),this._unsafeEvalCheck()}async init(t={}){const i=!0===t.skipExtensionImports||!1===t.manageImports;await async function(e){if(!e)for(let t=0;t<Rr.length;t++){const e=Rr[t];if(e.value.test())return void(await e.value.load())}}(i),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const e in this._systemsHash){t={...this._systemsHash[e].constructor.defaultOptions,...t}}t={...e.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let e=0;e<this.runners.init.items.length;e++)await this.runners.init.items[e].init(t);this._initOptions=t}render(e,t){let i=e;if(i instanceof Xt&&(i={container:i},t&&(pe(ce,"passing a second argument is deprecated, please use render options instead"),i.target=t.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const e=Array.isArray(i.clearColor)&&4===i.clearColor.length;i.clearColor=e?i.clearColor:st.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i)}resize(e,t,i){const r=this.view.resolution;this.view.resize(e,t,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),void 0!==i&&i!==r&&this.runners.resolutionChange.emit(i)}clear(e={}){e.target||(e.target=this.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=Lr.ALL);const{clear:t,clearColor:i,target:r}=e;st.shared.setValue(i??this.background.colorRgba),this.renderTarget.clear(r,t,st.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach((e=>{this.runners[e]=new Fr(e)}))}_addSystems(e){let t;for(t in e){const i=e[t];this._addSystem(i.value,i.name)}}_addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const r in this.runners)this.runners[r].add(i);return this}_addPipes(e,t){const i=t.reduce(((e,t)=>(e[t.name]=t.value,e)),{});e.forEach((e=>{const t=e.value,r=e.name,s=i[r];this.renderPipes[r]=new t(this,s?new s:null)}))}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach((e=>{e.destroy()})),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Br())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};zr.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Hr,Wr,Vr=zr;async function Xr(e={}){return void 0!==Wr||(Wr=await(async()=>{const t=ii.get().getNavigator().gpu;if(!t)return!1;try{const i=await t.requestAdapter(e);return await i.requestDevice(),!0}catch(i){return!1}})()),Wr}const Yr=["webgl","webgpu","canvas"];const jr="8.8.0";I.Application;class Kr{constructor(e){this._renderer=e}init(){var e;null==(e=globalThis.__PIXI_RENDERER_INIT__)||e.call(globalThis,this._renderer,jr)}destroy(){this._renderer=null}}Kr.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"initHook",priority:-10};class $r{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this._cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:r}=this._resizeTo;e=i,t=r}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}$r.extension=I.Application;class qr{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ni.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?hi.shared:new hi,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}qr.extension=I.Application;class Zr extends V{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return pe(ce,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return pe(ce,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return pe(ce,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return pe(ce,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return pe(ce,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(e=!1){var t;this.emit("destroy",this),this.removeAllListeners();for(const i in this.chars)null==(t=this.chars[i].texture)||t.destroy();this.chars=null,e&&(this.pages.forEach((e=>e.texture.destroy(!0))),this.pages=null)}}const Jr=[{offset:0,color:"white"},{offset:1,color:"black"}],Qr=class e{constructor(...t){this.uid=de("fillGradient"),this.type="linear",this.colorStops=[];let i=function(e){let t=e[0]??{};("number"==typeof t||e[1])&&(pe("8.5.2","use options object instead"),t={type:"linear",start:{x:e[0],y:e[1]},end:{x:e[2],y:e[3]},textureSpace:e[4],textureSize:e[5]??es.defaultLinearOptions.textureSize});return t}(t);i={..."radial"===i.type?e.defaultRadialOptions:e.defaultLinearOptions,..._e(i)},this._textureSize=i.textureSize,"radial"===i.type?(this.center=i.center,this.outerCenter=i.outerCenter??this.center,this.innerRadius=i.innerRadius,this.outerRadius=i.outerRadius,this.scale=i.scale,this.rotation=i.rotation):(this.start=i.start,this.end=i.end),this.textureSpace=i.textureSpace,this.type=i.type,i.colorStops.forEach((e=>{this.addColorStop(e.offset,e.color)}))}addColorStop(e,t){return this.colorStops.push({offset:e,color:st.shared.setValue(t).toHexa()}),this}buildLinearGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:Jr,t=this._textureSize,{canvas:i,context:r}=is(t,1),s=r.createLinearGradient(0,0,this._textureSize,0);ts(s,e),r.fillStyle=s,r.fillRect(0,0,t,1),this.texture=new Se({source:new si({resource:i})});const{x:n,y:o}=this.start,{x:a,y:l}=this.end,h=new q,d=a-n,u=l-o,c=Math.sqrt(d*d+u*u),p=Math.atan2(u,d);h.scale(c/t,1),h.rotate(p),h.translate(n,o),"local"===this.textureSpace&&h.scale(t,t),this.transform=h}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:Jr,t=this._textureSize,{canvas:i,context:r}=is(t,t),{x:s,y:n}=this.center,{x:o,y:a}=this.outerCenter,l=this.innerRadius,h=this.outerRadius,d=o-h,u=a-h,c=t/(2*h),p=(s-d)*c,g=(n-u)*c,f=r.createRadialGradient(p,g,l*c,(o-d)*c,(a-u)*c,h*c);ts(f,e),r.fillStyle=e[e.length-1].color,r.fillRect(0,0,t,t),r.fillStyle=f,r.translate(p,g),r.rotate(this.rotation),r.scale(1,this.scale),r.translate(-p,-g),r.fillRect(0,0,t,t),this.texture=new Se({source:new si({resource:i,addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"})});const m=new q;m.scale(1/c,1/c),m.translate(d,u),"local"===this.textureSpace&&m.scale(t,t),this.transform=m}get styleKey(){return this.uid}destroy(){var e;null==(e=this.texture)||e.destroy(!0),this.texture=null}};Qr.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256},Qr.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256};let es=Qr;function ts(e,t){for(let i=0;i<t.length;i++){const r=t[i];e.addColorStop(r.offset,r.color)}}function is(e,t){const i=ii.get().createCanvas(e,t),r=i.getContext("2d");return{canvas:i,context:r}}const rs={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class ss{constructor(e,t){this.uid=de("fillPattern"),this.transform=new q,this._styleKey=null,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),t&&(e.source.style.addressModeU=rs[t].addressModeU,e.source.style.addressModeV=rs[t].addressModeV)}setTransform(e){const t=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/t.frame.width,1/t.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}var ns,os;const as=z(function(){if(os)return ns;os=1,ns=function(r){var s=[];return r.replace(t,(function(t,r,n){var o=r.toLowerCase();for(n=function(e){var t=e.match(i);return t?t.map(Number):[]}(n),"m"==o&&n.length>2&&(s.push([r].concat(n.splice(0,2))),o="l",r="m"==r?"l":"L");;){if(n.length==e[o])return n.unshift(r),s.push(n);if(n.length<e[o])throw new Error("malformed path data");s.push([r].concat(n.splice(0,e[o])))}})),s};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi,i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;return ns}());class ls{constructor(e=0,t=0,i=0){this.type="circle",this.x=e,this.y=t,this.radius=i}clone(){return new ls(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-e,s=this.y-t;return r*=r,s*=s,r+s<=i}strokeContains(e,t,i,r=.5){if(0===this.radius)return!1;const s=this.x-e,n=this.y-t,o=this.radius,a=(1-r)*i,l=Math.sqrt(s*s+n*n);return l<=o+a&&l>o-(i-a)}getBounds(e){return e||(e=new le),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=2*this.radius,e.height=2*this.radius,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class hs{constructor(e=0,t=0,i=0,r=0){this.type="ellipse",this.x=e,this.y=t,this.halfWidth=i,this.halfHeight=r}clone(){return new hs(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,t){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(e-this.x)/this.halfWidth,r=(t-this.y)/this.halfHeight;return i*=i,r*=r,i+r<=1}strokeContains(e,t,i,r=.5){const{halfWidth:s,halfHeight:n}=this;if(s<=0||n<=0)return!1;const o=i*(1-r),a=i-o,l=s-a,h=n-a,d=s+o,u=n+o,c=e-this.x,p=t-this.y;return c*c/(l*l)+p*p/(h*h)>1&&c*c/(d*d)+p*p/(u*u)<=1}getBounds(e){return e||(e=new le),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=2*this.halfWidth,e.height=2*this.halfHeight,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function ds(e,t,i,r,s,n){const o=s-i,a=n-r,l=o*o+a*a;let h,d,u=-1;0!==l&&(u=((e-i)*o+(t-r)*a)/l),u<0?(h=i,d=r):u>1?(h=s,d=n):(h=i+u*o,d=r+u*a);const c=e-h,p=t-d;return c*c+p*p}class us{constructor(...e){this.type="polygon";let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){const e=[];for(let i=0,r=t.length;i<r;i++)e.push(t[i].x,t[i].y);t=e}this.points=t,this.closePath=!0}isClockwise(){let e=0;const t=this.points,i=t.length;for(let r=0;r<i;r+=2){const s=t[r],n=t[r+1];e+=(t[(r+2)%i]-s)*(t[(r+3)%i]+n)}return e<0}containsPolygon(e){const t=this.getBounds(undefined),i=e.getBounds(undefined);if(!t.containsRect(i))return!1;const r=e.points;for(let s=0;s<r.length;s+=2){const e=r[s],t=r[s+1];if(!this.contains(e,t))return!1}return!0}clone(){const e=this.points.slice(),t=new us(e);return t.closePath=this.closePath,t}contains(e,t){let i=!1;const r=this.points.length/2;for(let s=0,n=r-1;s<r;n=s++){const r=this.points[2*s],o=this.points[2*s+1],a=this.points[2*n],l=this.points[2*n+1];o>t!=l>t&&e<(t-o)/(l-o)*(a-r)+r&&(i=!i)}return i}strokeContains(e,t,i,r=.5){const s=i*i,n=s*(1-r),o=s-n,{points:a}=this,l=a.length-(this.closePath?0:2);for(let h=0;h<l;h+=2){const i=a[h],r=a[h+1],s=a[(h+2)%a.length],l=a[(h+3)%a.length];if(ds(e,t,i,r,s,l)<=(Math.sign((s-i)*(t-r)-(l-r)*(e-i))<0?o:n))return!0}return!1}getBounds(e){e||(e=new le);const t=this.points;let i=1/0,r=-1/0,s=1/0,n=-1/0;for(let o=0,a=t.length;o<a;o+=2){const e=t[o],a=t[o+1];i=e<i?e:i,r=e>r?e:r,s=a<s?a:s,n=a>n?a:n}return e.x=i,e.width=r-i,e.y=s,e.height=n-s,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce(((e,t)=>`${e}, ${t}`),"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const cs=(e,t,i,r,s,n,o)=>{const a=e-i,l=t-r,h=Math.sqrt(a*a+l*l);return h>=s-n&&h<=s+o};class ps{constructor(e=0,t=0,i=0,r=0,s=20){this.type="roundedRectangle",this.x=e,this.y=t,this.width=i,this.height=r,this.radius=s}getBounds(e){return e||(e=new le),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new ps(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let r=e-(this.x+i),s=t-(this.y+i);const n=i*i;if(r*r+s*s<=n)return!0;if(r=e-(this.x+this.width-i),r*r+s*s<=n)return!0;if(s=t-(this.y+this.height-i),r*r+s*s<=n)return!0;if(r=e-(this.x+i),r*r+s*s<=n)return!0}return!1}strokeContains(e,t,i,r=.5){const{x:s,y:n,width:o,height:a,radius:l}=this,h=i*(1-r),d=i-h,u=s+l,c=n+l,p=s+o,g=n+a;return(e>=s-h&&e<=s+d||e>=p-d&&e<=p+h)&&t>=c&&t<=c+(a-2*l)||((t>=n-h&&t<=n+d||t>=g-d&&t<=g+h)&&e>=u&&e<=u+(o-2*l)||(e<u&&t<c&&cs(e,t,u,c,l,d,h)||e>p-l&&t<c&&cs(e,t,p-l,c,l,d,h)||e>p-l&&t>g-l&&cs(e,t,p-l,g-l,l,d,h)||e<u&&t>g-l&&cs(e,t,u,g-l,l,d,h)))}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const gs=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function fs(e){let t="";for(let i=0;i<e;++i)i>0&&(t+="\nelse "),i<e-1&&(t+=`if(test == ${i}.0){}`);return t}let ms=null;function _s(){var e;if(ms)return ms;const t=rr();return ms=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),ms=function(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const r=gs.replace(/%forloop%/gi,fs(e));if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))break;e=e/2|0}}finally{t.deleteShader(i)}return e}(ms,t),null==(e=t.getExtension("WEBGL_lose_context"))||e.loseContext(),ms}const ys={};function xs(e,t){let i=2166136261;for(let r=0;r<t;r++)i^=e[r].uid,i=Math.imul(i,16777619),i>>>=0;return ys[i]||function(e,t,i){const r={};let s=0;vs||(vs=_s());for(let o=0;o<vs;o++){const i=o<t?e[o]:Se.EMPTY.source;r[s++]=i.source,r[s++]=i.style}const n=new Tr(r);return ys[i]=n,n}(e,t,i)}let vs=0;class bs{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function ws(e,t){const i=e.byteLength/8|0,r=new Float64Array(e,0,i);new Float64Array(t,0,i).set(r);const s=e.byteLength-8*i;if(s>0){const r=new Uint8Array(e,8*i,s);new Uint8Array(t,8*i,s).set(r)}}const Ts={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Es=(e=>(e[e.DISABLED=0]="DISABLED",e[e.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",e[e.MASK_ACTIVE=2]="MASK_ACTIVE",e[e.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",e[e.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",e[e.NONE=5]="NONE",e))(Es||{});function Cs(e,t){return"no-premultiply-alpha"===t.alphaMode&&Ts[e]||e}class Ss{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const t=this.textures[e];this.textures[e]=null,this.ids[t.uid]=null}this.count=0}}class Ns{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Ss,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const As=[];let Ps=0;function Ms(){return Ps>0?As[--Ps]:new Ns}function Rs(e){As[Ps++]=e}let ks=0;const Bs=class e{constructor(t={}){this.uid=de("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],e.defaultOptions.maxTextures=e.defaultOptions.maxTextures??_s(),t={...e.defaultOptions,...t};const{maxTextures:i,attributesInitialSize:r,indicesInitialSize:s}=t;this.attributeBuffer=new bs(4*r),this.indexBuffer=new Uint16Array(s),this.maxTextures=i}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)Rs(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,t){const i=e._batch.textures.ids[t._source.uid];return!(!i&&0!==i)&&(e._textureId=i,e.texture=t,!0)}updateElement(e){this.dirty=!0;const t=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId)}break(e){const t=this._elements;if(!t[this.elementStart])return;let i=Ms(),r=i.textures;r.clear();const s=t[this.elementStart];let n=Cs(s.blendMode,s.texture._source),o=s.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const a=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,h=this.indexBuffer;let d=this._batchIndexSize,u=this._batchIndexStart,c="startBatch";const p=this.maxTextures;for(let g=this.elementStart;g<this.elementSize;++g){const s=t[g];t[g]=null;const f=s.texture._source,m=Cs(s.blendMode,f),_=n!==m||o!==s.topology;f._batchTick!==ks||_?(f._batchTick=ks,(r.count>=p||_)&&(this._finishBatch(i,u,d-u,r,n,o,e,c),c="renderBatch",u=d,n=m,o=s.topology,i=Ms(),r=i.textures,r.clear(),++ks),s._textureId=f._textureBindLocation=r.count,r.ids[f.uid]=r.count,r.textures[r.count++]=f,s._batch=i,d+=s.indexSize,s.packAsQuad?(this.packQuadAttributes(s,a,l,s._attributeStart,s._textureId),this.packQuadIndex(h,s._indexStart,s._attributeStart/this.vertexSize)):(this.packAttributes(s,a,l,s._attributeStart,s._textureId),this.packIndex(s,h,s._indexStart,s._attributeStart/this.vertexSize))):(s._textureId=f._textureBindLocation,d+=s.indexSize,s.packAsQuad?(this.packQuadAttributes(s,a,l,s._attributeStart,s._textureId),this.packQuadIndex(h,s._indexStart,s._attributeStart/this.vertexSize)):(this.packAttributes(s,a,l,s._attributeStart,s._textureId),this.packIndex(s,h,s._indexStart,s._attributeStart/this.vertexSize)),s._batch=i)}r.count>0&&(this._finishBatch(i,u,d-u,r,n,o,e,c),u=d,++ks),this.elementStart=this.elementSize,this._batchIndexStart=u,this._batchIndexSize=d}_finishBatch(e,t,i,r,s,n,o,a){e.gpuBindGroup=null,e.bindGroup=null,e.action=a,e.batcher=this,e.textures=r,e.blendMode=s,e.topology=n,e.start=t,e.size=i,++ks,this.batches[this.batchIndex++]=e,o.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){4*e<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*e)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const t=Math.max(e,2*this.attributeBuffer.size),i=new bs(t);ws(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(e){const t=this.indexBuffer;let i=Math.max(e,1.5*t.length);i+=i%2;const r=i>65535?new Uint32Array(i):new Uint16Array(i);if(r.BYTES_PER_ELEMENT!==t.BYTES_PER_ELEMENT)for(let s=0;s<t.length;s++)r[s]=t[s];else ws(t.buffer,r.buffer);this.indexBuffer=r}packQuadIndex(e,t,i){e[t]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3}packIndex(e,t,i,r){const s=e.indices,n=e.indexSize,o=e.indexOffset,a=e.attributeOffset;for(let l=0;l<n;l++)t[i++]=r+s[l+o]-a}destroy(){for(let e=0;e<this.batches.length;e++)Rs(this.batches[e]);this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};Bs.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Is=Bs;var Os=(e=>(e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE",e[e.STATIC=1024]="STATIC",e))(Os||{});class Ds extends V{constructor(e){let{data:t,size:i}=e;const{usage:r,label:s,shrinkToFit:n}=e;super(),this.uid=de("buffer"),this._resourceType="buffer",this._resourceId=de("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,t instanceof Array&&(t=new Float32Array(t)),this._data=t,i??(i=null==t?void 0:t.byteLength);const o=!!t;this.descriptor={size:i,usage:r,mappedAtCreation:o,label:s},this.shrinkToFit=n??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Os.STATIC)}set static(e){e?this.descriptor.usage|=Os.STATIC:this.descriptor.usage&=~Os.STATIC}setDataWithSize(e,t,i){if(this._updateID++,this._updateSize=t*e.BYTES_PER_ELEMENT,this._data===e)return void(i&&this.emit("update",this));const r=this._data;this._data=e,this._dataInt32=null,r&&r.length===e.length||!this.shrinkToFit&&r&&e.byteLength<r.byteLength?i&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=de("resource"),this.emit("change",this))}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Gs(e,t){if(!(e instanceof Ds)){let i=t?Os.INDEX:Os.VERTEX;e instanceof Array&&(t?(e=new Uint32Array(e),i=Os.INDEX|Os.COPY_DST):(e=new Float32Array(e),i=Os.VERTEX|Os.COPY_DST)),e=new Ds({data:e,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:i})}return e}class Ls extends V{constructor(e={}){super(),this.uid=de("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Pe,this._boundsDirty=!0;const{attributes:t,indexBuffer:i,topology:r}=e;if(this.buffers=[],this.attributes={},t)for(const s in t)this.addAttribute(s,t[s]);this.instanceCount=e.instanceCount??1,i&&this.addIndex(i),this.topology=r||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const t=this.attributes[e];return t.buffer.data.length/(t.stride/4||t.size)}return 0}addAttribute(e,t){const i=function(e){return(e instanceof Ds||Array.isArray(e)||e.BYTES_PER_ELEMENT)&&(e={buffer:e}),e.buffer=Gs(e.buffer,!1),e}(t);-1===this.buffers.indexOf(i.buffer)&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=i}addIndex(e){this.indexBuffer=Gs(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(e,t,i){const r=e.getAttribute(t);if(!r)return i.minX=0,i.minY=0,i.maxX=0,i.maxY=0,i;const s=r.buffer.data;let n=1/0,o=1/0,a=-1/0,l=-1/0;const h=s.BYTES_PER_ELEMENT,d=(r.offset||0)/h,u=(r.stride||8)/h;for(let c=d;c<s.length;c+=u){const e=s[c],t=s[c+1];e>a&&(a=e),t>l&&(l=t),e<n&&(n=e),t<o&&(o=t)}return i.minX=n,i.minY=o,i.maxX=a,i.maxY=l,i}(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach((e=>e.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Fs=new Float32Array(1),Us=new Uint32Array(1);class zs extends Ls{constructor(){const e=new Ds({data:Fs,label:"attribute-batch-buffer",usage:Os.VERTEX|Os.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:24,offset:0},aUV:{buffer:e,format:"float32x2",stride:24,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:24,offset:20}},indexBuffer:new Ds({data:Us,label:"index-batch-buffer",usage:Os.INDEX|Os.COPY_DST,shrinkToFit:!1})})}}function Hs(e,t,i){if(e)for(const r in e){const s=t[r.toLocaleLowerCase()];if(s){let t=e[r];"header"===r&&(t=t.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),i&&s.push(`//----${i}----//`),s.push(t)}else At(`${r} placement hook does not exist in shader`)}}const Ws=/\{\{(.*?)\}\}/g;function Vs(e){var t;const i={};return((null==(t=e.match(Ws))?void 0:t.map((e=>e.replace(/[{()}]/g,""))))??[]).forEach((e=>{i[e]=[]})),i}function Xs(e,t){let i;const r=/@in\s+([^;]+);/g;for(;null!==(i=r.exec(e));)t.push(i[1])}function Ys(e,t,i=!1){const r=[];Xs(t,r),e.forEach((e=>{e.header&&Xs(e.header,r)}));const s=r;i&&s.sort();const n=s.map(((e,t)=>`       @location(${t}) ${e},`)).join("\n");let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`\n${n}\n`),o}function js(e,t){let i;const r=/@out\s+([^;]+);/g;for(;null!==(i=r.exec(e));)t.push(i[1])}function Ks(e,t){let i=e;for(const r in t){const e=t[r];i=e.join("\n").length?i.replace(`{{${r}}}`,`//-----${r} START-----//\n${e.join("\n")}\n//----${r} FINISH----//`):i.replace(`{{${r}}}`,"")}return i}const $s=Object.create(null),qs=new Map;let Zs=0;function Js({template:e,bits:t}){const i=en(e,t);if($s[i])return $s[i];const{vertex:r,fragment:s}=function(e,t){const i=t.map((e=>e.vertex)).filter((e=>!!e)),r=t.map((e=>e.fragment)).filter((e=>!!e));let s=Ys(i,e.vertex,!0);s=function(e,t){const i=[];js(t,i),e.forEach((e=>{e.header&&js(e.header,i)}));let r=0;const s=i.sort().map((e=>e.indexOf("builtin")>-1?e:`@location(${r++}) ${e}`)).join(",\n"),n=i.sort().map((e=>{return`       var ${t=e,t.replace(/@.*?\s+/g,"")};`;var t})).join("\n"),o=`return VSOutput(\n            ${i.sort().map((e=>` ${function(e){const t=/\b(\w+)\s*:/g.exec(e);return t?t[1]:""}(e)}`)).join(",\n")});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`\n${s}\n`),a=a.replace("{{start}}",`\n${n}\n`),a=a.replace("{{return}}",`\n${o}\n`),a}(i,s);const n=Ys(r,e.fragment,!0);return{vertex:s,fragment:n}}(e,t);return $s[i]=tn(r,s,t),$s[i]}function Qs({template:e,bits:t}){const i=en(e,t);return $s[i]||($s[i]=tn(e.vertex,e.fragment,t)),$s[i]}function en(e,t){return t.map((e=>(qs.has(e)||qs.set(e,Zs++),qs.get(e)))).sort(((e,t)=>e-t)).join("-")+e.vertex+e.fragment}function tn(e,t,i){const r=Vs(e),s=Vs(t);return i.forEach((e=>{Hs(e.vertex,r,e.name),Hs(e.fragment,s,e.name)})),{vertex:Ks(e,r),fragment:Ks(t,s)}}const rn={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},sn={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function nn({bits:e,name:t}){const i=Js({template:{fragment:"\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",vertex:"\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n"},bits:[rn,...e]});return _r.from({name:t,vertex:{source:i.vertex,entryPoint:"main"},fragment:{source:i.fragment,entryPoint:"main"}})}function on({bits:e,name:t}){return new dr({name:t,...Qs({template:{vertex:"\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",fragment:"\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n        \n        {{end}}\n    }\n"},bits:[sn,...e]})})}const an={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},ln={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}},hn={};function dn(e){const t=[];if(1===e)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let i=0;for(let r=0;r<e;r++)t.push(`@group(1) @binding(${i++}) var textureSource${r+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${i++}) var textureSampler${r+1}: sampler;`)}return t.join("\n")}function un(e){const t=[];if(1===e)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let i=0;i<e;i++)i===e-1?t.push("  default:{"):t.push(`  case ${i}:{`),t.push(`      outColor = textureSampleGrad(textureSource${i+1}, textureSampler${i+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join("\n")}function cn(e){return hn[e]||(hn[e]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${dn(e)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${un(e)}\n            `}}),hn[e]}const pn={};function gn(e){const t=[];for(let i=0;i<e;i++)i>0&&t.push("else"),i<e-1&&t.push(`if(vTextureId < ${i}.5)`),t.push("{"),t.push(`\toutColor = texture(uTextures[${i}], vUV);`),t.push("}");return t.join("\n")}function fn(e){return pn[e]||(pn[e]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${e}];\n\n            `,main:`\n\n                ${gn(e)}\n            `}}),pn[e]}const mn={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},_n={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},yn={};function xn(e){let t=yn[e];if(t)return t;const i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=r;return t=yn[e]=new wr({uTextures:{value:i,type:"i32",size:e}},{isStatic:!0}),t}class vn extends Cr{constructor(e){super({glProgram:on({name:"batch",bits:[ln,fn(e),_n]}),gpuProgram:nn({name:"batch",bits:[an,cn(e),mn]}),resources:{batchSamplers:xn(e)}})}}let bn=null;const wn=class e extends Is{constructor(){super(...arguments),this.geometry=new zs,this.shader=bn||(bn=new vn(this.maxTextures)),this.name=e.extension.name,this.vertexSize=6}packAttributes(e,t,i,r,s){const n=s<<16|65535&e.roundPixels,o=e.transform,a=o.a,l=o.b,h=o.c,d=o.d,u=o.tx,c=o.ty,{positions:p,uvs:g}=e,f=e.color,m=e.attributeOffset,_=m+e.attributeSize;for(let y=m;y<_;y++){const e=2*y,s=p[e],o=p[e+1];t[r++]=a*s+h*o+u,t[r++]=d*o+l*s+c,t[r++]=g[e],t[r++]=g[e+1],i[r++]=f,i[r++]=n}}packQuadAttributes(e,t,i,r,s){const n=e.texture,o=e.transform,a=o.a,l=o.b,h=o.c,d=o.d,u=o.tx,c=o.ty,p=e.bounds,g=p.maxX,f=p.minX,m=p.maxY,_=p.minY,y=n.uvs,x=e.color,v=s<<16|65535&e.roundPixels;t[r+0]=a*f+h*_+u,t[r+1]=d*_+l*f+c,t[r+2]=y.x0,t[r+3]=y.y0,i[r+4]=x,i[r+5]=v,t[r+6]=a*g+h*_+u,t[r+7]=d*_+l*g+c,t[r+8]=y.x1,t[r+9]=y.y1,i[r+10]=x,i[r+11]=v,t[r+12]=a*g+h*m+u,t[r+13]=d*m+l*g+c,t[r+14]=y.x2,t[r+15]=y.y2,i[r+16]=x,i[r+17]=v,t[r+18]=a*f+h*m+u,t[r+19]=d*m+l*f+c,t[r+20]=y.x3,t[r+21]=y.y3,i[r+22]=x,i[r+23]=v}};wn.extension={type:[I.Batcher],name:"default"};let Tn=wn;function En(e,t,i,r,s){const n=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,d=t.ty;i||(i=0),r||(r=2),s||(s=e.length/r-i);let u=i*r;for(let c=0;c<s;c++){const t=e[u],i=e[u+1];e[u]=n*t+a*i+h,e[u+1]=o*t+l*i+d,u+=r}}const Cn=new q;class Sn{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,t=e>>16|65280&e|(255&e)<<16,i=this.renderable;return i?wt(t,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):t+(255*this.alpha<<24)}get transform(){var e;return(null==(e=this.renderable)?void 0:e.groupTransform)||Cn}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const Nn={extension:{type:I.ShapeBuilder,name:"circle"},build(e,t){let i,r,s,n,o,a;if("circle"===e.type){const t=e;i=t.x,r=t.y,o=a=t.radius,s=n=0}else if("ellipse"===e.type){const t=e;i=t.x,r=t.y,o=t.halfWidth,a=t.halfHeight,s=n=0}else{const t=e,l=t.width/2,h=t.height/2;i=t.x+l,r=t.y+h,o=a=Math.max(0,Math.min(t.radius,Math.min(l,h))),s=l-o,n=h-a}if(!(o>=0&&a>=0&&s>=0&&n>=0))return t;const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(s?4:0)+(n?4:0);if(0===h)return t;if(0===l)return t[0]=t[6]=i+s,t[1]=t[3]=r+n,t[2]=t[4]=i-s,t[5]=t[7]=r-n,t;let d=0,u=4*l+(s?2:0)+2,c=u,p=h,g=s+o,f=n,m=i+g,_=i-g,y=r+f;if(t[d++]=m,t[d++]=y,t[--u]=y,t[--u]=_,n){const e=r-f;t[c++]=_,t[c++]=e,t[--p]=e,t[--p]=m}for(let v=1;v<l;v++){const e=Math.PI/2*(v/l),h=s+Math.cos(e)*o,g=n+Math.sin(e)*a,f=i+h,m=i-h,_=r+g,y=r-g;t[d++]=f,t[d++]=_,t[--u]=_,t[--u]=m,t[c++]=m,t[c++]=y,t[--p]=y,t[--p]=f}g=s,f=n+a,m=i+g,_=i-g,y=r+f;const x=r-f;return t[d++]=m,t[d++]=y,t[--p]=x,t[--p]=m,s&&(t[d++]=_,t[d++]=y,t[--p]=x,t[--p]=_),t},triangulate(e,t,i,r,s,n){if(0===e.length)return;let o=0,a=0;for(let d=0;d<e.length;d+=2)o+=e[d],a+=e[d+1];o/=e.length/2,a/=e.length/2;let l=r;t[l*i]=o,t[l*i+1]=a;const h=l++;for(let d=0;d<e.length;d+=2)t[l*i]=e[d],t[l*i+1]=e[d+1],d>0&&(s[n++]=l,s[n++]=h,s[n++]=l-1),l++;s[n++]=h+1,s[n++]=h,s[n++]=l-1}},An={...Nn,extension:{...Nn.extension,name:"ellipse"}},Pn={...Nn,extension:{...Nn.extension,name:"roundedRectangle"}},Mn=1e-4;function Rn(e,t,i,r,s,n,o,a){let l,h;o?(l=r,h=-i):(l=-r,h=i);const d=e-i*s+l,u=t-r*s+h,c=e+i*n+l,p=t+r*n+h;return a.push(d,u),a.push(c,p),2}function kn(e,t,i,r,s,n,o,a){const l=i-e,h=r-t;let d=Math.atan2(l,h),u=Math.atan2(s-e,n-t);a&&d<u?d+=2*Math.PI:!a&&d>u&&(u+=2*Math.PI);let c=d;const p=u-d,g=Math.abs(p),f=Math.sqrt(l*l+h*h),m=1+(15*g*Math.sqrt(f)/Math.PI|0),_=p/m;if(c+=_,a){o.push(e,t),o.push(i,r);for(let i=1,r=c;i<m;i++,r+=_)o.push(e,t),o.push(e+Math.sin(r)*f,t+Math.cos(r)*f);o.push(e,t),o.push(s,n)}else{o.push(i,r),o.push(e,t);for(let i=1,r=c;i<m;i++,r+=_)o.push(e+Math.sin(r)*f,t+Math.cos(r)*f),o.push(e,t);o.push(s,n),o.push(e,t)}return 2*m}function Bn(e,t,i,r,s,n,o){const a=Gr(e,t,2);if(!a)return;for(let h=0;h<a.length;h+=3)n[o++]=a[h]+s,n[o++]=a[h+1]+s,n[o++]=a[h+2]+s;let l=s*r;for(let h=0;h<e.length;h+=2)i[l]=e[h],i[l+1]=e[h+1],l+=r}const In=[],On={extension:{type:I.ShapeBuilder,name:"polygon"},build(e,t){for(let i=0;i<e.points.length;i++)t[i]=e.points[i];return t},triangulate(e,t,i,r,s,n){Bn(e,In,t,i,r,s,n)}},Dn={extension:{type:I.ShapeBuilder,name:"rectangle"},build(e,t){const i=e,r=i.x,s=i.y,n=i.width,o=i.height;return n>=0&&o>=0?(t[0]=r,t[1]=s,t[2]=r+n,t[3]=s,t[4]=r+n,t[5]=s+o,t[6]=r,t[7]=s+o,t):t},triangulate(e,t,i,r,s,n){let o=0;t[(r*=i)+o]=e[0],t[r+o+1]=e[1],o+=i,t[r+o]=e[2],t[r+o+1]=e[3],o+=i,t[r+o]=e[6],t[r+o+1]=e[7],o+=i,t[r+o]=e[4],t[r+o+1]=e[5],o+=i;const a=r/i;s[n++]=a,s[n++]=a+1,s[n++]=a+2,s[n++]=a+1,s[n++]=a+3,s[n++]=a+2}},Gn={extension:{type:I.ShapeBuilder,name:"triangle"},build:(e,t)=>(t[0]=e.x,t[1]=e.y,t[2]=e.x2,t[3]=e.y2,t[4]=e.x3,t[5]=e.y3,t),triangulate(e,t,i,r,s,n){let o=0;t[(r*=i)+o]=e[0],t[r+o+1]=e[1],o+=i,t[r+o]=e[2],t[r+o+1]=e[3],o+=i,t[r+o]=e[4],t[r+o+1]=e[5];const a=r/i;s[n++]=a,s[n++]=a+1,s[n++]=a+2}},Ln=new q,Fn=new le;const Un={};G.handleByMap(I.ShapeBuilder,Un),G.add(Dn,On,Gn,Nn,An,Pn);const zn=new le,Hn=new q;function Wn(e,t,i){const{vertices:r,uvs:s,indices:n}=i,o=n.length,a=r.length/2,l=[],h=Un.rectangle,d=zn,u=e.image;d.x=e.dx,d.y=e.dy,d.width=e.dw,d.height=e.dh;const c=e.transform;h.build(d,l),c&&En(l,c),h.triangulate(l,r,2,a,n,o);const p=u.uvs;s.push(p.x0,p.y0,p.x1,p.y1,p.x3,p.y3,p.x2,p.y2);const g=ot.get(Sn);g.indexOffset=o,g.indexSize=n.length-o,g.attributeOffset=a,g.attributeSize=r.length/2-a,g.baseColor=e.style,g.alpha=e.alpha,g.texture=u,g.geometryData=i,t.push(g)}function Vn(e,t,i,r,s){const{vertices:n,uvs:o,indices:a}=s;e.shapePrimitives.forEach((({shape:e,transform:l,holes:h})=>{const d=a.length,u=n.length/2,c=[],p=Un[e.type];let g="triangle-list";if(p.build(e,c),l&&En(c,l),i){const i=e.closePath??!0,r=t;r.pixelLine?(!function(e,t,i,r){const s=Mn;if(0===e.length)return;const n=e[0],o=e[1],a=e[e.length-2],l=e[e.length-1],h=t||Math.abs(n-a)<s&&Math.abs(o-l)<s,d=i,u=e.length/2,c=d.length/2;for(let p=0;p<u;p++)d.push(e[2*p]),d.push(e[2*p+1]);for(let p=0;p<u-1;p++)r.push(c+p,c+p+1);h&&r.push(c+u-1,c)}(c,i,n,a),g="line-list"):function(e,t,i,r,s,n){const o=Mn;if(0===e.length)return;const a=t;let l=a.alignment;if(.5!==t.alignment){let t=function(e){const t=e.length;if(t<6)return 1;let i=0;for(let r=0,s=e[t-2],n=e[t-1];r<t;r+=2){const t=e[r],o=e[r+1];i+=(t-s)*(o+n),s=t,n=o}return i<0?-1:1}(e);l=(l-.5)*t+.5}const h=new K(e[0],e[1]),d=new K(e[e.length-2],e[e.length-1]),u=r,c=Math.abs(h.x-d.x)<o&&Math.abs(h.y-d.y)<o;if(u){e=e.slice(),c&&(e.pop(),e.pop(),d.set(e[e.length-2],e[e.length-1]));const t=.5*(h.x+d.x),i=.5*(d.y+h.y);e.unshift(t,i),e.push(t,i)}const p=s,g=e.length/2;let f=e.length;const m=p.length/2,_=a.width/2,y=_*_,x=a.miterLimit*a.miterLimit;let v=e[0],b=e[1],w=e[2],T=e[3],E=0,C=0,S=-(b-T),N=v-w,A=0,P=0,M=Math.sqrt(S*S+N*N);S/=M,N/=M,S*=_,N*=_;const R=2*(1-l),k=2*l;u||("round"===a.cap?f+=kn(v-S*(R-k)*.5,b-N*(R-k)*.5,v-S*R,b-N*R,v+S*k,b+N*k,p,!0)+2:"square"===a.cap&&(f+=Rn(v,b,S,N,R,k,!0,p))),p.push(v-S*R,b-N*R),p.push(v+S*k,b+N*k);for(let B=1;B<g-1;++B){v=e[2*(B-1)],b=e[2*(B-1)+1],w=e[2*B],T=e[2*B+1],E=e[2*(B+1)],C=e[2*(B+1)+1],S=-(b-T),N=v-w,M=Math.sqrt(S*S+N*N),S/=M,N/=M,S*=_,N*=_,A=-(T-C),P=w-E,M=Math.sqrt(A*A+P*P),A/=M,P/=M,A*=_,P*=_;const t=w-v,i=b-T,r=w-E,s=C-T,n=t*r+i*s,o=i*r-s*t,l=o<0;if(Math.abs(o)<.001*Math.abs(n)){p.push(w-S*R,T-N*R),p.push(w+S*k,T+N*k),n>=0&&("round"===a.join?f+=kn(w,T,w-S*R,T-N*R,w-A*R,T-P*R,p,!1)+4:f+=2,p.push(w-A*k,T-P*k),p.push(w+A*R,T+P*R));continue}const h=(-S+v)*(-N+T)-(-S+w)*(-N+b),d=(-A+E)*(-P+T)-(-A+w)*(-P+C),u=(t*d-r*h)/o,c=(s*h-i*d)/o,g=(u-w)*(u-w)+(c-T)*(c-T),m=w+(u-w)*R,I=T+(c-T)*R,O=w-(u-w)*k,D=T-(c-T)*k,G=l?R:k;g<=Math.min(t*t+i*i,r*r+s*s)+G*G*y?"bevel"===a.join||g/y>x?(l?(p.push(m,I),p.push(w+S*k,T+N*k),p.push(m,I),p.push(w+A*k,T+P*k)):(p.push(w-S*R,T-N*R),p.push(O,D),p.push(w-A*R,T-P*R),p.push(O,D)),f+=2):"round"===a.join?l?(p.push(m,I),p.push(w+S*k,T+N*k),f+=kn(w,T,w+S*k,T+N*k,w+A*k,T+P*k,p,!0)+4,p.push(m,I),p.push(w+A*k,T+P*k)):(p.push(w-S*R,T-N*R),p.push(O,D),f+=kn(w,T,w-S*R,T-N*R,w-A*R,T-P*R,p,!1)+4,p.push(w-A*R,T-P*R),p.push(O,D)):(p.push(m,I),p.push(O,D)):(p.push(w-S*R,T-N*R),p.push(w+S*k,T+N*k),"round"===a.join?f+=l?kn(w,T,w+S*k,T+N*k,w+A*k,T+P*k,p,!0)+2:kn(w,T,w-S*R,T-N*R,w-A*R,T-P*R,p,!1)+2:"miter"===a.join&&g/y<=x&&(l?(p.push(O,D),p.push(O,D)):(p.push(m,I),p.push(m,I)),f+=2),p.push(w-A*R,T-P*R),p.push(w+A*k,T+P*k),f+=2)}v=e[2*(g-2)],b=e[2*(g-2)+1],w=e[2*(g-1)],T=e[2*(g-1)+1],S=-(b-T),N=v-w,M=Math.sqrt(S*S+N*N),S/=M,N/=M,S*=_,N*=_,p.push(w-S*R,T-N*R),p.push(w+S*k,T+N*k),u||("round"===a.cap?f+=kn(w-S*(R-k)*.5,T-N*(R-k)*.5,w-S*R,T-N*R,w+S*k,T+N*k,p,!1)+2:"square"===a.cap&&(f+=Rn(w,T,S,N,R,k,!1,p)));for(let B=m;B<f+m-2;++B)v=p[2*B],b=p[2*B+1],w=p[2*(B+1)],T=p[2*(B+1)+1],E=p[2*(B+2)],C=p[2*(B+2)+1],Math.abs(v*(T-C)+w*(C-b)+E*(b-T))<1e-8||n.push(B,B+1,B+2)}(c,r,0,i,n,a)}else if(h){const e=[],t=c.slice();(function(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i].shape,s=[];Un[r.type].build(r,s),t.push(s)}return t})(h).forEach((i=>{e.push(t.length/2),t.push(...i)})),Bn(t,e,n,2,u,a,d)}else p.triangulate(c,n,2,u,a,d);const f=o.length/2,m=t.texture;if(m!==Se.WHITE){const i=function(e,t,i,r){const s=t.matrix?e.copyFrom(t.matrix).invert():e.identity();if("local"===t.textureSpace){const e=i.getBounds(Fn);s.translate(-e.x,-e.y),s.scale(1/e.width,1/e.height)}else{s.translate(t.texture.frame.x,t.texture.frame.y),s.scale(1/t.texture.source.width,1/t.texture.source.height);const e=t.texture.source.style;"clamp-to-edge"===e.addressMode&&(e.addressMode="repeat",e.update())}return r&&s.append(Ln.copyFrom(r).invert()),s}(Hn,t,e,l);!function(e,t,i,r,s,n,o,a=null){let l=0;i*=t,s*=n;const h=a.a,d=a.b,u=a.c,c=a.d,p=a.tx,g=a.ty;for(;l<o;){const o=e[i],a=e[i+1];r[s]=h*o+u*a+p,r[s+1]=d*o+c*a+g,s+=n,i+=t,l++}}(n,2,u,o,f,2,n.length/2-u,i)}else!function(e,t,i,r){let s=0;for(t*=i;s<r;)e[t]=0,e[t+1]=0,t+=i,s++}(o,f,2,n.length/2-u);const _=ot.get(Sn);_.indexOffset=d,_.indexSize=a.length-d,_.attributeOffset=u,_.attributeSize=n.length/2-u,_.baseColor=t.color,_.alpha=t.alpha,_.texture=m,_.geometryData=s,_.topology=g,r.push(_)}))}class Xn{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Yn{constructor(){this.batcher=new Tn,this.instructions=new Lt}init(){this.instructions.reset()}get geometry(){return pe("8.3.4","GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const jn=class e{constructor(e){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),e.renderableGC.addManagedHash(this,"_gpuContextHash"),e.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){e.defaultOptions.bezierSmoothness=(null==t?void 0:t.bezierSmoothness)??e.defaultOptions.bezierSmoothness}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let t=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){t?this._cleanGraphicsContextData(e):t=this._initContext(e),function(e,t){const{geometryData:i,batches:r}=t;r.length=0,i.indices.length=0,i.vertices.length=0,i.uvs.length=0;for(let s=0;s<e.instructions.length;s++){const t=e.instructions[s];if("texture"===t.action)Wn(t.data,r,i);else if("fill"===t.action||"stroke"===t.action){const e="stroke"===t.action,s=t.data.path.shapePath,n=t.data.style,o=t.data.hole;e&&o&&Vn(o.shapePath,n,!0,r,i),o&&(s.shapePrimitives[s.shapePrimitives.length-1].holes=o.shapePath.shapePrimitives),Vn(s,n,e,r,i)}}}(e,t);const i=e.batchMode;e.customShader||"no-batch"===i?t.isBatchable=!1:"auto"===i&&(t.isBatchable=t.geometryData.vertices.length<400),e.dirty=!1}return t}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_initContextRenderData(e){const t=ot.get(Yn),{batches:i,geometryData:r}=this._gpuContextHash[e.uid],s=r.vertices.length,n=r.indices.length;for(let h=0;h<i.length;h++)i[h].applyTransform=!1;const o=t.batcher;o.ensureAttributeBuffer(s),o.ensureIndexBuffer(n),o.begin();for(let h=0;h<i.length;h++){const e=i[h];o.add(e)}o.finish(t.instructions);const a=o.geometry;a.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),a.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const l=o.batches;for(let h=0;h<l.length;h++){const e=l[h];e.bindGroup=xs(e.textures.textures,e.textures.count)}return this._graphicsDataContextHash[e.uid]=t,t}_initContext(e){const t=new Xn;return t.context=e,this._gpuContextHash[e.uid]=t,e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){const t=this._gpuContextHash[e.uid];t.isBatchable||this._graphicsDataContextHash[e.uid]&&(ot.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),t.batches&&t.batches.forEach((e=>{ot.return(e)}))}destroy(){for(const e in this._gpuContextHash)this._gpuContextHash[e]&&this.onGraphicsContextDestroy(this._gpuContextHash[e].context)}};jn.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"graphicsContext"},jn.defaultOptions={bezierSmoothness:.5};let Kn=jn;const $n=1.1920929e-7;function qn(e,t,i,r,s,n,o,a,l,h){let d=(1-Math.min(.99,Math.max(0,h??Kn.defaultOptions.bezierSmoothness)))/1;return d*=d,function(e,t,i,r,s,n,o,a,l,h){Zn(e,t,i,r,s,n,o,a,l,h,0),l.push(o,a)}(t,i,r,s,n,o,a,l,e,d),e}function Zn(e,t,i,r,s,n,o,a,l,h,d){if(d>8)return;const u=(e+i)/2,c=(t+r)/2,p=(i+s)/2,g=(r+n)/2,f=(s+o)/2,m=(n+a)/2,_=(u+p)/2,y=(c+g)/2,x=(p+f)/2,v=(g+m)/2,b=(_+x)/2,w=(y+v)/2;if(d>0){let d=o-e,u=a-t;const c=Math.abs((i-o)*u-(r-a)*d),p=Math.abs((s-o)*u-(n-a)*d);if(c>$n&&p>$n){if((c+p)*(c+p)<=h*(d*d+u*u))return void l.push(b,w)}else if(c>$n){if(c*c<=h*(d*d+u*u))return void l.push(b,w)}else if(p>$n){if(p*p<=h*(d*d+u*u))return void l.push(b,w)}else if(d=b-(e+o)/2,u=w-(t+a)/2,d*d+u*u<=h)return void l.push(b,w)}Zn(e,t,u,c,_,y,b,w,l,h,d+1),Zn(b,w,x,v,f,m,o,a,l,h,d+1)}function Jn(e,t,i,r,s,n,o,a){let l=(1-Math.min(.99,Math.max(0,a??Kn.defaultOptions.bezierSmoothness)))/1;return l*=l,function(e,t,i,r,s,n,o,a){Qn(o,e,t,i,r,s,n,a,0),o.push(s,n)}(t,i,r,s,n,o,e,l),e}function Qn(e,t,i,r,s,n,o,a,l){if(l>8)return;const h=(t+r)/2,d=(i+s)/2,u=(r+n)/2,c=(s+o)/2,p=(h+u)/2,g=(d+c)/2;let f=n-t,m=o-i;const _=Math.abs((r-n)*m-(s-o)*f);if(_>1.1920929e-7){if(_*_<=a*(f*f+m*m))return void e.push(p,g)}else if(f=p-(t+n)/2,m=g-(i+o)/2,f*f+m*m<=a)return void e.push(p,g);Qn(e,t,i,h,d,p,g,a,l+1),Qn(e,p,g,u,c,n,o,a,l+1)}function eo(e,t,i,r,s,n,o,a){let l=Math.abs(s-n);(!o&&s>n||o&&n>s)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(l/Math.PI))));let h=l/(a=Math.max(a,3)),d=s;h*=o?-1:1;for(let u=0;u<a+1;u++){const s=t+Math.cos(d)*r,n=i+Math.sin(d)*r;e.push(s,n),d+=h}}const to=2*Math.PI,io={centerX:0,centerY:0,ang1:0,ang2:0},ro=({x:e,y:t},i,r,s,n,o,a,l)=>{const h=s*(e*=i)-n*(t*=r),d=n*e+s*t;return l.x=h+o,l.y=d+a,l};function so(e,t){const i=-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),r=1.5707963267948966===t?.551915024494:i,s=Math.cos(e),n=Math.sin(e),o=Math.cos(e+t),a=Math.sin(e+t);return[{x:s-n*r,y:n+s*r},{x:o+a*r,y:a-o*r},{x:o,y:a}]}const no=(e,t,i,r)=>{let s=e*i+t*r;return s>1&&(s=1),s<-1&&(s=-1),(e*r-t*i<0?-1:1)*Math.acos(s)};function oo(e,t,i,r,s,n,o,a=0,l=0,h=0){if(0===n||0===o)return;const d=Math.sin(a*to/360),u=Math.cos(a*to/360),c=u*(t-r)/2+d*(i-s)/2,p=-d*(t-r)/2+u*(i-s)/2;if(0===c&&0===p)return;n=Math.abs(n),o=Math.abs(o);const g=Math.pow(c,2)/Math.pow(n,2)+Math.pow(p,2)/Math.pow(o,2);g>1&&(n*=Math.sqrt(g),o*=Math.sqrt(g)),((e,t,i,r,s,n,o,a,l,h,d,u,c)=>{const p=Math.pow(s,2),g=Math.pow(n,2),f=Math.pow(d,2),m=Math.pow(u,2);let _=p*g-p*m-g*f;_<0&&(_=0),_/=p*m+g*f,_=Math.sqrt(_)*(o===a?-1:1);const y=_*s/n*u,x=_*-n/s*d,v=h*y-l*x+(e+i)/2,b=l*y+h*x+(t+r)/2,w=(d-y)/s,T=(u-x)/n,E=(-d-y)/s,C=(-u-x)/n,S=no(1,0,w,T);let N=no(w,T,E,C);0===a&&N>0&&(N-=to),1===a&&N<0&&(N+=to),c.centerX=v,c.centerY=b,c.ang1=S,c.ang2=N})(t,i,r,s,n,o,l,h,d,u,c,p,io);let{ang1:f,ang2:m}=io;const{centerX:_,centerY:y}=io;let x=Math.abs(m)/(to/4);Math.abs(1-x)<1e-7&&(x=1);const v=Math.max(Math.ceil(x),1);m/=v;let b=e[e.length-2],w=e[e.length-1];const T={x:0,y:0};for(let E=0;E<v;E++){const t=so(f,m),{x:i,y:r}=ro(t[0],n,o,u,d,_,y,T),{x:s,y:a}=ro(t[1],n,o,u,d,_,y,T),{x:l,y:h}=ro(t[2],n,o,u,d,_,y,T);qn(e,b,w,i,r,s,a,l,h),b=l,w=h,f+=m}}const ao=new le;class lo{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Pe,this._graphicsPath2D=e,this.signed=e.checkForHoles}moveTo(e,t){return this.startPoly(e,t),this}lineTo(e,t){this._ensurePoly();const i=this._currentPoly.points,r=i[i.length-2],s=i[i.length-1];return r===e&&s===t||i.push(e,t),this}arc(e,t,i,r,s,n){this._ensurePoly(!1);return eo(this._currentPoly.points,e,t,i,r,s,n),this}arcTo(e,t,i,r,s){this._ensurePoly();return function(e,t,i,r,s,n){const o=e[e.length-2],a=e[e.length-1]-i,l=o-t,h=s-i,d=r-t,u=Math.abs(a*d-l*h);if(u<1e-8||0===n)return void(e[e.length-2]===t&&e[e.length-1]===i||e.push(t,i));const c=a*a+l*l,p=h*h+d*d,g=a*h+l*d,f=n*Math.sqrt(c)/u,m=n*Math.sqrt(p)/u,_=f*g/c,y=m*g/p,x=f*d+m*l,v=f*h+m*a,b=l*(m+_),w=a*(m+_),T=d*(f+y),E=h*(f+y);eo(e,x+t,v+i,n,Math.atan2(w-v,b-x),Math.atan2(E-v,T-x),l*h>d*a)}(this._currentPoly.points,e,t,i,r,s),this}arcToSvg(e,t,i,r,s,n,o){return oo(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,n,o,e,t,i,r,s),this}bezierCurveTo(e,t,i,r,s,n,o){this._ensurePoly();const a=this._currentPoly;return qn(this._currentPoly.points,a.lastX,a.lastY,e,t,i,r,s,n,o),this}quadraticCurveTo(e,t,i,r,s){this._ensurePoly();const n=this._currentPoly;return Jn(this._currentPoly.points,n.lastX,n.lastY,e,t,i,r,s),this}closePath(){return this.endPoly(!0),this}addPath(e,t){this.endPoly(),t&&!t.isIdentity()&&(e=e.clone(!0)).transform(t);const i=this.shapePrimitives,r=i.length;for(let s=0;s<e.instructions.length;s++){const t=e.instructions[s];this[t.action](...t.data)}if(e.checkForHoles&&i.length-r>1){let e=null;for(let t=r;t<i.length;t++){const r=i[t];if("polygon"===r.shape.type){const s=r.shape,n=null==e?void 0:e.shape;n&&n.containsPolygon(s)?(e.holes||(e.holes=[]),e.holes.push(r),i.copyWithin(t,t+1),i.length--,t--):e=r}}}return this}finish(e=!1){this.endPoly(e)}rect(e,t,i,r,s){return this.drawShape(new le(e,t,i,r),s),this}circle(e,t,i,r){return this.drawShape(new ls(e,t,i),r),this}poly(e,t,i){const r=new us(e);return r.closePath=t,this.drawShape(r,i),this}regularPoly(e,t,i,r,s=0,n){r=Math.max(0|r,3);const o=-1*Math.PI/2+s,a=2*Math.PI/r,l=[];for(let h=0;h<r;h++){const r=o-h*a;l.push(e+i*Math.cos(r),t+i*Math.sin(r))}return this.poly(l,!0,n),this}roundPoly(e,t,i,r,s,n=0,o){if(r=Math.max(0|r,3),s<=0)return this.regularPoly(e,t,i,r,n);const a=i*Math.sin(Math.PI/r)-.001;s=Math.min(s,a);const l=-1*Math.PI/2+n,h=2*Math.PI/r,d=(r-2)*Math.PI/r/2;for(let u=0;u<r;u++){const r=u*h+l,n=e+i*Math.cos(r),a=t+i*Math.sin(r),c=r+Math.PI+d,p=r-Math.PI-d,g=n+s*Math.cos(c),f=a+s*Math.sin(c),m=n+s*Math.cos(p),_=a+s*Math.sin(p);0===u?this.moveTo(g,f):this.lineTo(g,f),this.quadraticCurveTo(n,a,m,_,o)}return this.closePath()}roundShape(e,t,i=!1,r){return e.length<3?this:(i?function(e,t,i,r){const s=(e,t)=>Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2),n=(e,t,i)=>({x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}),o=t.length;for(let a=0;a<o;a++){const l=t[(a+1)%o],h=l.radius??i;if(h<=0){0===a?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y);continue}const d=t[a],u=t[(a+2)%o],c=s(d,l);let p;p=c<1e-4?l:n(l,d,Math.min(c/2,h)/c);const g=s(u,l);let f;f=g<1e-4?l:n(l,u,Math.min(g/2,h)/g),0===a?e.moveTo(p.x,p.y):e.lineTo(p.x,p.y),e.quadraticCurveTo(l.x,l.y,f.x,f.y,r)}}(this,e,t,r):function(e,t,i){const r=(e,t)=>{const i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);return{len:s,nx:i/s,ny:r/s}},s=(t,i)=>{0===t?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)};let n=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],l=a.radius??i;if(l<=0){s(o,a),n=a;continue}const h=t[(o+1)%t.length],d=r(a,n),u=r(a,h);if(d.len<1e-4||u.len<1e-4){s(o,a),n=a;continue}let c=Math.asin(d.nx*u.ny-d.ny*u.nx),p=1,g=!1;d.nx*u.nx-d.ny*-u.ny<0?c<0?c=Math.PI+c:(c=Math.PI-c,p=-1,g=!0):c>0&&(p=-1,g=!0);const f=c/2;let m,_=Math.abs(Math.cos(f)*l/Math.sin(f));_>Math.min(d.len/2,u.len/2)?(_=Math.min(d.len/2,u.len/2),m=Math.abs(_*Math.sin(f)/Math.cos(f))):m=l;const y=a.x+u.nx*_+-u.ny*m*p,x=a.y+u.ny*_+u.nx*m*p,v=Math.atan2(d.ny,d.nx)+Math.PI/2*p,b=Math.atan2(u.ny,u.nx)-Math.PI/2*p;0===o&&e.moveTo(y+Math.cos(v)*m,x+Math.sin(v)*m),e.arc(y,x,m,v,b,g),n=a}}(this,e,t),this.closePath())}filletRect(e,t,i,r,s){if(0===s)return this.rect(e,t,i,r);const n=Math.min(i,r)/2,o=Math.min(n,Math.max(-n,s)),a=e+i,l=t+r,h=o<0?-o:0,d=Math.abs(o);return this.moveTo(e,t+d).arcTo(e+h,t+h,e+d,t,d).lineTo(a-d,t).arcTo(a-h,t+h,a,t+d,d).lineTo(a,l-d).arcTo(a-h,l-h,e+i-d,l,d).lineTo(e+d,l).arcTo(e+h,l-h,e,l-d,d).closePath()}chamferRect(e,t,i,r,s,n){if(s<=0)return this.rect(e,t,i,r);const o=Math.min(s,Math.min(i,r)/2),a=e+i,l=t+r,h=[e+o,t,a-o,t,a,t+o,a,l-o,a-o,l,e+o,l,e,l-o,e,t+o];for(let d=h.length-1;d>=2;d-=2)h[d]===h[d-2]&&h[d-1]===h[d-3]&&h.splice(d-1,2);return this.poly(h,!0,n)}ellipse(e,t,i,r,s){return this.drawShape(new hs(e,t,i,r),s),this}roundRect(e,t,i,r,s,n){return this.drawShape(new ps(e,t,i,r,s),n),this}drawShape(e,t){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:t}),this}startPoly(e,t){let i=this._currentPoly;return i&&this.endPoly(),i=new us,i.points.push(e,t),this._currentPoly=i,this}endPoly(e=!1){const t=this._currentPoly;return t&&t.points.length>2&&(t.closePath=e,this.shapePrimitives.push({shape:t})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new us,e)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let t=e.shape.x,i=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const r=e.transform,s=t;t=r.a*t+r.c*i+r.tx,i=r.b*s+r.d*i+r.ty}this._currentPoly.points.push(t,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let t=0;t<e.instructions.length;t++){const i=e.instructions[t];this[i.action](...i.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const t=this.shapePrimitives;for(let i=0;i<t.length;i++){const r=t[i],s=r.shape.getBounds(ao);r.transform?e.addRect(s,r.transform):e.addRect(s)}return e}}class ho{constructor(e,t=!1){this.instructions=[],this.uid=de("graphicsPath"),this._dirty=!0,this.checkForHoles=t,"string"==typeof e?function(e,t){const i=as(e),r=[];let s=null,n=0,o=0;for(let a=0;a<i.length;a++){const e=i[a],l=e[0],h=e;switch(l){case"M":n=h[1],o=h[2],t.moveTo(n,o);break;case"m":n+=h[1],o+=h[2],t.moveTo(n,o);break;case"H":n=h[1],t.lineTo(n,o);break;case"h":n+=h[1],t.lineTo(n,o);break;case"V":o=h[1],t.lineTo(n,o);break;case"v":o+=h[1],t.lineTo(n,o);break;case"L":n=h[1],o=h[2],t.lineTo(n,o);break;case"l":n+=h[1],o+=h[2],t.lineTo(n,o);break;case"C":n=h[5],o=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],n,o);break;case"c":t.bezierCurveTo(n+h[1],o+h[2],n+h[3],o+h[4],n+h[5],o+h[6]),n+=h[5],o+=h[6];break;case"S":n=h[3],o=h[4],t.bezierCurveToShort(h[1],h[2],n,o);break;case"s":t.bezierCurveToShort(n+h[1],o+h[2],n+h[3],o+h[4]),n+=h[3],o+=h[4];break;case"Q":n=h[3],o=h[4],t.quadraticCurveTo(h[1],h[2],n,o);break;case"q":t.quadraticCurveTo(n+h[1],o+h[2],n+h[3],o+h[4]),n+=h[3],o+=h[4];break;case"T":n=h[1],o=h[2],t.quadraticCurveToShort(n,o);break;case"t":n+=h[1],o+=h[2],t.quadraticCurveToShort(n,o);break;case"A":n=h[6],o=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],n,o);break;case"a":n+=h[6],o+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],n,o);break;case"Z":case"z":t.closePath(),r.length>0&&(s=r.pop(),s?(n=s.startX,o=s.startY):(n=0,o=0)),s=null;break;default:At(`Unknown SVG path command: ${l}`)}"Z"!==l&&"z"!==l&&null===s&&(s={startX:n,startY:o},r.push(s))}}(e,this):this.instructions=(null==e?void 0:e.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new lo(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,t){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,t]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,t,i,r,s){const n=this.instructions[this.instructions.length-1],o=this.getLastPoint(K.shared);let a=0,l=0;if(n&&"bezierCurveTo"===n.action){a=n.data[2],l=n.data[3];const e=o.x,t=o.y;a=e+(e-a),l=t+(t-l)}else a=o.x,l=o.y;return this.instructions.push({action:"bezierCurveTo",data:[a,l,e,t,i,r,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,t,i){const r=this.instructions[this.instructions.length-1],s=this.getLastPoint(K.shared);let n=0,o=0;if(r&&"quadraticCurveTo"===r.action){n=r.data[0],o=r.data[1];const e=s.x,t=s.y;n=e+(e-n),o=t+(t-o)}else n=s.x,o=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,o,e,t,i]}),this._dirty=!0,this}rect(e,t,i,r,s){return this.instructions.push({action:"rect",data:[e,t,i,r,s]}),this._dirty=!0,this}circle(e,t,i,r){return this.instructions.push({action:"circle",data:[e,t,i,r]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,t,i,r,s,n,o){s||(s=r/2);const a=-1*Math.PI/2+n,l=2*i,h=2*Math.PI/l,d=[];for(let u=0;u<l;u++){const i=u%2?s:r,n=u*h+a;d.push(e+i*Math.cos(n),t+i*Math.sin(n))}return this.poly(d,!0,o),this}clone(e=!1){const t=new ho;if(t.checkForHoles=this.checkForHoles,e)for(let i=0;i<this.instructions.length;i++){const e=this.instructions[i];t.instructions.push({action:e.action,data:e.data.slice()})}else t.instructions=this.instructions.slice();return t}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const t=e.a,i=e.b,r=e.c,s=e.d,n=e.tx,o=e.ty;let a=0,l=0,h=0,d=0,u=0,c=0,p=0,g=0;for(let f=0;f<this.instructions.length;f++){const m=this.instructions[f],_=m.data;switch(m.action){case"moveTo":case"lineTo":a=_[0],l=_[1],_[0]=t*a+r*l+n,_[1]=i*a+s*l+o;break;case"bezierCurveTo":h=_[0],d=_[1],u=_[2],c=_[3],a=_[4],l=_[5],_[0]=t*h+r*d+n,_[1]=i*h+s*d+o,_[2]=t*u+r*c+n,_[3]=i*u+s*c+o,_[4]=t*a+r*l+n,_[5]=i*a+s*l+o;break;case"quadraticCurveTo":h=_[0],d=_[1],a=_[2],l=_[3],_[0]=t*h+r*d+n,_[1]=i*h+s*d+o,_[2]=t*a+r*l+n,_[3]=i*a+s*l+o;break;case"arcToSvg":a=_[5],l=_[6],p=_[0],g=_[1],_[0]=t*p+r*g,_[1]=i*p+s*g,_[5]=t*a+r*l+n,_[6]=i*a+s*l+o;break;case"circle":_[4]=uo(_[3],e);break;case"rect":_[4]=uo(_[4],e);break;case"ellipse":_[8]=uo(_[8],e);break;case"roundRect":_[5]=uo(_[5],e);break;case"addPath":_[0].transform(e);break;case"poly":_[2]=uo(_[2],e);break;default:At("unknown transform action",m.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let t=this.instructions.length-1,i=this.instructions[t];if(!i)return e.x=0,e.y=0,e;for(;"closePath"===i.action;){if(t--,t<0)return e.x=0,e.y=0,e;i=this.instructions[t]}switch(i.action){case"moveTo":case"lineTo":e.x=i.data[0],e.y=i.data[1];break;case"quadraticCurveTo":e.x=i.data[2],e.y=i.data[3];break;case"bezierCurveTo":e.x=i.data[4],e.y=i.data[5];break;case"arc":case"arcToSvg":e.x=i.data[5],e.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(e)}return e}}function uo(e,t){return e?e.prepend(t):t.clone()}function co(e,t,i){const r=e.getAttribute(t);return r?Number(r):i}function po(e){const t=co(e,"x1",0),i=co(e,"y1",0),r=co(e,"x2",1),s=co(e,"y2",0),n=e.getAttribute("gradientUnits")||"objectBoundingBox",o=new es(t,i,r,s,"objectBoundingBox"===n?"local":"global");for(let a=0;a<e.children.length;a++){const t=e.children[a],i=co(t,"offset",0),r=st.shared.setValue(t.getAttribute("stop-color")).toNumber();o.addColorStop(i,r)}return o}function go(e){return At("[SVG Parser] Radial gradients are not yet supported"),new es(0,0,1,0)}function fo(e){const t=e.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const mo={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function _o(e,t){const i=e.getAttribute("style"),r={},s={},n={strokeStyle:r,fillStyle:s,useFill:!1,useStroke:!1};for(const o in mo){const i=e.getAttribute(o);i&&yo(t,n,o,i.trim())}if(i){const e=i.split(";");for(let i=0;i<e.length;i++){const r=e[i].trim(),[s,o]=r.split(":");mo[s]&&yo(t,n,s,o.trim())}}return{strokeStyle:n.useStroke?r:null,fillStyle:n.useFill?s:null,useFill:n.useFill,useStroke:n.useStroke}}function yo(e,t,i,r){switch(i){case"stroke":if("none"!==r){if(r.startsWith("url(")){const i=fo(r);t.strokeStyle.fill=e.defs[i]}else t.strokeStyle.color=st.shared.setValue(r).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(r);break;case"fill":if("none"!==r){if(r.startsWith("url(")){const i=fo(r);t.fillStyle.fill=e.defs[i]}else t.fillStyle.color=st.shared.setValue(r).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(r);break;case"stroke-opacity":t.strokeStyle.alpha=Number(r);break;case"opacity":t.fillStyle.alpha=Number(r),t.strokeStyle.alpha=Number(r)}}function xo(e,t){if("string"==typeof e){const t=document.createElement("div");t.innerHTML=e.trim(),e=t.querySelector("svg")}const i={context:t,defs:{},path:new ho};!function(e,t){const i=e.querySelectorAll("defs");for(let r=0;r<i.length;r++){const e=i[r];for(let i=0;i<e.children.length;i++){const r=e.children[i];switch(r.nodeName.toLowerCase()){case"lineargradient":t.defs[r.id]=po(r);break;case"radialgradient":t.defs[r.id]=go()}}}}(e,i);const r=e.children,{fillStyle:s,strokeStyle:n}=_o(e,i);for(let o=0;o<r.length;o++){const e=r[o];"defs"!==e.nodeName.toLowerCase()&&vo(e,i,s,n)}return t}function vo(e,t,i,r){const s=e.children,{fillStyle:n,strokeStyle:o}=_o(e,t);n&&i?i={...i,...n}:n&&(i=n),o&&r?r={...r,...o}:o&&(r=o);const a=!i&&!r;let l,h,d,u,c,p,g,f,m,_,y,x,v,b,w,T,E;switch(a&&(i={color:0}),e.nodeName.toLowerCase()){case"path":b=e.getAttribute("d"),"evenodd"===e.getAttribute("fill-rule")&&At("SVG Evenodd fill rule not supported, your svg may render incorrectly"),w=new ho(b,!0),t.context.path(w),i&&t.context.fill(i),r&&t.context.stroke(r);break;case"circle":g=co(e,"cx",0),f=co(e,"cy",0),m=co(e,"r",0),t.context.ellipse(g,f,m,m),i&&t.context.fill(i),r&&t.context.stroke(r);break;case"rect":l=co(e,"x",0),h=co(e,"y",0),T=co(e,"width",0),E=co(e,"height",0),_=co(e,"rx",0),y=co(e,"ry",0),_||y?t.context.roundRect(l,h,T,E,_||y):t.context.rect(l,h,T,E),i&&t.context.fill(i),r&&t.context.stroke(r);break;case"ellipse":g=co(e,"cx",0),f=co(e,"cy",0),_=co(e,"rx",0),y=co(e,"ry",0),t.context.beginPath(),t.context.ellipse(g,f,_,y),i&&t.context.fill(i),r&&t.context.stroke(r);break;case"line":d=co(e,"x1",0),u=co(e,"y1",0),c=co(e,"x2",0),p=co(e,"y2",0),t.context.beginPath(),t.context.moveTo(d,u),t.context.lineTo(c,p),r&&t.context.stroke(r);break;case"polygon":v=e.getAttribute("points"),x=v.match(/\d+/g).map((e=>parseInt(e,10))),t.context.poly(x,!0),i&&t.context.fill(i),r&&t.context.stroke(r);break;case"polyline":v=e.getAttribute("points"),x=v.match(/\d+/g).map((e=>parseInt(e,10))),t.context.poly(x,!1),r&&t.context.stroke(r);break;case"g":case"svg":break;default:At(`[SVG parser] <${e.nodeName}> elements unsupported`)}a&&(i=null);for(let C=0;C<s.length;C++)vo(s[C],t,i,r)}function bo(e){return e instanceof ss}function wo(e){return e instanceof es}function To(e,t,i){return e.fill=t,e.color=16777215,e.texture=t.texture,e.matrix=t.transform,{...i,...e}}function Eo(e,t,i){return t.buildGradient(),e.fill=t,e.color=16777215,e.texture=t.texture,e.matrix=t.transform,e.textureSpace=t.textureSpace,{...i,...e}}function Co(e,t){if(null==e)return null;const i={},r=e;return function(e){return st.isColorLike(e)}(e)?function(e,t,i){const r=st.shared.setValue(t??0);return e.color=r.toNumber(),e.alpha=1===r.alpha?i.alpha:r.alpha,e.texture=Se.WHITE,{...i,...e}}(i,e,t):function(e){return e instanceof Se}(e)?function(e,t,i){return e.texture=t,{...i,...e}}(i,e,t):bo(e)?To(i,e,t):wo(e)?Eo(i,e,t):r.fill&&bo(r.fill)?To(r,r.fill,t):r.fill&&wo(r.fill)?Eo(r,r.fill,t):function(e,t){const i={...t,...e},r=st.shared.setValue(i.color);return i.alpha*=r.alpha,i.color=r.toNumber(),i}(r,t)}function So(e,t){const{width:i,alignment:r,miterLimit:s,cap:n,join:o,pixelLine:a,...l}=t,h=Co(e,l);return h?{width:i,alignment:r,miterLimit:s,cap:n,join:o,pixelLine:a,...h}:null}const No=new K,Ao=new q,Po=class e extends V{constructor(){super(...arguments),this.uid=de("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new ho,this._transform=new q,this._fillStyle={...e.defaultFillStyle},this._strokeStyle={...e.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Pe,this._boundsDirty=!0}clone(){const t=new e;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Co(t,e.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=So(t,e.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Co(t,e.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Co(t,e.defaultStrokeStyle),this}texture(e,t,i,r,s,n){return this.instructions.push({action:"texture",data:{image:e,dx:i||0,dy:r||0,dw:s||e.frame.width,dh:n||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:t?st.shared.setValue(t).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new ho,this}fill(t,i){let r;const s=this.instructions[this.instructions.length-1];return r=0===this._tick&&s&&"stroke"===s.action?s.data.path:this._activePath.clone(),r?(null!=t&&(void 0!==i&&"number"==typeof t&&(pe(ce,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:i}),this._fillStyle=Co(t,e.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:t}=this._activePath.getLastPoint(K.shared);this._activePath.clear(),this._activePath.moveTo(e,t)}stroke(t){let i;const r=this.instructions[this.instructions.length-1];return i=0===this._tick&&r&&"fill"===r.action?r.data.path:this._activePath.clone(),i?(null!=t&&(this._strokeStyle=So(t,e.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const t=this.instructions[this.instructions.length-1-e],i=this._activePath.clone();if(t&&("stroke"===t.action||"fill"===t.action)){if(!t.data.hole){t.data.hole=i;break}t.data.hole.addPath(i)}}return this._initNextPathLocation(),this}arc(e,t,i,r,s,n){this._tick++;const o=this._transform;return this._activePath.arc(o.a*e+o.c*t+o.tx,o.b*e+o.d*t+o.ty,i,r,s,n),this}arcTo(e,t,i,r,s){this._tick++;const n=this._transform;return this._activePath.arcTo(n.a*e+n.c*t+n.tx,n.b*e+n.d*t+n.ty,n.a*i+n.c*r+n.tx,n.b*i+n.d*r+n.ty,s),this}arcToSvg(e,t,i,r,s,n,o){this._tick++;const a=this._transform;return this._activePath.arcToSvg(e,t,i,r,s,a.a*n+a.c*o+a.tx,a.b*n+a.d*o+a.ty),this}bezierCurveTo(e,t,i,r,s,n,o){this._tick++;const a=this._transform;return this._activePath.bezierCurveTo(a.a*e+a.c*t+a.tx,a.b*e+a.d*t+a.ty,a.a*i+a.c*r+a.tx,a.b*i+a.d*r+a.ty,a.a*s+a.c*n+a.tx,a.b*s+a.d*n+a.ty,o),this}closePath(){var e;return this._tick++,null==(e=this._activePath)||e.closePath(),this}ellipse(e,t,i,r){return this._tick++,this._activePath.ellipse(e,t,i,r,this._transform.clone()),this}circle(e,t,i){return this._tick++,this._activePath.circle(e,t,i,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,t){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*e+i.c*t+i.tx,i.b*e+i.d*t+i.ty),this}moveTo(e,t){this._tick++;const i=this._transform,r=this._activePath.instructions,s=i.a*e+i.c*t+i.tx,n=i.b*e+i.d*t+i.ty;return 1===r.length&&"moveTo"===r[0].action?(r[0].data[0]=s,r[0].data[1]=n,this):(this._activePath.moveTo(s,n),this)}quadraticCurveTo(e,t,i,r,s){this._tick++;const n=this._transform;return this._activePath.quadraticCurveTo(n.a*e+n.c*t+n.tx,n.b*e+n.d*t+n.ty,n.a*i+n.c*r+n.tx,n.b*i+n.d*r+n.ty,s),this}rect(e,t,i,r){return this._tick++,this._activePath.rect(e,t,i,r,this._transform.clone()),this}roundRect(e,t,i,r,s){return this._tick++,this._activePath.roundRect(e,t,i,r,s,this._transform.clone()),this}poly(e,t){return this._tick++,this._activePath.poly(e,t,this._transform.clone()),this}regularPoly(e,t,i,r,s=0,n){return this._tick++,this._activePath.regularPoly(e,t,i,r,s,n),this}roundPoly(e,t,i,r,s,n){return this._tick++,this._activePath.roundPoly(e,t,i,r,s,n),this}roundShape(e,t,i,r){return this._tick++,this._activePath.roundShape(e,t,i,r),this}filletRect(e,t,i,r,s){return this._tick++,this._activePath.filletRect(e,t,i,r,s),this}chamferRect(e,t,i,r,s,n){return this._tick++,this._activePath.chamferRect(e,t,i,r,s,n),this}star(e,t,i,r,s=0,n=0){return this._tick++,this._activePath.star(e,t,i,r,s,n,this._transform.clone()),this}svg(e){return this._tick++,xo(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,t=e){return this._transform.scale(e,t),this}setTransform(e,t,i,r,s,n){return e instanceof q?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,t,i,r,s,n),this)}transform(e,t,i,r,s,n){return e instanceof q?(this._transform.append(e),this):(Ao.set(e,t,i,r,s,n),this._transform.append(Ao),this)}translate(e,t=e){return this._transform.translate(e,t),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const e=this._bounds;e.clear();for(let t=0;t<this.instructions.length;t++){const i=this.instructions[t],r=i.action;if("fill"===r){const t=i.data;e.addBounds(t.path.bounds)}else if("texture"===r){const t=i.data;e.addFrame(t.dx,t.dy,t.dx+t.dw,t.dy+t.dh,t.transform)}if("stroke"===r){const t=i.data,r=t.style.alignment,s=t.style.width*(1-r),n=t.path.bounds;e.addFrame(n.minX-s,n.minY-s,n.maxX+s,n.maxY+s)}}return e}containsPoint(e){var t;if(!this.bounds.containsPoint(e.x,e.y))return!1;const i=this.instructions;let r=!1;for(let s=0;s<i.length;s++){const n=i[s],o=n.data,a=o.path;if(!n.action||!a)continue;const l=o.style,h=a.shapePath.shapePrimitives;for(let i=0;i<h.length;i++){const s=h[i].shape;if(!l||!s)continue;const a=h[i].transform,d=a?a.applyInverse(e,No):e;if("fill"===n.action)r=s.contains(d.x,d.y);else{const e=l;r=s.strokeContains(d.x,d.y,e.width,e.alignment)}const u=o.hole;if(u){const e=null==(t=u.shapePath)?void 0:t.shapePrimitives;if(e)for(let t=0;t<e.length;t++)e[t].shape.contains(d.x,d.y)&&(r=!1)}if(r)return!0}}return r}destroy(e=!1){this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners();if("boolean"==typeof e?e:null==e?void 0:e.texture){const t="boolean"==typeof e?e:null==e?void 0:e.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(t),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(t)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Po.defaultFillStyle={color:16777215,alpha:1,texture:Se.WHITE,matrix:null,fill:null,textureSpace:"local"},Po.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Se.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Mo=Po;const Ro=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function ko(e){const t=[];let i=0;for(let r=0;r<Ro.length;r++){const s=`_${Ro[r]}`;t[i++]=e[s]}return i=Bo(e._fill,t,i),i=function(e,t,i){return e?(i=Bo(e,t,i),t[i++]=e.width,t[i++]=e.alignment,t[i++]=e.cap,t[i++]=e.join,t[i++]=e.miterLimit,i):i}(e._stroke,t,i),i=function(e,t,i){return e?(t[i++]=e.alpha,t[i++]=e.angle,t[i++]=e.blur,t[i++]=e.distance,t[i++]=st.shared.setValue(e.color).toNumber(),i):i}(e.dropShadow,t,i),t.join("-")}function Bo(e,t,i){var r;return e?(t[i++]=e.color,t[i++]=e.alpha,t[i++]=null==(r=e.fill)?void 0:r.styleKey,i):i}const Io=class e extends V{constructor(t={}){super(),function(e){const t=e;if("boolean"==typeof t.dropShadow&&t.dropShadow){const i=Oo.defaultDropShadow;e.dropShadow={alpha:t.dropShadowAlpha??i.alpha,angle:t.dropShadowAngle??i.angle,blur:t.dropShadowBlur??i.blur,color:t.dropShadowColor??i.color,distance:t.dropShadowDistance??i.distance}}if(void 0!==t.strokeThickness){pe(ce,"strokeThickness is now a part of stroke");const i=t.stroke;let r={};if(st.isColorLike(i))r.color=i;else if(i instanceof es||i instanceof ss)r.fill=i;else{if(!Object.hasOwnProperty.call(i,"color")&&!Object.hasOwnProperty.call(i,"fill"))throw new Error("Invalid stroke value.");r=i}e.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){let i;pe(ce,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==e.fontSize?e.fontSize=Oo.defaultTextStyle.fontSize:i="string"==typeof e.fontSize?parseInt(e.fontSize,10):e.fontSize;const r=new es({start:{x:0,y:0},end:{x:0,y:1.7*(i||0)}}),s=t.fillGradientStops.map((e=>st.shared.setValue(e).toNumber()));s.forEach(((e,t)=>{const i=t/(s.length-1);r.addColorStop(i,e)})),e.fill={fill:r}}}(t);const i={...e.defaultTextStyle,...t};for(const e in i){this[e]=i[e]}this.update()}get align(){return this._align}set align(e){this._align=e,this.update()}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords=e,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow=null!==t&&"object"==typeof t?this._createProxy({...e.defaultDropShadow,...t}):t?this._createProxy({...e.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e,this.update()}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize="string"==typeof e?parseInt(e,10):e,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this.update()}get leading(){return this._leading}set leading(e){this._leading=e,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing=e,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e,this.update()}get padding(){return this._padding}set padding(e){this._padding=e,this.update()}get trim(){return this._trim}set trim(e){this._trim=e,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace=e,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap=e,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth=e,this.update()}get fill(){return this._originalFill}set fill(e){e!==this._originalFill&&(this._originalFill=e,this._isFillStyle(e)&&(this._originalFill=this._createProxy({...Mo.defaultFillStyle,...e},(()=>{this._fill=Co({...this._originalFill},Mo.defaultFillStyle)}))),this._fill=Co(0===e?"black":e,Mo.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(e){e!==this._originalStroke&&(this._originalStroke=e,this._isFillStyle(e)&&(this._originalStroke=this._createProxy({...Mo.defaultStrokeStyle,...e},(()=>{this._stroke=So({...this._originalStroke},Mo.defaultStrokeStyle)}))),this._stroke=So(e,Mo.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=ko(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=e.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new e({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(e=!1){var t,i,r,s;this.removeAllListeners();if("boolean"==typeof e?e:null==e?void 0:e.texture){const n="boolean"==typeof e?e:null==e?void 0:e.textureSource;(null==(t=this._fill)?void 0:t.texture)&&this._fill.texture.destroy(n),(null==(i=this._originalFill)?void 0:i.texture)&&this._originalFill.texture.destroy(n),(null==(r=this._stroke)?void 0:r.texture)&&this._stroke.texture.destroy(n),(null==(s=this._originalStroke)?void 0:s.texture)&&this._originalStroke.texture.destroy(n)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(e,t){return new Proxy(e,{set:(e,i,r)=>(e[i]=r,null==t||t(i,r),this.update(),!0)})}_isFillStyle(e){return null!==(e??null)&&!(st.isColorLike(e)||e instanceof es||e instanceof ss)}};Io.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},Io.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Oo=Io;const Do=new class{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,t){const i=ii.get().createCanvas();i.width=e,i.height=t;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(e,t,i=1){e=Math.ceil(e*i-1e-6),t=Math.ceil(t*i-1e-6);const r=((e=fe(e))<<17)+((t=fe(t))<<1);this._canvasPool[r]||(this._canvasPool[r]=[]);let s=this._canvasPool[r].pop();return s||(s=this._createCanvasAndContext(e,t)),s}returnCanvasAndContext(e){const t=e.canvas,{width:i,height:r}=t,s=(i<<17)+(r<<1);e.context.clearRect(0,0,i,r),this._canvasPool[s].push(e)}clear(){this._canvasPool={}}},Go=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Lo(e){const t="number"==typeof e.fontSize?`${e.fontSize}px`:e.fontSize;let i=e.fontFamily;Array.isArray(e.fontFamily)||(i=e.fontFamily.split(","));for(let r=i.length-1;r>=0;r--){let e=i[r].trim();/([\"\'])[^\'\"]+\1/.test(e)||Go.includes(e)||(e=`"${e}"`),i[r]=e}return`${e.fontStyle} ${e.fontVariant} ${e.fontWeight} ${t} ${i.join(",")}`}const Fo={willReadFrequently:!0},Uo=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){const i=ii.get().getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported="letterSpacing"in i||"textLetterSpacing"in i}return t}constructor(e,t,i,r,s,n,o,a,l){this.text=e,this.style=t,this.width=i,this.height=r,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t=" ",i,r=e._canvas,s=i.wordWrap){var n;const o=`${t}:${i.styleKey}`;if(e._measurementCache[o])return e._measurementCache[o];const a=Lo(i),l=e.measureFont(a);0===l.fontSize&&(l.fontSize=i.fontSize,l.ascent=i.fontSize);const h=e.__context;h.font=a;const d=(s?e._wordWrap(t,i,r):t).split(/(?:\r\n|\r|\n)/),u=new Array(d.length);let c=0;for(let _=0;_<d.length;_++){const t=e._measureText(d[_],i.letterSpacing,h);u[_]=t,c=Math.max(c,t)}const p=(null==(n=i._stroke)?void 0:n.width)||0;let g=c+p;i.dropShadow&&(g+=i.dropShadow.distance);const f=i.lineHeight||l.fontSize;let m=Math.max(f,l.fontSize+p)+(d.length-1)*(f+i.leading);i.dropShadow&&(m+=i.dropShadow.distance);return new e(t,i,g,m,d,u,f+i.leading,c,l)}static _measureText(t,i,r){let s=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(r.letterSpacing=`${i}px`,r.textLetterSpacing=`${i}px`,s=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));const n=r.measureText(t);let o=n.width;const a=-n.actualBoundingBoxLeft;let l=n.actualBoundingBoxRight-a;if(o>0)if(s)o-=i,l-=i;else{const r=(e.graphemeSegmenter(t).length-1)*i;o+=r,l+=r}return Math.max(o,l)}static _wordWrap(t,i,r=e._canvas){const s=r.getContext("2d",Fo);let n=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:d}=i,u=e._collapseSpaces(d),c=e._collapseNewlines(d);let p=!u;const g=i.wordWrapWidth+h,f=e._tokenize(t);for(let m=0;m<f.length;m++){let t=f[m];if(e._isNewline(t)){if(!c){a+=e._addLine(o),p=!u,o="",n=0;continue}t=" "}if(u){const i=e.isBreakingSpace(t),r=e.isBreakingSpace(o[o.length-1]);if(i&&r)continue}const r=e._getFromCache(t,h,l,s);if(r>g)if(""!==o&&(a+=e._addLine(o),o="",n=0),e.canBreakWords(t,i.breakWords)){const r=e.wordWrapSplit(t);for(let d=0;d<r.length;d++){let u=r[d],c=u,f=1;for(;r[d+f];){const s=r[d+f];if(e.canBreakChars(c,s,t,d,i.breakWords))break;u+=s,c=s,f++}d+=f-1;const m=e._getFromCache(u,h,l,s);m+n>g&&(a+=e._addLine(o),p=!1,o="",n=0),o+=u,n+=m}}else{o.length>0&&(a+=e._addLine(o),o="",n=0);const i=m===f.length-1;a+=e._addLine(t,!i),p=!1,o="",n=0}else r+n>g&&(p=!1,a+=e._addLine(o),o="",n=0),(o.length>0||!e.isBreakingSpace(t)||p)&&(o+=t,n+=r)}return a+=e._addLine(o,!1),a}static _addLine(t,i=!0){return t=e._trimRight(t),t=i?`${t}\n`:t}static _getFromCache(t,i,r,s){let n=r[t];return"number"!=typeof n&&(n=e._measureText(t,i,s)+i,r[t]=n),n}static _collapseSpaces(e){return"normal"===e||"pre-line"===e}static _collapseNewlines(e){return"normal"===e}static _trimRight(t){if("string"!=typeof t)return"";for(let i=t.length-1;i>=0;i--){const r=t[i];if(!e.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,i){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const i=[];let r="";if("string"!=typeof t)return i;for(let s=0;s<t.length;s++){const n=t[s],o=t[s+1];e.isBreakingSpace(n,o)||e._isNewline(n)?(""!==r&&(i.push(r),r=""),i.push(n)):r+=n}return""!==r&&i.push(r),i}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,r,s){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];const i=e._context;i.font=t;const r=i.measureText(e.METRICS_STRING+e.BASELINE_SYMBOL),s={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return e._fonts[t]=s,s}static clearMetrics(t=""){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let i;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",Fo);if(null==r?void 0:r.measureText)return e.__canvas=t,t;i=ii.get().createCanvas()}catch(t){i=ii.get().createCanvas()}i.width=i.height=10,e.__canvas=i}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",Fo)),e.__context}};Uo.METRICS_STRING="|ÉqÅ",Uo.BASELINE_SYMBOL="M",Uo.BASELINE_MULTIPLIER=1.4,Uo.HEIGHT_MULTIPLIER=2,Uo.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map((e=>e.segment))}return e=>[...e]})(),Uo.experimentalLetterSpacing=!1,Uo._fonts={},Uo._newlines=[10,13],Uo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],Uo._measurementCache={};let zo=Uo;const Ho=1e5;function Wo(e,t,i,r=0){if(e.texture===Se.WHITE&&!e.fill)return st.shared.setValue(e.color).setAlpha(e.alpha??1).toHexa();if(!e.fill){const i=t.createPattern(e.texture.source.resource,"repeat"),r=e.matrix.copyTo(q.shared);return r.scale(e.texture.frame.width,e.texture.frame.height),i.setTransform(r),i}if(e.fill instanceof ss){const i=e.fill,r=t.createPattern(i.texture.source.resource,"repeat"),s=i.transform.copyTo(q.shared);return s.scale(i.texture.frame.width,i.texture.frame.height),r.setTransform(s),r}if(e.fill instanceof es){const s=e.fill,n="linear"===s.type,o="local"===s.textureSpace;let a,l=1,h=1;o&&i&&(l=i.width+r,h=i.height+r);let d=!1;if(n){const{start:e,end:i}=s;a=t.createLinearGradient(e.x*l,e.y*h,i.x*l,i.y*h),d=Math.abs(i.x-e.x)<Math.abs(.1*(i.y-e.y))}else{const{center:e,innerRadius:i,outerCenter:r,outerRadius:n}=s;a=t.createRadialGradient(e.x*l,e.y*h,i*l,r.x*l,r.y*h,n*l)}if(d&&o&&i){const e=i.lineHeight/h;for(let t=0;t<i.lines.length;t++){const n=(t*i.lineHeight+r/2)/h;s.colorStops.forEach((t=>{const i=n+t.offset*e;a.addColorStop(Math.floor(i*Ho)/Ho,st.shared.setValue(t.color).toHex())}))}}else s.colorStops.forEach((e=>{a.addColorStop(e.offset,st.shared.setValue(e.color).toHex())}));return a}return At("FillStyle not recognised",e),"red"}function Vo(e){if(""===e)return[];"string"==typeof e&&(e=[e]);const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);if(0===r[0].length||0===r[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const e=r[0].charCodeAt(0),i=r[1].charCodeAt(0);if(i<e)throw new Error("[BitmapFont]: Invalid character range.");for(let r=e,s=i;r<=s;r++)t.push(String.fromCharCode(r))}else t.push(...Array.from(r))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Xo=class e extends Zr{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const i={...e.defaultOptions,...t};this._textureSize=i.textureSize,this._mipmap=i.mipmap;const r=i.style.clone();i.overrideFill&&(r._fill.color=16777215,r._fill.alpha=1,r._fill.texture=Se.WHITE,r._fill.fill=null),this.applyFillAsTint=i.overrideFill;const s=r.fontSize;r.fontSize=this.baseMeasurementFontSize;const n=Lo(r);i.overrideSize?r._stroke&&(r._stroke.width*=this.baseRenderedFontSize/s):r.fontSize=this.baseRenderedFontSize=s,this._style=r,this._skipKerning=i.skipKerning??!1,this.resolution=i.resolution??1,this._padding=i.padding??4,this.fontMetrics=zo.measureFont(n),this.lineHeight=r.lineHeight||this.fontMetrics.fontSize||r.fontSize}ensureCharacters(e){var t,i;const r=Vo(e).filter((e=>!this._currentChars.includes(e))).filter(((e,t,i)=>i.indexOf(e)===t));if(!r.length)return;let s;this._currentChars=[...this._currentChars,...r],s=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:n,context:o}=s.canvasAndContext,a=s.texture.source;const l=this._style;let h=this._currentX,d=this._currentY;const u=this.baseRenderedFontSize/this.baseMeasurementFontSize,c=this._padding*u;let p=0,g=!1;const f=n.width/this.resolution,m=n.height/this.resolution;for(let _=0;_<r.length;_++){const e=r[_],s=zo.measureText(e,l,n,!1);s.lineHeight=s.height;const y=s.width*u,x=Math.ceil(("italic"===l.fontStyle?2:1)*y)+2*c,v=s.height*u+2*c;if(g=!1,"\n"!==e&&"\r"!==e&&"\t"!==e&&" "!==e&&(g=!0,p=Math.ceil(Math.max(v,p))),h+x>f&&(d+=p,p=v,h=0,d+p>m)){a.update();const e=this._nextPage();n=e.canvasAndContext.canvas,o=e.canvasAndContext.context,a=e.texture.source,d=0}const b=y/u-((null==(t=l.dropShadow)?void 0:t.distance)??0)-((null==(i=l._stroke)?void 0:i.width)??0);if(this.chars[e]={id:e.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:b,kerning:{}},g){this._drawGlyph(o,s,h+c,d+c,u,l);const t=a.width*u,i=a.height*u,r=new le(h/t*a.width,d/i*a.height,x/t*a.width,v/i*a.height);this.chars[e].texture=new Se({source:a,frame:r}),h+=Math.ceil(x)}}a.update(),this._currentX=h,this._currentY=d,this._skipKerning&&this._applyKerning(r,o)}get pageTextures(){return pe(ce,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,t){const i=this._measureCache;for(let r=0;r<e.length;r++){const s=e[r];for(let e=0;e<this._currentChars.length;e++){const r=this._currentChars[e];let n=i[s];n||(n=i[s]=t.measureText(s).width);let o=i[r];o||(o=i[r]=t.measureText(r).width);let a=t.measureText(s+r).width,l=a-(n+o);l&&(this.chars[s].kerning[r]=l),a=t.measureText(s+r).width,l=a-(n+o),l&&(this.chars[r].kerning[s]=l)}}}_nextPage(){this._currentPageIndex++;const e=this.resolution,t=Do.getOptimalCanvasAndContext(this._textureSize,this._textureSize,e);this._setupContext(t.context,this._style,e);const i=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),r={canvasAndContext:t,texture:new Se({source:new si({resource:t.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})})};return this.pages[this._currentPageIndex]=r,r}_setupContext(e,t,i){t.fontSize=this.baseRenderedFontSize,e.scale(i,i),e.font=Lo(t),t.fontSize=this.baseMeasurementFontSize,e.textBaseline=t.textBaseline;const r=t._stroke,s=(null==r?void 0:r.width)??0;if(r&&(e.lineWidth=s,e.lineJoin=r.join,e.miterLimit=r.miterLimit,e.strokeStyle=Wo(r,e)),t._fill&&(e.fillStyle=Wo(t._fill,e)),t.dropShadow){const r=t.dropShadow,s=st.shared.setValue(r.color).toArray(),n=r.blur*i,o=r.distance*i;e.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${r.alpha})`,e.shadowBlur=n,e.shadowOffsetX=Math.cos(r.angle)*o,e.shadowOffsetY=Math.sin(r.angle)*o}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,t,i,r,s,n){const o=t.text,a=t.fontProperties,l=n._stroke,h=((null==l?void 0:l.width)??0)*s,d=i+h/2,u=r-h/2,c=a.descent*s,p=t.lineHeight*s;n.stroke&&h&&e.strokeText(o,d,u+p-c),n._fill&&e.fillText(o,d,u+p-c)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{canvasAndContext:t,texture:i}=this.pages[e];Do.returnCanvasAndContext(t),i.destroy(!0)}this.pages=null}};Xo.defaultOptions={textureSize:512,style:new Oo,mipmap:!0};let Yo=Xo;function jo(e,t,i,r){const s={width:0,height:0,offsetY:0,scale:t.fontSize/i.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=i.baseLineOffset;let n=s.lines[0],o=null,a=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},h=e=>{const t=n.width;for(let i=0;i<l.index;i++){const r=e.positions[i];n.chars.push(e.chars[i]),n.charPositions.push(r+t)}n.width+=e.width,a=!1,l.width=0,l.index=0,l.chars.length=0},d=()=>{let e=n.chars.length-1;if(r){let t=n.chars[e];for(;" "===t;)n.width-=i.chars[t].xAdvance,t=n.chars[--e]}s.width=Math.max(s.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,s.lines.push(n),s.height+=i.lineHeight},u=i.baseMeasurementFontSize/t.fontSize,c=t.letterSpacing*u,p=t.wordWrapWidth*u;for(let g=0;g<e.length+1;g++){let r;const s=g===e.length;s||(r=e[g]);const u=i.chars[r]||i.chars[" "];if(/(?:\s)/.test(r)||"\r"===r||"\n"===r||s){if(!a&&t.wordWrap&&n.width+l.width-c>p?(d(),h(l),s||n.charPositions.push(0)):(l.start=n.width,h(l),s||n.charPositions.push(0)),"\r"===r||"\n"===r)0!==n.width&&d();else if(!s){const e=u.xAdvance+(u.kerning[o]||0)+c;n.width+=e,n.spaceWidth=e,n.spacesIndex.push(n.charPositions.length),n.chars.push(r)}}else{const e=u.kerning[o]||0,t=u.xAdvance+e+c;l.positions[l.index++]=l.width+e,l.chars.push(r),l.width+=t}o=r}return d(),"center"===t.align?function(e){for(let t=0;t<e.lines.length;t++){const i=e.lines[t],r=e.width/2-i.width/2;for(let e=0;e<i.charPositions.length;e++)i.charPositions[e]+=r}}(s):"right"===t.align?function(e){for(let t=0;t<e.lines.length;t++){const i=e.lines[t],r=e.width-i.width;for(let e=0;e<i.charPositions.length;e++)i.charPositions[e]+=r}}(s):"justify"===t.align&&function(e){const t=e.width;for(let i=0;i<e.lines.length;i++){const r=e.lines[i];let s=0,n=r.spacesIndex[s++],o=0;const a=r.spacesIndex.length,l=(t-r.width)/a;for(let e=0;e<r.charPositions.length;e++)e===n&&(n=r.spacesIndex[s++],o+=l),r.charPositions[e]+=o}}(s),s}let Ko=0;const $o=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,t){var i;let r=`${t.fontFamily}-bitmap`,s=!0;if(t._fill.fill&&!t._stroke)r+=t._fill.fill.styleKey,s=!1;else if(t._stroke||t.dropShadow){let e=t.styleKey;e=e.substring(0,e.lastIndexOf("-")),r=`${e}-bitmap`,s=!1}if(!gi.has(r)){const e=new Yo({style:t,overrideFill:s,overrideSize:!0,...this.defaultOptions});Ko++,Ko>50&&At("BitmapText",`You have dynamically created ${Ko} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),e.once("destroy",(()=>{Ko--,gi.remove(r)})),gi.set(r,e)}const n=gi.get(r);return null==(i=n.ensureCharacters)||i.call(n,e),n}getLayout(e,t,i=!0){const r=this.getFont(e,t);return jo([...e],t,r,i)}measureText(e,t,i=!0){return this.getLayout(e,t,i)}install(...e){var t,i,r,s;let n=e[0];"string"==typeof n&&(n={name:n,style:e[1],chars:null==(t=e[2])?void 0:t.chars,resolution:null==(i=e[2])?void 0:i.resolution,padding:null==(r=e[2])?void 0:r.padding,skipKerning:null==(s=e[2])?void 0:s.skipKerning},pe(ce,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const o=null==n?void 0:n.name;if(!o)throw new Error("[BitmapFontManager] Property `name` is required.");n={...this.defaultOptions,...n};const a=n.style,l=a instanceof Oo?a:new Oo(a),h=null!==l._fill.fill&&void 0!==l._fill.fill,d=new Yo({style:l,overrideFill:h,skipKerning:n.skipKerning,padding:n.padding,resolution:n.resolution,overrideSize:!1}),u=Vo(n.chars);return d.ensureCharacters(u.join("")),gi.set(`${o}-bitmap`,d),d.once("destroy",(()=>gi.remove(`${o}-bitmap`))),d}uninstall(e){const t=`${e}-bitmap`,i=gi.get(t);i&&i.destroy()}};class qo extends Zr{constructor(e,t){super();const{textures:i,data:r}=e;Object.keys(r.pages).forEach((e=>{const t=r.pages[parseInt(e,10)],s=i[t.id];this.pages.push({texture:s})})),Object.keys(r.chars).forEach((e=>{const t=r.chars[e],{frame:s,source:n}=i[t.page],o=new le(t.x+s.x,t.y+s.y,t.width,t.height),a=new Se({source:n,frame:o});this.chars[e]={id:e.codePointAt(0),xOffset:t.xOffset,yOffset:t.yOffset,xAdvance:t.xAdvance,kerning:t.kerning??{},texture:a}})),this.baseRenderedFontSize=r.fontSize,this.baseMeasurementFontSize=r.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:r.fontSize},this.baseLineOffset=r.baseLineOffset,this.lineHeight=r.lineHeight,this.fontFamily=r.fontFamily,this.distanceField=r.distanceField??{type:"none",range:0},this.url=t}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:t}=this.pages[e];t.destroy(!0)}this.pages=null}static install(e){$o.install(e)}static uninstall(e){$o.uninstall(e)}}const Zo={test:e=>"string"==typeof e&&e.startsWith("info face="),parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const e=t[u].match(/^[a-z]+/gm)[0],r=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const t in r){const e=r[t].split("="),i=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;s[i]=a}i[e].push(s)}const r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[s]=i.info,[n]=i.common,[o]=i.distanceField??[];o&&(r.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),r.fontSize=parseInt(s.size,10),r.fontFamily=s.face,r.lineHeight=parseInt(n.lineHeight,10);const a=i.page;for(let u=0;u<a.length;u++)r.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const l={};r.baseLineOffset=r.lineHeight-parseInt(n.base,10);const h=i.char;for(let u=0;u<h.length;u++){const e=h[u],t=parseInt(e.id,10);let i=e.letter??e.char??String.fromCharCode(t);"space"===i&&(i=" "),l[t]=i,r.chars[i]={id:t,page:parseInt(e.page,10)||0,x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xOffset:parseInt(e.xoffset,10),yOffset:parseInt(e.yoffset,10),xAdvance:parseInt(e.xadvance,10),kerning:{}}}const d=i.kerning||[];for(let u=0;u<d.length;u++){const e=parseInt(d[u].first,10),t=parseInt(d[u].second,10),i=parseInt(d[u].amount,10);r.chars[l[t]].kerning[l[e]]=i}return r}},Jo={test(e){const t=e;return"string"!=typeof t&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},parse(e){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},i=e.getElementsByTagName("info")[0],r=e.getElementsByTagName("common")[0],s=e.getElementsByTagName("distanceField")[0];s&&(t.distanceField={type:s.getAttribute("fieldType"),range:parseInt(s.getAttribute("distanceRange"),10)});const n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning");t.fontSize=parseInt(i.getAttribute("size"),10),t.fontFamily=i.getAttribute("face"),t.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let h=0;h<n.length;h++)t.pages.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(r.getAttribute("base"),10);for(let h=0;h<o.length;h++){const e=o[h],i=parseInt(e.getAttribute("id"),10);let r=e.getAttribute("letter")??e.getAttribute("char")??String.fromCharCode(i);"space"===r&&(r=" "),l[i]=r,t.chars[r]={id:i,page:parseInt(e.getAttribute("page"),10)||0,x:parseInt(e.getAttribute("x"),10),y:parseInt(e.getAttribute("y"),10),width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10),xOffset:parseInt(e.getAttribute("xoffset"),10),yOffset:parseInt(e.getAttribute("yoffset"),10),xAdvance:parseInt(e.getAttribute("xadvance"),10),kerning:{}}}for(let h=0;h<a.length;h++){const e=parseInt(a[h].getAttribute("first"),10),i=parseInt(a[h].getAttribute("second"),10),r=parseInt(a[h].getAttribute("amount"),10);t.chars[l[i]].kerning[l[e]]=r}return t}},Qo={test:e=>!("string"!=typeof e||!e.includes("<font>"))&&Jo.test(ii.get().parseXML(e)),parse:e=>Jo.parse(ii.get().parseXML(e))},ea=[".xml",".fnt"],ta={extension:{type:I.CacheParser,name:"cacheBitmapFont"},test:e=>e instanceof qo,getCacheableAssets(e,t){const i={};return e.forEach((e=>{i[e]=t,i[`${e}-bitmap`]=t})),i[`${t.fontFamily}-bitmap`]=t,i}},ia={extension:{type:I.LoadParser,priority:_i.Normal},name:"loadBitmapFont",test:e=>ea.includes(vi.extname(e).toLowerCase()),testParse:async e=>Zo.test(e)||Qo.test(e),async parse(e,t,i){const r=Zo.test(e)?Zo.parse(e):Qo.parse(e),{src:s}=t,{pages:n}=r,o=[],a=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<n.length;++d){const e=n[d].file;let t=vi.join(vi.dirname(s),e);t=Ci(t,s),o.push({src:t,data:a})}const l=await i.load(o),h=o.map((e=>l[e.src]));return new qo({data:r,textures:h},s)},async load(e,t){const i=await ii.get().fetch(e);return await i.text()},async unload(e,t,i){await Promise.all(e.pages.map((e=>i.unload(e.texture.source._sourceOrigin)))),e.destroy()}};class ra{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach((e=>{this._assetList.push(e)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const sa={extension:{type:I.CacheParser,name:"cacheTextureArray"},test:e=>Array.isArray(e)&&e.every((e=>e instanceof Se)),getCacheableAssets:(e,t)=>{const i={};return e.forEach((e=>{t.forEach(((t,r)=>{i[e+(0===r?"":r+1)]=t}))})),i}};async function na(e){if("Image"in globalThis)return new Promise((t=>{const i=new Image;i.onload=()=>{t(!0)},i.onerror=()=>{t(!1)},i.src=e}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch(t){return!1}return!0}return!1}const oa={extension:{type:I.DetectionParser,priority:1},test:async()=>na("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter((e=>"avif"!==e))},aa=["png","jpg","jpeg"],la={extension:{type:I.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...aa],remove:async e=>e.filter((e=>!aa.includes(e)))},ha="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function da(e){if(ha)return!1;return""!==document.createElement("video").canPlayType(e)}const ua={extension:{type:I.DetectionParser,priority:0},test:async()=>da("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter((e=>"mp4"!==e&&"m4v"!==e))},ca={extension:{type:I.DetectionParser,priority:0},test:async()=>da("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter((e=>"ogv"!==e))},pa={extension:{type:I.DetectionParser,priority:0},test:async()=>da("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter((e=>"webm"!==e))},ga={extension:{type:I.DetectionParser,priority:0},test:async()=>na("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter((e=>"webp"!==e))};class fa{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{var r,s;let n=null,o=null;if(t.loadParser&&(o=this._parserHash[t.loadParser],o||At(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!o){for(let i=0;i<this.parsers.length;i++){const s=this.parsers[i];if(s.load&&(null==(r=s.test)?void 0:r.call(s,e,t,this))){o=s;break}}if(!o)return At(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await o.load(e,t,this),i.parser=o;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];r.parse&&r.parse&&await(null==(s=r.testParse)?void 0:s.call(r,n,t,this))&&(n=await r.parse(n,t,this)||n,i.parser=r)}return n})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const r={},s=Ti(e),n=pi(e,(e=>({alias:[e],src:e,data:{}}))),o=n.length,a=n.map((async e=>{const s=vi.toAbsolute(e.src);if(!r[e.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,e)),r[e.src]=await this.promiseCache[s].promise,t&&t(++i/o)}catch(n){throw delete this.promiseCache[s],delete r[e.src],new Error(`[Loader.load] Failed to load ${s}.\n${n}`)}}));return await Promise.all(a),s?r[n[0].src]:r}async unload(e){const t=pi(e,(e=>({alias:[e],src:e}))).map((async e=>{var t,i;const r=vi.toAbsolute(e.src),s=this.promiseCache[r];if(s){const n=await s.promise;delete this.promiseCache[r],await(null==(i=null==(t=s.parser)?void 0:t.unload)?void 0:i.call(t,n,e,this))}}));await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((e=>e.name)).reduce(((e,t)=>(t.name?e[t.name]&&At(`[Assets] loadParser name conflict "${t.name}"`):At("[Assets] loadParser should have a name"),{...e,[t.name]:t})),{})}}function ma(e,t){if(Array.isArray(t)){for(const i of t)if(e.startsWith(`data:${i}`))return!0;return!1}return e.startsWith(`data:${t}`)}function _a(e,t){const i=e.split("?")[0],r=vi.extname(i).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const ya={extension:{type:I.LoadParser,priority:_i.Low},name:"loadJson",test:e=>ma(e,"application/json")||_a(e,".json"),async load(e){const t=await ii.get().fetch(e);return await t.json()}},xa={name:"loadTxt",extension:{type:I.LoadParser,priority:_i.Low,name:"loadTxt"},test:e=>ma(e,"text/plain")||_a(e,".txt"),async load(e){const t=await ii.get().fetch(e);return await t.text()}},va=["normal","bold","100","200","300","400","500","600","700","800","900"],ba=[".ttf",".otf",".woff",".woff2"],wa=["font/ttf","font/otf","font/woff","font/woff2"],Ta=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Ea=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;const Ca={extension:{type:I.LoadParser,priority:_i.Low},name:"loadWebFont",test:e=>ma(e,wa)||_a(e,ba),async load(e,t){var i,r,s;const n=ii.get().getFontFaceSet();if(n){const a=[],l=(null==(i=t.data)?void 0:i.family)??function(e){const t=vi.extname(e),i=vi.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1)));let r=i.length>0;for(const n of i)if(!n.match(Ta)){r=!1;break}let s=i.join(" ");return r||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}(e),h=(null==(s=null==(r=t.data)?void 0:r.weights)?void 0:s.filter((e=>va.includes(e))))??["normal"],d=t.data??{};for(let t=0;t<h.length;t++){const i=h[t],r=new FontFace(l,`url(${o=e,Ea.test(o)?o:encodeURI(o)})`,{...d,weight:i});await r.load(),n.add(r),a.push(r)}return gi.set(`${l}-and-url`,{url:e,fontFaces:a}),1===a.length?a[0]:a}var o;return At("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach((e=>{gi.remove(`${e.family}-and-url`),ii.get().getFontFaceSet().delete(e)}))}};function Sa(e,t=1){var i;const r=null==(i=Ei.RETINA_PREFIX)?void 0:i.exec(e);return r?parseFloat(r[1]):t}function Na(e,t,i){e.label=i,e._sourceOrigin=i;const r=new Se({source:e,label:i}),s=()=>{delete t.promiseCache[i],gi.has(i)&&gi.remove(i)};return r.source.once("destroy",(()=>{t.promiseCache[i]&&(At("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),s())})),r.once("destroy",(()=>{e.destroyed||(At("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())})),r}const Aa={extension:{type:I.LoadParser,priority:_i.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test:e=>ma(e,"image/svg+xml")||_a(e,".svg"),async load(e,t,i){var r;return(null==(r=t.data)?void 0:r.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?async function(e){const t=await ii.get().fetch(e),i=await t.text(),r=new Mo;return r.svg(i),r}(e):async function(e,t,i,r){var s,n,o;const a=await ii.get().fetch(e),l=await a.blob(),h=URL.createObjectURL(l),d=new Image;d.src=h,d.crossOrigin=r,await d.decode(),URL.revokeObjectURL(h);const u=document.createElement("canvas"),c=u.getContext("2d"),p=(null==(s=t.data)?void 0:s.resolution)||Sa(e),g=(null==(n=t.data)?void 0:n.width)??d.width,f=(null==(o=t.data)?void 0:o.height)??d.height;u.width=g*p,u.height=f*p,c.drawImage(d,0,0,g*p,f*p);const{parseAsGraphicsContext:m,..._}=t.data??{};return Na(new si({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:p,..._}),i,e)}(e,t,i,this.config.crossOrigin)},unload(e){e.destroy(!0)}};let Pa=null,Ma=class{constructor(){Pa||(Pa=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n    async function checkImageBitmap() {\n      try {\n        if (typeof createImageBitmap !== "function")\n          return false;\n        const response = await fetch(WHITE_PNG);\n        const imageBlob = await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n        return imageBitmap.width === 1 && imageBitmap.height === 1;\n      } catch (_e) {\n        return false;\n      }\n    }\n    void checkImageBitmap().then((result) => {\n      self.postMessage(result);\n    });\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Pa)}};Ma.revokeObjectURL=function(){Pa&&(URL.revokeObjectURL(Pa),Pa=null)};let Ra=null;class ka{constructor(){Ra||(Ra=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    async function loadImageBitmap(url, alphaMode) {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n      }\n      const imageBlob = await response.blob();\n      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);\n    }\n    self.onmessage = async (event) => {\n      try {\n        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);\n        self.postMessage({\n          data: imageBitmap,\n          uuid: event.data.uuid,\n          id: event.data.id\n        }, [imageBitmap]);\n      } catch (e) {\n        self.postMessage({\n          error: e,\n          uuid: event.data.uuid,\n          id: event.data.id\n        });\n      }\n    };\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Ra)}}ka.revokeObjectURL=function(){Ra&&(URL.revokeObjectURL(Ra),Ra=null)};let Ba,Ia=0;const Oa=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((e=>{const{worker:t}=new Ma;t.addEventListener("message",(i=>{t.terminate(),Ma.revokeObjectURL(),e(i.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(e,t){var i;return this._run("loadImageBitmap",[e,null==(i=null==t?void 0:t.data)?void 0:i.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){void 0===Ba&&(Ba=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<Ba&&(this._createdWorkers++,e=(new ka).worker,e.addEventListener("message",(e=>{this._complete(e.data),this._returnWorker(e.target),this._next()}))),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){void 0!==e.error?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise(((i,r)=>{this._queue.push({id:e,arguments:t,resolve:i,reject:r})}));return this._next(),i}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const t=this._queue.pop(),i=t.id;this._resolveHash[Ia]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Ia++,id:i})}},Da=[".jpeg",".jpg",".png",".webp",".avif"],Ga=["image/jpeg","image/png","image/webp","image/avif"];const La={name:"loadTextures",extension:{type:I.LoadParser,priority:_i.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>ma(e,Ga)||_a(e,Da),async load(e,t,i){var r;let s=null;s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Oa.isImageBitmapSupported()?await Oa.loadImageBitmap(e,t):await async function(e,t){var i;const r=await ii.get().fetch(e);if(!r.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${r.status} ${r.statusText}`);const s=await r.blob();return"premultiplied-alpha"===(null==(i=null==t?void 0:t.data)?void 0:i.alphaMode)?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}(e,t):await new Promise(((t,i)=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=e,s.complete?t(s):(s.onload=()=>{t(s)},s.onerror=i)}));return Na(new si({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:(null==(r=t.data)?void 0:r.resolution)||Sa(e),...t.data}),i,e)},unload(e){e.destroy(!0)}},Fa=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],Ua=Fa.map((e=>`video/${e.substring(1)}`));function za(e,t,i){void 0!==i||t.startsWith("data:")?!1!==i&&(e.crossOrigin="string"==typeof i?i:"anonymous"):e.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t||(t=globalThis.location);const i=new URL(e,document.baseURI);if(i.hostname!==t.hostname||i.port!==t.port||i.protocol!==t.protocol)return"anonymous";return""}(t)}const Ha={name:"loadVideo",extension:{type:I.LoadParser,name:"loadVideo"},test(e){const t=ma(e,Ua),i=_a(e,Fa);return t||i},async load(e,t,i){var r,s;const n={...ci.defaultOptions,resolution:(null==(r=t.data)?void 0:r.resolution)||Sa(e),alphaMode:(null==(s=t.data)?void 0:s.alphaMode)||await di(),...t.data},o=document.createElement("video"),a={preload:!1!==n.autoLoad?"auto":void 0,"webkit-playsinline":!1!==n.playsinline?"":void 0,playsinline:!1!==n.playsinline?"":void 0,muted:!0===n.muted?"":void 0,loop:!0===n.loop?"":void 0,autoplay:!1!==n.autoPlay?"":void 0};Object.keys(a).forEach((e=>{const t=a[e];void 0!==t&&o.setAttribute(e,t)})),!0===n.muted&&(o.muted=!0),za(o,e,n.crossorigin);const l=document.createElement("source");let h;if(e.startsWith("data:"))h=e.slice(5,e.indexOf(";"));else if(!e.startsWith("blob:")){const t=e.split("?")[0].slice(e.lastIndexOf(".")+1).toLowerCase();h=ci.MIME_TYPES[t]||`video/${t}`}return l.src=e,h&&(l.type=h),new Promise((r=>{const s=async()=>{const a=new ci({...n,resource:o});var l;o.removeEventListener("canplay",s),t.data.preload&&await(l=o,new Promise(((e,t)=>{function i(){s(),e()}function r(e){s(),t(e)}function s(){l.removeEventListener("canplaythrough",i),l.removeEventListener("error",r)}l.addEventListener("canplaythrough",i),l.addEventListener("error",r),l.load()}))),r(Na(a,i,e))};o.addEventListener("canplay",s),o.appendChild(l)}))},unload(e){e.destroy(!0)}},Wa={extension:{type:I.ResolveParser,name:"resolveTexture"},test:La.test,parse:e=>{var t;return{resolution:parseFloat((null==(t=Ei.RETINA_PREFIX.exec(e))?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}},Va={extension:{type:I.ResolveParser,priority:-2,name:"resolveJson"},test:e=>Ei.RETINA_PREFIX.test(e)&&e.endsWith(".json"),parse:Wa.parse};const Xa=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ei,this.loader=new fa,this.cache=gi,this._backgroundLoader=new ra(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var t,i;if(this._initialized)return void At("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const r=(null==(t=e.texturePreference)?void 0:t.resolution)??1,s="number"==typeof r?[r]:r,n=await this._detectFormats({preferredFormats:null==(i=e.texturePreference)?void 0:i.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();const i=Ti(e),r=pi(e).map((e=>{if("string"!=typeof e){const t=this.resolver.getAlias(e);return t.some((e=>!this.resolver.hasKey(e)))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e})),s=this.resolver.resolve(r),n=await this._mapLoadToResolve(s,t);return i?n[r[0]]:n}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;"string"==typeof e&&(i=!0,e=[e]);const r=this.resolver.resolveBundle(e),s={},n=Object.keys(r);let o=0,a=0;const l=()=>{null==t||t(++o/a)},h=n.map((e=>{const t=r[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,l).then((t=>{s[e]=t}))}));return await Promise.all(h),i?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach((e=>{this._backgroundLoader.add(Object.values(e))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return gi.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=gi.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const r=await this.loader.load(i,t);this._backgroundLoader.active=!0;const s={};return i.forEach((e=>{const t=r[e.src],i=[e.src];e.alias&&i.push(...e.alias),i.forEach((e=>{s[e]=t})),gi.set(i,t)})),s}async unload(e){this._initialized||await this.init();const t=pi(e).map((e=>"string"!=typeof e?e.src:e)),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=pi(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map((e=>this._unloadFromResolved(t[e])));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach((e=>{gi.remove(e.src)})),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter(((e,i)=>t.indexOf(e)===i)),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach((t=>{t.config&&Object.keys(t.config).filter((t=>t in e)).forEach((i=>{t.config[i]=e[i]}))}))}};G.handleByList(I.LoadParser,Xa.loader.parsers).handleByList(I.ResolveParser,Xa.resolver.parsers).handleByList(I.CacheParser,Xa.cache.parsers).handleByList(I.DetectionParser,Xa.detections),G.add(sa,la,oa,ga,ua,ca,pa,ya,xa,Ca,Aa,La,Ha,ia,ta,Wa,Va);const Ya={loader:I.LoadParser,resolver:I.ResolveParser,cache:I.CacheParser,detection:I.DetectionParser};G.handle(I.Asset,(e=>{const t=e.ref;Object.entries(Ya).filter((([e])=>!!t[e])).forEach((([e,i])=>G.add(Object.assign(t[e],{extension:t[e].extension??i}))))}),(e=>{const t=e.ref;Object.keys(Ya).filter((e=>!!t[e])).forEach((e=>G.remove(t[e])))}));const ja=new Pe,Ka=class{cull(e,t,i=!0){this._cullRecursive(e,t,i)}_cullRecursive(e,t,i=!0){if(e.cullable&&e.measurable&&e.includeInBuild){const r=e.cullArea??xt(e,i,ja);e.culled=r.x>=t.x+t.width||r.y>=t.y+t.height||r.x+r.width<=t.x||r.y+r.height<=t.y}else e.culled=!1;if(e.cullableChildren&&!e.culled&&e.renderable&&e.measurable&&e.includeInBuild)for(let r=0;r<e.children.length;r++)this._cullRecursive(e.children[r],t,i)}};Ka.shared=new Ka;let $a=Ka;const qa=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){!this._tickerAdded&&this.domElement&&(hi.system.add(this._tickerUpdate,this,ni.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(hi.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events._rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,pointerId:e.pointerId}))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this._update())}};class Za extends Ri{constructor(){super(...arguments),this.client=new K,this.movement=new K,this.offset=new K,this.global=new K,this.screen=new K}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,r,s,n,o,a,l,h,d,u,c,p,g){throw new Error("Method not implemented.")}}class Ja extends Za{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Qa extends Za{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Qa.DOM_DELTA_PIXEL=0,Qa.DOM_DELTA_LINE=1,Qa.DOM_DELTA_PAGE=2;const el=new K,tl=new K;class il{constructor(e){this.dispatch=new V,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort(((e,t)=>e.priority-t.priority))}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,r=t.length;i<r;i++)t[i].fn(e);else At(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){qa.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,el.set(e,t),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,s=i.length-1;r<s;r++)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(0===i.length)return;e.eventPhase=e.BUBBLING_PHASE;const r=Array.isArray(t)?t:[t];for(let s=i.length-1;s>=0;s--)r.forEach((t=>{e.currentTarget=i[s],this.notifyTarget(e,t)}))}propagationPath(e){const t=[e];for(let i=0;i<2048&&e!==this.rootTarget&&e.parent;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,r,s,n=!1){let o=!1;if(this._interactivePrune(e))return null;if("dynamic"!==e.eventMode&&"dynamic"!==t||(qa.pauseUpdate=!1),e.interactiveChildren&&e.children){const a=e.children;for(let l=a.length-1;l>=0;l--){const h=a[l],d=this.hitTestMoveRecursive(h,this._isInteractive(t)?t:h.eventMode,i,r,s,n||s(e,i));if(d){if(d.length>0&&!d[d.length-1].parent)continue;const t=e.isInteractive();(d.length>0||t)&&(t&&this._allInteractiveElements.push(e),d.push(e)),0===this._hitElements.length&&(this._hitElements=d),o=!0}}}const a=this._isInteractive(t),l=e.isInteractive();return l&&l&&this._allInteractiveElements.push(e),n||this._hitElements.length>0?null:o?this._hitElements:a&&!s(e,i)&&r(e,i)?l?[e]:[]:null}hitTestRecursive(e,t,i,r,s){if(this._interactivePrune(e)||s(e,i))return null;if("dynamic"!==e.eventMode&&"dynamic"!==t||(qa.pauseUpdate=!1),e.interactiveChildren&&e.children){const n=e.children,o=i;for(let i=n.length-1;i>=0;i--){const a=n[i],l=this.hitTestRecursive(a,this._isInteractive(t)?t:a.eventMode,o,r,s);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const t=e.isInteractive();return(l.length>0||t)&&l.push(e),l}}}const n=this._isInteractive(t),o=e.isInteractive();return n&&r(e,i)?o?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!(e&&e.visible&&e.renderable&&e.measurable)||("none"===e.eventMode||"passive"===e.eventMode&&!e.interactiveChildren)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,tl),!e.hitArea.contains(tl.x,tl.y)))return!0;if(e.effects&&e.effects.length)for(let i=0;i<e.effects.length;i++){const r=e.effects[i];if(r.containsPoint){if(!r.containsPoint(t,this.hitTestFn))return!0}}return!1}hitTestFn(e,t){return!!e.hitArea||!!(null==e?void 0:e.containsPoint)&&(e.worldTransform.applyInverse(t,tl),e.containsPoint(tl))}notifyTarget(e,t){var i,r;if(!e.currentTarget.isInteractive())return;t??(t=e.type);const s=`on${t}`;null==(r=(i=e.currentTarget)[s])||r.call(i,e);const n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this._notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var t,i;if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const r=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const s="mouse"===r.pointerType||"pen"===r.pointerType,n=this.trackingData(e.pointerId),o=this.findMountedTarget(n.overTargets);if((null==(t=n.overTargets)?void 0:t.length)>0&&o!==r.target){const t="mousemove"===e.type?"mouseout":"pointerout",i=this.createPointerEvent(e,t,o);if(this.dispatchEvent(i,"pointerout"),s&&this.dispatchEvent(i,"mouseout"),!r.composedPath().includes(o)){const t=this.createPointerEvent(e,"pointerleave",o);for(t.eventPhase=t.AT_TARGET;t.target&&!r.composedPath().includes(t.target);)t.currentTarget=t.target,this.notifyTarget(t),s&&this.notifyTarget(t,"mouseleave"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(i)}if(o!==r.target){const t="mousemove"===e.type?"mouseover":"pointerover",i=this.clonePointerEvent(r,t);this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover");let n=null==o?void 0:o.parent;for(;n&&n!==this.rootTarget.parent&&n!==r.target;)n=n.parent;if(!n||n===this.rootTarget.parent){const e=this.clonePointerEvent(r,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==o&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),s&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}const a=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(r,"pointermove"),l&&a.push("globalpointermove"),"touch"===r.pointerType&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(r,"touchmove"),l&&a.push("globaltouchmove")),s&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(r,"mousemove"),l&&a.push("globalmousemove"),this.cursor=null==(i=r.target)?void 0:i.cursor),a.length>0&&this.all(r,a),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(e){var t;if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");const i=this.trackingData(e.pointerId),r=this.createPointerEvent(e),s="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=null==(t=r.target)?void 0:t.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;i.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId);if(t.overTargets){const i="mouse"===e.pointerType||"pen"===e.pointerType,r=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",r);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const n=this.createPointerEvent(e,"pointerleave",r);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(e){if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const e=2===i.button;this.dispatchEvent(i,e?"rightup":"mouseup")}const r=this.trackingData(e.pointerId),s=this.findMountedTarget(r.pressTargetsByButton[e.button]);let n=s;if(s&&!i.composedPath().includes(s)){let t=s;for(;t&&!i.composedPath().includes(t);){if(i.currentTarget=t,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const e=2===i.button;this.notifyTarget(i,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete r.pressTargetsByButton[e.button],n=t}if(n){const s=this.clonePointerEvent(i,"click");s.target=n,s.path=null,r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:s.target,timeStamp:t});const o=r.clicksByButton[e.button];if(o.target===s.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=t,s.detail=o.clickCount,"mouse"===s.pointerType){const e=2===s.button;this.dispatchEvent(s,e?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof Ja))return void At("EventBoundary cannot map a non-pointer event as a pointer event");const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),r=this.createPointerEvent(e);if(i){let s=i;for(;s;)r.currentTarget=s,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(r)}mapWheel(e){if(!(e instanceof Qa))return void At("EventBoundary cannot map a non-wheel event as a wheel event");const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const r=this.allocateEvent(Ja);return this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],"string"==typeof t&&(r.type=t),r}createWheelEvent(e){const t=this.allocateEvent(Qa);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(Ja);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof Ja&&t instanceof Ja&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Za&&t instanceof Za&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.defaultPrevented=!1,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}_notifyListeners(e,t){const i=e.currentTarget._events[t];if(i)if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let r=0,s=i.length;r<s&&!e.propagationImmediatelyStopped;r++)i[r].once&&e.currentTarget.removeListener(t,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,e)}}const rl={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},sl=class e{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new il(null),qa.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new Ja(null),this._rootWheelEvent=new Qa(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,i)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=i),e[t]=i,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{canvas:i,resolution:r}=this.renderer;this.setTargetElement(i),this.resolution=r,e._defaultEventMode=t.eventMode??"passive",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(e){e||(e="default");let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this._currentCursor===e)return;this._currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this._rootPointerEvent}_onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this._normalizeToPointerData(e);if(this.autoPreventDefault&&t[0].isNormalized){(e.cancelable||!("cancelable"in e))&&e.preventDefault()}for(let i=0,r=t.length;i<r;i++){const e=t[i],r=this._bootstrapEvent(this._rootPointerEvent,e);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,qa.pointerMoved();const t=this._normalizeToPointerData(e);for(let i=0,r=t.length;i<r;i++){const e=this._bootstrapEvent(this._rootPointerEvent,t[i]);this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",r=this._normalizeToPointerData(e);for(let s=0,n=r.length;s<n;s++){const e=this._bootstrapEvent(this._rootPointerEvent,r[s]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this._normalizeToPointerData(e);for(let i=0,r=t.length;i<r;i++){const e=this._bootstrapEvent(this._rootPointerEvent,t[i]);this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this._removeEvents(),this.domElement=e,qa.domElement=e,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;qa.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;qa.removeTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(e,t,i){const r=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;e.x=(t-r.left)*(this.domElement.width/r.width)*s,e.y=(i-r.top)*(this.domElement.height/r.height)*s}_normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,r=e.changedTouches.length;i<r;i++){const r=e.changedTouches[i];void 0===r.button&&(r.button=0),void 0===r.buttons&&(r.buttons=1),void 0===r.isPrimary&&(r.isPrimary=1===e.touches.length&&"touchstart"===e.type),void 0===r.width&&(r.width=r.radiusX||1),void 0===r.height&&(r.height=r.radiusY||1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="touch"),void 0===r.pointerId&&(r.pointerId=r.identifier||0),void 0===r.pressure&&(r.pressure=r.force||.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),void 0===r.layerX&&(r.layerX=r.offsetX=r.clientX),void 0===r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(globalThis.MouseEvent&&(!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof globalThis.PointerEvent))t.push(e);else{const i=e;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}return t}normalizeWheelEvent(e){const t=this._rootWheelEvent;return this._transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}_bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this._transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=rl[e.type]||e.type),e}_transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};sl.extension={name:"events",type:[I.WebGLSystem,I.CanvasSystem,I.WebGPUSystem],priority:-1},sl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let nl=sl;const ol={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(e){this.eventMode=e?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??nl.defaultEventMode},set eventMode(e){this._internalEventMode=e},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,i){const r="boolean"==typeof i&&i||"object"==typeof i&&i.capture,s="object"==typeof i?i.signal:void 0,n="object"==typeof i&&!0===i.once,o="function"==typeof t?void 0:t;e=r?`${e}capture`:e;const a="function"==typeof t?t:t.handleEvent,l=this;s&&s.addEventListener("abort",(()=>{l.off(e,a,o)})),n?l.once(e,a,o):l.on(e,a,o)},removeEventListener(e,t,i){const r="function"==typeof t?void 0:t;e="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,r)},dispatchEvent(e){if(!(e instanceof Ri))throw new Error("Container cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};class al{constructor(e){this._renderer=e}push(e,t,i){this._renderer.renderPipes.batch.break(i),i.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:t,filterEffect:e})}pop(e,t,i){this._renderer.renderPipes.batch.break(i),i.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(e){"pushFilter"===e.action?this._renderer.filter.push(e):"popFilter"===e.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}al.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"filter"};const ll=new Ls({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class hl{constructor(e){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new wr({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new Tr({}),this.renderer=e}get activeBackTexture(){var e;return null==(e=this._activeFilterData)?void 0:e.backTexture}push(e){var t;const i=this.renderer,r=e.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const s=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0===r.length)return void(s.skip=!0);const n=s.bounds;if(e.renderables?function(e,t){t.clear();const i=t.matrix;for(let r=0;r<e.length;r++){const i=e[r];i.globalDisplayStatus<7||(t.matrix=i.worldTransform,t.addBounds(i.bounds))}t.matrix=i}(e.renderables,n):e.filterEffect.filterArea?(n.clear(),n.addRect(e.filterEffect.filterArea),n.applyMatrix(e.container.worldTransform)):e.container.getFastGlobalBounds(!0,n),e.container){const t=(e.container.renderGroup||e.container.parentRenderGroup).cacheToLocalTransform;t&&n.applyMatrix(t)}const o=i.renderTarget.renderTarget.colorTexture.source;let a=1/0,l=0,h=!0,d=!1,u=!1,c=!0;for(let p=0;p<r.length;p++){const e=r[p];a=Math.min(a,"inherit"===e.resolution?o._resolution:e.resolution),l+=e.padding,"off"===e.antialias?h=!1:"inherit"===e.antialias&&h&&(h=o.antialias),e.clipToViewport||(c=!1);if(!!!(e.compatibleRenderers&i.type)){u=!1;break}if(e.blendRequired&&!((null==(t=i.backBuffer)?void 0:t.useBackBuffer)??1)){At("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),u=!1;break}u=e.enabled||u,d||(d=e.blendRequired)}if(u){if(c){const e=i.renderTarget.rootViewPort,t=i.renderTarget.renderTarget.resolution;n.fitBounds(0,e.width/t,0,e.height/t)}n.scale(a).ceil().scale(1/a).pad(0|l),n.isPositive?(s.skip=!1,s.bounds=n,s.blendRequired=d,s.container=e.container,s.filterEffect=e.filterEffect,s.previousRenderSurface=i.renderTarget.renderSurface,s.inputTexture=Ut.getOptimalTexture(n.width,n.height,a,h),i.renderTarget.bind(s.inputTexture,!0),i.globalUniforms.push({offset:n})):s.skip=!0}else s.skip=!0}pop(){const e=this.renderer;this._filterStackIndex--;const t=this._filterStack[this._filterStackIndex];if(t.skip)return;this._activeFilterData=t;const i=t.inputTexture,r=t.bounds;let s=Se.EMPTY;if(e.renderTarget.finishRenderPass(),t.blendRequired){const i=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,n=e.renderTarget.getRenderTarget(t.previousRenderSurface);s=this.getBackTexture(n,r,i)}t.backTexture=s;const n=t.filterEffect.filters;if(this._globalFilterBindGroup.setResource(i.source.style,2),this._globalFilterBindGroup.setResource(s.source,3),e.globalUniforms.pop(),1===n.length)n[0].apply(this,i,t.previousRenderSurface,!1),Ut.returnTexture(i);else{let e=t.inputTexture,i=Ut.getOptimalTexture(r.width,r.height,e.source._resolution,!1),s=0;for(s=0;s<n.length-1;++s){n[s].apply(this,e,i,!0);const t=e;e=i,i=t}n[s].apply(this,e,t.previousRenderSurface,!1),Ut.returnTexture(e),Ut.returnTexture(i)}t.blendRequired&&Ut.returnTexture(s)}getBackTexture(e,t,i){const r=e.colorTexture.source._resolution,s=Ut.getOptimalTexture(t.width,t.height,r,!1);let n=t.minX,o=t.minY;i&&(n-=i.minX,o-=i.minY),n=Math.floor(n*r),o=Math.floor(o*r);const a=Math.ceil(t.width*r),l=Math.ceil(t.height*r);return this.renderer.renderTarget.copyToTexture(e,s,{x:n,y:o},{width:a,height:l},{x:0,y:0}),s}applyFilter(e,t,i,r){const s=this.renderer,n=this._filterStack[this._filterStackIndex],o=n.bounds,a=K.shared,l=n.previousRenderSurface===i;let h=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,d=this._filterStackIndex-1;for(;d>0&&this._filterStack[d].skip;)--d;d>0&&(h=this._filterStack[d].inputTexture.source._resolution);const u=this._filterGlobalUniforms,c=u.uniforms,p=c.uOutputFrame,g=c.uInputSize,f=c.uInputPixel,m=c.uInputClamp,_=c.uGlobalFrame,y=c.uOutputTexture;if(l){let e=this._filterStackIndex;for(;e>0;){e--;const t=this._filterStack[this._filterStackIndex-1];if(!t.skip){a.x=t.bounds.minX,a.y=t.bounds.minY;break}}p[0]=o.minX-a.x,p[1]=o.minY-a.y}else p[0]=0,p[1]=0;p[2]=t.frame.width,p[3]=t.frame.height,g[0]=t.source.width,g[1]=t.source.height,g[2]=1/g[0],g[3]=1/g[1],f[0]=t.source.pixelWidth,f[1]=t.source.pixelHeight,f[2]=1/f[0],f[3]=1/f[1],m[0]=.5*f[2],m[1]=.5*f[3],m[2]=t.frame.width*g[2]-.5*f[2],m[3]=t.frame.height*g[3]-.5*f[3];const x=this.renderer.renderTarget.rootRenderTarget.colorTexture;_[0]=a.x*h,_[1]=a.y*h,_[2]=x.source.width*h,_[3]=x.source.height*h;const v=this.renderer.renderTarget.getRenderTarget(i);if(s.renderTarget.bind(i,!!r),i instanceof Se?(y[0]=i.frame.width,y[1]=i.frame.height):(y[0]=v.width,y[1]=v.height),y[2]=v.isRoot?-1:1,u.update(),s.renderPipes.uniformBatch){const e=s.renderPipes.uniformBatch.getUboResource(u);this._globalFilterBindGroup.setResource(e,0)}else this._globalFilterBindGroup.setResource(u,0);this._globalFilterBindGroup.setResource(t.source,1),this._globalFilterBindGroup.setResource(t.source.style,2),e.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:ll,shader:e,state:e._state,topology:"triangle-list"}),s.type===Er.WEBGL&&s.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new Pe,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(e,t){const i=this._activeFilterData,r=e.set(i.inputTexture._source.width,0,0,i.inputTexture._source.height,i.bounds.minX,i.bounds.minY),s=t.worldTransform.copyTo(q.shared),n=t.renderGroup||t.parentRenderGroup;return n&&n.cacheToLocalTransform&&s.prepend(n.cacheToLocalTransform),s.invert(),r.prepend(s),r.scale(1/t.texture.frame.width,1/t.texture.frame.height),r.translate(t.anchor.x,t.anchor.y),r}}hl.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"filter"};var dl="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct MaskUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uMaskClamp:vec4<f32>,\n  uAlpha:f32,\n  uInverse:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;\n@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);\n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var maskClamp = filterUniforms.uMaskClamp;\n    var uAlpha = filterUniforms.uAlpha;\n\n    var clip = step(3.5,\n      step(maskClamp.x, filterUv.x) +\n      step(maskClamp.y, filterUv.y) +\n      step(filterUv.x, maskClamp.z) +\n      step(filterUv.y, maskClamp.w));\n\n    var mask = textureSample(uMaskTexture, uSampler, filterUv);\n    var source = textureSample(uTexture, uSampler, uv);\n    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);\n\n    var a: f32 = alphaMul * mask.r * uAlpha * clip;\n\n    if (filterUniforms.uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    return source * a;\n}\n";class ul extends Mr{constructor(e){const{sprite:t,...i}=e,r=new Ce(t.texture),s=new wr({uFilterMatrix:{value:new q,type:"mat3x3<f32>"},uMaskClamp:{value:r.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:e.inverse?1:0,type:"f32"}});super({...i,gpuProgram:_r.from({vertex:{source:dl,entryPoint:"mainVertex"},fragment:{source:dl,entryPoint:"mainFragment"}}),glProgram:dr.from({vertex:"in vec2 aPosition;\n\nout vec2 vTextureCoord;\nout vec2 vMaskCoord;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition(  vec2 aPosition )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n       \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(  vec2 aPosition )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( vec2 aPosition )\n{\n    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}   \n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition(aPosition);\n    vTextureCoord = filterTextureCoord(aPosition);\n    vMaskCoord = getFilterCoord(aPosition);\n}\n",fragment:"in vec2 vMaskCoord;\nin vec2 vTextureCoord;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMaskTexture;\n\nuniform float uAlpha;\nuniform vec4 uMaskClamp;\nuniform float uInverse;\n\nout vec4 finalColor;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(uMaskClamp.x, vMaskCoord.x) +\n        step(uMaskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, uMaskClamp.z) +\n        step(vMaskCoord.y, uMaskClamp.w));\n\n    // TODO look into why this is needed\n    float npmAlpha = uAlpha;\n    vec4 original = texture(uTexture, vTextureCoord);\n    vec4 masky = texture(uMaskTexture, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    float a = alphaMul * masky.r * npmAlpha * clip;\n\n    if (uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    finalColor = original * a;\n}\n",name:"mask-filter"}),resources:{filterUniforms:s,uMaskTexture:t.texture.source}}),this.sprite=t,this._textureMatrix=r}set inverse(e){this.resources.filterUniforms.uniforms.uInverse=e?1:0}get inverse(){return 1===this.resources.filterUniforms.uniforms.uInverse}apply(e,t,i,r){this._textureMatrix.texture=this.sprite.texture,e.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,e.applyFilter(this,t,i,r)}}class cl extends Yt{constructor(e){e instanceof Mo&&(e={context:e});const{context:t,roundPixels:i,...r}=e||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",this._context=t||(this._ownedContext=new Mo),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=i??!1}set context(e){e!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=e,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(e){return this._context.containsPoint(e)}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):!0!==e&&!0!==(null==e?void 0:e.context)||this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_callContextMethod(e,t){return this.context[e](...t),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){if(e)return new cl(this._context.clone());this._ownedContext=null;return new cl(this._context)}lineStyle(e,t,i){pe(ce,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return e&&(r.width=e),t&&(r.color=t),i&&(r.alpha=i),this.context.strokeStyle=r,this}beginFill(e,t){pe(ce,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return void 0!==e&&(i.color=e),void 0!==t&&(i.alpha=t),this.context.fillStyle=i,this}endFill(){pe(ce,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const e=this.context.strokeStyle;return e.width===Mo.defaultStrokeStyle.width&&e.color===Mo.defaultStrokeStyle.color&&e.alpha===Mo.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...e){return pe(ce,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return pe(ce,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return pe(ce,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return pe(ce,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return pe(ce,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return pe(ce,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}const pl=class e extends Ls{constructor(...t){let i=t[0]??{};i instanceof Float32Array&&(pe(ce,"use new MeshGeometry({ positions, uvs, indices }) instead"),i={positions:i,uvs:t[1],indices:t[2]}),i={...e.defaultOptions,...i};const r=i.positions||new Float32Array([0,0,1,0,1,1,0,1]);let s=i.uvs;s||(s=i.positions?new Float32Array(r.length):new Float32Array([0,0,1,0,1,1,0,1]));const n=i.indices||new Uint32Array([0,1,2,0,2,3]),o=i.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new Ds({data:r,label:"attribute-mesh-positions",shrinkToFit:o,usage:Os.VERTEX|Os.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new Ds({data:s,label:"attribute-mesh-uvs",shrinkToFit:o,usage:Os.VERTEX|Os.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new Ds({data:n,label:"index-mesh-buffer",shrinkToFit:o,usage:Os.INDEX|Os.COPY_DST}),topology:i.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(e){this.attributes.aPosition.buffer.data=e}get uvs(){return this.attributes.aUV.buffer.data}set uvs(e){this.attributes.aUV.buffer.data=e}get indices(){return this.indexBuffer.data}set indices(e){this.indexBuffer.data=e}};pl.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let gl=pl;class fl{constructor({matrix:e,observer:t}={}){this.dirty=!0,this._matrix=e??new q,this.observer=t,this.position=new U(this,0,0),this.scale=new U(this,1,1),this.pivot=new U(this,0,0),this.skew=new U(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty?(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1,e):e}_onUpdate(e){var t;this.dirty=!0,e===this.skew&&this.updateSkew(),null==(t=this.observer)||t._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const ml=class e extends Yt{constructor(...t){let i=t[0]||{};i instanceof Se&&(i={texture:i}),t.length>1&&(pe(ce,"use new TilingSprite({ texture, width:100, height:100 }) instead"),i.width=t[1],i.height=t[2]),i={...e.defaultOptions,...i};const{texture:r,anchor:s,tilePosition:n,tileScale:o,tileRotation:a,width:l,height:h,applyAnchorToTexture:d,roundPixels:u,...c}=i??{};super({label:"TilingSprite",...c}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new U({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=d,this.texture=r,this._width=l??r.width,this._height=h??r.height,this._tileTransform=new fl({observer:{_onUpdate:()=>this.onViewUpdate()}}),s&&(this.anchor=s),this.tilePosition=n,this.tileScale=o,this.tileRotation=a,this.roundPixels=u??!1}static from(t,i={}){return new e("string"==typeof t?{texture:gi.get(t),...i}:{texture:t,...i})}get uvRespectAnchor(){return At("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){At("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){"number"==typeof e?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=Se.EMPTY);const t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,t){"object"==typeof e&&(t=e.height??e.width,e=e.width),this._width=e,this._height=t??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,t=this._anchor,i=this._width,r=this._height;e.minX=-t._x*i,e.maxX=e.minX+i,e.minY=-t._y*r,e.maxY=e.minY+r}containsPoint(e){const t=this._width,i=this._height,r=-t*this._anchor._x;let s=0;return e.x>=r&&e.x<=r+t&&(s=-i*this._anchor._y,e.y>=s&&e.y<=s+i)}destroy(e=!1){super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null;if("boolean"==typeof e?e:null==e?void 0:e.texture){const t="boolean"==typeof e?e:null==e?void 0:e.textureSource;this._texture.destroy(t)}this._texture=null}};ml.defaultOptions={texture:Se.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let _l=ml;class yl extends Yt{constructor(e,t){const{text:i,resolution:r,style:s,anchor:n,width:o,height:a,roundPixels:l,...h}=e;super({...h}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=t,this.text=i??"",this.style=s,this.resolution=r??null,this.allowChildren=!1,this._anchor=new U({_onUpdate:()=>{this.onViewUpdate()}}),n&&(this.anchor=n),this.roundPixels=l??!1,void 0!==o&&(this.width=o),void 0!==a&&(this.height=a)}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=null===e,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){var t;e||(e={}),null==(t=this._style)||t.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,t){"object"==typeof e?(t=e.height??e.width,e=e.width):t??(t=e),void 0!==e&&this._setWidth(e,this.bounds.width),void 0!==t&&this._setHeight(t,this.bounds.height)}containsPoint(e){const t=this.bounds.width,i=this.bounds.height,r=-t*this.anchor.x;let s=0;return e.x>=r&&e.x<=r+t&&(s=-i*this.anchor.y,e.y>=s&&e.y<=s+i)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,("boolean"==typeof e?e:null==e?void 0:e.style)&&this._style.destroy(e),this._style=null,this._text=null}}class xl extends yl{constructor(...e){const t=function(e,t){let i=e[0]??{};return("string"==typeof i||e[1])&&(pe(ce,`use new ${t}({ text: "hi!", style }) instead`),i={text:i,style:e[1]}),i}(e,"Text");super(t,Oo),this.renderPipeId="text"}updateBounds(){const e=this._bounds,t=this._anchor,i=zo.measureText(this._text,this._style),{width:r,height:s}=i;e.minX=-t._x*r,e.maxX=e.minX+r,e.minY=-t._y*s,e.maxY=e.minY+s}}function vl(e){const t=e._stroke,i=e._fill,r=[`div { ${[`color: ${st.shared.setValue(i.color).toHex()}`,`font-size: ${e.fontSize}px`,`font-family: ${e.fontFamily}`,`font-weight: ${e.fontWeight}`,`font-style: ${e.fontStyle}`,`font-variant: ${e.fontVariant}`,`letter-spacing: ${e.letterSpacing}px`,`text-align: ${e.align}`,`padding: ${e.padding}px`,`white-space: ${"pre"===e.whiteSpace&&e.wordWrap?"pre-wrap":e.whiteSpace}`,...e.lineHeight?[`line-height: ${e.lineHeight}px`]:[],...e.wordWrap?["word-wrap: "+(e.breakWords?"break-all":"break-word"),`max-width: ${e.wordWrapWidth}px`]:[],...t?[wl(t)]:[],...e.dropShadow?[bl(e.dropShadow)]:[],...e.cssOverrides].join(";")} }`];return function(e,t){for(const i in e){const r=e[i],s=[];for(const e in r)El[e]?s.push(El[e](r[e])):Tl[e]&&s.push(Tl[e].replace("{{VALUE}}",r[e]));t.push(`${i} { ${s.join(";")} }`)}}(e.tagStyles,r),r.join(" ")}function bl(e){const t=st.shared.setValue(e.color).setAlpha(e.alpha).toHexa(),i=`${Math.round(Math.cos(e.angle)*e.distance)}px ${Math.round(Math.sin(e.angle)*e.distance)}px`;return e.blur>0?`text-shadow: ${i} ${e.blur}px ${t}`:`text-shadow: ${i} ${t}`}function wl(e){return[`-webkit-text-stroke-width: ${e.width}px`,`-webkit-text-stroke-color: ${st.shared.setValue(e.color).toHex()}`,`text-stroke-width: ${e.width}px`,`text-stroke-color: ${st.shared.setValue(e.color).toHex()}`,"paint-order: stroke"].join(";")}const Tl={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},El={fill:e=>`color: ${st.shared.setValue(e).toHex()}`,breakWords:e=>"word-wrap: "+(e?"break-all":"break-word"),stroke:wl,dropShadow:bl};class Cl extends Oo{constructor(e={}){super(e),this._cssOverrides=[],this.cssOverrides??(this.cssOverrides=e.cssOverrides),this.tagStyles=e.tagStyles??{}}set cssOverrides(e){this._cssOverrides=e instanceof Array?e:[e],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=ko(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new Cl({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=vl(this)),this._cssStyle}addOverride(...e){const t=e.filter((e=>!this.cssOverrides.includes(e)));t.length>0&&(this.cssOverrides.push(...t),this.update())}removeOverride(...e){const t=e.filter((e=>this.cssOverrides.includes(e)));t.length>0&&(this.cssOverrides=this.cssOverrides.filter((e=>!t.includes(e))),this.update())}set fill(e){"string"!=typeof e&&"number"!=typeof e&&At("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=e}set stroke(e){e&&"string"!=typeof e&&"number"!=typeof e&&At("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=e}}const Sl="http://www.w3.org/2000/svg",Nl="http://www.w3.org/1999/xhtml";class Al{constructor(){this.svgRoot=document.createElementNS(Sl,"svg"),this.foreignObject=document.createElementNS(Sl,"foreignObject"),this.domElement=document.createElementNS(Nl,"div"),this.styleElement=document.createElementNS(Nl,"style"),this.image=new Image;const{foreignObject:e,svgRoot:t,styleElement:i,domElement:r}=this;e.setAttribute("width","10000"),e.setAttribute("height","10000"),e.style.overflow="hidden",t.appendChild(e),e.appendChild(i),e.appendChild(r)}}let Pl;class Ml{constructor(){this._tempState=Ar.for2d(),this._didUploadHash={}}init(e){e.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(e,t,i){const r=e.renderer,s=this._didUploadHash[i.uid];r.shader.bind(i,s),s||(this._didUploadHash[i.uid]=!0),r.shader.updateUniformGroup(r.globalUniforms.uniformGroup),r.geometry.bind(t,i.glProgram)}execute(e,t){const i=e.renderer;this._tempState.blendMode=t.blendMode,i.state.set(this._tempState);const r=t.textures.textures;for(let s=0;s<t.textures.count;s++)i.texture.bind(r[s],s);i.geometry.draw(t.topology,t.size,t.start)}}Ml.extension={type:[I.WebGLPipesAdaptor],name:"batch"};const Rl=Ar.for2d();class kl{start(e,t,i){const r=e.renderer,s=r.encoder,n=i.gpuProgram;this._shader=i,this._geometry=t,s.setGeometry(t,n),Rl.blendMode="normal",r.pipeline.getPipeline(t,n,Rl);const o=r.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,o,n)}execute(e,t){const i=this._shader.gpuProgram,r=e.renderer,s=r.encoder;if(!t.bindGroup){const e=t.textures;t.bindGroup=xs(e.textures,e.count)}Rl.blendMode=t.blendMode;const n=r.bindGroup.getBindGroup(t.bindGroup,i,1),o=r.pipeline.getPipeline(this._geometry,i,Rl,t.topology);t.bindGroup._touch(r.textureGC.count),s.setPipeline(o),s.renderPassEncoder.setBindGroup(1,n),s.renderPassEncoder.drawIndexed(t.size,1,t.start)}}kl.extension={type:[I.WebGPUPipesAdaptor],name:"batch"};const Bl=class e{constructor(e,t){var i,r;this.state=Ar.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=e,this._adaptor=t,null==(r=(i=this._adaptor).init)||r.call(i,this)}static getBatcher(e){return new this._availableBatchers[e]}buildStart(e){let t=this._batchersByInstructionSet[e.uid];t||(t=this._batchersByInstructionSet[e.uid]=Object.create(null),t.default||(t.default=new Tn)),this._activeBatches=t,this._activeBatch=this._activeBatches.default;for(const i in this._activeBatches)this._activeBatches[i].begin()}addToBatch(t,i){if(this._activeBatch.name!==t.batcherName){this._activeBatch.break(i);let r=this._activeBatches[t.batcherName];r||(r=this._activeBatches[t.batcherName]=e.getBatcher(t.batcherName),r.begin()),this._activeBatch=r}this._activeBatch.add(t)}break(e){this._activeBatch.break(e)}buildEnd(e){this._activeBatch.break(e);const t=this._activeBatches;for(const i in t){const e=t[i],r=e.geometry;r.indexBuffer.setDataWithSize(e.indexBuffer,e.indexSize,!0),r.buffers[0].setDataWithSize(e.attributeBuffer.float32View,e.attributeSize,!1)}}upload(e){const t=this._batchersByInstructionSet[e.uid];for(const i in t){const e=t[i],r=e.geometry;e.dirty&&(e.dirty=!1,r.buffers[0].update(4*e.attributeSize))}}execute(e){if("startBatch"===e.action){const t=e.batcher,i=t.geometry,r=t.shader;this._adaptor.start(this,i,r)}this._adaptor.execute(this,e)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(const e in this._activeBatches)this._activeBatches[e].destroy();this._activeBatches=null}};Bl.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"batch"},Bl._availableBatchers=Object.create(null);let Il=Bl;G.handleByMap(I.Batcher,Il._availableBatchers),G.add(Tn);const Ol={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},Dl={...Ol,vertex:{...Ol.vertex,header:Ol.vertex.header.replace("group(1)","group(2)")}},Gl={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}},Ll={name:"texture-bit",vertex:{header:"\n\n        struct TextureUniforms {\n            uTextureMatrix:mat3x3<f32>,\n        }\n\n        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;\n        ",main:"\n            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n            @group(2) @binding(0) var uTexture: texture_2d<f32>;\n            @group(2) @binding(1) var uSampler: sampler;\n\n         \n        ",main:"\n            outColor = textureSample(uTexture, uSampler, vUV);\n        "}},Fl={name:"texture-bit",vertex:{header:"\n            uniform mat3 uTextureMatrix;\n        ",main:"\n            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n        uniform sampler2D uTexture;\n\n         \n        ",main:"\n            outColor = texture(uTexture, vUV);\n        "}},Ul=new Pe;class zl extends ut{constructor(){super(),this.filters=[new ul({sprite:new jt(Se.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(e){this.filters[0].sprite=e}get inverse(){return this.filters[0].inverse}set inverse(e){this.filters[0].inverse=e}}class Hl{constructor(e){this._activeMaskStage=[],this._renderer=e}push(e,t,i){const r=this._renderer;if(r.renderPipes.batch.break(i),i.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1,maskedContainer:t}),e.inverse=t._maskOptions.inverse,e.renderMaskToTexture){const t=e.mask;t.includeInBuild=!0,t.collectRenderables(i,r,null),t.includeInBuild=!1}r.renderPipes.batch.break(i),i.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:e,maskedContainer:t,inverse:t._maskOptions.inverse,canBundle:!1})}pop(e,t,i){this._renderer.renderPipes.batch.break(i),i.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1})}execute(e){const t=this._renderer,i=e.mask.renderMaskToTexture;if("pushMaskBegin"===e.action){const r=ot.get(zl);if(r.inverse=e.inverse,i){e.mask.mask.measurable=!0;const i=xt(e.mask.mask,!0,Ul);e.mask.mask.measurable=!1,i.ceil();const s=t.renderTarget.renderTarget.colorTexture.source,n=Ut.getOptimalTexture(i.width,i.height,s._resolution,s.antialias);t.renderTarget.push(n,!0),t.globalUniforms.push({offset:i,worldColor:4294967295});const o=r.sprite;o.texture=n,o.worldTransform.tx=i.minX,o.worldTransform.ty=i.minY,this._activeMaskStage.push({filterEffect:r,maskedContainer:e.maskedContainer,filterTexture:n})}else r.sprite=e.mask.mask,this._activeMaskStage.push({filterEffect:r,maskedContainer:e.maskedContainer})}else if("pushMaskEnd"===e.action){const e=this._activeMaskStage[this._activeMaskStage.length-1];i&&(t.type===Er.WEBGL&&t.renderTarget.finishRenderPass(),t.renderTarget.pop(),t.globalUniforms.pop()),t.filter.push({renderPipeId:"filter",action:"pushFilter",container:e.maskedContainer,filterEffect:e.filterEffect,canBundle:!1})}else if("popMaskEnd"===e.action){t.filter.pop();const e=this._activeMaskStage.pop();i&&Ut.returnTexture(e.filterTexture),ot.return(e.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}Hl.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"alphaMask"};class Wl{constructor(e){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=e}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(e,t,i){this._renderer.renderPipes.batch.break(i);const r=this._colorStack;r[this._colorStackIndex]=r[this._colorStackIndex-1]&e.mask;const s=this._colorStack[this._colorStackIndex];s!==this._currentColor&&(this._currentColor=s,i.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1})),this._colorStackIndex++}pop(e,t,i){this._renderer.renderPipes.batch.break(i);const r=this._colorStack;this._colorStackIndex--;const s=r[this._colorStackIndex-1];s!==this._currentColor&&(this._currentColor=s,i.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1}))}execute(e){this._renderer.colorMask.setMask(e.colorMask)}destroy(){this._colorStack=null}}Wl.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"colorMask"};class Vl{constructor(e){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=e}push(e,t,i){var r;const s=e,n=this._renderer;n.renderPipes.batch.break(i),n.renderPipes.blendMode.setBlendMode(s.mask,"none",i),i.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});const o=s.mask;o.includeInBuild=!0,this._maskHash.has(s)||this._maskHash.set(s,{instructionsStart:0,instructionsLength:0});const a=this._maskHash.get(s);a.instructionsStart=i.instructionSize,o.collectRenderables(i,n,null),o.includeInBuild=!1,n.renderPipes.batch.break(i),i.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});const l=i.instructionSize-a.instructionsStart-1;a.instructionsLength=l;const h=n.renderTarget.renderTarget.uid;(r=this._maskStackHash)[h]??(r[h]=0)}pop(e,t,i){const r=e,s=this._renderer;s.renderPipes.batch.break(i),s.renderPipes.blendMode.setBlendMode(r.mask,"none",i),i.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:t._maskOptions.inverse,canBundle:!1});const n=this._maskHash.get(e);for(let o=0;o<n.instructionsLength;o++)i.instructions[i.instructionSize++]=i.instructions[n.instructionsStart++];i.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(e){var t;const i=this._renderer,r=i.renderTarget.renderTarget.uid;let s=(t=this._maskStackHash)[r]??(t[r]=0);"pushMaskBegin"===e.action?(i.renderTarget.ensureDepthStencil(),i.stencil.setStencilMode(Es.RENDERING_MASK_ADD,s),s++,i.colorMask.setMask(0)):"pushMaskEnd"===e.action?(e.inverse?i.stencil.setStencilMode(Es.INVERSE_MASK_ACTIVE,s):i.stencil.setStencilMode(Es.MASK_ACTIVE,s),i.colorMask.setMask(15)):"popMaskBegin"===e.action?(i.colorMask.setMask(0),0!==s?i.stencil.setStencilMode(Es.RENDERING_MASK_REMOVE,s):(i.renderTarget.clear(null,Lr.STENCIL),i.stencil.setStencilMode(Es.DISABLED,s)),s--):"popMaskEnd"===e.action&&(e.inverse?i.stencil.setStencilMode(Es.INVERSE_MASK_ACTIVE,s):i.stencil.setStencilMode(Es.MASK_ACTIVE,s),i.colorMask.setMask(15)),this._maskStackHash[r]=s}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}Vl.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"stencilMask"};var Xl=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Xl||{});class Yl{constructor(e,t){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=t}}class jl{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){const e=this._gl=this._renderer.gl;this._gpuBuffers=Object.create(null),this._maxBindings=e.MAX_UNIFORM_BUFFER_BINDINGS?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){const{_gl:t}=this,i=this.getGlBuffer(e);t.bindBuffer(i.type,i.buffer)}bindBufferBase(e,t){const{_gl:i}=this;this._boundBufferBases[t]!==e&&(this._boundBufferBases[t]=e,e._lastBindBaseLocation=t,i.bindBufferBase(i.UNIFORM_BUFFER,t,e.buffer))}nextBindBase(e){this._bindCallId++,this._minBaseLocation=0,e&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(e){let t=this.getLastBindBaseLocation(e);if(t>=this._minBaseLocation)return e._lastBindCallId=this._bindCallId,t;let i=0,r=this._nextBindBaseIndex;for(;i<2;){r>=this._maxBindings&&(r=this._minBaseLocation,i++);const e=this._boundBufferBases[r];if(!e||e._lastBindCallId!==this._bindCallId)break;r++}return t=r,this._nextBindBaseIndex=r+1,i>=2?-1:(e._lastBindCallId=this._bindCallId,this._boundBufferBases[t]=null,t)}getLastBindBaseLocation(e){const t=e._lastBindBaseLocation;return this._boundBufferBases[t]===e?t:-1}bindBufferRange(e,t,i,r){const{_gl:s}=this;i||(i=0),t||(t=0),this._boundBufferBases[t]=null,s.bindBufferRange(s.UNIFORM_BUFFER,t||0,e.buffer,256*i,r||256)}updateBuffer(e){const{_gl:t}=this,i=this.getGlBuffer(e);if(e._updateID===i.updateID)return i;i.updateID=e._updateID,t.bindBuffer(i.type,i.buffer);const r=e.data,s=e.descriptor.usage&Os.STATIC?t.STATIC_DRAW:t.DYNAMIC_DRAW;return r?i.byteLength>=r.byteLength?t.bufferSubData(i.type,0,r,0,e._updateSize/r.BYTES_PER_ELEMENT):(i.byteLength=r.byteLength,t.bufferData(i.type,r,s)):(i.byteLength=e.descriptor.size,t.bufferData(i.type,i.byteLength,s)),i}destroyAll(){const e=this._gl;for(const t in this._gpuBuffers)e.deleteBuffer(this._gpuBuffers[t].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(e,t){const i=this._gpuBuffers[e.uid],r=this._gl;t||r.deleteBuffer(i.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){const{_gl:t}=this;let i=Xl.ARRAY_BUFFER;e.descriptor.usage&Os.INDEX?i=Xl.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&Os.UNIFORM&&(i=Xl.UNIFORM_BUFFER);const r=new Yl(t.createBuffer(),i);return this._gpuBuffers[e.uid]=r,e.on("destroy",this.onBufferDestroy,this),r}resetState(){this._boundBufferBases=Object.create(null)}}jl.extension={type:[I.WebGLSystem],name:"buffer"};const Kl=class e{constructor(e){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=e,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e}init(t){t={...e.defaultOptions,...t};let i=this.multiView=t.multiView;if(t.context&&i&&(At("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),i=!1),this.canvas=i?ii.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this._renderer.view.canvas,t.context)this.initFromContext(t.context);else{const e=this._renderer.background.alpha<1,i=t.premultipliedAlpha??!0,r=t.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(t.preferWebGLVersion,{alpha:e,premultipliedAlpha:i,antialias:r,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference??"default"})}}ensureCanvasSize(e){if(!this.multiView)return void(e!==this.canvas&&At("multiView is disabled, but targetCanvas is not the main canvas"));const{canvas:t}=this;(t.width<e.width||t.height<e.height)&&(t.width=Math.max(e.width,e.width),t.height=Math.max(e.height,e.height))}initFromContext(e){this.gl=e,this.webGLVersion=e instanceof ii.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(e),this._renderer.runners.contextChange.emit(e);const t=this._renderer.view.canvas;t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(e,t){let i;const r=this.canvas;if(2===e&&(i=r.getContext("webgl2",t)),!i&&(i=r.getContext("webgl",t),!i))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=i,this.initFromContext(this.gl)}getExtensions(){const{gl:e}=this,t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc"),rgtc:e.getExtension("EXT_texture_compression_rgtc"),loseContext:e.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions={...t,drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:e.getExtension("ANGLE_instanced_arrays"),srgb:e.getExtension("EXT_sRGB")};else{this.extensions={...t,colorBufferFloat:e.getExtension("EXT_color_buffer_float")};const i=e.getExtension("WEBGL_provoking_vertex");i&&i.provokingVertexWEBGL(i.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(e){e.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout((()=>{var e;this.gl.isContextLost()&&(null==(e=this.extensions.loseContext)||e.restoreContext())}),0))}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){var e;const t=this._renderer.view.canvas;this._renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),null==(e=this.extensions.loseContext)||e.loseContext()}forceContextLoss(){var e;null==(e=this.extensions.loseContext)||e.loseContext(),this._contextLossForced=!0}validateContext(e){const t=e.getContextAttributes();t&&!t.stencil&&At("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=this.supports,r=2===this.webGLVersion,s=this.extensions;i.uint32Indices=r||!!s.uint32ElementIndex,i.uniformBufferObject=r,i.vertexArrayObject=r||!!s.vertexArrayObject,i.srgbTextures=r||!!s.srgb,i.nonPowOf2wrapping=r,i.nonPowOf2mipmaps=r,i.msaa=r,i.uint32Indices||At("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};Kl.extension={type:[I.WebGLSystem],name:"context"},Kl.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let $l=Kl;function ql(e,t){for(const i in e.attributes){const r=e.attributes[i],s=t[i];s?(r.format??(r.format=s.format),r.offset??(r.offset=s.offset),r.instance??(r.instance=s.instance)):At(`Attribute ${i} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}!function(e){const{buffers:t,attributes:i}=e,r={},s={};for(const n in t){const e=t[n];r[e.uid]=0,s[e.uid]=0}for(const n in i){const e=i[n];r[e.buffer.uid]+=cr(e.format).stride}for(const n in i){const e=i[n];e.stride??(e.stride=r[e.buffer.uid]),e.start??(e.start=s[e.buffer.uid]),s[e.buffer.uid]+=cr(e.format).stride}}(e)}var Zl=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(Zl||{}),Jl=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(Jl||{}),Ql=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(Ql||{});const eh={uint8x2:Ql.UNSIGNED_BYTE,uint8x4:Ql.UNSIGNED_BYTE,sint8x2:Ql.BYTE,sint8x4:Ql.BYTE,unorm8x2:Ql.UNSIGNED_BYTE,unorm8x4:Ql.UNSIGNED_BYTE,snorm8x2:Ql.BYTE,snorm8x4:Ql.BYTE,uint16x2:Ql.UNSIGNED_SHORT,uint16x4:Ql.UNSIGNED_SHORT,sint16x2:Ql.SHORT,sint16x4:Ql.SHORT,unorm16x2:Ql.UNSIGNED_SHORT,unorm16x4:Ql.UNSIGNED_SHORT,snorm16x2:Ql.SHORT,snorm16x4:Ql.SHORT,float16x2:Ql.HALF_FLOAT,float16x4:Ql.HALF_FLOAT,float32:Ql.FLOAT,float32x2:Ql.FLOAT,float32x3:Ql.FLOAT,float32x4:Ql.FLOAT,uint32:Ql.UNSIGNED_INT,uint32x2:Ql.UNSIGNED_INT,uint32x3:Ql.UNSIGNED_INT,uint32x4:Ql.UNSIGNED_INT,sint32:Ql.INT,sint32x2:Ql.INT,sint32x3:Ql.INT,sint32x4:Ql.INT};const th={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class ih{constructor(e){this._geometryVaoHash=Object.create(null),this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const e=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const t=this._renderer.context.extensions.vertexArrayObject;t&&(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e));const i=this._renderer.context.extensions.vertexAttribDivisorANGLE;i&&(e.drawArraysInstanced=(e,t,r,s)=>{i.drawArraysInstancedANGLE(e,t,r,s)},e.drawElementsInstanced=(e,t,r,s,n)=>{i.drawElementsInstancedANGLE(e,t,r,s,n)},e.vertexAttribDivisor=(e,t)=>i.vertexAttribDivisorANGLE(e,t)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(e,t){const i=this.gl;this._activeGeometry=e;const r=this.getVao(e,t);this._activeVao!==r&&(this._activeVao=r,i.bindVertexArray(r)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this._renderer.buffer;for(let i=0;i<e.buffers.length;i++){const r=e.buffers[i];t.updateBuffer(r)}}checkCompatibility(e,t){const i=e.attributes,r=t._attributeData;for(const s in r)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,t){const i=e.attributes,r=t._attributeData,s=["g",e.uid];for(const n in i)r[n]&&s.push(n,r[n].location);return s.join("-")}getVao(e,t){var i;return(null==(i=this._geometryVaoHash[e.uid])?void 0:i[t._key])||this.initGeometryVao(e,t)}initGeometryVao(e,t,i=!0){const r=this._renderer.gl,s=this._renderer.buffer;this._renderer.shader._getProgramData(t),this.checkCompatibility(e,t);const n=this.getSignature(e,t);this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this));const o=this._geometryVaoHash[e.uid];let a=o[n];if(a)return o[t._key]=a,a;ql(e,t._attributeData);const l=e.buffers;a=r.createVertexArray(),r.bindVertexArray(a);for(let h=0;h<l.length;h++){const e=l[h];s.bind(e)}return this.activateVao(e,t),o[t._key]=a,o[n]=a,r.bindVertexArray(null),a}onGeometryDestroy(e,t){const i=this._geometryVaoHash[e.uid],r=this.gl;if(i){if(t)for(const e in i)this._activeVao!==i[e]&&this.unbind(),r.deleteVertexArray(i[e]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){const t=this.gl;for(const i in this._geometryVaoHash){if(e)for(const e in this._geometryVaoHash[i]){const r=this._geometryVaoHash[i];this._activeVao!==r&&this.unbind(),t.deleteVertexArray(r[e])}this._geometryVaoHash[i]=null}}activateVao(e,t){var i;const r=this._renderer.gl,s=this._renderer.buffer,n=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let o=null;for(const l in n){const e=n[l],h=e.buffer,d=s.getGlBuffer(h),u=t._attributeData[l];if(u){o!==d&&(s.bind(h),o=d);const t=u.location;r.enableVertexAttribArray(t);const n=cr(e.format),l=(a=e.format,eh[a]??eh.float32);if("int"===(null==(i=u.format)?void 0:i.substring(1,4))?r.vertexAttribIPointer(t,n.size,l,e.stride,e.offset):r.vertexAttribPointer(t,n.size,l,n.normalised,e.stride,e.offset),e.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");{const i=e.divisor??1;r.vertexAttribDivisor(t,i)}}}}var a}draw(e,t,i,r){const{gl:s}=this._renderer,n=this._activeGeometry,o=th[e||n.topology];if(r??(r=n.instanceCount),n.indexBuffer){const e=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===e?s.UNSIGNED_SHORT:s.UNSIGNED_INT;r>1?s.drawElementsInstanced(o,t||n.indexBuffer.data.length,a,(i||0)*e,r):s.drawElements(o,t||n.indexBuffer.data.length,a,(i||0)*e)}else r>1?s.drawArraysInstanced(o,i||0,t||n.getSize(),r):s.drawArrays(o,i||0,t||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}ih.extension={type:[I.WebGLSystem],name:"geometry"};const rh=new Ls({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),sh=class e{constructor(e){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=e}init(t={}){const{useBackBuffer:i,antialias:r}={...e.defaultOptions,...t};this.useBackBuffer=i,this._antialias=r,this._renderer.context.supports.msaa||(At("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=Ar.for2d();const s=new dr({vertex:"\n                attribute vec2 aPosition;\n                out vec2 vUv;\n\n                void main() {\n                    gl_Position = vec4(aPosition, 0.0, 1.0);\n\n                    vUv = (aPosition + 1.0) / 2.0;\n\n                    // flip dem UVs\n                    vUv.y = 1.0 - vUv.y;\n                }",fragment:"\n                in vec2 vUv;\n                out vec4 finalColor;\n\n                uniform sampler2D uTexture;\n\n                void main() {\n                    finalColor = texture(uTexture, vUv);\n                }",name:"big-triangle"});this._bigTriangleShader=new Cr({glProgram:s,resources:{uTexture:Se.WHITE.source}})}renderStart(e){const t=this._renderer.renderTarget.getRenderTarget(e.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!t.isRoot,this._useBackBufferThisRender){const t=this._renderer.renderTarget.getRenderTarget(e.target);this._targetTexture=t.colorTexture,e.target=this._getBackBufferTexture(t.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const e=this._renderer;e.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(e.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,e.encoder.draw({geometry:rh,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(e){return this._backBufferTexture=this._backBufferTexture||new Se({source:new we({width:e.width,height:e.height,resolution:e._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(e.width,e.height,e._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};sh.extension={type:[I.WebGLSystem],name:"backBuffer",priority:1},sh.defaultOptions={useBackBuffer:!1};let nh=sh;class oh{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(8&e),!!(4&e),!!(2&e),!!(1&e)))}}oh.extension={type:[I.WebGLSystem],name:"colorMask"};class ah{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,t){this._renderer.geometry.bind(e,t.glProgram)}finishRenderPass(){}draw(e){const t=this._renderer,{geometry:i,shader:r,state:s,skipSync:n,topology:o,size:a,start:l,instanceCount:h}=e;t.shader.bind(r,n),t.geometry.bind(i,t.shader._activeProgram),s&&t.state.set(s),t.geometry.draw(o,a,l,h??i.instanceCount)}destroy(){this._renderer=null}}ah.extension={type:[I.WebGLSystem],name:"encoder"};class lh{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const hh=[];hh[Es.NONE]=void 0,hh[Es.DISABLED]={stencilWriteMask:0,stencilReadMask:0},hh[Es.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}},hh[Es.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}},hh[Es.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}},hh[Es.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}};class dh{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:Es.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP},this.resetState()}onRenderTargetChange(e){if(this._activeRenderTarget===e)return;this._activeRenderTarget=e;let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Es.DISABLED,stencilReference:0}),this.setStencilMode(t.stencilMode,t.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=Es.NONE,this._stencilCache.stencilReference=0}setStencilMode(e,t){const i=this._renderTargetStencilState[this._activeRenderTarget.uid],r=this._gl,s=hh[e],n=this._stencilCache;i.stencilMode=e,i.stencilReference=t,e!==Es.DISABLED?(this._stencilCache.enabled||(this._stencilCache.enabled=!0,r.enable(r.STENCIL_TEST)),e===n.stencilMode&&n.stencilReference===t||(n.stencilMode=e,n.stencilReference=t,r.stencilFunc(this._comparisonFuncMapping[s.stencilBack.compare],t,255),r.stencilOp(r.KEEP,r.KEEP,this._stencilOpsMapping[s.stencilBack.passOp]))):this._stencilCache.enabled&&(this._stencilCache.enabled=!1,r.disable(r.STENCIL_TEST))}}dh.extension={type:[I.WebGLSystem],name:"stencil"};class uh{constructor(e){this._syncFunctionHash=Object.create(null),this._adaptor=e,this._systemCheck()}_systemCheck(){if(!Br())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(e){const t=this.getUniformGroupData(e);e.buffer||(e.buffer=new Ds({data:new Float32Array(t.layout.size/4),usage:Os.UNIFORM|Os.COPY_DST}))}getUniformGroupData(e){return this._syncFunctionHash[e._signature]||this._initUniformGroup(e)}_initUniformGroup(e){const t=e._signature;let i=this._syncFunctionHash[t];if(!i){const r=Object.keys(e.uniformStructures).map((t=>e.uniformStructures[t])),s=this._adaptor.createUboElements(r),n=this._generateUboSync(s.uboElements);i=this._syncFunctionHash[t]={layout:s,syncFunction:n}}return this._syncFunctionHash[t]}_generateUboSync(e){return this._adaptor.generateUboSync(e)}syncUniformGroup(e,t,i){const r=this.getUniformGroupData(e);e.buffer||(e.buffer=new Ds({data:new Float32Array(r.layout.size/4),usage:Os.UNIFORM|Os.COPY_DST}));let s=null;return t||(t=e.buffer.data,s=e.buffer.dataInt32),i||(i=0),r.syncFunction(e.uniforms,t,s,i),!0}updateUniformGroup(e){if(e.isStatic&&!e._dirtyId)return!1;e._dirtyId=0;const t=this.syncUniformGroup(e);return e.buffer.update(),t}destroy(){this._syncFunctionHash=null}}const ch={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function ph(e){const t=e.map((e=>({data:e,offset:0,size:0})));let i=0,r=0;for(let s=0;s<t.length;s++){const e=t[s];if(i=ch[e.data.type],!i)throw new Error(`Unknown type ${e.data.type}`);e.data.size>1&&(i=Math.max(i,16)*e.data.size);const n=12===i?16:i;e.size=i;const o=r%16;r+=o>0&&16-o<n?(16-o)%16:(i-o%i)%i,e.offset=r,r+=i}return r=16*Math.ceil(r/16),{uboElements:t,size:r}}const gh=[{type:"mat3x3<f32>",test:e=>void 0!==e.value.a,ubo:"\n            var matrix = uv[name].toArray(true);\n            data[offset] = matrix[0];\n            data[offset + 1] = matrix[1];\n            data[offset + 2] = matrix[2];\n            data[offset + 4] = matrix[3];\n            data[offset + 5] = matrix[4];\n            data[offset + 6] = matrix[5];\n            data[offset + 8] = matrix[6];\n            data[offset + 9] = matrix[7];\n            data[offset + 10] = matrix[8];\n        ",uniform:"\n            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));\n        "},{type:"vec4<f32>",test:e=>"vec4<f32>"===e.type&&1===e.size&&void 0!==e.value.width,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n            data[offset + 2] = v.width;\n            data[offset + 3] = v.height;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                cv[2] = v.width;\n                cv[3] = v.height;\n                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);\n            }\n        "},{type:"vec2<f32>",test:e=>"vec2<f32>"===e.type&&1===e.size&&void 0!==e.value.x,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                gl.uniform2f(ud[name].location, v.x, v.y);\n            }\n        "},{type:"vec4<f32>",test:e=>"vec4<f32>"===e.type&&1===e.size&&void 0!==e.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n            data[offset + 3] = v.alpha;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                cv[3] = v.alpha;\n                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);\n            }\n        "},{type:"vec3<f32>",test:e=>"vec3<f32>"===e.type&&1===e.size&&void 0!==e.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);\n            }\n        "}];function fh(e,t,i,r){const s=["\n        var v = null;\n        var v2 = null;\n        var t = 0;\n        var index = 0;\n        var name = null;\n        var arrayOffset = null;\n    "];let n=0;for(let a=0;a<e.length;a++){const o=e[a],l=o.data.name;let h=!1,d=0;for(let e=0;e<gh.length;e++){if(gh[e].test(o.data)){d=o.offset/4,s.push(`name = "${l}";`,`offset += ${d-n};`,gh[e][t]||gh[e].ubo),h=!0;break}}if(!h)if(o.data.size>1)d=o.offset/4,s.push(i(o,d-n));else{const e=r[o.data.type];d=o.offset/4,s.push(`\n                    v = uv.${l};\n                    offset += ${d-n};\n                    ${e};\n                `)}n=d}const o=s.join("\n");return new Function("uv","data","dataInt32","offset",o)}function mh(e,t){return`\n        for (let i = 0; i < ${e*t}; i++) {\n            data[offset + (((i / ${e})|0) * 4) + (i % ${e})] = v[i];\n        }\n    `}const _h={f32:"\n        data[offset] = v;",i32:"\n        dataInt32[offset] = v;","vec2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];","vec3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];","vec4<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];","vec2<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];","vec3<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];","vec4<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];\n        dataInt32[offset + 3] = v[3];","mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 4] = v[2];\n        data[offset + 5] = v[3];","mat3x3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];","mat4x4<f32>":"\n        for (let i = 0; i < 16; i++) {\n            data[offset + i] = v[i];\n        }","mat3x2<f32>":mh(3,2),"mat4x2<f32>":mh(4,2),"mat2x3<f32>":mh(2,3),"mat4x3<f32>":mh(4,3),"mat2x4<f32>":mh(2,4),"mat3x4<f32>":mh(3,4)},yh={..._h,"mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];\n    "};function xh(e,t){const i=Math.max(ch[e.data.type]/16,1),r=e.data.value.length/e.data.size,s=(4-r%4)%4,n=e.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n        v = uv.${e.data.name};\n        offset += ${t};\n\n        arrayOffset = offset;\n\n        t = 0;\n\n        for(var i=0; i < ${e.data.size*i}; i++)\n        {\n            for(var j = 0; j < ${r}; j++)\n            {\n                ${n}[arrayOffset++] = v[t++];\n            }\n            ${0!==s?`arrayOffset += ${s};`:""}\n        }\n    `}function vh(e){return fh(e,"uboStd40",xh,_h)}class bh extends uh{constructor(){super({createUboElements:ph,generateUboSync:vh})}}bh.extension={type:[I.WebGLSystem],name:"ubo"};class wh{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new le}init(e,t){this._renderer=e,this._renderTargetSystem=t,e.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new le}copyToTexture(e,t,i,r,s){const n=this._renderTargetSystem,o=this._renderer,a=n.getGpuRenderTarget(e),l=o.gl;return this.finishRenderPass(e),l.bindFramebuffer(l.FRAMEBUFFER,a.resolveTargetFramebuffer),o.texture.bind(t,0),l.copyTexSubImage2D(l.TEXTURE_2D,0,s.x,s.y,i.x,i.y,r.width,r.height),t}startRenderPass(e,t=!0,i,r){const s=this._renderTargetSystem,n=e.colorTexture,o=s.getGpuRenderTarget(e);let a=r.y;e.isRoot&&(a=n.pixelHeight-r.height),e.colorTextures.forEach((e=>{this._renderer.texture.unbind(e)}));const l=this._renderer.gl;l.bindFramebuffer(l.FRAMEBUFFER,o.framebuffer);const h=this._viewPortCache;h.x===r.x&&h.y===a&&h.width===r.width&&h.height===r.height||(h.x=r.x,h.y=a,h.width=r.width,h.height=r.height,l.viewport(r.x,a,r.width,r.height)),o.depthStencilRenderBuffer||!e.stencil&&!e.depth||this._initStencil(o),this.clear(e,t,i)}finishRenderPass(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);if(!t.msaa)return;const i=this._renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,t.resolveTargetFramebuffer),i.bindFramebuffer(i.READ_FRAMEBUFFER,t.framebuffer),i.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer)}initGpuRenderTarget(e){const t=this._renderer.gl,i=new lh,r=e.colorTexture;return ri.test(r.resource)?(this._renderer.context.ensureCanvasSize(e.colorTexture.resource),i.framebuffer=null,i):(this._initColor(e,i),t.bindFramebuffer(t.FRAMEBUFFER,null),i)}destroyGpuRenderTarget(e){const t=this._renderer.gl;e.framebuffer&&(t.deleteFramebuffer(e.framebuffer),e.framebuffer=null),e.resolveTargetFramebuffer&&(t.deleteFramebuffer(e.resolveTargetFramebuffer),e.resolveTargetFramebuffer=null),e.depthStencilRenderBuffer&&(t.deleteRenderbuffer(e.depthStencilRenderBuffer),e.depthStencilRenderBuffer=null),e.msaaRenderBuffer.forEach((e=>{t.deleteRenderbuffer(e)})),e.msaaRenderBuffer=null}clear(e,t,i){if(!t)return;const r=this._renderTargetSystem;"boolean"==typeof t&&(t=t?Lr.ALL:Lr.NONE);const s=this._renderer.gl;if(t&Lr.COLOR){i??(i=r.defaultClearColor);const e=this._clearColorCache,t=i;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],s.clearColor(t[0],t[1],t[2],t[3]))}s.clear(t)}resizeGpuRenderTarget(e){if(e.isRoot)return;const t=this._renderTargetSystem.getGpuRenderTarget(e);this._resizeColor(e,t),(e.stencil||e.depth)&&this._resizeStencil(t)}_initColor(e,t){const i=this._renderer,r=i.gl,s=r.createFramebuffer();if(t.resolveTargetFramebuffer=s,r.bindFramebuffer(r.FRAMEBUFFER,s),t.width=e.colorTexture.source.pixelWidth,t.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach(((e,s)=>{const n=e.source;n.antialias&&(i.context.supports.msaa?t.msaa=!0:At("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),i.texture.bindSource(n,0);const o=i.texture.getGlSource(n).texture;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+s,3553,o,0)})),t.msaa){const i=r.createFramebuffer();t.framebuffer=i,r.bindFramebuffer(r.FRAMEBUFFER,i),e.colorTextures.forEach(((e,i)=>{const s=r.createRenderbuffer();t.msaaRenderBuffer[i]=s}))}else t.framebuffer=s;this._resizeColor(e,t)}_resizeColor(e,t){const i=e.colorTexture.source;if(t.width=i.pixelWidth,t.height=i.pixelHeight,e.colorTextures.forEach(((e,t)=>{0!==t&&e.source.resize(i.width,i.height,i._resolution)})),t.msaa){const i=this._renderer,r=i.gl,s=t.framebuffer;r.bindFramebuffer(r.FRAMEBUFFER,s),e.colorTextures.forEach(((e,s)=>{const n=e.source;i.texture.bindSource(n,0);const o=i.texture.getGlSource(n).internalFormat,a=t.msaaRenderBuffer[s];r.bindRenderbuffer(r.RENDERBUFFER,a),r.renderbufferStorageMultisample(r.RENDERBUFFER,4,o,n.pixelWidth,n.pixelHeight),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+s,r.RENDERBUFFER,a)}))}}_initStencil(e){if(null===e.framebuffer)return;const t=this._renderer.gl,i=t.createRenderbuffer();e.depthStencilRenderBuffer=i,t.bindRenderbuffer(t.RENDERBUFFER,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,i),this._resizeStencil(e)}_resizeStencil(e){const t=this._renderer.gl;t.bindRenderbuffer(t.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,2===this._renderer.context.webGLVersion?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,e.width,e.height)}prerender(e){const t=e.colorTexture.resource;this._renderer.context.multiView&&ri.test(t)&&this._renderer.context.ensureCanvasSize(t)}postrender(e){if(this._renderer.context.multiView&&ri.test(e.colorTexture.resource)){const t=this._renderer.context.canvas,i=e.colorTexture;i.context2D.drawImage(t,0,i.pixelHeight-t.height)}}}const Th=new Map;function Eh(e,t){if(!Th.has(e)){const i=new Se({source:new ri({resource:e,...t})}),r=()=>{Th.get(e)===i&&Th.delete(e)};i.once("destroy",r),i.source.once("destroy",r),Th.set(e,i)}return Th.get(e)}const Ch=class e{constructor(t={}){if(this.uid=de("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,t={...e.defaultOptions,...t},this.stencil=t.stencil,this.depth=t.depth,this.isRoot=t.isRoot,"number"==typeof t.colorTextures){this._managedColorTextures=!0;for(let e=0;e<t.colorTextures;e++)this.colorTextures.push(new we({width:t.width,height:t.height,resolution:t.resolution,antialias:t.antialias}))}else{this.colorTextures=[...t.colorTextures.map((e=>e.source))];const e=this.colorTexture.source;this.resize(e.width,e.height,e._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(t.depthStencilTexture||this.stencil)&&(t.depthStencilTexture instanceof Se||t.depthStencilTexture instanceof we?this.depthStencilTexture=t.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const e=this._size;return e[0]=this.pixelWidth,e[1]=this.pixelHeight,e}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(e){this.resize(e.width,e.height,e._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new we({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(e,t,i=this.resolution,r=!1){this.dirtyId++,this.colorTextures.forEach(((s,n)=>{r&&0===n||s.source.resize(e,t,i)})),this.depthStencilTexture&&this.depthStencilTexture.source.resize(e,t,i)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach((e=>{e.destroy()})),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};Ch.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let Sh=Ch;class Nh{constructor(e){this.rootViewPort=new le,this.viewport=new le,this.onRenderTargetChange=new Fr("onRenderTargetChange"),this.projectionMatrix=new q,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:e,clear:t,clearColor:i,frame:r}){var s,n;this._renderTargetStack.length=0,this.push(e,t,i,r),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=function(e){const t=e.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement&&document.body.contains(t)}(this.rootRenderTarget),null==(n=(s=this.adaptor).prerender)||n.call(s,this.rootRenderTarget)}postrender(){var e,t;null==(t=(e=this.adaptor).postrender)||t.call(e,this.rootRenderTarget)}bind(e,t=!0,i,r){const s=this.getRenderTarget(e),n=this.renderTarget!==s;this.renderTarget=s,this.renderSurface=e;const o=this.getGpuRenderTarget(s);s.pixelWidth===o.width&&s.pixelHeight===o.height||(this.adaptor.resizeGpuRenderTarget(s),o.width=s.pixelWidth,o.height=s.pixelHeight);const a=s.colorTexture,l=this.viewport,h=a.pixelWidth,d=a.pixelHeight;if(!r&&e instanceof Se&&(r=e.frame),r){const e=a._resolution;l.x=r.x*e+.5|0,l.y=r.y*e+.5|0,l.width=r.width*e+.5|0,l.height=r.height*e+.5|0}else l.x=0,l.y=0,l.width=h,l.height=d;return function(e,t,i,r,s,n){const o=n?1:-1;e.identity(),e.a=1/r*2,e.d=o*(1/s*2),e.tx=-1-t*e.a,e.ty=-o-i*e.d}(this.projectionMatrix,0,0,l.width/a.resolution,l.height/a.resolution,!s.isRoot),this.adaptor.startRenderPass(s,t,i,l),n&&this.onRenderTargetChange.emit(s),s}clear(e,t=Lr.ALL,i){t&&(e&&(e=this.getRenderTarget(e)),this.adaptor.clear(e||this.renderTarget,t,i,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(e,t=Lr.ALL,i,r){const s=this.bind(e,t,i,r);return this._renderTargetStack.push({renderTarget:s,frame:r}),s}pop(){this._renderTargetStack.pop();const e=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(e.renderTarget,!1,null,e.frame)}getRenderTarget(e){return e.isTexture&&(e=e.source),this._renderSurfaceToRenderTargetHash.get(e)??this._initRenderTarget(e)}copyToTexture(e,t,i,r,s){i.x<0&&(r.width+=i.x,s.x-=i.x,i.x=0),i.y<0&&(r.height+=i.y,s.y-=i.y,i.y=0);const{pixelWidth:n,pixelHeight:o}=e;return r.width=Math.min(r.width,n-i.x),r.height=Math.min(r.height,o-i.y),this.adaptor.copyToTexture(e,t,i,r,s)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach(((e,t)=>{e!==t&&e.destroy()})),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(e){let t=null;return ri.test(e)&&(e=Eh(e).source),e instanceof Sh?t=e:e instanceof we&&(t=new Sh({colorTextures:[e]}),ri.test(e.source.resource)&&(t.isRoot=!0),e.once("destroy",(()=>{t.destroy(),this._renderSurfaceToRenderTargetHash.delete(e);const i=this._gpuRenderTargetHash[t.uid];i&&(this._gpuRenderTargetHash[t.uid]=null,this.adaptor.destroyGpuRenderTarget(i))}))),this._renderSurfaceToRenderTargetHash.set(e,t),t}getGpuRenderTarget(e){return this._gpuRenderTargetHash[e.uid]||(this._gpuRenderTargetHash[e.uid]=this.adaptor.initGpuRenderTarget(e))}resetState(){this.renderTarget=null,this.renderSurface=null}}class Ah extends Nh{constructor(e){super(e),this.adaptor=new wh,this.adaptor.init(e,this)}}Ah.extension={type:[I.WebGLSystem],name:"renderTarget"};class Ph extends V{constructor({buffer:e,offset:t,size:i}){super(),this.uid=de("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=de("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=e,this.offset=0|t,this.size=i,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=de("resource"),this.emit("change",this)}destroy(e=!1){this.destroyed=!0,e&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}class Mh{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function Rh(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}function kh(e){const t=new Array(e);for(let i=0;i<t.length;i++)t[i]=!1;return t}function Bh(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return kh(2*t);case"bvec3":return kh(3*t);case"bvec4":return kh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let Ih=null;const Oh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},Dh={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function Gh(e,t){if(!Ih){const t=Object.keys(Oh);Ih={};for(let i=0;i<t.length;++i){const r=t[i];Ih[e[r]]=Oh[r]}}return Ih[t]}function Lh(e,t){const i=Gh(e,t);return Dh[i]||"float32"}function Fh(e,t){const i=e.getShaderSource(t).split("\n").map(((e,t)=>`${t}: ${e}`)),r=e.getShaderInfoLog(t),s=r.split("\n"),n={},o=s.map((e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((e=>!(!e||n[e])&&(n[e]=!0,!0))),a=[""];o.forEach((e=>{i[e-1]=`%c${i[e-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=i.join("\n");a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Uh(e,t){const i=Rh(e,e.VERTEX_SHADER,t.vertex),r=Rh(e,e.FRAGMENT_SHADER,t.fragment),s=e.createProgram();e.attachShader(s,i),e.attachShader(s,r);const n=t.transformFeedbackVaryings;n&&("function"!=typeof e.transformFeedbackVaryings?At("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(s,n.names,"separate"===n.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||function(e,t,i,r){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||Fh(e,i),e.getShaderParameter(r,e.COMPILE_STATUS)||Fh(e,r),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(t)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}(e,s,i,r),t._attributeData=function(e,t,i=!1){const r={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let o=0;o<s;o++){const i=t.getActiveAttrib(e,o);if(i.name.startsWith("gl_"))continue;const s=Lh(t,i.type);r[i.name]={location:0,format:s,stride:cr(s).stride,offset:0,instance:!1,start:0}}const n=Object.keys(r);if(i){n.sort(((e,t)=>e>t?1:-1));for(let i=0;i<n.length;i++)r[n[i]].location=i,t.bindAttribLocation(e,i,n[i]);t.linkProgram(e)}else for(let o=0;o<n.length;o++)r[n[o]].location=t.getAttribLocation(e,n[o]);return r}(s,e,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertex)),t._uniformData=function(e,t){const i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const r=t.getActiveUniform(e,s),n=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),a=Gh(t,r.type);i[n]={name:n,index:s,type:a,size:r.size,isArray:o,value:Bh(a,r.size)}}return i}(s,e),t._uniformBlockData=function(e,t){if(!t.ACTIVE_UNIFORM_BLOCKS)return{};const i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<r;s++){const r=t.getActiveUniformBlockName(e,s),n=t.getUniformBlockIndex(e,r),o=t.getActiveUniformBlockParameter(e,s,t.UNIFORM_BLOCK_DATA_SIZE);i[r]={name:r,index:n,size:o}}return i}(s,e),e.deleteShader(i),e.deleteShader(r);const o={};for(const a in t._uniformData){const i=t._uniformData[a];o[a]={location:e.getUniformLocation(s,a),value:Bh(i.type,i.size)}}return new Mh(s,o)}const zh={textureCount:0,blockIndex:0};class Hh{constructor(e){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(e){this._gl=e,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null,this.maxTextures=_s()}bind(e,t){if(this._setProgram(e.glProgram),t)return;zh.textureCount=0,zh.blockIndex=0;let i=this._shaderSyncFunctions[e.glProgram._key];i||(i=this._shaderSyncFunctions[e.glProgram._key]=this._generateShaderSync(e,this)),this._renderer.buffer.nextBindBase(!!e.glProgram.transformFeedbackVaryings),i(this._renderer,e,zh)}updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this._activeProgram,zh)}bindUniformBlock(e,t,i=0){const r=this._renderer.buffer,s=this._getProgramData(this._activeProgram),n=e._bufferResource;n||this._renderer.ubo.updateUniformGroup(e);const o=e.buffer,a=r.updateBuffer(o),l=r.freeLocationForBufferBase(a);if(n){const{offset:t,size:i}=e;0===t&&i===o.data.byteLength?r.bindBufferBase(a,l):r.bindBufferRange(a,l,t)}else r.getLastBindBaseLocation(a)!==l&&r.bindBufferBase(a,l);const h=this._activeProgram._uniformBlockData[t].index;s.uniformBlockBindings[i]!==l&&(s.uniformBlockBindings[i]=l,this._renderer.gl.uniformBlockBinding(s.program,h,l))}_setProgram(e){if(this._activeProgram===e)return;this._activeProgram=e;const t=this._getProgramData(e);this._gl.useProgram(t.program)}_getProgramData(e){return this._programDataHash[e._key]||this._createProgramData(e)}_createProgramData(e){const t=e._key;return this._programDataHash[t]=Uh(this._gl,e),this._programDataHash[t]}destroy(){for(const e of Object.keys(this._programDataHash)){this._programDataHash[e].destroy(),this._programDataHash[e]=null}this._programDataHash=null}_generateShaderSync(e,t){return function(e,t){const i=[],r=["\n        var g = s.groups;\n        var sS = r.shader;\n        var p = s.glProgram;\n        var ugS = r.uniformGroup;\n        var resources;\n    "];let s=!1,n=0;const o=t._getProgramData(e.glProgram);for(const l in e.groups){const a=e.groups[l];i.push(`\n            resources = g[${l}].resources;\n        `);for(const h in a.resources){const d=a.resources[h];if(d instanceof wr)if(d.ubo){const t=e._uniformBindMap[l][Number(h)];i.push(`\n                        sS.bindUniformBlock(\n                            resources[${h}],\n                            '${t}',\n                            ${e.glProgram._uniformBlockData[t].index}\n                        );\n                    `)}else i.push(`\n                        ugS.updateUniformGroup(resources[${h}], p, sD);\n                    `);else if(d instanceof Ph){const t=e._uniformBindMap[l][Number(h)];i.push(`\n                    sS.bindUniformBlock(\n                        resources[${h}],\n                        '${t}',\n                        ${e.glProgram._uniformBlockData[t].index}\n                    );\n                `)}else if(d instanceof we){const a=e._uniformBindMap[l][h],d=o.uniformData[a];d&&(s||(s=!0,r.push("\n                        var tS = r.texture;\n                        ")),t._gl.uniform1i(d.location,n),i.push(`\n                        tS.bind(resources[${h}], ${n});\n                    `),n++)}}}const a=[...r,...i].join("\n");return new Function("r","s","sD",a)}(e,t)}resetState(){this._activeProgram=null}}Hh.extension={type:[I.WebGLSystem],name:"shader"};const Wh={f32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1f(location, v);\n        }","vec2<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2f(location, v[0], v[1]);\n        }","vec3<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3f(location, v[0], v[1], v[2]);\n        }","vec4<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n        }",i32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }",u32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1ui(location, v);\n        }","vec2<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2ui(location, v[0], v[1]);\n        }","vec3<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3ui(location, v[0], v[1], v[2]);\n        }","vec4<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n        }",bool:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},Vh={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};class Xh{constructor(e){this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this.gl=null,this._cache={}}contextChange(e){this.gl=e}updateUniformGroup(e,t,i){const r=this._renderer.shader._getProgramData(t);if(!e.isStatic||e._dirtyId!==r.uniformDirtyGroups[e.uid]){r.uniformDirtyGroups[e.uid]=e._dirtyId;this._getUniformSyncFunction(e,t)(r.uniformData,e.uniforms,this._renderer,i)}}_getUniformSyncFunction(e,t){var i;return(null==(i=this._uniformGroupSyncHash[e._signature])?void 0:i[t._key])||this._createUniformSyncFunction(e,t)}_createUniformSyncFunction(e,t){const i=this._uniformGroupSyncHash[e._signature]||(this._uniformGroupSyncHash[e._signature]={}),r=this._getSignature(e,t._uniformData,"u");return this._cache[r]||(this._cache[r]=this._generateUniformsSync(e,t._uniformData)),i[t._key]=this._cache[r],i[t._key]}_generateUniformsSync(e,t){return function(e,t){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n        var name = null;\n    "];for(const r in e.uniforms){if(!t[r]){e.uniforms[r]instanceof wr?e.uniforms[r].ubo?i.push(`\n                        renderer.shader.bindUniformBlock(uv.${r}, "${r}");\n                    `):i.push(`\n                        renderer.shader.updateUniformGroup(uv.${r});\n                    `):e.uniforms[r]instanceof Ph&&i.push(`\n                        renderer.shader.bindBufferResource(uv.${r}, "${r}");\n                    `);continue}const s=e.uniformStructures[r];let n=!1;for(let e=0;e<gh.length;e++){const t=gh[e];if(s.type===t.type&&t.test(s)){i.push(`name = "${r}";`,gh[e].uniform),n=!0;break}}if(!n){const e=(1===s.size?Wh:Vh)[s.type].replace("location",`ud["${r}"].location`);i.push(`\n            cu = ud["${r}"];\n            cv = cu.value;\n            v = uv["${r}"];\n            ${e};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(e,t)}_getSignature(e,t,i){const r=e.uniforms,s=[`${i}-`];for(const n in r)s.push(n),t[n]&&s.push(t[n].type);return s.join("-")}destroy(){this._renderer=null,this._cache=null}}Xh.extension={type:[I.WebGLSystem],name:"uniformGroup"};const Yh=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=Ar.for2d()}contextChange(e){this.gl=e,this.blendModesMap=function(e){const t={};if(t.normal=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.add=[e.ONE,e.ONE],t.multiply=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.screen=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.none=[0,0],t["normal-npm"]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t["add-npm"]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t["screen-npm"]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t.erase=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],e instanceof ii.get().getWebGLRenderingContext()){const i=e.getExtension("EXT_blend_minmax");i&&(t.min=[e.ONE,e.ONE,e.ONE,e.ONE,i.MIN_EXT,i.MIN_EXT],t.max=[e.ONE,e.ONE,e.ONE,e.ONE,i.MAX_EXT,i.MAX_EXT])}else t.min=[e.ONE,e.ONE,e.ONE,e.ONE,e.MIN,e.MIN],t.max=[e.ONE,e.ONE,e.ONE,e.ONE,e.MAX,e.MAX];return t}(e),this.resetState()}set(e){if(e||(e=this.defaultState),this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)1&t&&this.map[i].call(this,!!(e.data&1<<i)),t>>=1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e||(e=this.defaultState);for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this._updateCheck(e._checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this._updateCheck(e._checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(this.blendModesMap[e]||(e="normal"),e===this.blendMode)return;this.blendMode=e;const t=this.blendModesMap[e],i=this.gl;2===t.length?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}resetState(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(e,t){const i=this.checks.indexOf(e);t&&-1===i?this.checks.push(e):t||-1===i||this.checks.splice(i,1)}static _checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static _checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};Yh.extension={type:[I.WebGLSystem],name:"state"};let jh=Yh;class Kh{constructor(e){this.target=Jl.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=Ql.UNSIGNED_BYTE,this.internalFormat=Zl.RGBA,this.format=Zl.RGBA,this.samplerType=0}}const $h={id:"buffer",upload(e,t,i){t.width===e.width||t.height===e.height?i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.width,e.height,t.format,t.type,e.resource):i.texImage2D(t.target,0,t.internalFormat,e.width,e.height,0,t.format,t.type,e.resource),t.width=e.width,t.height=e.height}},qh={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Zh={id:"compressed",upload(e,t,i){i.pixelStorei(i.UNPACK_ALIGNMENT,4);let r=e.pixelWidth,s=e.pixelHeight;const n=!!qh[e.format];for(let o=0;o<e.resource.length;o++){const a=e.resource[o];n?i.compressedTexImage2D(i.TEXTURE_2D,o,t.internalFormat,r,s,0,a):i.texImage2D(i.TEXTURE_2D,o,t.internalFormat,r,s,0,t.format,t.type,a),r=Math.max(r>>1,1),s=Math.max(s>>1,1)}}},Jh={id:"image",upload(e,t,i,r){const s=t.width,n=t.height,o=e.pixelWidth,a=e.pixelHeight,l=e.resourceWidth,h=e.resourceHeight;l<o||h<a?(s===o&&n===a||i.texImage2D(t.target,0,t.internalFormat,o,a,0,t.format,t.type,null),2===r?i.texSubImage2D(i.TEXTURE_2D,0,0,0,l,h,t.format,t.type,e.resource):i.texSubImage2D(i.TEXTURE_2D,0,0,0,t.format,t.type,e.resource)):s===o&&n===a?i.texSubImage2D(i.TEXTURE_2D,0,0,0,t.format,t.type,e.resource):2===r?i.texImage2D(t.target,0,t.internalFormat,o,a,0,t.format,t.type,e.resource):i.texImage2D(t.target,0,t.internalFormat,t.format,t.type,e.resource),t.width=o,t.height=a}},Qh={id:"video",upload(e,t,i,r){e.isValid?Jh.upload(e,t,i,r):i.texImage2D(t.target,0,t.internalFormat,1,1,0,t.format,t.type,null)}},ed={linear:9729,nearest:9728},td={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},id={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},rd={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function sd(e,t,i,r,s,n,o,a){const l=n;if(!a||"repeat"!==e.addressModeU||"repeat"!==e.addressModeV||"repeat"!==e.addressModeW){const i=id[o?"clamp-to-edge":e.addressModeU],r=id[o?"clamp-to-edge":e.addressModeV],n=id[o?"clamp-to-edge":e.addressModeW];t[s](l,t.TEXTURE_WRAP_S,i),t[s](l,t.TEXTURE_WRAP_T,r),t.TEXTURE_WRAP_R&&t[s](l,t.TEXTURE_WRAP_R,n)}if(a&&"linear"===e.magFilter||t[s](l,t.TEXTURE_MAG_FILTER,ed[e.magFilter]),i){if(!a||"linear"!==e.mipmapFilter){const i=td[e.minFilter][e.mipmapFilter];t[s](l,t.TEXTURE_MIN_FILTER,i)}}else t[s](l,t.TEXTURE_MIN_FILTER,ed[e.minFilter]);if(r&&e.maxAnisotropy>1){const i=Math.min(e.maxAnisotropy,t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));t[s](l,r.TEXTURE_MAX_ANISOTROPY_EXT,i)}e.compare&&t[s](l,t.TEXTURE_COMPARE_FUNC,rd[e.compare])}class nd{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:Jh,buffer:$h,video:Qh,compressed:Zh},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(e){this._gl=e,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=function(e,t){let i={},r=e.RGBA;return e instanceof ii.get().getWebGLRenderingContext()?t.srgb&&(i={"rgba8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT}):(i={"rgba8unorm-srgb":e.SRGB8_ALPHA8,"bgra8unorm-srgb":e.SRGB8_ALPHA8},r=e.RGBA8),{r8unorm:e.R8,r8snorm:e.R8_SNORM,r8uint:e.R8UI,r8sint:e.R8I,r16uint:e.R16UI,r16sint:e.R16I,r16float:e.R16F,rg8unorm:e.RG8,rg8snorm:e.RG8_SNORM,rg8uint:e.RG8UI,rg8sint:e.RG8I,r32uint:e.R32UI,r32sint:e.R32I,r32float:e.R32F,rg16uint:e.RG16UI,rg16sint:e.RG16I,rg16float:e.RG16F,rgba8unorm:e.RGBA,...i,rgba8snorm:e.RGBA8_SNORM,rgba8uint:e.RGBA8UI,rgba8sint:e.RGBA8I,bgra8unorm:r,rgb9e5ufloat:e.RGB9_E5,rgb10a2unorm:e.RGB10_A2,rg11b10ufloat:e.R11F_G11F_B10F,rg32uint:e.RG32UI,rg32sint:e.RG32I,rg32float:e.RG32F,rgba16uint:e.RGBA16UI,rgba16sint:e.RGBA16I,rgba16float:e.RGBA16F,rgba32uint:e.RGBA32UI,rgba32sint:e.RGBA32I,rgba32float:e.RGBA32F,stencil8:e.STENCIL_INDEX8,depth16unorm:e.DEPTH_COMPONENT16,depth24plus:e.DEPTH_COMPONENT24,"depth24plus-stencil8":e.DEPTH24_STENCIL8,depth32float:e.DEPTH_COMPONENT32F,"depth32float-stencil8":e.DEPTH32F_STENCIL8,...t.s3tc?{"bc1-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...t.s3tc_sRGB?{"bc1-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...t.rgtc?{"bc4-r-unorm":t.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":t.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":t.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":t.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...t.bptc?{"bc6h-rgb-float":t.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":t.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":t.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":t.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...t.etc?{"etc2-rgb8unorm":t.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":t.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":t.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":t.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":t.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":t.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":t.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":t.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...t.astc?{"astc-4x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}(e,this._renderer.context.extensions),this._mapFormatToType=function(e){return{r8unorm:e.UNSIGNED_BYTE,r8snorm:e.BYTE,r8uint:e.UNSIGNED_BYTE,r8sint:e.BYTE,r16uint:e.UNSIGNED_SHORT,r16sint:e.SHORT,r16float:e.HALF_FLOAT,rg8unorm:e.UNSIGNED_BYTE,rg8snorm:e.BYTE,rg8uint:e.UNSIGNED_BYTE,rg8sint:e.BYTE,r32uint:e.UNSIGNED_INT,r32sint:e.INT,r32float:e.FLOAT,rg16uint:e.UNSIGNED_SHORT,rg16sint:e.SHORT,rg16float:e.HALF_FLOAT,rgba8unorm:e.UNSIGNED_BYTE,"rgba8unorm-srgb":e.UNSIGNED_BYTE,rgba8snorm:e.BYTE,rgba8uint:e.UNSIGNED_BYTE,rgba8sint:e.BYTE,bgra8unorm:e.UNSIGNED_BYTE,"bgra8unorm-srgb":e.UNSIGNED_BYTE,rgb9e5ufloat:e.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:e.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:e.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:e.UNSIGNED_INT,rg32sint:e.INT,rg32float:e.FLOAT,rgba16uint:e.UNSIGNED_SHORT,rgba16sint:e.SHORT,rgba16float:e.HALF_FLOAT,rgba32uint:e.UNSIGNED_INT,rgba32sint:e.INT,rgba32float:e.FLOAT,stencil8:e.UNSIGNED_BYTE,depth16unorm:e.UNSIGNED_SHORT,depth24plus:e.UNSIGNED_INT,"depth24plus-stencil8":e.UNSIGNED_INT_24_8,depth32float:e.FLOAT,"depth32float-stencil8":e.FLOAT_32_UNSIGNED_INT_24_8_REV}}(e),this._mapFormatToFormat=function(e){return{r8unorm:e.RED,r8snorm:e.RED,r8uint:e.RED,r8sint:e.RED,r16uint:e.RED,r16sint:e.RED,r16float:e.RED,rg8unorm:e.RG,rg8snorm:e.RG,rg8uint:e.RG,rg8sint:e.RG,r32uint:e.RED,r32sint:e.RED,r32float:e.RED,rg16uint:e.RG,rg16sint:e.RG,rg16float:e.RG,rgba8unorm:e.RGBA,"rgba8unorm-srgb":e.RGBA,rgba8snorm:e.RGBA,rgba8uint:e.RGBA,rgba8sint:e.RGBA,bgra8unorm:e.RGBA,"bgra8unorm-srgb":e.RGBA,rgb9e5ufloat:e.RGB,rgb10a2unorm:e.RGBA,rg11b10ufloat:e.RGB,rg32uint:e.RG,rg32sint:e.RG,rg32float:e.RG,rgba16uint:e.RGBA,rgba16sint:e.RGBA,rgba16float:e.RGBA,rgba32uint:e.RGBA,rgba32sint:e.RGBA,rgba32float:e.RGBA,stencil8:e.STENCIL_INDEX8,depth16unorm:e.DEPTH_COMPONENT,depth24plus:e.DEPTH_COMPONENT,"depth24plus-stencil8":e.DEPTH_STENCIL,depth32float:e.DEPTH_COMPONENT,"depth32float-stencil8":e.DEPTH_STENCIL}}(e)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let t=0;t<16;t++)this.bind(Se.EMPTY,t)}initSource(e){this.bind(e)}bind(e,t=0){const i=e.source;e?(this.bindSource(i,t),this._useSeparateSamplers&&this._bindSampler(i.style,t)):(this.bindSource(null,t),this._useSeparateSamplers&&this._bindSampler(null,t))}bindSource(e,t=0){const i=this._gl;if(e._touched=this._renderer.textureGC.count,this._boundTextures[t]!==e){this._boundTextures[t]=e,this._activateLocation(t),e||(e=Se.EMPTY.source);const r=this.getGlSource(e);i.bindTexture(r.target,r.texture)}}_bindSampler(e,t=0){const i=this._gl;if(!e)return this._boundSamplers[t]=null,void i.bindSampler(t,null);const r=this._getGlSampler(e);this._boundSamplers[t]!==r&&(this._boundSamplers[t]=r,i.bindSampler(t,r))}unbind(e){const t=e.source,i=this._boundTextures,r=this._gl;for(let s=0;s<i.length;s++)if(i[s]===t){this._activateLocation(s);const e=this.getGlSource(t);r.bindTexture(e.target,null),i[s]=null}}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){const t=this._gl,i=new Kh(t.createTexture());if(i.type=this._mapFormatToType[e.format],i.internalFormat=this._mapFormatToInternalFormat[e.format],i.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||e.isPowerOfTwo)){const t=Math.max(e.width,e.height);e.mipLevelCount=Math.floor(Math.log2(t))+1}return this._glTextures[e.uid]=i,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),this.updateStyle(e,!1),i}onStyleChange(e){this.updateStyle(e,!1)}updateStyle(e,t){const i=this._gl,r=this.getGlSource(e);i.bindTexture(i.TEXTURE_2D,r.texture),this._boundTextures[this._activeTextureLocation]=e,sd(e.style,i,e.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",i.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!e.isPowerOfTwo,t)}onSourceUnload(e){const t=this._glTextures[e.uid];t&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(t.texture))}onSourceUpdate(e){const t=this._gl,i=this.getGlSource(e);t.bindTexture(t.TEXTURE_2D,i.texture),this._boundTextures[this._activeTextureLocation]=e;const r="premultiply-alpha-on-upload"===e.alphaMode;this._premultiplyAlpha!==r&&(this._premultiplyAlpha=r,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r)),this._uploads[e.uploadMethodId]?this._uploads[e.uploadMethodId].upload(e,i,t,this._renderer.context.webGLVersion):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.pixelWidth,e.pixelHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e,!1)}onUpdateMipmaps(e,t=!0){t&&this.bindSource(e,0);const i=this.getGlSource(e);this._gl.generateMipmap(i.target)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("resize",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("styleChange",this.onStyleChange,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){const t=this._gl,i=this._gl.createSampler();return this._glSamplers[e._resourceId]=i,sd(e,t,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",i,!1,!0),this._glSamplers[e._resourceId]}_getGlSampler(e){return this._glSamplers[e._resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){const{pixels:t,width:i,height:r}=this.getPixels(e),s=ii.get().createCanvas();s.width=i,s.height=r;const n=s.getContext("2d");if(n){const e=n.createImageData(i,r);e.data.set(t),n.putImageData(e,0,0)}return s}getPixels(e){const t=e.source.resolution,i=e.frame,r=Math.max(Math.round(i.width*t),1),s=Math.max(Math.round(i.height*t),1),n=new Uint8Array(4*r*s),o=this._renderer,a=o.renderTarget.getRenderTarget(e),l=o.renderTarget.getGpuRenderTarget(a),h=o.gl;return h.bindFramebuffer(h.FRAMEBUFFER,l.resolveTargetFramebuffer),h.readPixels(Math.round(i.x*t),Math.round(i.y*t),r,s,h.RGBA,h.UNSIGNED_BYTE,n),{pixels:new Uint8ClampedArray(n.buffer),width:r,height:s}}destroy(){this.managedTextures.slice().forEach((e=>this.onSourceDestroy(e))),this.managedTextures=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(Se.EMPTY.source),this._boundSamplers=Object.create(null)}}nd.extension={type:[I.WebGLSystem],name:"texture"};class od{init(){const e=new wr({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new q,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),t=_s(),i=on({name:"graphics",bits:[ln,fn(t),Gl,_n]});this.shader=new Cr({glProgram:i,resources:{localUniforms:e,batchSamplers:xn(t)}})}execute(e,t){const i=t.context,r=i.customShader||this.shader,s=e.renderer,n=s.graphicsContext,{batcher:o,instructions:a}=n.getContextRenderData(i);r.groups[0]=s.globalUniforms.bindGroup,s.state.set(e.state),s.shader.bind(r),s.geometry.bind(o.geometry,r.glProgram);const l=a.instructions;for(let h=0;h<a.instructionSize;h++){const e=l[h];if(e.size){for(let t=0;t<e.textures.count;t++)s.texture.bind(e.textures.textures[t],t);s.geometry.draw(e.topology,e.size,e.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}od.extension={type:[I.WebGLPipesAdaptor],name:"graphics"};class ad{init(){const e=on({name:"mesh",bits:[Gl,Fl,_n]});this._shader=new Cr({glProgram:e,resources:{uTexture:Se.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new q}}}})}execute(e,t){const i=e.renderer;let r=t._shader;if(r){if(!r.glProgram)return void At("Mesh shader has no glProgram",t.shader)}else{r=this._shader;const e=t.texture,i=e.source;r.resources.uTexture=i,r.resources.uSampler=i.style,r.resources.textureUniforms.uniforms.uTextureMatrix=e.textureMatrix.mapCoord}r.groups[100]=i.globalUniforms.bindGroup,r.groups[101]=e.localUniformsBindGroup,i.encoder.draw({geometry:t._geometry,shader:r,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}ad.extension={type:[I.WebGLPipesAdaptor],name:"mesh"};class ld{constructor(e){this._renderer=e}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(e,t){this._renderer.renderPipes.batch.break(t),t.add(e)}execute(e){e.isRenderable&&e.render(this._renderer)}destroy(){this._renderer=null}}ld.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"customRender"};class hd{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}function dd(e,t){const i=e.instructionSet,r=i.instructions;for(let s=0;s<i.instructionSize;s++){const e=r[s];t[e.renderPipeId].execute(e)}}const ud=new q;class cd{constructor(e){this._renderer=e}addRenderGroup(e,t){e.isCachedAsTexture?this._addRenderableCacheAsTexture(e,t):this._addRenderableDirect(e,t)}execute(e){e.isRenderable&&(e.isCachedAsTexture?this._executeCacheAsTexture(e):this._executeDirect(e))}destroy(){this._renderer=null}_addRenderableDirect(e,t){this._renderer.renderPipes.batch.break(t),e._batchableRenderGroup&&(ot.return(e._batchableRenderGroup),e._batchableRenderGroup=null),t.add(e)}_addRenderableCacheAsTexture(e,t){const i=e._batchableRenderGroup??(e._batchableRenderGroup=ot.get(hd));i.renderable=e.root,i.transform=e.root.relativeGroupTransform,i.texture=e.texture,i.bounds=e._textureBounds,t.add(e),this._renderer.renderPipes.batch.addToBatch(i,t)}_executeCacheAsTexture(e){if(e.textureNeedsUpdate){e.textureNeedsUpdate=!1;const t=ud.identity().translate(-e._textureBounds.x,-e._textureBounds.y);this._renderer.renderTarget.push(e.texture,!0,null,e.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:t,worldColor:4294967295}),dd(e,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}e._batchableRenderGroup._batcher.updateElement(e._batchableRenderGroup),e._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(e){this._renderer.globalUniforms.push({worldTransformMatrix:e.inverseParentTextureTransform,worldColor:e.worldColorAlpha}),dd(e,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}function pd(e,t){t||(t=0);for(let i=t;i<e.length&&e[i];i++)e[i]=null}cd.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"renderGroup"};const gd=new Xt;function fd(e,t=!1){!function(e){const t=e.root;let i;if(e.renderGroupParent){const r=e.renderGroupParent;e.worldTransform.appendFrom(t.relativeGroupTransform,r.worldTransform),e.worldColor=Et(t.groupColor,r.worldColor),i=t.groupAlpha*r.worldAlpha}else e.worldTransform.copyFrom(t.localTransform),e.worldColor=t.localColor,i=t.localAlpha;i=i<0?0:i>1?1:i,e.worldAlpha=i,e.worldColorAlpha=e.worldColor+(255*i<<24)}(e);const i=e.childrenToUpdate,r=e.updateTick++;for(const s in i){const t=Number(s),n=i[s],o=n.list,a=n.index;for(let i=0;i<a;i++){const s=o[i];s.parentRenderGroup===e&&s.relativeRenderGroupDepth===t&&md(s,r,0)}pd(o,a),n.index=0}if(t)for(let s=0;s<e.renderGroupChildren.length;s++)fd(e.renderGroupChildren[s],t)}function md(e,t,i){if(t===e.updateTick)return;e.updateTick=t,e.didChange=!1;const r=e.localTransform;e.updateLocalTransform();const s=e.parent;if(s&&!s.renderGroup?(i|=e._updateFlags,e.relativeGroupTransform.appendFrom(r,s.relativeGroupTransform),7&i&&_d(e,s,i)):(i=e._updateFlags,e.relativeGroupTransform.copyFrom(r),7&i&&_d(e,gd,i)),!e.renderGroup){const r=e.children,s=r.length;for(let e=0;e<s;e++)md(r[e],t,i);const n=e.parentRenderGroup,o=e;o.renderPipeId&&!n.structureDidChange&&n.updateRenderable(o)}}function _d(e,t,i){if(1&i){e.groupColor=Et(e.localColor,t.groupColor);let i=e.localAlpha*t.groupAlpha;i=i<0?0:i>1?1:i,e.groupAlpha=i,e.groupColorAlpha=e.groupColor+(255*i<<24)}2&i&&(e.groupBlendMode="inherit"===e.localBlendMode?t.groupBlendMode:e.localBlendMode),4&i&&(e.globalDisplayStatus=e.localDisplayStatus&t.globalDisplayStatus),e._updateFlags=0}const yd=new q;class xd{constructor(e){this._renderer=e}render({container:e,transform:t}){const i=e.parent,r=e.renderGroup.renderGroupParent;e.parent=null,e.renderGroup.renderGroupParent=null;const s=this._renderer;let n=yd;t&&(n=n.copyFrom(e.renderGroup.localTransform),e.renderGroup.localTransform.copyFrom(t));const o=s.renderPipes;this._updateCachedRenderGroups(e.renderGroup,null),this._updateRenderGroups(e.renderGroup),s.globalUniforms.start({worldTransformMatrix:t?e.renderGroup.localTransform:e.renderGroup.worldTransform,worldColor:e.renderGroup.worldColorAlpha}),dd(e.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),t&&e.renderGroup.localTransform.copyFrom(n),e.parent=i,e.renderGroup.renderGroupParent=r}destroy(){this._renderer=null}_updateCachedRenderGroups(e,t){if(e.isCachedAsTexture){if(!e.updateCacheTexture)return;t=e}e._parentCacheAsTextureRenderGroup=t;for(let i=e.renderGroupChildren.length-1;i>=0;i--)this._updateCachedRenderGroups(e.renderGroupChildren[i],t);if(e.invalidateMatrices(),e.isCachedAsTexture){if(e.textureNeedsUpdate){const t=e.root.getLocalBounds();t.ceil();const i=e.texture;e.texture&&Ut.returnTexture(e.texture);const r=this._renderer,s=e.textureOptions.resolution||r.view.resolution,n=e.textureOptions.antialias??r.view.antialias;e.texture=Ut.getOptimalTexture(t.width,t.height,s,n),e._textureBounds||(e._textureBounds=new Pe),e._textureBounds.copyFrom(t),i!==e.texture&&e.renderGroupParent&&(e.renderGroupParent.structureDidChange=!0)}}else e.texture&&(Ut.returnTexture(e.texture),e.texture=null)}_updateRenderGroups(e){const t=this._renderer,i=t.renderPipes;if(e.runOnRender(t),e.instructionSet.renderPipes=i,e.structureDidChange?pd(e.childrenRenderablesToUpdate.list,0):function(e,t){const{list:i,index:r}=e.childrenRenderablesToUpdate;let s=!1;for(let n=0;n<r;n++){const e=i[n];if(s=t[e.renderPipeId].validateRenderable(e),s)break}e.structureDidChange=s}(e,i),fd(e),e.structureDidChange?(e.structureDidChange=!1,this._buildInstructions(e,t)):this._updateRenderables(e),e.childrenRenderablesToUpdate.index=0,t.renderPipes.batch.upload(e.instructionSet),!e.isCachedAsTexture||e.textureNeedsUpdate)for(let r=0;r<e.renderGroupChildren.length;r++)this._updateRenderGroups(e.renderGroupChildren[r])}_updateRenderables(e){const{list:t,index:i}=e.childrenRenderablesToUpdate;for(let r=0;r<i;r++){const i=t[r];i.didViewUpdate&&e.updateRenderable(i)}pd(t,i)}_buildInstructions(e,t){const i=e.root,r=e.instructionSet;r.reset();const s=t.renderPipes?t:t.batch.renderer,n=s.renderPipes;n.batch.buildStart(r),n.blendMode.buildStart(),n.colorMask.buildStart(),i.sortableChildren&&i.sortChildren(),i.collectRenderablesWithEffects(r,s,null),n.batch.buildEnd(r),n.blendMode.buildEnd(r)}}xd.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"renderGroup"};class vd{constructor(e){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(e,t){const i=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,i),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){const t=this._gpuSpriteHash[e.uid];e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){const t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}destroyRenderable(e){const t=this._gpuSpriteHash[e.uid];ot.return(t),this._gpuSpriteHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(e,t){t.bounds=e.visualBounds,t.texture=e._texture}_getGpuSprite(e){return this._gpuSpriteHash[e.uid]||this._initGPUSprite(e)}_initGPUSprite(e){const t=ot.get(hd);return t.renderable=e,t.transform=e.groupTransform,t.texture=e._texture,t.bounds=e.visualBounds,t.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuSpriteHash[e.uid]=t,e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(const e in this._gpuSpriteHash)ot.return(this._gpuSpriteHash[e]);this._gpuSpriteHash=null,this._renderer=null}}vd.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"sprite"};const bd=class e{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new st(0),this.color=this._backgroundColor,this.alpha=1}init(t){t={...e.defaultOptions,...t},this.clearBeforeRender=t.clearBeforeRender,this.color=t.background||t.backgroundColor||this._backgroundColor,this.alpha=t.backgroundAlpha,this._backgroundColor.setAlpha(t.backgroundAlpha)}get color(){return this._backgroundColor}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};bd.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"background",priority:0},bd.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let wd=bd;const Td={};G.handle(I.BlendMode,(e=>{if(!e.name)throw new Error("BlendMode extension must have a name property");Td[e.name]=e.ref}),(e=>{delete Td[e.name]}));class Ed{constructor(e){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=e,this._renderer.runners.prerender.add(this)}prerender(){this._activeBlendMode="normal",this._isAdvanced=!1}setBlendMode(e,t,i){this._activeBlendMode!==t?(this._activeBlendMode=t,this._isAdvanced&&this._endAdvancedBlendMode(i),this._isAdvanced=!!Td[t],this._isAdvanced&&(this._beginAdvancedBlendMode(i),this._renderableList.push(e))):this._isAdvanced&&this._renderableList.push(e)}_beginAdvancedBlendMode(e){this._renderer.renderPipes.batch.break(e);const t=this._activeBlendMode;if(!Td[t])return void At(`Unable to assign BlendMode: '${t}'. You may want to include: import 'pixi.js/advanced-blend-modes'`);let i=this._filterHash[t];i||(i=this._filterHash[t]=new ut,i.filters=[new Td[t]]);const r={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:i,canBundle:!1};this._renderableList=r.renderables,e.add(r)}_endAdvancedBlendMode(e){this._renderableList=null,this._renderer.renderPipes.batch.break(e),e.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(e){this._isAdvanced&&this._endAdvancedBlendMode(e)}destroy(){this._renderer=null,this._renderableList=null;for(const e in this._filterHash)this._filterHash[e].destroy();this._filterHash=null}}Ed.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"blendMode"};const Cd={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},Sd=class e{constructor(e){this._renderer=e}_normalizeOptions(e,t={}){return e instanceof Xt||e instanceof Se?{target:e,...t}:{...t,...e}}async image(e){const t=new Image;return t.src=await this.base64(e),t}async base64(t){t=this._normalizeOptions(t,e.defaultImageOptions);const{format:i,quality:r}=t,s=this.canvas(t);if(void 0!==s.toBlob)return new Promise(((e,t)=>{s.toBlob((i=>{if(!i)return void t(new Error("ICanvas.toBlob failed!"));const r=new FileReader;r.onload=()=>e(r.result),r.onerror=t,r.readAsDataURL(i)}),Cd[i],r)}));if(void 0!==s.toDataURL)return s.toDataURL(Cd[i],r);if(void 0!==s.convertToBlob){const e=await s.convertToBlob({type:Cd[i],quality:r});return new Promise(((t,i)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=i,r.readAsDataURL(e)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e){const t=(e=this._normalizeOptions(e)).target,i=this._renderer;if(t instanceof Se)return i.texture.generateCanvas(t);const r=i.textureGenerator.generateTexture(e),s=i.texture.generateCanvas(r);return r.destroy(!0),s}pixels(e){const t=(e=this._normalizeOptions(e)).target,i=this._renderer,r=t instanceof Se?t:i.textureGenerator.generateTexture(e),s=i.texture.getPixels(r);return t instanceof Xt&&r.destroy(!0),s}texture(e){return(e=this._normalizeOptions(e)).target instanceof Se?e.target:this._renderer.textureGenerator.generateTexture(e)}download(e){e=this._normalizeOptions(e);const t=this.canvas(e),i=document.createElement("a");i.download=e.filename??"image.png",i.href=t.toDataURL("image/png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}log(e){const t=e.width??200;e=this._normalizeOptions(e);const i=this.canvas(e),r=i.toDataURL();console.log(`[Pixi Texture] ${i.width}px ${i.height}px`);const s=["font-size: 1px;",`padding: ${t}px 300px;`,`background: url(${r}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",s)}destroy(){this._renderer=null}};Sd.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"extract"},Sd.defaultImageOptions={format:"png",quality:1};let Nd=Sd;class Ad extends Se{static create(e){return new Ad({source:new we(e)})}resize(e,t,i){return this.source.resize(e,t,i),this}}const Pd=new le,Md=new Pe,Rd=[0,0,0,0];class kd{constructor(e){this._renderer=e}generateTexture(e){var t;e instanceof Xt&&(e={target:e,frame:void 0,textureSourceOptions:{},resolution:void 0});const i=e.resolution||this._renderer.resolution,r=e.antialias||this._renderer.view.antialias,s=e.target;let n=e.clearColor;if(n){n=Array.isArray(n)&&4===n.length?n:st.shared.setValue(n).toArray()}else n=Rd;const o=(null==(t=e.frame)?void 0:t.copyTo(Pd))||Pt(s,Md).rectangle;o.width=0|Math.max(o.width,1/i),o.height=0|Math.max(o.height,1/i);const a=Ad.create({...e.textureSourceOptions,width:o.width,height:o.height,resolution:i,antialias:r}),l=q.shared.translate(-o.x,-o.y);return this._renderer.render({container:s,transform:l,target:a,clearColor:n}),a.source.updateMipmaps(),a}destroy(){this._renderer=null}}function Bd(e,t,i){const r=(e>>24&255)/255;t[i++]=(255&e)/255*r,t[i++]=(e>>8&255)/255*r,t[i++]=(e>>16&255)/255*r,t[i++]=r}kd.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"textureGenerator"};class Id{constructor(e){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=e}reset(){this._stackIndex=0;for(let e=0;e<this._activeUniforms.length;e++)this._uniformsPool.push(this._activeUniforms[e]);for(let e=0;e<this._activeBindGroups.length;e++)this._bindGroupPool.push(this._activeBindGroups[e]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(e){this.reset(),this.push(e)}bind({size:e,projectionMatrix:t,worldTransformMatrix:i,worldColor:r,offset:s}){const n=this._renderer.renderTarget.renderTarget,o=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{worldTransformMatrix:new q,worldColor:4294967295,offset:new K},a={projectionMatrix:t||this._renderer.renderTarget.projectionMatrix,resolution:e||n.size,worldTransformMatrix:i||o.worldTransformMatrix,worldColor:r||o.worldColor,offset:s||o.offset,bindGroup:null},l=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(l);const h=l.uniforms;let d;h.uProjectionMatrix=a.projectionMatrix,h.uResolution=a.resolution,h.uWorldTransformMatrix.copyFrom(a.worldTransformMatrix),h.uWorldTransformMatrix.tx-=a.offset.x,h.uWorldTransformMatrix.ty-=a.offset.y,Bd(a.worldColor,h.uWorldColorAlpha,0),l.update(),this._renderer.renderPipes.uniformBatch?d=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(l,!1):(d=this._bindGroupPool.pop()||new Tr,this._activeBindGroups.push(d),d.setResource(l,0)),a.bindGroup=d,this._currentGlobalUniformData=a}push(e){this.bind(e),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===Er.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new wr({uProjectionMatrix:{value:new q,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new q,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}}Id.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"globalUniforms"};let Od=1;class Dd{constructor(){this._tasks=[],this._offset=0}init(){hi.system.add(this._update,this)}repeat(e,t,i=!0){const r=Od++;let s=0;return i&&(this._offset+=1e3,s=this._offset),this._tasks.push({func:e,duration:t,start:performance.now(),offset:s,last:performance.now(),repeat:!0,id:r}),r}cancel(e){for(let t=0;t<this._tasks.length;t++)if(this._tasks[t].id===e)return void this._tasks.splice(t,1)}_update(){const e=performance.now();for(let t=0;t<this._tasks.length;t++){const i=this._tasks[t];if(e-i.offset-i.last>=i.duration){const t=e-i.start;i.func(t),i.last=e}}}destroy(){hi.system.remove(this._update,this),this._tasks.length=0}}Dd.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"scheduler",priority:0};let Gd=!1;class Ld{constructor(e){this._renderer=e}init(e){if(e.hello){let e=this._renderer.name;this._renderer.type===Er.WEBGL&&(e+=` ${this._renderer.context.webGLVersion}`),function(e){if(!Gd){if(ii.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const t=[`%c  %c  %c  %c  %c PixiJS %c v${jr} (${e}) http://www.pixijs.com/\n\n`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...t)}else globalThis.console&&globalThis.console.log(`PixiJS ${jr} - ${e} - http://www.pixijs.com/`);Gd=!0}}(e)}}}function Fd(e){let t=!1;for(const r in e)if(null==e[r]){t=!0;break}if(!t)return e;const i=Object.create(null);for(const r in e){const t=e[r];t&&(i[r]=t)}return i}function Ud(e){let t=0;for(let i=0;i<e.length;i++)null==e[i]?t++:e[i-t]=e[i];return e.length-=t,e}Ld.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"hello",priority:-2},Ld.defaultOptions={hello:!1};let zd=0;const Hd=class e{constructor(e){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=e}init(t){t={...e.defaultOptions,...t},this.maxUnusedTime=t.renderableGCMaxUnusedTime,this._frequency=t.renderableGCFrequency,this.enabled=t.renderableGCActive}get enabled(){return!!this._handler}set enabled(e){this.enabled!==e&&(e?(this._handler=this._renderer.scheduler.repeat((()=>this.run()),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat((()=>{for(const e of this._managedHashes)e.context[e.hash]=Fd(e.context[e.hash])}),this._frequency),this._arrayHandler=this._renderer.scheduler.repeat((()=>{for(const e of this._managedArrays)Ud(e.context[e.hash])}),this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(e,t){this._managedHashes.push({context:e,hash:t})}addManagedArray(e,t){this._managedArrays.push({context:e,hash:t})}prerender({container:e}){this._now=performance.now(),e.renderGroup.gcTick=zd++,this._updateInstructionGCTick(e.renderGroup,e.renderGroup.gcTick)}addRenderable(e){this.enabled&&(-1===e._lastUsed&&(this._managedRenderables.push(e),e.once("destroyed",this._removeRenderable,this)),e._lastUsed=this._now)}run(){var e;const t=this._now,i=this._managedRenderables,r=this._renderer.renderPipes;let s=0;for(let n=0;n<i.length;n++){const o=i[n];if(null===o){s++;continue}const a=o.renderGroup??o.parentRenderGroup,l=(null==(e=null==a?void 0:a.instructionSet)?void 0:e.gcTick)??-1;if(((null==a?void 0:a.gcTick)??0)===l&&(o._lastUsed=t),t-o._lastUsed>this.maxUnusedTime){if(!o.destroyed){const e=r;a&&(a.structureDidChange=!0),e[o.renderPipeId].destroyRenderable(o)}o._lastUsed=-1,s++,o.off("destroyed",this._removeRenderable,this)}else i[n-s]=o}i.length-=s}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(e){const t=this._managedRenderables.indexOf(e);t>=0&&(e.off("destroyed",this._removeRenderable,this),this._managedRenderables[t]=null)}_updateInstructionGCTick(e,t){e.instructionSet.gcTick=t;for(const i of e.renderGroupChildren)this._updateInstructionGCTick(i,t)}};Hd.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"renderableGC",priority:0},Hd.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let Wd=Hd;const Vd=class e{constructor(e){this._renderer=e,this.count=0,this.checkCount=0}init(t){t={...e.defaultOptions,...t},this.checkCountMax=t.textureGCCheckCountMax,this.maxIdle=t.textureGCAMaxIdle??t.textureGCMaxIdle,this.active=t.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this._renderer.texture.managedTextures;for(let t=0;t<e.length;t++){const i=e[t];i.autoGarbageCollect&&i.resource&&i._touched>-1&&this.count-i._touched>this.maxIdle&&(i._touched=-1,i.unload())}}destroy(){this._renderer=null}};Vd.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"textureGC"},Vd.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:3600,textureGCCheckCountMax:600};let Xd=Vd;const Yd=class e{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(e){this.texture.source.autoDensity=e}get resolution(){return this.texture.source._resolution}set resolution(e){this.texture.source.resize(this.texture.source.width,this.texture.source.height,e)}init(t){(t={...e.defaultOptions,...t}).view&&(pe(ce,"ViewSystem.view has been renamed to ViewSystem.canvas"),t.canvas=t.view),this.screen=new le(0,0,t.width,t.height),this.canvas=t.canvas||ii.get().createCanvas(),this.antialias=!!t.antialias,this.texture=Eh(this.canvas,t),this.renderTarget=new Sh({colorTextures:[this.texture],depth:!!t.depth,isRoot:!0}),this.texture.source.transparent=t.backgroundAlpha<1,this.resolution=t.resolution}resize(e,t,i){this.texture.source.resize(e,t,i),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(e=!1){("boolean"==typeof e?e:!!(null==e?void 0:e.removeView))&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};Yd.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"view",priority:0},Yd.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};const jd=[wd,Id,Ld,Yd,xd,Xd,kd,Nd,Kr,Wd,Dd],Kd=[Ed,Il,vd,cd,Hl,Vl,Wl,ld],$d=[...jd,bh,nh,$l,jl,nd,Ah,ih,Xh,Hh,ah,jh,dh,oh],qd=[...Kd],Zd=[Ml,ad,od],Jd=[],Qd=[],eu=[];G.handleByNamedList(I.WebGLSystem,Jd),G.handleByNamedList(I.WebGLPipes,Qd),G.handleByNamedList(I.WebGLPipesAdaptor,eu),G.add(...$d,...qd,...Zd);const tu=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:class extends Vr{constructor(){super({name:"webgl",type:Er.WEBGL,systems:Jd,renderPipes:Qd,renderPipeAdaptors:eu})}}},Symbol.toStringTag,{value:"Module"}));class iu{constructor(e){this._hash=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(e){this._gpu=e}getBindGroup(e,t,i){e._updateKey();return this._hash[e._key]||this._createBindGroup(e,t,i)}_createBindGroup(e,t,i){const r=this._gpu.device,s=t.layout[i],n=[],o=this._renderer;for(const h in s){const t=e.resources[h]??e.resources[s[h]];let i;if("uniformGroup"===t._resourceType){const e=t;o.ubo.updateUniformGroup(e);const r=e.buffer;i={buffer:o.buffer.getGPUBuffer(r),offset:0,size:r.descriptor.size}}else if("buffer"===t._resourceType){const e=t;i={buffer:o.buffer.getGPUBuffer(e),offset:0,size:e.descriptor.size}}else if("bufferResource"===t._resourceType){const e=t;i={buffer:o.buffer.getGPUBuffer(e.buffer),offset:e.offset,size:e.size}}else if("textureSampler"===t._resourceType){const e=t;i=o.texture.getGpuSampler(e)}else if("textureSource"===t._resourceType){const e=t;i=o.texture.getGpuSource(e).createView({})}n.push({binding:s[h],resource:i})}const a=o.shader.getProgramData(t).bindGroups[i],l=r.createBindGroup({layout:a,entries:n});return this._hash[e._key]=l,l}destroy(){for(const e of Object.keys(this._hash))this._hash[e]=null;this._hash=null,this._renderer=null}}iu.extension={type:[I.WebGPUSystem],name:"bindGroup"};class ru{constructor(e){this._gpuBuffers=Object.create(null),this._managedBuffers=[],e.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){const t=this._gpuBuffers[e.uid]||this.createGPUBuffer(e),i=e.data;return e._updateID&&i&&(e._updateID=0,this._gpu.device.queue.writeBuffer(t,0,i.buffer,0,(e._updateSize||i.byteLength)+3&-4)),t}destroyAll(){for(const e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){this._gpuBuffers[e.uid]||(e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(e));const t=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&(ws(e.data.buffer,t.getMappedRange()),t.unmap()),this._gpuBuffers[e.uid]=t,t}onBufferChange(e){this._gpuBuffers[e.uid].destroy(),e._updateID=0,this._gpuBuffers[e.uid]=this.createGPUBuffer(e)}onBufferDestroy(e){this._managedBuffers.splice(this._managedBuffers.indexOf(e),1),this._destroyBuffer(e)}destroy(){this._managedBuffers.forEach((e=>this._destroyBuffer(e))),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(e){this._gpuBuffers[e.uid].destroy(),e.off("update",this.updateBuffer,this),e.off("change",this.onBufferChange,this),e.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[e.uid]=null}}ru.extension={type:[I.WebGPUSystem],name:"buffer"};class su{constructor({minUniformOffsetAlignment:e}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=e,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw new Error("UniformBufferBatch: array is too large: "+4*e);const t=this.byteIndex;let i=t+4*e;if(i=Math.ceil(i/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,i>4*this.data.length)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=i,t}addGroup(e){const t=this.addEmptyGroup(e.length);for(let i=0;i<e.length;i++)this.data[t/4+i]=e[i];return t}destroy(){this.data=null}}class nu{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){this._renderer=null,this._colorMaskCache=null}}nu.extension={type:[I.WebGPUSystem],name:"colorMask"};class ou{constructor(e){this._renderer=e}async init(e){return this._initPromise||(this._initPromise=this._createDeviceAndAdaptor(e).then((e=>{this.gpu=e,this._renderer.runners.contextChange.emit(this.gpu)}))),this._initPromise}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){const t=await ii.get().getNavigator().gpu.requestAdapter({powerPreference:e.powerPreference,forceFallbackAdapter:e.forceFallbackAdapter}),i=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter((e=>t.features.has(e))),r=await t.requestDevice({requiredFeatures:i});return{adapter:t,device:r}}destroy(){this.gpu=null,this._renderer=null}}ou.extension={type:[I.WebGPUSystem],name:"device"},ou.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};class au{constructor(e){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=e}renderStart(){this.commandFinished=new Promise((e=>{this._resolveCommandFinished=e})),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,t,i,r){const s=this._renderer.pipeline.getPipeline(e,t,i,r);this.setPipeline(s)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,t){this._boundVertexBuffer[e]!==t&&(this._boundVertexBuffer[e]=t,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(t)))}_setIndexBuffer(e){if(this._boundIndexBuffer===e)return;this._boundIndexBuffer=e;const t=2===e.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),t)}resetBindGroup(e){this._boundBindGroup[e]=null}setBindGroup(e,t,i){if(this._boundBindGroup[e]===t)return;this._boundBindGroup[e]=t,t._touch(this._renderer.textureGC.count);const r=this._renderer.bindGroup.getBindGroup(t,i,e);this.renderPassEncoder.setBindGroup(e,r)}setGeometry(e,t){const i=this._renderer.pipeline.getBufferNamesToBind(e,t);for(const r in i)this._setVertexBuffer(r,e.attributes[i[r]].buffer);e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,t){for(const i in e.groups){const r=e.groups[i];t||this._syncBindGroup(r),this.setBindGroup(i,r,e.gpuProgram)}}_syncBindGroup(e){for(const t in e.resources){const i=e.resources[t];i.isUniformGroup&&this._renderer.ubo.updateUniformGroup(i)}}draw(e){const{geometry:t,shader:i,state:r,topology:s,size:n,start:o,instanceCount:a,skipSync:l}=e;this.setPipelineFromGeometryProgramAndState(t,i.gpuProgram,r,s),this.setGeometry(t,i.gpuProgram),this._setShaderBindGroups(i,l),t.indexBuffer?this.renderPassEncoder.drawIndexed(n||t.indexBuffer.data.length,a??t.instanceCount,o||0):this.renderPassEncoder.draw(n||t.getSize(),a??t.instanceCount,o||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const e=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);const t=this._boundPipeline,i={...this._boundVertexBuffer},r=this._boundIndexBuffer,s={...this._boundBindGroup};this._clearCache();const n=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(n.x,n.y,n.width,n.height,0,1),this.setPipeline(t);for(const o in i)this._setVertexBuffer(o,i[o]);for(const o in s)this.setBindGroup(o,s[o],null);this._setIndexBuffer(r)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}}au.extension={type:[I.WebGPUSystem],name:"encoder",priority:1};class lu{constructor(e){this._renderTargetStencilState=Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Es.DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){const i=this._renderTargetStencilState[this._activeRenderTarget.uid];i.stencilMode=e,i.stencilReference=t;const r=this._renderer;r.pipeline.setStencilMode(e),r.encoder.renderPassEncoder.setStencilReference(t)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}lu.extension={type:[I.WebGPUSystem],name:"stencil"};const hu={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function du(e){const t=e.map((e=>({data:e,offset:0,size:0})));let i=0;for(let r=0;r<t.length;r++){const e=t[r];let s=hu[e.data.type].size;const n=hu[e.data.type].align;if(!hu[e.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${e.data.type}`);e.data.size>1&&(s=Math.max(s,n)*e.data.size),i=Math.ceil(i/n)*n,e.size=s,e.offset=i,i+=s}return i=16*Math.ceil(i/16),{uboElements:t,size:i}}function uu(e,t){const{size:i,align:r}=hu[e.data.type],s=(r-i)/4,n=e.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n         v = uv.${e.data.name};\n         ${0!==t?`offset += ${t};`:""}\n\n         arrayOffset = offset;\n\n         t = 0;\n\n         for(var i=0; i < ${e.data.size*(i/4)}; i++)\n         {\n             for(var j = 0; j < ${i/4}; j++)\n             {\n                 ${n}[arrayOffset++] = v[t++];\n             }\n             ${0!==s?`arrayOffset += ${s};`:""}\n         }\n     `}function cu(e){return fh(e,"uboWgsl",uu,yh)}class pu extends uh{constructor(){super({createUboElements:du,generateUboSync:cu})}}pu.extension={type:[I.WebGPUSystem],name:"ubo"};const gu=128;class fu{constructor(e){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new su({minUniformOffsetAlignment:gu});for(let t=0;t<2;t++){let e=Os.UNIFORM|Os.COPY_DST;0===t&&(e|=Os.COPY_SRC),this._buffers.push(new Ds({data:this._batchBuffer.data,usage:e}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,t){if(!t&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.ubo.ensureUniformGroup(e);const i=e.buffer.data,r=this._batchBuffer.addEmptyGroup(i.length);return this._renderer.ubo.syncUniformGroup(e,this._batchBuffer.data,r/4),this._bindGroupHash[e.uid]=this._getBindGroup(r/gu),this._bindGroupHash[e.uid]}getUboResource(e){this._renderer.ubo.updateUniformGroup(e);const t=e.buffer.data,i=this._batchBuffer.addGroup(t);return this._getBufferResource(i/gu)}getArrayBindGroup(e){const t=this._batchBuffer.addGroup(e);return this._getBindGroup(t/gu)}getArrayBufferResource(e){const t=this._batchBuffer.addGroup(e)/gu;return this._getBufferResource(t)}_getBufferResource(e){if(!this._bufferResources[e]){const t=this._buffers[e%2];this._bufferResources[e]=new Ph({buffer:t,offset:256*(e/2|0),size:gu})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){const t=new Tr({0:this._getBufferResource(e)});this._bindGroups[e]=t}return this._bindGroups[e]}_uploadBindGroups(){const e=this._renderer.buffer,t=this._buffers[0];t.update(this._batchBuffer.byteIndex),e.updateBuffer(t);const i=this._renderer.gpu.device.createCommandEncoder();for(let r=1;r<this._buffers.length;r++){const s=this._buffers[r];i.copyBufferToBuffer(e.getGPUBuffer(t),gu,e.getGPUBuffer(s),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([i.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}fu.extension={type:[I.WebGPUPipes],name:"uniformBatch"};const mu={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};class _u{constructor(e){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(Es.DISABLED),this._updatePipeHash()}setMultisampleCount(e){this._multisampleCount!==e&&(this._multisampleCount=e,this._updatePipeHash())}setRenderTarget(e){this._multisampleCount=e.msaaSamples,this._depthStencilAttachment=e.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(e){this._colorMask!==e&&(this._colorMask=e,this._updatePipeHash())}setStencilMode(e){this._stencilMode!==e&&(this._stencilMode=e,this._stencilState=hh[e],this._updatePipeHash())}setPipeline(e,t,i,r){const s=this.getPipeline(e,t,i);r.setPipeline(s)}getPipeline(e,t,i,r){e._layoutKey||(ql(e,t.attributeData),this._generateBufferKey(e)),r||(r=e.topology);const s=function(e,t,i,r,s){return e<<24|t<<16|i<<10|r<<5|s}(e._layoutKey,t._layoutKey,i.data,i._blendModeId,mu[r]);return this._pipeCache[s]||(this._pipeCache[s]=this._createPipeline(e,t,i,r)),this._pipeCache[s]}_createPipeline(e,t,i,r){const s=this._gpu.device,n=this._createVertexBufferLayouts(e,t),o=this._renderer.state.getColorTargets(i);o[0].writeMask=this._stencilMode===Es.RENDERING_MASK_ADD?0:this._colorMask;const a=this._renderer.shader.getProgramData(t).pipeline,l={vertex:{module:this._getModule(t.vertex.source),entryPoint:t.vertex.entryPoint,buffers:n},fragment:{module:this._getModule(t.fragment.source),entryPoint:t.fragment.entryPoint,targets:o},primitive:{topology:r,cullMode:i.cullMode},layout:a,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};this._depthStencilAttachment&&(l.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:i.depthTest,depthCompare:i.depthTest?"less":"always"});return s.createRenderPipeline(l)}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){const t=this._gpu.device;return this._moduleCache[e]=t.createShaderModule({code:e}),this._moduleCache[e]}_generateBufferKey(e){const t=[];let i=0;const r=Object.keys(e.attributes).sort();for(let n=0;n<r.length;n++){const s=e.attributes[r[n]];t[i++]=s.offset,t[i++]=s.format,t[i++]=s.stride,t[i++]=s.instance}const s=t.join("|");return e._layoutKey=er(s,"geometry"),e._layoutKey}_generateAttributeLocationsKey(e){const t=[];let i=0;const r=Object.keys(e.attributeData).sort();for(let n=0;n<r.length;n++){const s=e.attributeData[r[n]];t[i++]=s.location}const s=t.join("|");return e._attributeLocationsKey=er(s,"programAttributes"),e._attributeLocationsKey}getBufferNamesToBind(e,t){const i=e._layoutKey<<16|t._attributeLocationsKey;if(this._bindingNamesCache[i])return this._bindingNamesCache[i];const r=this._createVertexBufferLayouts(e,t),s=Object.create(null),n=t.attributeData;for(let o=0;o<r.length;o++){const e=Object.values(r[o].attributes)[0].shaderLocation;for(const t in n)if(n[t].location===e){s[o]=t;break}}return this._bindingNamesCache[i]=s,s}_createVertexBufferLayouts(e,t){t._attributeLocationsKey||this._generateAttributeLocationsKey(t);const i=e._layoutKey<<16|t._attributeLocationsKey;if(this._bufferLayoutsCache[i])return this._bufferLayoutsCache[i];const r=[];return e.buffers.forEach((i=>{const s={arrayStride:0,stepMode:"vertex",attributes:[]},n=s.attributes;for(const r in t.attributeData){const o=e.attributes[r];1!==(o.divisor??1)&&At(`Attribute ${r} has an invalid divisor value of '${o.divisor}'. WebGPU only supports a divisor value of 1`),o.buffer===i&&(s.arrayStride=o.stride,s.stepMode=o.instance?"instance":"vertex",n.push({shaderLocation:t.attributeData[r].location,offset:o.offset,format:o.format}))}n.length&&r.push(s)})),this._bufferLayoutsCache[i]=r,r}_updatePipeHash(){const e=(t=this._stencilMode,i=this._multisampleCount,r=this._colorMask,s=this._depthStencilAttachment,r<<6|t<<3|s<<1|i);var t,i,r,s;this._pipeStateCaches[e]||(this._pipeStateCaches[e]=Object.create(null)),this._pipeCache=this._pipeStateCaches[e]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}_u.extension={type:[I.WebGPUSystem],name:"pipeline"};class yu{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class xu{init(e,t){this._renderer=e,this._renderTargetSystem=t}copyToTexture(e,t,i,r,s){const n=this._renderer,o=this._getGpuColorTexture(e),a=n.texture.getGpuSource(t.source);return n.encoder.commandEncoder.copyTextureToTexture({texture:o,origin:i},{texture:a,origin:s},r),t}startRenderPass(e,t=!0,i,r){const s=this._renderTargetSystem.getGpuRenderTarget(e),n=this.getDescriptor(e,t,i);s.descriptor=n,this._renderer.pipeline.setRenderTarget(s),this._renderer.encoder.beginRenderPass(s),this._renderer.encoder.setViewport(r)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);return t.contexts[0]?t.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,t,i){"boolean"==typeof t&&(t=t?Lr.ALL:Lr.NONE);const r=this._renderTargetSystem,s=r.getGpuRenderTarget(e),n=e.colorTextures.map(((e,n)=>{const o=s.contexts[n];let a,l;if(o){a=o.getCurrentTexture().createView()}else a=this._renderer.texture.getGpuSource(e).createView({mipLevelCount:1});s.msaaTextures[n]&&(l=a,a=this._renderer.texture.getTextureView(s.msaaTextures[n]));const h=t&Lr.COLOR?"clear":"load";return i??(i=r.defaultClearColor),{view:a,resolveTarget:l,clearValue:i,storeOp:"store",loadOp:h}}));let o;if(!e.stencil&&!e.depth||e.depthStencilTexture||(e.ensureDepthStencilTexture(),e.depthStencilTexture.source.sampleCount=s.msaa?4:1),e.depthStencilTexture){const i=t&Lr.STENCIL?"clear":"load",r=t&Lr.DEPTH?"clear":"load";o={view:this._renderer.texture.getGpuSource(e.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:i,depthClearValue:1,depthLoadOp:r,depthStoreOp:"store"}}return{colorAttachments:n,depthStencilAttachment:o}}clear(e,t=!0,i,r){if(!t)return;const{gpu:s,encoder:n}=this._renderer,o=s.device;if(null===n.commandEncoder){const s=o.createCommandEncoder(),n=this.getDescriptor(e,t,i),a=s.beginRenderPass(n);a.setViewport(r.x,r.y,r.width,r.height,0,1),a.end();const l=s.finish();o.queue.submit([l])}else this.startRenderPass(e,t,i,r)}initGpuRenderTarget(e){e.isRoot=!0;const t=new yu;return e.colorTextures.forEach(((e,i)=>{if(ri.test(e.resource)){const s=e.resource.getContext("webgpu"),n=e.transparent?"premultiplied":"opaque";try{s.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:n})}catch(r){console.error(r)}t.contexts[i]=s}if(t.msaa=e.source.antialias,e.source.antialias){const e=new we({width:0,height:0,sampleCount:4});t.msaaTextures[i]=e}})),t.msaa&&(t.msaaSamples=4,e.depthStencilTexture&&(e.depthStencilTexture.source.sampleCount=4)),t}destroyGpuRenderTarget(e){e.contexts.forEach((e=>{e.unconfigure()})),e.msaaTextures.forEach((e=>{e.destroy()})),e.msaaTextures.length=0,e.contexts.length=0}ensureDepthStencilTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);e.depthStencilTexture&&t.msaa&&(e.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);t.width=e.width,t.height=e.height,t.msaa&&e.colorTextures.forEach(((e,i)=>{const r=t.msaaTextures[i];null==r||r.resize(e.source.width,e.source.height,e.source._resolution)}))}}class vu extends Nh{constructor(e){super(e),this.adaptor=new xu,this.adaptor.init(e,this)}}vu.extension={type:[I.WebGPUSystem],name:"renderTarget"};class bu{constructor(){this._gpuProgramData=Object.create(null)}contextChange(e){this._gpu=e,this.maxTextures=e.device.limits.maxSampledTexturesPerShaderStage}getProgramData(e){return this._gpuProgramData[e._layoutKey]||this._createGPUProgramData(e)}_createGPUProgramData(e){const t=this._gpu.device,i=e.gpuLayout.map((e=>t.createBindGroupLayout({entries:e}))),r={bindGroupLayouts:i};return this._gpuProgramData[e._layoutKey]={bindGroups:i,pipeline:t.createPipelineLayout(r)},this._gpuProgramData[e._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}bu.extension={type:[I.WebGPUSystem],name:"shader"};const wu={normal:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},add:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},multiply:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},screen:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},overlay:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},none:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},"normal-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},"add-npm":{alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},"screen-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},erase:{alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}},min:{alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}},max:{alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}};class Tu{constructor(){this.defaultState=new Ar,this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){return[{format:"bgra8unorm",writeMask:0,blend:wu[e.blendMode]||wu.normal}]}destroy(){this.gpu=null}}Tu.extension={type:[I.WebGPUSystem],name:"state"};const Eu={type:"image",upload(e,t,i){const r=e.resource,s=(0|e.pixelWidth)*(0|e.pixelHeight),n=r.byteLength/s;i.device.queue.writeTexture({texture:t},r,{offset:0,rowsPerImage:e.pixelHeight,bytesPerRow:e.pixelHeight*n},{width:e.pixelWidth,height:e.pixelHeight,depthOrArrayLayers:1})}},Cu={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},Su={blockBytes:4,blockWidth:1,blockHeight:1},Nu={type:"compressed",upload(e,t,i){let r=e.pixelWidth,s=e.pixelHeight;const n=Cu[e.format]||Su;for(let o=0;o<e.resource.length;o++){const a=e.resource[o],l=Math.ceil(r/n.blockWidth)*n.blockBytes;i.device.queue.writeTexture({texture:t,mipLevel:o},a,{offset:0,bytesPerRow:l},{width:Math.ceil(r/n.blockWidth)*n.blockWidth,height:Math.ceil(s/n.blockHeight)*n.blockHeight,depthOrArrayLayers:1}),r=Math.max(r>>1,1),s=Math.max(s>>1,1)}}},Au={type:"image",upload(e,t,i){const r=e.resource;if(!r)return;const s=Math.min(t.width,e.resourceWidth||e.pixelWidth),n=Math.min(t.height,e.resourceHeight||e.pixelHeight),o="premultiply-alpha-on-upload"===e.alphaMode;i.device.queue.copyExternalImageToTexture({source:r},{texture:t,premultipliedAlpha:o},{width:s,height:n})}},Pu={type:"video",upload(e,t,i){Au.upload(e,t,i)}};class Mu{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let t=this.pipelines[e];return t||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:"\n                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n                        struct VertexOutput {\n                        @builtin(position) position : vec4<f32>,\n                        @location(0) texCoord : vec2<f32>,\n                        };\n\n                        @vertex\n                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n                        var output : VertexOutput;\n                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n                        return output;\n                        }\n\n                        @group(0) @binding(0) var imgSampler : sampler;\n                        @group(0) @binding(1) var img : texture_2d<f32>;\n\n                        @fragment\n                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n                        return textureSample(img, imgSampler, texCoord);\n                        }\n                    "})),t=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=t),t}generateMipmap(e){const t=this._getMipmapPipeline(e.format);if("3d"===e.dimension||"1d"===e.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let i=e;const r=e.depthOrArrayLayers||1,s=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){const t={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:r},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};i=this.device.createTexture(t)}const n=this.device.createCommandEncoder({}),o=t.getBindGroupLayout(0);for(let a=0;a<r;++a){let r=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),l=s?1:0;for(let s=1;s<e.mipLevelCount;++s){const e=i.createView({baseMipLevel:l++,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),s=n.beginRenderPass({colorAttachments:[{view:e,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),h=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.sampler},{binding:1,resource:r}]});s.setPipeline(t),s.setBindGroup(0,h),s.draw(3,1,0,0),s.end(),r=e}}if(!s){const t={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:r};for(let r=1;r<e.mipLevelCount;++r)n.copyTextureToTexture({texture:i,mipLevel:r-1},{texture:e,mipLevel:r},t),t.width=Math.ceil(t.width/2),t.height=Math.ceil(t.height/2)}return this.device.queue.submit([n.finish()]),s||i.destroy(),e}}class Ru{constructor(e){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:Au,buffer:Eu,video:Pu,compressed:Nu},this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuSources"),e.renderableGC.addManagedHash(this,"_gpuSamplers"),e.renderableGC.addManagedHash(this,"_bindGroupHash"),e.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){const t=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(t))+1}let t=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==e.uploadMethodId&&(t|=GPUTextureUsage.RENDER_ATTACHMENT,t|=GPUTextureUsage.COPY_SRC);const i=Cu[e.format]||{blockWidth:1,blockHeight:1},r=Math.ceil(e.pixelWidth/i.blockWidth)*i.blockWidth,s=Math.ceil(e.pixelHeight/i.blockHeight)*i.blockHeight,n={label:e.label,size:{width:r,height:s},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:t},o=this._gpu.device.createTexture(n);return this._gpuSources[e.uid]=o,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),o}onSourceUpdate(e){const t=this.getGpuSource(e);t&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,t,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e))}onSourceUnload(e){const t=this._gpuSources[e.uid];t&&(this._gpuSources[e.uid]=null,t.destroy())}onUpdateMipmaps(e){this._mipmapGenerator||(this._mipmapGenerator=new Mu(this._gpu.device));const t=this.getGpuSource(e);this._mipmapGenerator.generateMipmap(t)}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){const t=this._gpuSources[e.uid];t?t.width===e.pixelWidth&&t.height===e.pixelHeight||(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e)):this.initSource(e)}_initSampler(e){return this._gpuSamplers[e._resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e._resourceId]}getGpuSampler(e){return this._gpuSamplers[e._resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){return this._bindGroupHash[e.uid]??this._createTextureBindGroup(e)}_createTextureBindGroup(e){const t=e.source;return this._bindGroupHash[e.uid]=new Tr({0:t,1:t.style,2:new wr({uTextureMatrix:{type:"mat3x3<f32>",value:e.textureMatrix.mapCoord}})}),this._bindGroupHash[e.uid]}getTextureView(e){const t=e.source;return this._textureViewHash[t.uid]??this._createTextureView(t)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){const t=this._renderer,i=t.gpu.device.createCommandEncoder(),r=ii.get().createCanvas();r.width=e.source.pixelWidth,r.height=e.source.pixelHeight;const s=r.getContext("webgpu");return s.configure({device:t.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:ii.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),i.copyTextureToTexture({texture:t.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:s.getCurrentTexture()},{width:r.width,height:r.height}),t.gpu.device.queue.submit([i.finish()]),r}getPixels(e){const t=this.generateCanvas(e),i=Do.getOptimalCanvasAndContext(t.width,t.height),r=i.context;r.drawImage(t,0,0);const{width:s,height:n}=t,o=r.getImageData(0,0,s,n),a=new Uint8ClampedArray(o.data.buffer);return Do.returnCanvasAndContext(i),{pixels:a,width:s,height:n}}destroy(){this.managedTextures.slice().forEach((e=>this.onSourceDestroy(e))),this.managedTextures=null;for(const e of Object.keys(this._bindGroupHash)){const t=Number(e),i=this._bindGroupHash[t];null==i||i.destroy(),this._bindGroupHash[t]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}Ru.extension={type:[I.WebGPUSystem],name:"texture"};class ku{init(){const e=new wr({uTransformMatrix:{value:new q,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),t=nn({name:"graphics",bits:[an,cn(_s()),Dl,mn]});this.shader=new Cr({gpuProgram:t,resources:{localUniforms:e}})}execute(e,t){const i=t.context,r=i.customShader||this.shader,s=e.renderer,n=s.graphicsContext,{batcher:o,instructions:a}=n.getContextRenderData(i),l=s.encoder;l.setGeometry(o.geometry,r.gpuProgram);const h=s.globalUniforms.bindGroup;l.setBindGroup(0,h,r.gpuProgram);const d=s.renderPipes.uniformBatch.getUniformBindGroup(r.resources.localUniforms,!0);l.setBindGroup(2,d,r.gpuProgram);const u=a.instructions;let c=null;for(let p=0;p<a.instructionSize;p++){const t=u[p];if(t.topology!==c&&(c=t.topology,l.setPipelineFromGeometryProgramAndState(o.geometry,r.gpuProgram,e.state,t.topology)),r.groups[1]=t.bindGroup,!t.gpuBindGroup){const e=t.textures;t.bindGroup=xs(e.textures,e.count),t.gpuBindGroup=s.bindGroup.getBindGroup(t.bindGroup,r.gpuProgram,1)}l.setBindGroup(1,t.bindGroup,r.gpuProgram),l.renderPassEncoder.drawIndexed(t.size,1,t.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}ku.extension={type:[I.WebGPUPipesAdaptor],name:"graphics"};class Bu{init(){const e=nn({name:"mesh",bits:[Ol,Ll,mn]});this._shader=new Cr({gpuProgram:e,resources:{uTexture:Se.EMPTY._source,uSampler:Se.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new q}}}})}execute(e,t){const i=e.renderer;let r=t._shader;if(r){if(!r.gpuProgram)return void At("Mesh shader has no gpuProgram",t.shader)}else r=this._shader,r.groups[2]=i.texture.getTextureBindGroup(t.texture);const s=r.gpuProgram;if(s.autoAssignGlobalUniforms&&(r.groups[0]=i.globalUniforms.bindGroup),s.autoAssignLocalUniforms){const t=e.localUniforms;r.groups[1]=i.renderPipes.uniformBatch.getUniformBindGroup(t,!0)}i.encoder.draw({geometry:t._geometry,shader:r,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}Bu.extension={type:[I.WebGPUPipesAdaptor],name:"mesh"};const Iu=[...jd,pu,au,ou,ru,Ru,vu,bu,Tu,_u,nu,lu,iu],Ou=[...Kd,fu],Du=[kl,Bu,ku],Gu=[],Lu=[],Fu=[];G.handleByNamedList(I.WebGPUSystem,Gu),G.handleByNamedList(I.WebGPUPipes,Lu),G.handleByNamedList(I.WebGPUPipesAdaptor,Fu),G.add(...Iu,...Ou,...Du);const Uu=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:class extends Vr{constructor(){super({name:"webgpu",type:Er.WEBGPU,systems:Gu,renderPipes:Lu,renderPipeAdaptors:Fu})}}},Symbol.toStringTag,{value:"Module"}));class zu{constructor(e,t){this.state=Ar.for2d(),this._graphicsBatchesHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=e,this._adaptor=t,this._adaptor.init(),this.renderer.renderableGC.addManagedHash(this,"_graphicsBatchesHash")}validateRenderable(e){const t=e.context,i=!!this._graphicsBatchesHash[e.uid],r=this.renderer.graphicsContext.updateGpuContext(t);return!(!r.isBatchable&&i===r.isBatchable)}addRenderable(e,t){const i=this.renderer.graphicsContext.updateGpuContext(e.context);e.didViewUpdate&&this._rebuild(e),i.isBatchable?this._addToBatcher(e,t):(this.renderer.renderPipes.batch.break(t),t.add(e))}updateRenderable(e){const t=this._graphicsBatchesHash[e.uid];if(t)for(let i=0;i<t.length;i++){const e=t[i];e._batcher.updateElement(e)}}destroyRenderable(e){this._graphicsBatchesHash[e.uid]&&this._removeBatchForRenderable(e.uid),e.off("destroyed",this._destroyRenderableBound)}execute(e){if(!e.isRenderable)return;const t=this.renderer,i=e.context;if(!t.graphicsContext.getGpuContext(i).batches.length)return;const r=i.customShader||this._adaptor.shader;this.state.blendMode=e.groupBlendMode;const s=r.resources.localUniforms.uniforms;s.uTransformMatrix=e.groupTransform,s.uRound=t._roundPixels|e._roundPixels,Bd(e.groupColorAlpha,s.uColor,0),this._adaptor.execute(this,e)}_rebuild(e){const t=!!this._graphicsBatchesHash[e.uid],i=this.renderer.graphicsContext.updateGpuContext(e.context);t&&this._removeBatchForRenderable(e.uid),i.isBatchable&&this._initBatchesForRenderable(e),e.batched=i.isBatchable}_addToBatcher(e,t){const i=this.renderer.renderPipes.batch,r=this._getBatchesForRenderable(e);for(let s=0;s<r.length;s++){const e=r[s];i.addToBatch(e,t)}}_getBatchesForRenderable(e){return this._graphicsBatchesHash[e.uid]||this._initBatchesForRenderable(e)}_initBatchesForRenderable(e){const t=e.context,i=this.renderer.graphicsContext.getGpuContext(t),r=this.renderer._roundPixels|e._roundPixels,s=i.batches.map((t=>{const i=ot.get(Sn);return t.copyTo(i),i.renderable=e,i.roundPixels=r,i}));return void 0===this._graphicsBatchesHash[e.uid]&&e.on("destroyed",this._destroyRenderableBound),this._graphicsBatchesHash[e.uid]=s,s}_removeBatchForRenderable(e){this._graphicsBatchesHash[e].forEach((e=>{ot.return(e)})),this._graphicsBatchesHash[e]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const e in this._graphicsBatchesHash)this._removeBatchForRenderable(e);this._graphicsBatchesHash=null}}zu.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"graphics"};const Hu=class e extends gl{constructor(...e){super({});let t=e[0]??{};"number"==typeof t&&(pe(ce,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),t={width:t,height:e[1],verticesX:e[2],verticesY:e[3]}),this.build(t)}build(t){t={...e.defaultOptions,...t},this.verticesX=this.verticesX??t.verticesX,this.verticesY=this.verticesY??t.verticesY,this.width=this.width??t.width,this.height=this.height??t.height;const i=this.verticesX*this.verticesY,r=[],s=[],n=[],o=this.verticesX-1,a=this.verticesY-1,l=this.width/o,h=this.height/a;for(let e=0;e<i;e++){const t=e%this.verticesX,i=e/this.verticesX|0;r.push(t*l,i*h),s.push(t/o,i/a)}const d=o*a;for(let e=0;e<d;e++){const t=e%o,i=e/o|0,r=i*this.verticesX+t,s=i*this.verticesX+t+1,a=(i+1)*this.verticesX+t,l=(i+1)*this.verticesX+t+1;n.push(r,s,a,s,l,a)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};Hu.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let Wu=Hu;class Vu{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(e){this._topology=e}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(e){this.texture!==e&&(this.texture=e,this._textureMatrixUpdateId=-1)}get uvs(){const e=this.geometry.getBuffer("aUV"),t=e.data;let i=t;const r=this.texture.textureMatrix;return r.isSimple||(i=this._transformedUvs,this._textureMatrixUpdateId===r._updateID&&this._uvUpdateId===e._updateID||((!i||i.length<t.length)&&(i=this._transformedUvs=new Float32Array(t.length)),this._textureMatrixUpdateId=r._updateID,this._uvUpdateId=e._updateID,r.multiplyUvs(t,i))),i}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class Xu{constructor(e,t){this.localUniforms=new wr({uTransformMatrix:{value:new q,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new Tr({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=e,this._adaptor=t,this._adaptor.init(),e.renderableGC.addManagedHash(this,"_gpuBatchableMeshHash"),e.renderableGC.addManagedHash(this,"_meshDataHash")}validateRenderable(e){const t=this._getMeshData(e),i=t.batched,r=e.batched;if(t.batched=r,i!==r)return!0;if(r){const i=e._geometry;if(i.indices.length!==t.indexSize||i.positions.length!==t.vertexSize)return t.indexSize=i.indices.length,t.vertexSize=i.positions.length,!0;const r=this._getBatchableMesh(e);return r.texture.uid!==e._texture.uid&&(r._textureMatrixUpdateId=-1),!r._batcher.checkAndUpdateTexture(r,e._texture)}return!1}addRenderable(e,t){const i=this.renderer.renderPipes.batch,{batched:r}=this._getMeshData(e);if(r){const r=this._getBatchableMesh(e);r.setTexture(e._texture),r.geometry=e._geometry,i.addToBatch(r,t)}else i.break(t),t.add(e)}updateRenderable(e){if(e.batched){const t=this._gpuBatchableMeshHash[e.uid];t.setTexture(e._texture),t.geometry=e._geometry,t._batcher.updateElement(t)}}destroyRenderable(e){this._meshDataHash[e.uid]=null;const t=this._gpuBatchableMeshHash[e.uid];t&&(ot.return(t),this._gpuBatchableMeshHash[e.uid]=null),e.off("destroyed",this._destroyRenderableBound)}execute(e){if(!e.isRenderable)return;e.state.blendMode=Cs(e.groupBlendMode,e.texture._source);const t=this.localUniforms;t.uniforms.uTransformMatrix=e.groupTransform,t.uniforms.uRound=this.renderer._roundPixels|e._roundPixels,t.update(),Bd(e.groupColorAlpha,t.uniforms.uColor,0),this._adaptor.execute(this,e)}_getMeshData(e){return this._meshDataHash[e.uid]||this._initMeshData(e)}_initMeshData(e){var t,i;return this._meshDataHash[e.uid]={batched:e.batched,indexSize:null==(t=e._geometry.indices)?void 0:t.length,vertexSize:null==(i=e._geometry.positions)?void 0:i.length},e.on("destroyed",this._destroyRenderableBound),this._meshDataHash[e.uid]}_getBatchableMesh(e){return this._gpuBatchableMeshHash[e.uid]||this._initBatchableMesh(e)}_initBatchableMesh(e){const t=ot.get(Vu);return t.renderable=e,t.setTexture(e._texture),t.transform=e.groupTransform,t.roundPixels=this.renderer._roundPixels|e._roundPixels,this._gpuBatchableMeshHash[e.uid]=t,t}destroy(){for(const e in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[e]&&ot.return(this._gpuBatchableMeshHash[e]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}Xu.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"mesh"};class Yu{execute(e,t){const i=e.state,r=e.renderer,s=t.shader||e.defaultShader;s.resources.uTexture=t.texture._source,s.resources.uniforms=e.localUniforms;const n=r.gl,o=e.getBuffers(t);r.shader.bind(s),r.state.set(i),r.geometry.bind(o.geometry,s.glProgram);const a=2===o.geometry.indexBuffer.data.BYTES_PER_ELEMENT?n.UNSIGNED_SHORT:n.UNSIGNED_INT;n.drawElements(n.TRIANGLES,6*t.particleChildren.length,a,0)}}class ju{execute(e,t){const i=e.renderer,r=t.shader||e.defaultShader;r.groups[0]=i.renderPipes.uniformBatch.getUniformBindGroup(e.localUniforms,!0),r.groups[1]=i.texture.getTextureBindGroup(t.texture);const s=e.state,n=e.getBuffers(t);i.encoder.draw({geometry:n.geometry,shader:t.shader||e.defaultShader,state:s,size:6*t.particleChildren.length})}}function Ku(e,t=null){const i=6*e;if(i>65535?t||(t=new Uint32Array(i)):t||(t=new Uint16Array(i)),t.length!==i)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${i}`);for(let r=0,s=0;r<i;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function $u(e,t){const i=[];i.push("\n      \n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let r=0;for(const n in e){const s=e[n];if(t!==s.dynamic)continue;i.push(`offset = index + ${r}`),i.push(s.code);r+=cr(s.format).stride/4}i.push("\n            index += stride * 4;\n        }\n    "),i.unshift(`\n        var stride = ${r};\n    `);const s=i.join("\n");return new Function("ps","f32v","u32v",s)}class qu{constructor(e){this._size=0,this._generateParticleUpdateCache={};const t=this._size=e.size??1e3,i=e.properties;let r=0,s=0;for(const h in i){const e=i[h],t=cr(e.format);e.dynamic?s+=t.stride:r+=t.stride}this._dynamicStride=s/4,this._staticStride=r/4,this.staticAttributeBuffer=new bs(4*t*r),this.dynamicAttributeBuffer=new bs(4*t*s),this.indexBuffer=Ku(t);const n=new Ls;let o=0,a=0;this._staticBuffer=new Ds({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:Os.VERTEX|Os.COPY_DST}),this._dynamicBuffer=new Ds({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:Os.VERTEX|Os.COPY_DST});for(const h in i){const e=i[h],t=cr(e.format);e.dynamic?(n.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*o,format:e.format}),o+=t.size):(n.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*a,format:e.format}),a+=t.size)}n.addIndex(this.indexBuffer);const l=this.getParticleUpdate(i);this._dynamicUpload=l.dynamicUpdate,this._staticUpload=l.staticUpdate,this.geometry=n}getParticleUpdate(e){const t=function(e){const t=[];for(const i in e){const r=e[i];t.push(i,r.code,r.dynamic?"d":"s")}return t.join("_")}(e);return this._generateParticleUpdateCache[t]||(this._generateParticleUpdateCache[t]=this.generateParticleUpdate(e)),this._generateParticleUpdateCache[t]}generateParticleUpdate(e){return function(e){return{dynamicUpdate:$u(e,!0),staticUpdate:$u(e,!1)}}(e)}update(e,t){e.length>this._size&&(t=!0,this._size=Math.max(e.length,1.5*this._size|0),this.staticAttributeBuffer=new bs(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new bs(this._size*this._dynamicStride*4*4),this.indexBuffer=Ku(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const i=this.dynamicAttributeBuffer;if(this._dynamicUpload(e,i.float32View,i.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,e.length*this._dynamicStride*4,!0),t){const t=this.staticAttributeBuffer;this._staticUpload(e,t.float32View,t.uint32View),this._staticBuffer.setDataWithSize(t.float32View,e.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var Zu="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class Ju extends Cr{constructor(){super({glProgram:dr.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:_r.from({fragment:{source:Zu,entryPoint:"mainFragment"},vertex:{source:Zu,entryPoint:"mainVertex"}}),resources:{uTexture:Se.WHITE.source,uSampler:new ve({}),uniforms:{uTranslationMatrix:{value:new q,type:"mat3x3<f32>"},uColor:{value:new st(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class Qu{constructor(e,t){this.state=Ar.for2d(),this._gpuBufferHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.localUniforms=new wr({uTranslationMatrix:{value:new q,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=e,this.adaptor=t,this.defaultShader=new Ju,this.state=Ar.for2d()}validateRenderable(e){return!1}addRenderable(e,t){this.renderer.renderPipes.batch.break(t),t.add(e)}getBuffers(e){return this._gpuBufferHash[e.uid]||this._initBuffer(e)}_initBuffer(e){return this._gpuBufferHash[e.uid]=new qu({size:e.particleChildren.length,properties:e._properties}),e.on("destroyed",this._destroyRenderableBound),this._gpuBufferHash[e.uid]}updateRenderable(e){}destroyRenderable(e){this._gpuBufferHash[e.uid].destroy(),this._gpuBufferHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}execute(e){const t=e.particleChildren;if(0===t.length)return;const i=this.renderer,r=this.getBuffers(e);e.texture||(e.texture=t[0].texture);const s=this.state;r.update(t,e._childrenDirty),e._childrenDirty=!1,s.blendMode=Cs(e.blendMode,e.texture._source);const n=this.localUniforms.uniforms,o=n.uTranslationMatrix;e.worldTransform.copyTo(o),o.prepend(i.globalUniforms.globalUniformData.projectionMatrix),n.uResolution=i.globalUniforms.globalUniformData.resolution,n.uRound=i._roundPixels|e._roundPixels,Bd(e.groupColorAlpha,n.uColor,0),this.adaptor.execute(this,e)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class ec extends Qu{constructor(e){super(e,new Yu)}}ec.extension={type:[I.WebGLPipes],name:"particle"};class tc extends Qu{constructor(e){super(e,new ju)}}tc.extension={type:[I.WebGPUPipes],name:"particle"};const ic=class e extends Wu{constructor(t={}){super({width:(t={...e.defaultOptions,...t}).width,height:t.height,verticesX:4,verticesY:4}),this.update(t)}update(e){var t,i;this.width=e.width??this.width,this.height=e.height??this.height,this._originalWidth=e.originalWidth??this._originalWidth,this._originalHeight=e.originalHeight??this._originalHeight,this._leftWidth=e.leftWidth??this._leftWidth,this._rightWidth=e.rightWidth??this._rightWidth,this._topHeight=e.topHeight??this._topHeight,this._bottomHeight=e.bottomHeight??this._bottomHeight,this._anchorX=null==(t=e.anchor)?void 0:t.x,this._anchorY=null==(i=e.anchor)?void 0:i.y,this.updateUvs(),this.updatePositions()}updatePositions(){const e=this.positions,{width:t,height:i,_leftWidth:r,_rightWidth:s,_topHeight:n,_bottomHeight:o,_anchorX:a,_anchorY:l}=this,h=r+s,d=t>h?1:t/h,u=n+o,c=i>u?1:i/u,p=Math.min(d,c),g=a*t,f=l*i;e[0]=e[8]=e[16]=e[24]=-g,e[2]=e[10]=e[18]=e[26]=r*p-g,e[4]=e[12]=e[20]=e[28]=t-s*p-g,e[6]=e[14]=e[22]=e[30]=t-g,e[1]=e[3]=e[5]=e[7]=-f,e[9]=e[11]=e[13]=e[15]=n*p-f,e[17]=e[19]=e[21]=e[23]=i-o*p-f,e[25]=e[27]=e[29]=e[31]=i-f,this.getBuffer("aPosition").update()}updateUvs(){const e=this.uvs;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1;const t=1/this._originalWidth,i=1/this._originalHeight;e[2]=e[10]=e[18]=e[26]=t*this._leftWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[4]=e[12]=e[20]=e[28]=1-t*this._rightWidth,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.getBuffer("aUV").update()}};ic.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let rc=ic;class sc{constructor(e){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(e,t){const i=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,i),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){const t=this._gpuSpriteHash[e.uid];e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){const t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}destroyRenderable(e){const t=this._gpuSpriteHash[e.uid];ot.return(t.geometry),ot.return(t),this._gpuSpriteHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(e,t){t.geometry.update(e),t.setTexture(e._texture)}_getGpuSprite(e){return this._gpuSpriteHash[e.uid]||this._initGPUSprite(e)}_initGPUSprite(e){const t=ot.get(Vu);return t.geometry=ot.get(rc),t.renderable=e,t.transform=e.groupTransform,t.texture=e._texture,t.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuSpriteHash[e.uid]=t,e.didViewUpdate||this._updateBatchableSprite(e,t),e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(const e in this._gpuSpriteHash){this._gpuSpriteHash[e].geometry.destroy()}this._gpuSpriteHash=null,this._renderer=null}}sc.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"nineSliceSprite"};const nc={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},oc={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};let ac,lc;class hc extends Cr{constructor(){ac??(ac=nn({name:"tiling-sprite-shader",bits:[Ol,nc,mn]})),lc??(lc=on({name:"tiling-sprite-shader",bits:[Gl,oc,_n]}));const e=new wr({uMapCoord:{value:new q,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new q,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:lc,gpuProgram:ac,resources:{localUniforms:new wr({uTransformMatrix:{value:new q,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:e,uTexture:Se.EMPTY.source,uSampler:Se.EMPTY.source.style}})}updateUniforms(e,t,i,r,s,n){const o=this.resources.tilingUniforms,a=n.width,l=n.height,h=n.textureMatrix,d=o.uniforms.uTextureTransform;d.set(i.a*a/e,i.b*a/t,i.c*l/e,i.d*l/t,i.tx/e,i.ty/t),d.invert(),o.uniforms.uMapCoord=h.mapCoord,o.uniforms.uClampFrame=h.uClampFrame,o.uniforms.uClampOffset=h.uClampOffset,o.uniforms.uTextureTransform=d,o.uniforms.uSizeAnchor[0]=e,o.uniforms.uSizeAnchor[1]=t,o.uniforms.uSizeAnchor[2]=r,o.uniforms.uSizeAnchor[3]=s,n&&(this.resources.uTexture=n.source,this.resources.uSampler=n.source.style)}}const dc=new class extends gl{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}};class uc{constructor(e){this._state=Ar.default2d,this._tilingSpriteDataHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_tilingSpriteDataHash")}validateRenderable(e){const t=this._getTilingSpriteData(e),i=t.canBatch;this._updateCanBatch(e);const r=t.canBatch;if(r&&r===i){const{batchableMesh:i}=t;return!i._batcher.checkAndUpdateTexture(i,e.texture)}return i!==r}addRenderable(e,t){const i=this._renderer.renderPipes.batch;this._updateCanBatch(e);const r=this._getTilingSpriteData(e),{geometry:s,canBatch:n}=r;if(n){r.batchableMesh||(r.batchableMesh=new Vu);const n=r.batchableMesh;e.didViewUpdate&&(this._updateBatchableMesh(e),n.geometry=s,n.renderable=e,n.transform=e.groupTransform,n.setTexture(e._texture)),n.roundPixels=this._renderer._roundPixels|e._roundPixels,i.addToBatch(n,t)}else i.break(t),r.shader||(r.shader=new hc),this.updateRenderable(e),t.add(e)}execute(e){const{shader:t}=this._tilingSpriteDataHash[e.uid];t.groups[0]=this._renderer.globalUniforms.bindGroup;const i=t.resources.localUniforms.uniforms;i.uTransformMatrix=e.groupTransform,i.uRound=this._renderer._roundPixels|e._roundPixels,Bd(e.groupColorAlpha,i.uColor,0),this._state.blendMode=Cs(e.groupBlendMode,e.texture._source),this._renderer.encoder.draw({geometry:dc,shader:t,state:this._state})}updateRenderable(e){const t=this._getTilingSpriteData(e),{canBatch:i}=t;if(i){const{batchableMesh:i}=t;e.didViewUpdate&&this._updateBatchableMesh(e),i._batcher.updateElement(i)}else if(e.didViewUpdate){const{shader:i}=t;i.updateUniforms(e.width,e.height,e._tileTransform.matrix,e.anchor.x,e.anchor.y,e.texture)}}destroyRenderable(e){var t;const i=this._getTilingSpriteData(e);i.batchableMesh=null,null==(t=i.shader)||t.destroy(),this._tilingSpriteDataHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_getTilingSpriteData(e){return this._tilingSpriteDataHash[e.uid]||this._initTilingSpriteData(e)}_initTilingSpriteData(e){const t=new gl({indices:dc.indices,positions:dc.positions.slice(),uvs:dc.uvs.slice()});return this._tilingSpriteDataHash[e.uid]={canBatch:!0,renderable:e,geometry:t},e.on("destroyed",this._destroyRenderableBound),this._tilingSpriteDataHash[e.uid]}_updateBatchableMesh(e){const t=this._getTilingSpriteData(e),{geometry:i}=t,r=e.texture.source.style;"repeat"!==r.addressMode&&(r.addressMode="repeat",r.update()),function(e,t){const i=e.texture,r=i.frame.width,s=i.frame.height;let n=0,o=0;e.applyAnchorToTexture&&(n=e.anchor.x,o=e.anchor.y),t[0]=t[6]=-n,t[2]=t[4]=1-n,t[1]=t[3]=-o,t[5]=t[7]=1-o;const a=q.shared;a.copyFrom(e._tileTransform.matrix),a.tx/=e.width,a.ty/=e.height,a.invert(),a.scale(e.width/r,e.height/s),function(e,t,i,r){let s=0;const n=e.length/t,o=r.a,a=r.b,l=r.c,h=r.d,d=r.tx,u=r.ty;for(i*=t;s<n;){const r=e[i],n=e[i+1];e[i]=o*r+l*n+d,e[i+1]=a*r+h*n+u,i+=t,s++}}(t,2,0,a)}(e,i.uvs),function(e,t){const i=e.anchor.x,r=e.anchor.y;t[0]=-i*e.width,t[1]=-r*e.height,t[2]=(1-i)*e.width,t[3]=-r*e.height,t[4]=(1-i)*e.width,t[5]=(1-r)*e.height,t[6]=-i*e.width,t[7]=(1-r)*e.height}(e,i.positions)}destroy(){for(const e in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[e].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(e){const t=this._getTilingSpriteData(e),i=e.texture;let r=!0;return this._renderer.type===Er.WEBGL&&(r=this._renderer.context.supports.nonPowOf2wrapping),t.canBatch=i.textureMatrix.isSimple&&(r||i.source.isPowerOfTwo),t.canBatch}}uc.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"tilingSprite"};const cc={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},pc={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},gc={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n             \n            }\n        "}},fc={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);  \n              \n                return coverage;\n            }\n        "}};let mc,_c;class yc extends Cr{constructor(){const e=new wr({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new q,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),t=_s();mc??(mc=nn({name:"sdf-shader",bits:[an,cn(t),cc,gc,mn]})),_c??(_c=on({name:"sdf-shader",bits:[ln,fn(t),pc,fc,_n]})),super({glProgram:_c,gpuProgram:mc,resources:{localUniforms:e,batchSamplers:xn(t)}})}}class xc{constructor(e){this._gpuBitmapText={},this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(e){const t=this._getGpuBitmapText(e);return e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,t)),this._renderer.renderPipes.graphics.validateRenderable(t)}addRenderable(e,t){const i=this._getGpuBitmapText(e);vc(e,i),e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,i)),this._renderer.renderPipes.graphics.addRenderable(i,t),i.context.customShader&&this._updateDistanceField(e)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableByUid(e.uid)}_destroyRenderableByUid(e){const t=this._gpuBitmapText[e].context;t.customShader&&(ot.return(t.customShader),t.customShader=null),ot.return(this._gpuBitmapText[e]),this._gpuBitmapText[e]=null}updateRenderable(e){const t=this._getGpuBitmapText(e);vc(e,t),this._renderer.renderPipes.graphics.updateRenderable(t),t.context.customShader&&this._updateDistanceField(e)}_updateContext(e,t){const{context:i}=t,r=$o.getFont(e.text,e._style);i.clear(),"none"!==r.distanceField.type&&(i.customShader||(i.customShader=ot.get(yc)));const s=Array.from(e.text),n=e._style;let o=r.baseLineOffset;const a=jo(s,n,r,!0);let l=0;const h=n.padding,d=a.scale;let u=a.width,c=a.height+a.offsetY;n._stroke&&(u+=n._stroke.width/d,c+=n._stroke.width/d),i.translate(-e._anchor._x*u-h,-e._anchor._y*c-h).scale(d,d);const p=r.applyFillAsTint?n._fill.color:16777215;for(let g=0;g<a.lines.length;g++){const e=a.lines[g];for(let t=0;t<e.charPositions.length;t++){const n=s[l++],a=r.chars[n];(null==a?void 0:a.texture)&&i.texture(a.texture,p||"black",Math.round(e.charPositions[t]+a.xOffset),Math.round(o+a.yOffset))}o+=r.lineHeight}}_getGpuBitmapText(e){return this._gpuBitmapText[e.uid]||this.initGpuText(e)}initGpuText(e){const t=ot.get(cl);return this._gpuBitmapText[e.uid]=t,this._updateContext(e,t),e.on("destroyed",this._destroyRenderableBound),this._gpuBitmapText[e.uid]}_updateDistanceField(e){const t=this._getGpuBitmapText(e).context,i=e._style.fontFamily,r=gi.get(`${i}-bitmap`),{a:s,b:n,c:o,d:a}=e.groupTransform,l=Math.sqrt(s*s+n*n),h=Math.sqrt(o*o+a*a),d=(Math.abs(l)+Math.abs(h))/2,u=r.baseRenderedFontSize/e._style.fontSize,c=d*r.distanceField.range*(1/u);t.customShader.resources.localUniforms.uniforms.uDistance=c}destroy(){for(const e in this._gpuBitmapText)this._destroyRenderableByUid(e);this._gpuBitmapText=null,this._renderer=null}}function vc(e,t){t.groupTransform=e.groupTransform,t.groupColorAlpha=e.groupColorAlpha,t.groupColor=e.groupColor,t.groupBlendMode=e.groupBlendMode,t.globalDisplayStatus=e.globalDisplayStatus,t.groupTransform=e.groupTransform,t.localDisplayStatus=e.localDisplayStatus,t.groupAlpha=e.groupAlpha,t._roundPixels=e._roundPixels}function bc(e,t){const{texture:i,bounds:r}=e;Ne(r,t._anchor,i);const s=t._style.padding;r.minX-=s,r.minY-=s,r.maxX-=s,r.maxY-=s}xc.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"bitmapText"};class wc{constructor(e){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const e in this._gpuText){const t=this._gpuText[e];if(!t)continue;const i=t.batchableSprite.renderable;i._autoResolution&&(i._resolution=this._renderer.resolution,i.onViewUpdate())}}validateRenderable(e){const t=this._getGpuText(e),i=e._getKey();return t.textureNeedsUploading?(t.textureNeedsUploading=!1,!0):t.currentKey!==i}addRenderable(e,t){const i=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){const t=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),t._batcher.updateElement(t)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(e.uid)}_destroyRenderableById(e){const t=this._gpuText[e];this._renderer.htmlText.decreaseReferenceCount(t.currentKey),ot.return(t.batchableSprite),this._gpuText[e]=null}_updateText(e){const t=e._getKey(),i=this._getGpuText(e),r=i.batchableSprite;i.currentKey!==t&&this._updateGpuText(e).catch((e=>{console.error(e)})),e._didTextUpdate=!1,bc(r,e)}async _updateGpuText(e){e._didTextUpdate=!1;const t=this._getGpuText(e);if(t.generatingTexture)return;const i=e._getKey();this._renderer.htmlText.decreaseReferenceCount(t.currentKey),t.generatingTexture=!0,t.currentKey=i;const r=e.resolution??this._renderer.resolution,s=await this._renderer.htmlText.getManagedTexture(e.text,r,e._style,e._getKey()),n=t.batchableSprite;n.texture=t.texture=s,t.generatingTexture=!1,t.textureNeedsUploading=!0,e.onViewUpdate(),bc(n,e)}_getGpuText(e){return this._gpuText[e.uid]||this.initGpuText(e)}initGpuText(e){const t={texture:Se.EMPTY,currentKey:"--",batchableSprite:ot.get(hd),textureNeedsUploading:!1,generatingTexture:!1},i=t.batchableSprite;return i.renderable=e,i.transform=e.groupTransform,i.texture=Se.EMPTY,i.bounds={minX:0,maxX:1,minY:0,maxY:0},i.roundPixels=this._renderer._roundPixels|e._roundPixels,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,this._gpuText[e.uid]=t,e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(const e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}}wc.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"htmlText"};const Tc=new Pe;function Ec(e,t,i,r){const s=Tc;s.minX=0,s.minY=0,s.maxX=e.width/r|0,s.maxY=e.height/r|0;const n=Ut.getOptimalTexture(s.width,s.height,r,!1);return n.source.uploadMethodId="image",n.source.resource=e,n.source.alphaMode="premultiply-alpha-on-upload",n.frame.width=t/r,n.frame.height=i/r,n.source.emit("update",n.source),n.updateUvs(),n}async function Cc(e,t){const i=await async function(e){const t=await ii.get().fetch(e),i=await t.blob(),r=new FileReader;return await new Promise(((e,t)=>{r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(i)}))}(t);return`@font-face {\n        font-family: "${e.fontFamily}";\n        src: url('${i}');\n        font-weight: ${e.fontWeight};\n        font-style: ${e.fontStyle};\n    }`}const Sc=new Map;class Nc{constructor(e){this._activeTextures={},this._renderer=e,this._createCanvas=e.type===Er.WEBGPU}getTexture(e){return this._buildTexturePromise(e.text,e.resolution,e.style)}getManagedTexture(e,t,i,r){if(this._activeTextures[r])return this._increaseReferenceCount(r),this._activeTextures[r].promise;const s=this._buildTexturePromise(e,t,i).then((e=>(this._activeTextures[r].texture=e,e)));return this._activeTextures[r]={texture:null,promise:s,usageCount:1},s}async _buildTexturePromise(e,t,i){const r=ot.get(Al),s=function(e,t){const i=t.fontFamily,r=[],s={},n=e.match(/font-family:([^;"\s]+)/g);function o(e){s[e]||(r.push(e),s[e]=!0)}if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else o(i);n&&n.forEach((e=>{o(e.split(":")[1].trim())}));for(const a in t.tagStyles)o(t.tagStyles[a].fontFamily);return r}(e,i),n=await async function(e,t,i){const r=e.filter((e=>gi.has(`${e}-and-url`))).map(((e,r)=>{if(!Sc.has(e)){const{url:s}=gi.get(`${e}-and-url`);0===r?Sc.set(e,Cc({fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:e},s)):Sc.set(e,Cc({fontWeight:i.fontWeight,fontStyle:i.fontStyle,fontFamily:e},s))}return Sc.get(e)}));return(await Promise.all(r)).join("\n")}(s,i,Cl.defaultTextStyle),o=function(e,t,i,r){r||(r=Pl||(Pl=new Al));const{domElement:s,styleElement:n,svgRoot:o}=r;s.innerHTML=`<style>${t.cssStyle};</style><div style='padding:0'>${e}</div>`,s.setAttribute("style","transform-origin: top left; display: inline-block"),i&&(n.textContent=i),document.body.appendChild(o);const a=s.getBoundingClientRect();o.remove();const l=2*t.padding;return{width:a.width-l,height:a.height-l}}(e,i,n,r),a=Math.ceil(Math.ceil(Math.max(1,o.width)+2*i.padding)*t),l=Math.ceil(Math.ceil(Math.max(1,o.height)+2*i.padding)*t),h=r.image;h.width=2+(0|a),h.height=2+(0|l);const d=function(e,t,i,r,s){const{domElement:n,styleElement:o,svgRoot:a}=s;n.innerHTML=`<style>${t.cssStyle}</style><div style='padding:0;'>${e}</div>`,n.setAttribute("style",`transform: scale(${i});transform-origin: top left; display: inline-block`),o.textContent=r;const{width:l,height:h}=s.image;return a.setAttribute("width",l.toString()),a.setAttribute("height",h.toString()),(new XMLSerializer).serializeToString(a)}(e,i,t,n,r);await function(e,t,i){return new Promise((async r=>{i&&await new Promise((e=>setTimeout(e,100))),e.onload=()=>{r()},e.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(t)}`,e.crossOrigin="anonymous"}))}(h,d,function(){const{userAgent:e}=ii.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}()&&s.length>0);const u=h;let c;this._createCanvas&&(c=function(e,t){const i=Do.getOptimalCanvasAndContext(e.width,e.height,t),{context:r}=i;return r.clearRect(0,0,e.width,e.height),r.drawImage(e,0,0),i}(h,t));const p=Ec(c?c.canvas:u,h.width-2,h.height-2,t);return this._createCanvas&&(this._renderer.texture.initSource(p.source),Do.returnCanvasAndContext(c)),ot.return(r),p}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}decreaseReferenceCount(e){const t=this._activeTextures[e];t&&(t.usageCount--,0===t.usageCount&&(t.texture?this._cleanUp(t):t.promise.then((e=>{t.texture=e,this._cleanUp(t)})).catch((()=>{At("HTMLTextSystem: Failed to clean texture")})),this._activeTextures[e]=null))}_cleanUp(e){Ut.returnTexture(e.texture),e.texture.source.resource=null,e.texture.source.uploadMethodId="unknown"}getReferenceCount(e){return this._activeTextures[e].usageCount}destroy(){this._activeTextures=null}}Nc.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"htmlText"},Nc.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"};class Ac{constructor(e){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const e in this._gpuText){const t=this._gpuText[e];if(!t)continue;const i=t.batchableSprite.renderable;i._autoResolution&&(i._resolution=this._renderer.resolution,i.onViewUpdate())}}validateRenderable(e){const t=this._getGpuText(e),i=e._getKey();return t.currentKey!==i}addRenderable(e,t){const i=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){const t=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),t._batcher.updateElement(t)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(e.uid)}_destroyRenderableById(e){const t=this._gpuText[e];this._renderer.canvasText.decreaseReferenceCount(t.currentKey),ot.return(t.batchableSprite),this._gpuText[e]=null}_updateText(e){const t=e._getKey(),i=this._getGpuText(e),r=i.batchableSprite;i.currentKey!==t&&this._updateGpuText(e),e._didTextUpdate=!1,bc(r,e)}_updateGpuText(e){const t=this._getGpuText(e),i=t.batchableSprite;t.texture&&this._renderer.canvasText.decreaseReferenceCount(t.currentKey),t.texture=i.texture=this._renderer.canvasText.getManagedTexture(e),t.currentKey=e._getKey(),i.texture=t.texture}_getGpuText(e){return this._gpuText[e.uid]||this.initGpuText(e)}initGpuText(e){const t={texture:null,currentKey:"--",batchableSprite:ot.get(hd)};return t.batchableSprite.renderable=e,t.batchableSprite.transform=e.groupTransform,t.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},t.batchableSprite.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuText[e.uid]=t,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,this._updateText(e),e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(const e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}}function Pc(e,t,i){for(let r=0,s=4*i*t;r<t;++r,s+=4)if(0!==e[s+3])return!1;return!0}function Mc(e,t,i,r,s){const n=4*t;for(let o=r,a=r*n+4*i;o<=s;++o,a+=n)if(0!==e[a+3])return!1;return!0}Ac.extension={type:[I.WebGLPipes,I.WebGPUPipes,I.CanvasPipes],name:"text"};class Rc{constructor(e){this._activeTextures={},this._renderer=e}getTextureSize(e,t,i){const r=zo.measureText(e||" ",i);let s=Math.ceil(Math.ceil(Math.max(1,r.width)+2*i.padding)*t),n=Math.ceil(Math.ceil(Math.max(1,r.height)+2*i.padding)*t);return s=Math.ceil(s-1e-6),n=Math.ceil(n-1e-6),s=fe(s),n=fe(n),{width:s,height:n}}getTexture(e,t,i,r){"string"==typeof e&&(pe("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),e={text:e,style:i,resolution:t}),e.style instanceof Oo||(e.style=new Oo(e.style));const{texture:s,canvasAndContext:n}=this.createTextureAndCanvas(e);return this._renderer.texture.initSource(s._source),Do.returnCanvasAndContext(n),s}createTextureAndCanvas(e){const{text:t,style:i}=e,r=e.resolution??this._renderer.resolution,s=zo.measureText(t||" ",i),n=Math.ceil(Math.ceil(Math.max(1,s.width)+2*i.padding)*r),o=Math.ceil(Math.ceil(Math.max(1,s.height)+2*i.padding)*r),a=Do.getOptimalCanvasAndContext(n,o),{canvas:l}=a;this.renderTextToCanvas(t,i,r,a);const h=Ec(l,n,o,r);if(i.trim){const e=function(e,t=1){const{width:i,height:r}=e,s=e.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");const n=s.getImageData(0,0,i,r).data;let o=0,a=0,l=i-1,h=r-1;for(;a<r&&Pc(n,i,a);)++a;if(a===r)return le.EMPTY;for(;Pc(n,i,h);)--h;for(;Mc(n,i,o,a,h);)++o;for(;Mc(n,i,l,a,h);)--l;return++l,++h,new le(o/t,a/t,(l-o)/t,(h-a)/t)}(l,r);h.frame.copyFrom(e),h.updateUvs()}return{texture:h,canvasAndContext:a}}getManagedTexture(e){e._resolution=e._autoResolution?this._renderer.resolution:e.resolution;const t=e._getKey();if(this._activeTextures[t])return this._increaseReferenceCount(t),this._activeTextures[t].texture;const{texture:i,canvasAndContext:r}=this.createTextureAndCanvas(e);return this._activeTextures[t]={canvasAndContext:r,texture:i,usageCount:1},i}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}returnTexture(e){const t=e.source;t.resource=null,t.uploadMethodId="unknown",t.alphaMode="no-premultiply-alpha",Ut.returnTexture(e)}decreaseReferenceCount(e){const t=this._activeTextures[e];t.usageCount--,0===t.usageCount&&(Do.returnCanvasAndContext(t.canvasAndContext),this.returnTexture(t.texture),this._activeTextures[e]=null)}getReferenceCount(e){return this._activeTextures[e].usageCount}renderTextToCanvas(e,t,i,r){var s,n,o,a;const{canvas:l,context:h}=r,d=Lo(t),u=zo.measureText(e||" ",t),c=u.lines,p=u.lineHeight,g=u.lineWidths,f=u.maxLineWidth,m=u.fontProperties,_=l.height;if(h.resetTransform(),h.scale(i,i),h.textBaseline=t.textBaseline,null==(s=t._stroke)?void 0:s.width){const e=t._stroke;h.lineWidth=e.width,h.miterLimit=e.miterLimit,h.lineJoin=e.join,h.lineCap=e.cap}let y,x;h.font=d;const v=t.dropShadow?2:1;for(let b=0;b<v;++b){const e=t.dropShadow&&0===b,s=e?Math.ceil(Math.max(1,_)+2*t.padding):0,l=s*i;if(e){h.fillStyle="black",h.strokeStyle="black";const e=t.dropShadow,r=e.color,s=e.alpha;h.shadowColor=st.shared.setValue(r).setAlpha(s).toRgbaString();const n=e.blur*i,o=e.distance*i;h.shadowBlur=n,h.shadowOffsetX=Math.cos(e.angle)*o,h.shadowOffsetY=Math.sin(e.angle)*o+l}else{if(h.fillStyle=t._fill?Wo(t._fill,h,u):null,null==(n=t._stroke)?void 0:n.width){const e=t._stroke.width*t._stroke.alignment;h.strokeStyle=Wo(t._stroke,h,u,e)}h.shadowColor="black"}let d=(p-m.fontSize)/2;p-m.fontSize<0&&(d=0);const v=(null==(o=t._stroke)?void 0:o.width)??0;for(let i=0;i<c.length;i++)y=v/2,x=v/2+i*p+m.ascent+d,"right"===t.align?y+=f-g[i]:"center"===t.align&&(y+=(f-g[i])/2),(null==(a=t._stroke)?void 0:a.width)&&this._drawLetterSpacing(c[i],t,r,y+t.padding,x+t.padding-s,!0),void 0!==t._fill&&this._drawLetterSpacing(c[i],t,r,y+t.padding,x+t.padding-s)}}_drawLetterSpacing(e,t,i,r,s,n=!1){const{context:o}=i,a=t.letterSpacing;let l=!1;if(zo.experimentalLetterSpacingSupported&&(zo.experimentalLetterSpacing?(o.letterSpacing=`${a}px`,o.textLetterSpacing=`${a}px`,l=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),0===a||l)return void(n?o.strokeText(e,r,s):o.fillText(e,r,s));let h=r;const d=zo.graphemeSegmenter(e);let u=o.measureText(e).width,c=0;for(let p=0;p<d.length;++p){const e=d[p];n?o.strokeText(e,h,s):o.fillText(e,h,s);let t="";for(let i=p+1;i<d.length;++i)t+=d[i];c=o.measureText(t).width,h+=u-c+a,u=c}}destroy(){this._activeTextures=null}}function kc(e,t){return{x:e,y:t}}Rc.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"canvasText"},G.add(L,F);class Bc{constructor(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r}static get empty(){return new Bc(0,0,0,0)}static fromRect(e){return new Bc(e.left,e.top,e.width,e.height)}static fromLTRB(e,t,i,r){return new Bc(e,t,i-e,r-t)}contains(e){return e.x>=this.left&&e.x<=this.right&&e.y>=this.top&&e.y<=this.bottom}inflate(e,t){return Bc.fromLTRB(this.left-e,this.top-t,this.right+e,this.bottom+t)}intersects(e){const t=this.left,i=this.top,r=this.width,s=this.height,n=e.left,o=e.top,a=e.width,l=e.height;return n<t+r&&t<n+a&&o<i+s&&i<o+l}union(e){const t=[this.left,this.right,e.left,e.right],i=[this.top,this.bottom,e.top,e.bottom];return Bc.fromLTRB(Math.min(...t),Math.min(...i),Math.max(...t),Math.max(...i))}get center(){return{x:this.left+this.width/2,y:this.top+this.height/2}}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get location(){return kc(this.left,this.top)}get northEast(){return{x:this.right,y:this.top}}get southEast(){return{x:this.right,y:this.bottom}}get southWest(){return{x:this.left,y:this.bottom}}get northWest(){return{x:this.left,y:this.top}}get east(){return kc(this.right,this.center.y)}get north(){return kc(this.center.x,this.top)}get south(){return kc(this.center.x,this.bottom)}get west(){return kc(this.left,this.center.y)}get size(){return{width:this.width,height:this.height}}}class Ic{constructor(e){this.data=e,this.distance=Number.MAX_SAFE_INTEGER,this.shortestPath=[],this.adjacentNodes=new Map}}class Oc{constructor(){this.index={}}add(e){const{x:t,y:i}=e,r=t.toString(),s=i.toString();r in this.index||(this.index[r]={}),s in this.index[r]||(this.index[r][s]=new Ic(e))}getLowestDistanceNode(e){let t=null,i=Number.MAX_SAFE_INTEGER;for(const r of e){const e=r.distance;e<i&&(i=e,t=r)}return t}inferPathDirection(e){return 0==e.shortestPath.length?null:this.directionOfNodes(e.shortestPath[e.shortestPath.length-1],e)}calculateShortestPathFromSource(e,t){t.distance=0;const i=new Set,r=new Set;for(r.add(t);0!=r.size;){const e=this.getLowestDistanceNode(r);r.delete(e);for(const[t,s]of e.adjacentNodes)i.has(t)||(this.calculateMinimumDistance(t,s,e),r.add(t));i.add(e)}return e}calculateMinimumDistance(e,t,i){const r=i.distance,s=this.inferPathDirection(i),n=this.directionOfNodes(i,e),o=s&&n&&s!=n?Math.pow(t+1,2):0;if(r+t+o<e.distance){e.distance=r+t+o;const s=[...i.shortestPath];s.push(i),e.shortestPath=s}}directionOf(e,t){return e.x===t.x?"h":e.y===t.y?"v":null}directionOfNodes(e,t){return this.directionOf(e.data,t.data)}connect(e,t){const i=this.get(e),r=this.get(t);if(!i||!r)throw new Error("A point was not found");i.adjacentNodes.set(r,function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}(e,t))}has(e){const{x:t,y:i}=e,r=t.toString(),s=i.toString();return r in this.index&&s in this.index[r]}get(e){const{x:t,y:i}=e,r=t.toString(),s=i.toString();return r in this.index&&s in this.index[r]?this.index[r][s]:null}}function Dc(e){const t=Bc.fromRect(e.shape);switch(e.side){case"bottom":return kc(t.left+t.width*e.distance,t.bottom);case"top":return kc(t.left+t.width*e.distance,t.top);case"left":return kc(t.left,t.top+t.height*e.distance);case"right":return kc(t.right,t.top+t.height*e.distance)}}function Gc(e,t){const{x:i,y:r}=Dc(e);switch(e.side){case"top":return kc(i,r-t);case"right":return kc(i+t,r);case"bottom":return kc(i,r+t);case"left":return kc(i-t,r)}}function Lc(e){return"top"==e||"bottom"==e}function Fc(e,t){const i=[];for(const[r,s]of e.data){const t=0==r,n=r==e.rows-1;for(const[r,o]of s){const s=0==r,a=r==e.columns-1;s&&t||t&&a||n&&a||n&&s?i.push(o.northWest,o.northEast,o.southWest,o.southEast):t?i.push(o.northWest,o.north,o.northEast):n?i.push(o.southEast,o.south,o.southWest):s?i.push(o.northWest,o.west,o.southWest):a?i.push(o.northEast,o.east,o.southEast):i.push(o.northWest,o.north,o.northEast,o.east,o.southEast,o.south,o.southWest,o.west,o.center)}}return function(e){const t=[],i=new Map;e.forEach((e=>{const{x:t,y:r}=e,s=i.get(r)||i.set(r,[]).get(r);s.indexOf(t)<0&&s.push(t)}));for(const[r,s]of i)for(const e of s)t.push(kc(e,r));return t}(i).filter((e=>!(e=>t.filter((t=>t.contains(e))).length>0)(e)))}function Uc(e,t,i){const r=e.get(t),s=e.get(i);if(!r)throw new Error(`Origin node {${t.x},${t.y}} not found`);if(!s)throw new Error(`Origin node {${t.x},${t.y}} not found`);return e.calculateShortestPathFromSource(e,r),s.shortestPath.map((e=>e.data))}function zc(e,t,i){const r=e.x===t.x&&t.x===i.x,s=e.y===t.y&&t.y===i.y,n=e.y===t.y,o=e.x===t.x,a=t.y===i.y,l=t.x===i.x;if(r||s)return"none";if(!o&&!n||!l&&!a)return"unknown";if(n&&l)return i.y>t.y?"s":"n";if(o&&a)return i.x>t.x?"e":"w";throw new Error("Nope")}class Hc{constructor(){this._rows=0,this._cols=0,this.data=new Map}set(e,t,i){this._rows=Math.max(this.rows,e+1),this._cols=Math.max(this.columns,t+1);(this.data.get(e)||this.data.set(e,new Map).get(e)).set(t,i)}get(e,t){const i=this.data.get(e);return i&&i.get(t)||null}rectangles(){const e=[];for(const[,t]of this.data)for(const[,i]of t)e.push(i);return e}get columns(){return this._cols}get rows(){return this._rows}}class Wc{constructor(){this.byproduct={hRulers:[],vRulers:[],spots:[],grid:[],connections:[]}}getPoints(e,t,i,r){return[{name:"top",x:e+i/2,y:t},{name:"bottom",x:e+i/2,y:t+r},{name:"left",x:e,y:t+r/2},{name:"right",x:e+i,y:t+r/2}]}assignSides(e,t){if(!e.side||!t.side){const i=this.getPoints(e.shape.left,e.shape.top,e.shape.width,e.shape.height),r=this.getPoints(t.shape.left,t.shape.top,t.shape.width,t.shape.height);let s={source:null,target:null,distance:1/0};for(let e=0;e<4;e++)for(let t=0;t<4;t++){const n=Math.sqrt(Math.pow(i[e].x-r[t].x,2)+Math.pow(i[e].y-r[t].y,2));n<s.distance&&(s={source:i[e].name,target:r[t].name,distance:n})}e.side=e.side||s.source,t.side=t.side||s.target}}route(e){const{pointA:t,pointB:i,globalBoundsMargin:r}=e;this.assignSides(t,i);const s=[],n=[],o=[],a=Lc(t.side),l=Lc(i.side),h=Dc(t),d=Dc(i),u=Bc.fromRect(t.shape),c=Bc.fromRect(i.shape),p=Bc.fromRect(e.globalBounds);let g=e.shapeMargin,f=u.inflate(g,g),m=c.inflate(g,g);f.intersects(m)&&(g=0,f=u,m=c);const _=f.union(m).inflate(r,r),y=Bc.fromLTRB(Math.max(_.left,p.left),Math.max(_.top,p.top),Math.min(_.right,p.right),Math.min(_.bottom,p.bottom));for(const N of[f,m])n.push(N.left),n.push(N.right),o.push(N.top),o.push(N.bottom);(a?n:o).push(a?h.x:h.y),(l?n:o).push(l?d.x:d.y);for(const N of[t,i]){const e=Dc(N),t=(t,i)=>s.push(kc(e.x+t,e.y+i));switch(N.side){case"top":t(0,-g);break;case"right":t(g,0);break;case"bottom":t(0,g);break;case"left":t(-g,0)}}n.sort(((e,t)=>e-t)),o.sort(((e,t)=>e-t));const x=function(e,t,i){const r=new Hc;e.sort(((e,t)=>e-t)),t.sort(((e,t)=>e-t));let s=i.left,n=i.top,o=0,a=0;for(const l of t){for(const t of e)r.set(a,o++,Bc.fromLTRB(s,n,t,l)),s=t;r.set(a,o,Bc.fromLTRB(s,n,i.right,l)),s=i.left,n=l,o=0,a++}s=i.left;for(const l of e)r.set(a,o++,Bc.fromLTRB(s,n,l,i.bottom)),s=l;return r.set(a,o,Bc.fromLTRB(s,n,i.right,i.bottom)),r}(n,o,y),v=Fc(x,[f,m]);s.push(...v);const{graph:b,connections:w}=function(e){const t=[],i=[],r=new Oc,s=[];e.forEach((e=>{const{x:s,y:n}=e;t.indexOf(s)<0&&t.push(s),i.indexOf(n)<0&&i.push(n),r.add(e)})),t.sort(((e,t)=>e-t)),i.sort(((e,t)=>e-t));const n=e=>r.has(e);for(let o=0;o<i.length;o++)for(let e=0;e<t.length;e++){const a=kc(t[e],i[o]);if(n(a)){if(e>0){const l=kc(t[e-1],i[o]);n(l)&&(r.connect(l,a),r.connect(a,l),s.push({a:l,b:a}))}if(o>0){const l=kc(t[e],i[o-1]);n(l)&&(r.connect(l,a),r.connect(a,l),s.push({a:l,b:a}))}}}return{graph:r,connections:s}}(s),T=Gc(t,g),E=Gc(i,g),C=Dc(t),S=Dc(i);this.byproduct.spots=s,this.byproduct.vRulers=n,this.byproduct.hRulers=o,this.byproduct.grid=x.rectangles(),this.byproduct.connections=w;return Uc(b,T,E).length>0?function(e){if(e.length<=2)return e;const t=[e[0]];for(let i=1;i<e.length;i++){const r=e[i];if(i===e.length-1){t.push(r);break}"none"!==zc(e[i-1],r,e[i+1])&&t.push(r)}return t}([C,...Uc(b,T,E),S]):[]}}class Vc{constructor(){this.tooltip=document.createElement("div"),this.tooltip.style.position="fixed",this.tooltip.style.top="0",this.tooltip.style.left="0",this.tooltip.style.display="none",this.tooltip.style.zIndex="999999",this.tooltip.style.background="#0f172a",this.tooltip.style.color="#f1f5f9",this.tooltip.style.fontFamily="sans-serif",this.tooltip.style.fontSize="0.875rem",this.tooltip.style.lineHeight="1.2",this.tooltip.style.paddingInline="1rem",this.tooltip.style.paddingBlock="0.625rem",this.tooltip.style.borderRadius="0.5rem",this.tooltip.style.maxWidth="200px",this.tooltip.style.pointerEvents="none",document.body.appendChild(this.tooltip)}hideTooltip(){this.tooltip.style.display="none"}showTooltip(e,t,i){this.tooltip.innerHTML="",this.tooltip.appendChild(document.createTextNode(i)),this.moveTooltip(e,t),this.tooltip.style.display="block"}moveTooltip(e,t){this.tooltip.style.left=`${e+5}px`,this.tooltip.style.top=`${t+5}px`}unmount(){this.tooltip.remove()}}class Xc{constructor(e,t){this.element=e,this.element.style.position="relative",this.renderer=t,this.buttonContainer=document.createElement("div"),this.buttonContainer.style.display="flex",this.buttonContainer.style.flexDirection="column",this.buttonContainer.style.gap="0.5rem",this.buttonContainer.style.position="absolute",this.buttonContainer.style.bottom="2rem",this.buttonContainer.style.right="2rem";const i=this.createButton(),r=this.createButton(),s=this.createButton();i.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'></circle><line x1='21' y1='21' x2='16.65' y2='16.65'></line><line x1='11' y1='8' x2='11' y2='14'></line><line x1='8' y1='11' x2='14' y2='11'></line></svg>",r.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'></circle><line x1='21' y1='21' x2='16.65' y2='16.65'></line><line x1='8' y1='11' x2='14' y2='11'></line></svg>",s.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3'></path></svg>",i.addEventListener("click",(()=>this.zoomToMultiplier(2))),r.addEventListener("click",(()=>this.zoomToMultiplier(.5))),s.addEventListener("click",(()=>t.zoomToFit())),this.buttonContainer.appendChild(i),this.buttonContainer.appendChild(r),this.buttonContainer.appendChild(s),e.appendChild(this.buttonContainer)}createButton(){const e=document.createElement("button");return e.style.background="#ffffff",e.style.color="#000000",e.style.border="none",e.style.borderRadius="0.375rem",e.style.padding="0.5rem",e.style.height="2.25rem",e.style.width="2.25rem",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.boxShadow="rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0.1) 0px 4px 6px -1px, rgba(0, 0, 0, 0.1) 0px 2px 4px -2px",e}zoomToMultiplier(e){const t=this.element.clientWidth/2,i=this.element.clientHeight/2,r=this.renderer.stage.x,s=this.renderer.stage.y,n=this.renderer.viewportToLocalCoordinates(t,i),o=this.renderer.stage.scale.x;this.renderer.stage.updateTransform({x:r,y:s,scaleX:o*e,scaleY:o*e});const a=this.renderer.viewportToLocalCoordinates(t,i),l=r+(a.x-n.x)*this.renderer.stage.scale.x,h=s+(a.y-n.y)*this.renderer.stage.scale.y;this.renderer.stage.updateTransform({x:r,y:s,scaleX:o,scaleY:o}),this.renderer.zoomTo(l,h,this.renderer.stage.scale.x*e)}unmount(){this.buttonContainer.remove()}}class Yc{constructor(){this.rootElement=document.createElement("div"),this.shadowRoot=this.rootElement.attachShadow({mode:"open"}),this.menu=document.createElement("div"),this.shadowRoot.appendChild(this.menu),this.menu.setAttribute("style","position:fixed;top:0;left:0;display:none;z-index:9999999;"),document.body.appendChild(this.rootElement),this.menu.addEventListener("click",(()=>this.hideMenu()))}hideMenu(){this.menu.style.display="none"}showMenu(e,t,i){this.menu.innerHTML="",this.menu.style.left=`${e}px`,this.menu.style.top=`${t}px`,this.menu.style.display="block",this.createMenuFromSections(i,this.menu);const r=()=>{this.hideMenu(),document.removeEventListener("click",r)};document.addEventListener("click",r);const s=this.computeAdjustIntoViewport(this.menu);this.menu.style.left=`${e+s.leftAdjustment}px`,this.menu.style.top=`${t+s.topAdjustment}px`}computeAdjustIntoViewport(e){const t=e.getBoundingClientRect();let i=0,r=0;return t.x+t.width>window.innerWidth&&(i=-t.width),t.y+t.height>window.innerHeight&&(r=-t.height),{leftAdjustment:i,topAdjustment:r}}createMenuFromSections(e,t){t.style.boxShadow="rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0.1) 0px 4px 6px -1px, rgba(0, 0, 0, 0.1) 0px 2px 4px -2px",t.style.borderRadius="0.5rem",t.style.padding="0.5rem",t.style.background="#ffffff",t.style.width="max-content",t.style.minWidth="200px",e.forEach((e=>{if("divider"===e){const e=document.createElement("hr");return e.style.border="1px solid #f2f3f5",t.appendChild(e),0}const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.position="relative",i.style.background="#ffffff",i.style.paddingRight="0.25rem",i.style.marginRight="-0.25rem";const r=document.createElement("button");if(r.style.background="inherit",r.style.border="none",r.style.paddingBlock="0.375rem",r.style.paddingInline="0.625rem",r.style.borderRadius="0.25rem",r.style.display="grid",r.style.gridTemplateColumns="auto",r.style.alignItems="center",r.style.justifyContent="left",r.style.gap="0.5rem",e.icon){const t=document.createElement("img");t.style.minWidth="1.25rem",t.style.minHeight="1.25rem",t.style.width="1.25rem",t.style.height="1.25rem",t.style.maxWidth="1.25rem",t.style.maxHeight="1.25rem",t.style.objectFit="1.25rem",t.src=e.icon,r.appendChild(t),r.style.gridTemplateColumns="max-content auto"}const s=document.createElement("div");if(s.style.textAlign="left",s.style.fontSize="0.875rem",s.style.fontFamily="sans-serif",s.appendChild(document.createTextNode(e.label)),r.appendChild(s),"function"==typeof e.action)r.addEventListener("click",e.action);else if(Array.isArray(e.action)){const t=document.createElement("div");t.innerHTML="<svg width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'><polyline points='7 2 18 12 7 22'></polyline></svg>",r.appendChild(t),r.style.gridTemplateColumns=e.icon?"max-content 1fr max-content":"auto max-content";const s=document.createElement("div");s.style.position="absolute",s.style.zIndex=1,s.style.left="100%",s.style.top="-0.5rem",s.style.display="none",this.createMenuFromSections(e.action,s),i.addEventListener("pointerenter",(()=>{s.style.display="block";const{leftAdjustment:e,topAdjustment:t}=this.computeAdjustIntoViewport(s);e<0&&(s.style.right=s.style.left,s.style.left=null),t<0&&(s.style.bottom=s.style.top,s.style.top=null)})),i.addEventListener("pointerleave",(()=>s.style.display="none")),i.appendChild(s)}i.addEventListener("pointerenter",(()=>{r.style.background="#f3f4f6"})),i.addEventListener("pointerleave",(()=>{r.style.background="inherit"})),i.appendChild(r),t.appendChild(i)}))}unmount(){this.menu.remove()}}class jc{constructor(e,t){this.graphics=e,this.dash=t||[10,5],this.dashSize=this.dash.reduce(((e,t)=>e+t)),this.cursor=new K,this.lineLength=0}computeDistance(e,t,i,r){return Math.sqrt(Math.pow(i-e,2)+Math.pow(r-t,2))}moveTo(e,t){return this.lineLength=0,this.cursor.set(e,t),this.start=new K(e,t),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(e,t){const i=this.computeDistance(this.cursor.x,this.cursor.y,e,t),r=Math.atan2(t-this.cursor.y,e-this.cursor.x),s=Math.cos(r),n=Math.sin(r);let o=this.cursor.x,a=this.cursor.y;const l=this.lineLength%this.dashSize;let h=0,d=0,u=0;for(let p=0;p<this.dash.length;p++){const e=this.dash[p];if(l<u+e){h=p,d=l-u;break}u+=e}let c=i;for(;c>0;){const e=this.dash[h]-d,t=c>e?e:c;o+=s*t,a+=n*t,h%2?this.graphics.moveTo(o,a):this.graphics.lineTo(o,a),c-=t,h++,h=h===this.dash.length?0:h,d=0}return this.lineLength+=i,this.cursor.set(e,t),this}circle(e,t,i,r=80){const s=2*Math.PI/r;let n=0;const o=new K(e+Math.cos(n)*i,t+Math.sin(n)*i);this.moveTo(o.x,o.y),n+=s;for(let a=1;a<r+1;a++){const l=a===r?o:[e+Math.cos(n)*i,t+Math.sin(n)*i];this.lineTo(l[0],l[1]),n+=s}return this}rect(e,t,i,r){return this.moveTo(e,t).lineTo(e+i,t).lineTo(e+i,t+r).lineTo(e,t+r).lineTo(e,t,!0),this}getDirectionalTexture(e,t,i,r){const s=document.createElement("canvas");s.width=this.dashSize,s.height=1;const n=s.getContext("2d");n.strokeStyle="white",n.globalAlpha=1,n.lineWidth=1;let o=0;n.moveTo(o,.5);for(let d=0;d<this.dash.length;d+=2)o+=this.dash[d],n.lineTo(o,.5),this.dash.length!==d+1&&(o+=this.dash[d+1],n.moveTo(o,.5));n.stroke();const a=Se.from(s),l=Math.atan2(r-t,i-e),h=new q;return h.rotate(l),h.translate(e*Math.cos(l),t*Math.sin(l)),{texture:a,matrix:h,textureSpace:"global"}}}class Kc{constructor(e,t,r,s){var n,o,a,l;this.element=e,this.element.style.overflow="hidden",this.nodes=t,this.edges=r,this.options=s,this.renderer=null,this.stage=null,this.backdrop=null,this.resizeObserver=null,this.lassoEnabled=!1,this.lineType=(null==(n=this.options)?void 0:n.lineType)||"line",this.rotateEdgeLabels="boolean"==typeof(null==(o=this.options)?void 0:o.rotateEdgeLabels)?null==(a=this.options)?void 0:a.rotateEdgeLabels:i.DEFAULT_RENDERER_ROTATE_EDGE_LABELS,this.LINE_MARGIN_PX=i.RENDERER_LINE_MARGIN,this.sceneSize=i.RENDERER_SCENE_SIZE,this.primaryColor=(null==s?void 0:s.primaryColor)?this.getHexColor(this.options.primaryColor):i.DEFAULT_RENDERER_PRIMARY_COLOR,this.backgroundColor=(null==(l=this.options)?void 0:l.backdropColor)?this.getHexColor(this.options.backdropColor):i.DEFAULT_RENDERER_BACKGROUND_COLOR,this.tooltip=new Vc,this.contextMenu=new Yc,this.contextMenuBuilder=(null==s?void 0:s.contextMenuBuilder)||null,(null==s?void 0:s.zoomControls)&&(this.zoomControls=new Xc(this.element,this)),this.listeners=new Map([["backdropclick",new Set],["backdroprightclick",new Set],["entityclick",new Set],["entityrightclick",new Set],["entityhoverstart",new Set],["entityhovermove",new Set],["entityhoverend",new Set],["entitydragstart",new Set],["entitydragmove",new Set],["entitydragend",new Set],["edgelabelhoverstart",new Set],["edgelabelhovermove",new Set],["edgelabelhoverend",new Set],["edgelabelclick",new Set],["edgelabelrightclick",new Set],["canvasdragstart",new Set],["canvasdragend",new Set],["lassostart",new Set],["lassoupdate",new Set],["lassoend",new Set]]),this.markers={none:"data:image/svg+xml;utf-8,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='60'></svg>",arrow:"data:image/svg+xml;utf-8,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='60' style='fill:%23000000;'><polygon points='0,0 30,15 0,30' /></svg>",hollowArrow:"data:image/svg+xml;utf-8,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='60' style='fill:%23ffffff;stroke:%23000000;stroke-width:4;'><polygon points='0,0 30,15 0,30' /></svg>"}}getHexColor(e){return"string"==typeof e?st.shared.setValue(e).toNumber():e}on(e,t){this.listeners.has(e)||console.error(`No such event name: ${e}`),this.listeners.get(e).add(t)}triggerEvent(e,t){this.listeners.get(e).forEach((e=>e(t)))}async initialize(){await this.initializeRenderer(),this.initializePanAndBackdropEvents(),this.initializeZoom(),this.initializeResizer(),await this.initializeData(this.nodes,this.edges),this.initializeEdgeCounters(),this.initializeLasso()}async initializeRenderer(){this.worldWidth=this.sceneSize,this.worldHeight=this.sceneSize;const e=this.element.clientWidth,t=this.element.clientHeight;this.stage=new Xt,this.stage.position.set(e/2,t/2),this.renderer=await async function(e){let t,i=[];e.preference?(i.push(e.preference),Yr.forEach((t=>{t!==e.preference&&i.push(t)}))):i=Yr.slice();let r={};for(let o=0;o<i.length;o++){const n=i[o];if("webgpu"===n&&await Xr()){const{WebGPURenderer:i}=await B((async()=>{const{WebGPURenderer:e}=await Promise.resolve().then((()=>Uu));return{WebGPURenderer:e}}),void 0,import.meta.url);t=i,r={...e,...e.webgpu};break}if("webgl"===n&&(s=e.failIfMajorPerformanceCaveat??Vr.defaultOptions.failIfMajorPerformanceCaveat,void 0!==Hr||(Hr=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:s??Vr.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ii.get().getWebGLRenderingContext())return!1;let i=ii.get().createCanvas().getContext("webgl",t);const r=!!(null==(e=null==i?void 0:i.getContextAttributes())?void 0:e.stencil);if(i){const e=i.getExtension("WEBGL_lose_context");e&&e.loseContext()}return i=null,r}catch(i){return!1}})()),Hr)){const{WebGLRenderer:i}=await B((async()=>{const{WebGLRenderer:e}=await Promise.resolve().then((()=>tu));return{WebGLRenderer:e}}),void 0,import.meta.url);t=i,r={...e,...e.webgl};break}if("canvas"===n)throw r={...e},new Error("CanvasRenderer is not yet implemented")}var s;if(delete r.webgpu,delete r.webgl,!t)throw new Error("No available renderer for the current environment");const n=new t;return await n.init(r),n}({preference:"webgl",resolution:i.RENDERER_RESOLUTION,width:e,height:t,autoDensity:!0,antialias:!0,backgroundAlpha:1,backgroundColor:this.backgroundColor}),this.renderer.view.canvas.style.display="block",this.element.appendChild(this.renderer.view.canvas),this.backdrop=new Xt,this.backdrop.interactive=!0,this.backdrop.containsPoint=()=>!0;const r=`data:image/svg+xml;utf-8,<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='200' height='200' style='background-color:%23${this.backgroundColor.toString(16)};'><path style='stroke: %23a0a0a0; stroke-width: 4px;fill: none;stroke-dasharray: 0;stroke-linecap: round; stroke-linejoin: round;' d='M95 100 L105 100 M100 95 L100 105 Z' /></svg>`,s=await Xa.load(r),n=new _l({texture:s,width:this.worldWidth,height:this.worldHeight,tileScale:{x:.25,y:.25}});n.anchor.set(.5),this.backdrop.addChild(n),this.stage.addChild(this.backdrop)}initializePanAndBackdropEvents(){let e,t,i=!1,r=!1;const s=s=>{i&&(r=!0,this.stage.x=s.data.global.x-e,this.stage.y=s.data.global.y-t,$a.shared.cull(this.stage,this.renderer.screen),requestAnimationFrame((()=>this.renderer.render(this.stage))))},n=()=>{i&&(i=!1,this.backdrop.removeEventListener("globalpointermove",s),this.triggerEvent("canvasdragend"),setTimeout((()=>{r=!1}),1))};this.backdrop.on("pointerdown",(r=>{this.lassoEnabled||(e=r.data.global.x-this.stage.x,t=r.data.global.y-this.stage.y,i=!0,this.backdrop.on("globalpointermove",s),this.triggerEvent("canvasdragstart"))})).on("pointerup",n).on("pointerupoutside",n).on("click",(e=>{r||this.lassoEnabled||this.triggerEvent("backdropclick",{position:{x:e.clientX,y:e.clientY}})})).on("rightclick",(e=>{r||this.lassoEnabled||(this.triggerEvent("backdroprightclick",{position:{x:e.clientX,y:e.clientY}}),this.contextMenuBuilder&&this.contextMenu.showMenu(e.clientX,e.clientY,this.contextMenuBuilder(null)))}))}initializeZoom(){const e=i.RENDERER_MAX_SCALE,t=i.RENDERER_MIN_SCALE;let r=!1;this.renderer.view.canvas.addEventListener("wheel",(s=>{s.stopPropagation(),s.preventDefault();const n=s.clientX,o=s.clientY,a=this.stage.toLocal(new K(n,o)),l=1+Math.abs(s.wheelDelta)/i.RENDERER_ZOOM_SENSITIVITY;let h=!1,d=this.stage.scale._x;s.wheelDelta<0?(d=Math.min(d*l,e),this.stage.updateTransform({x:this.stage.x,y:this.stage.y,scaleX:d,scaleY:d}),h=!0):s.wheelDelta&&(d=Math.max(d/l,t),this.stage.updateTransform({x:this.stage.x,y:this.stage.y,scaleX:d,scaleY:d}),h=!0);const u=this.stage.toLocal(new K(n,o));u.x===a.x&&u.y===a.y||(this.stage.x+=(u.x-a.x)*this.stage.scale.x,this.stage.y+=(u.y-a.y)*this.stage.scale.y),h&&(r=!0,setTimeout((()=>{r&&(r=!1,this.render())}),0))}))}initializeResizer(){let e=null;this.resizeObserver=new ResizeObserver((()=>{e&&clearTimeout(e),e=setTimeout((()=>{this.renderer.resize(this.element.clientWidth,this.element.clientHeight),requestAnimationFrame((()=>this.renderer.render(this.stage)))}),100)})),this.resizeObserver.observe(this.element)}async initializeData(e,t){var r,s,n,o,a,l,h,d,u,c,p,g,f,m,_,y;this.nodes=e,this.edges=t;const x=new Map,v=new Xt,b=new Xt,w=new Xt;for(const T of this.nodes){x.set(T.id,T),T.rendererInternals={container:new Xt,node:new cl,text:null,icon:null,selected:new cl,isFocused:!1,isSelected:!1,isDisabled:!1};const e=T.rendererInternals.node;T.rendererInternals.container.addChild(e);const t=T.shape.id,h=T.shape.height||2*T.shape.radius,d=T.shape.width||2*T.shape.radius;"rectangle"===t?e.roundRect(-d/2,-h/2,d,h,4):e.circle(0,0,T.shape.radius),e.fill(this.getHexColor((null==(r=T.rendererOptions)?void 0:r.backgroundColor)||i.DEFAULT_RENDERER_NODE_FILL)),e.stroke({width:i.DEFAULT_RENDERER_NODE_STROKE_WIDTH,color:i.DEFAULT_RENDERER_NODE_STROKE});const u=Math.max(.1*h,i.RENDERER_NODE_MIN_FONT_SIZE),c=null==(s=T.rendererOptions)?void 0:s.icon,p=i.RENDERER_NODE_MAX_ICON_SIZE,g=i.RENDERER_NODE_MIN_ICON_SIZE,f=Math.max(Math.min(.2*h,p),g),m="rectangle"===t?c?d-3*f:.625*d:1.25*T.shape.radius,_=new Oo({fontFamily:i.RENDERER_NODE_FONT_FAMILY,fontSize:u,wordWrap:!0,breakWords:!0,wordWrapWidth:m,align:"center",fill:this.getHexColor((null==(n=T.rendererOptions)?void 0:n.textColor)||i.DEFAULT_RENDERER_NODE_TEXT_COLOR)}),y=(null==(o=T.rendererOptions)?void 0:o.label)||`${T.id}`,b=zo.measureText(y,_);let w=b.lines.shift();const E="rectangle"===t&&h>=40||"rectangle"!==t&&T.shape.radius>40;b.lines.length&&E&&(w=`${w}\n${b.lines.shift()}`),b.lines.length&&(w=`${w.slice(0,w.length-2)}..`);const C=new xl({text:w,style:_});if(C.resolution=i.RENDERER_NODE_TEXT_RESOLUTION,C.anchor.set(.5),T.rendererInternals.container.addChild(C),T.rendererInternals.text=C,null==(a=T.rendererOptions)?void 0:a.icon){const e=await Xa.load(null==(l=T.rendererOptions)?void 0:l.icon),i=jt.from(e);i.width=f,i.height=f,i.anchor.x=.5,i.anchor.y=.5,C.anchor.y=.5,C.anchor.x=.5,T.rendererInternals.container.addChild(i),"rectangle"===t?(i.x=-b.maxLineWidth/2-i.width/2,C.x=f/2):(i.anchor.y=1.2,C.anchor.y=0),T.rendererInternals.icon=i}const S=T.rendererInternals.selected;"rectangle"===T.shape.id?S.roundRect(-(T.shape.width/2+6),-(T.shape.height/2+6),T.shape.width+12,T.shape.height+12,8):S.circle(0,0,T.shape.radius+6),S.fill(this.primaryColor),S.alpha=0,T.rendererInternals.container.addChildAt(S,0),e.interactive=!0,e.cursor="pointer";let N=null,A=!1,P=!1,M=null,R={x:null,y:null};const k=t=>{N=t.data,M=N.getLocalPosition(this.stage),A=!0,e.on("globalpointermove",B),R={x:T.x,y:T.y},this.triggerEvent("entitydragstart",{node:T,position:{...R}})},B=()=>{if(A){P=!0;const e=N.getLocalPosition(this.stage),t={x:e.x-M.x,y:e.y-M.y};this.triggerEvent("entitydragmove",{node:T,position:{x:R.x+t.x,y:R.y+t.y},delta:{...t}})}},I=()=>{setTimeout((()=>{P=!1}),1),A=!1,e.removeEventListener("globalpointermove",B),N=null,this.triggerEvent("entitydragend",{node:T})};e.on("pointerdown",k),e.on("pointerup",I),e.on("pointerupoutside",I);const O=new cl,D=new cl;O.alpha=.2,D.alpha=.1,"rectangle"===T.shape.id?(O.roundRect(-(T.shape.width/2+6),-(T.shape.height/2+6),T.shape.width+12,T.shape.height+12,8),D.roundRect(-(T.shape.width/2+12),-(T.shape.height/2+12),T.shape.width+24,T.shape.height+24,12)):(O.circle(0,0,T.shape.radius+6),D.circle(0,0,T.shape.radius+12)),O.fill(this.primaryColor),D.fill(this.primaryColor);const G=e=>{A||(T.rendererInternals.container.addChildAt(O,0),T.rendererInternals.container.addChildAt(D,0),T.rendererInternals.isFocused=!0,this.render(),this.triggerEvent("entityhoverstart",{node:T,position:{x:e.clientX,y:e.clientY}}),this.tooltip.showTooltip(e.clientX,e.clientY,y))},L=e=>{this.triggerEvent("entityhovermove",{node:T,position:{x:e.clientX,y:e.clientY}}),this.tooltip.moveTooltip(e.clientX,e.clientY)},F=()=>{T.rendererInternals.isFocused&&(T.rendererInternals.container.removeChild(O),T.rendererInternals.container.removeChild(D),T.rendererInternals.isFocused=!1,this.render(),this.triggerEvent("entityhoverend",{node:T}),this.tooltip.hideTooltip())};e.on("pointerover",G),e.on("pointermove",L),e.on("pointerout",F);const U=e=>{P||this.triggerEvent("entityclick",{node:T,position:{x:e.clientX,y:e.clientY}})},z=e=>{P||(this.triggerEvent("entityrightclick",{node:T,position:{x:e.clientX,y:e.clientY}}),this.contextMenuBuilder&&this.contextMenu.showMenu(e.clientX,e.clientY,this.contextMenuBuilder(T)))};e.on("click",U),e.on("rightclick",z),T.rendererInternals.container.cullable=!0,T.rendererInternals.container.cullableChildren=!1,v.addChild(T.rendererInternals.container)}for(const T of this.edges){const e=await Xa.load((null==(h=T.rendererOptions)?void 0:h.markerSource)?this.markers[null==(d=T.rendererOptions)?void 0:d.markerSource]:this.markers.none),t=await Xa.load((null==(u=T.rendererOptions)?void 0:u.markerTarget)?this.markers[null==(c=T.rendererOptions)?void 0:c.markerTarget]:this.markers.arrow),r=jt.from(e),s=jt.from(t),n=i.RENDERER_EDGE_MARKER_SIZE;if(r.width=n,r.height=n,s.width=n,s.height=n,T.rendererInternals={source:x.get(T.sourceNode),target:x.get(T.targetNode),container:new Xt,line:new cl,markerSource:r,markerTarget:s,text:null,isSelected:!1,isFocused:!1,isDisabled:!1,selected:null,edgeCounter:{total:-1,index:-1}},T.rendererInternals.container.addChild(T.rendererInternals.line),T.rendererInternals.container.addChild(T.rendererInternals.markerSource),T.rendererInternals.container.addChild(T.rendererInternals.markerTarget),T.rendererInternals.markerSource.anchor.set(.45,.25),T.rendererInternals.markerTarget.anchor.set(.45,.25),T.rendererInternals.container.cullable=!0,T.rendererInternals.container.cullableChildren=!1,b.addChild(T.rendererInternals.container),null==(p=T.rendererOptions)?void 0:p.label){const e=new Oo({fontFamily:i.RENDERER_EDGE_FONT_FAMILY,fontSize:i.RENDERER_EDGE_FONT_SIZE,wordWrap:!0,breakWords:!0,align:"center",wordWrapWidth:!!T.rendererOptions.isInteractive&&i.RENDERER_EDGE_LABEL_WIDTH||.5*T.visibleDistance,fill:this.getHexColor((null==(g=T.rendererOptions)?void 0:g.labelTextColor)||i.DEFAULT_RENDERER_EDGE_TEXT_COLOR)}),t=null==(f=T.rendererOptions)?void 0:f.label,r=zo.measureText(t,e);let s=r.lines[0];r.lines.length>1&&(s=`${s.slice(0,s.length-2)}..`);const n=new xl({text:s,style:e});n.resolution=i.RENDERER_EDGE_TEXT_RESOLUTION,T.sourceNode!==T.targetNode?(n.anchor.x=.5,n.anchor.y=1.2):(n.anchor.x=.5,n.anchor.y=.5);const o=new Xt;if(o.addChild(n),null==(m=T.rendererOptions)?void 0:m.isInteractive){n.anchor.y=.5;const e=(i.RENDERER_EDGE_LABEL_WIDTH||n.width)+i.RENDERER_EDGE_LABEL_INLINE_PADDING,r=n.height+i.RENDERER_EDGE_LABEL_BLOCK_PADDING,s=new cl;s.alpha=1,s.roundRect(-e/2,-r/2,e,r,4),s.fill(this.getHexColor((null==(_=T.rendererOptions)?void 0:_.labelBackgroundColor)||i.DEFAULT_RENDERER_EDGE_LABEL_FILL)),s.stroke({width:i.DEFAULT_RENDERER_EDGE_LABEL_STROKE_WIDTH,color:this.getHexColor((null==(y=T.rendererOptions)?void 0:y.labelBackgroundColor)||i.DEFAULT_RENDERER_EDGE_LABEL_STROKE)}),o.addChildAt(s,0);const a=new cl;T.rendererInternals.selected=a,a.roundRect(-(e/2+6),-(r/2+6),e+12,r+12,8),a.fill(this.primaryColor),a.alpha=0,o.addChildAt(a,0);const l=new cl,h=new cl;l.roundRect(-e/2-12,-r/2-12,e+24,r+24,12),h.roundRect(-e/2-6,-r/2-6,e+12,r+12,8),l.fill(this.primaryColor),h.fill(this.primaryColor),l.alpha=.1,h.alpha=.2,o.interactive=!0;const d=e=>{o.addChildAt(l,0),o.addChildAt(h,0),T.rendererInternals.isFocused=!0,this.render(),this.triggerEvent("edgelabelhoverstart",{edge:T,position:{x:e.clientX,y:e.clientY}}),this.tooltip.showTooltip(e.clientX,e.clientY,t)},u=e=>{this.triggerEvent("edgelabelhovermove",{edge:T,position:{x:e.clientX,y:e.clientY}}),this.tooltip.moveTooltip(e.clientX,e.clientY)},c=()=>{T.rendererInternals.isFocused&&(o.removeChild(l),o.removeChild(h),T.rendererInternals.isFocused=!1,this.render(),this.triggerEvent("edgelabelhoverend",{edge:T}),this.tooltip.hideTooltip())};o.on("pointerover",d),o.on("pointermove",u),o.on("pointerout",c);const p=e=>{this.triggerEvent("edgelabelclick",{edge:T,position:{x:e.clientX,y:e.clientY}})},g=e=>{this.triggerEvent("edgelabelrightclick",{edge:T,position:{x:e.clientX,y:e.clientY}}),this.contextMenuBuilder&&this.contextMenu.showMenu(e.clientX,e.clientY,this.contextMenuBuilder(T))};o.on("click",p),o.on("rightclick",g)}w.addChild(o),T.rendererInternals.text=o}}this.stage.addChild(b),this.stage.addChild(w),this.stage.addChild(v)}initializeEdgeCounters(){const e=new Map;for(let t=0;t<this.edges.length;t++){const i=this.edges[t],r=i.sourceNode>i.targetNode?`${i.sourceNode}${i.targetNode}`:`${i.targetNode}${i.sourceNode}`;e.has(r)?e.get(r).push(i):e.set(r,[i])}for(const[,t]of e)for(let e=0;e<t.length;e++){t[e].rendererInternals.edgeCounter={total:t.length,index:e}}}initializeLasso(){let e,t,i=!1,r=new Set;const s=s=>{if(i){const i=this.stage.toLocal(new K(s.data.global.x,s.data.global.y)),n=Math.abs(i.x-e.x),o=Math.abs(i.y-e.y),a=e.x<i.x?e.x:i.x,l=e.y<i.y?e.y:i.y;t.clear(),t.rect(a,l,n,o),t.fill(this.primaryColor);const h=a+n,d=l+o,u=new Set(Array.from(r));let c=!1;const p=[],g=[],f=[],m=[];[...this.nodes,...this.edges.filter((e=>{var t;return(null==(t=e.rendererOptions)?void 0:t.isInteractive)&&!e.rendererInternals.isDisabled}))].filter((e=>!e.rendererInternals.isDisabled)).forEach((e=>{const t=!!e.shape,i=t?e.shape.width/2||e.shape.radius:e.rendererInternals.text.width/2,s=t?e.shape.height/2||e.shape.radius:e.rendererInternals.text.height/2,n=t?e.x:e.rendererInternals.text.x,o=t?e.y:e.rendererInternals.text.y,_=t?e.id:`${e.sourceNode}-${e.targetNode}`;n>=Math.min(a,h)&&o>=Math.min(l,d)&&n+i<=Math.max(h,a)&&o+s<=Math.max(d,l)?r.has(_)||(t?g.push(e):m.push(e),u.add(_),c=!0):r.has(_)&&(t?p.push(e):f.push(e),u.delete(_),c=!0)})),c&&(this.triggerEvent("lassoupdate",{addedNodes:g,removedNodes:p,addedEdges:m,removedEdges:f,selection:Array.from(u)}),r=u),this.render()}},n=()=>{i=!1,this.backdrop.removeEventListener("globalpointermove",s),this.stage.removeChild(t),this.triggerEvent("lassoend",{selection:Array.from(r)}),r=new Set,this.render()};this.backdrop.on("pointerdown",(r=>{this.lassoEnabled&&(e=this.stage.toLocal(new K(r.data.global.x,r.data.global.y)),t=new cl,this.stage.addChild(t),t.alpha=.4,i=!0,this.backdrop.on("globalpointermove",s),this.triggerEvent("lassostart"))})).on("pointerup",n).on("pointerupoutside",n)}toggleLasso(e){this.lassoEnabled="boolean"==typeof e?e:!this.lassoEnabled}toggleSelectNodes(e,t=null){for(const i of e)i.rendererInternals.isSelected="boolean"!=typeof t?!i.rendererInternals.isSelected:t,i.rendererInternals.isSelected?i.rendererInternals.selected.alpha=1:i.rendererInternals.selected.alpha=0;this.render()}toggleSelectEdges(e,t=null){for(const i of e)i.rendererOptions.isInteractive&&(i.rendererInternals.isSelected="boolean"!=typeof t?!i.rendererInternals.isSelected:t,i.rendererInternals.isSelected?i.rendererInternals.selected.alpha=1:i.rendererInternals.selected.alpha=0);this.render()}async updateNodesAndEdges(e,t){for(;this.stage.children[0];)this.stage.removeChild(this.stage.children[0]);this.stage.addChild(this.backdrop),this.nodes.forEach((e=>delete e.rendererInternals)),this.edges.forEach((e=>delete e.rendererInternals)),await this.initializeData(e,t),this.initializeEdgeCounters(),this.render()}isNodeSelected(e){var t;return!!(null==(t=null==e?void 0:e.rendererInternals)?void 0:t.isSelected)}isEdgeSelected(e){var t;return!!(null==(t=null==e?void 0:e.rendererInternals)?void 0:t.isSelected)}clearAllNodeSelections(e=!0){this.nodes.forEach((e=>{e.rendererInternals.isSelected=!1,e.rendererInternals.selected.alpha=0})),e&&this.render()}clearAllEdgeSelections(e=!0){this.edges.forEach((e=>{var t;(null==(t=e.rendererOptions)?void 0:t.isInteractive)&&(e.rendererInternals.isSelected=!1,e.rendererInternals.selected&&(e.rendererInternals.selected.alpha=0))})),e&&this.render()}clearAllSelections(){this.clearAllNodeSelections(!1),this.clearAllEdgeSelections(!1),this.render()}setLineType(e){this.lineType=e,this.render()}zoomToFit(e=200){const t=this.element.clientWidth,r=this.element.clientHeight,s={lowestX:1/0,lowestY:1/0,highestX:-1/0,highestY:-1/0};let n;for(let i=0;i<this.nodes.length;i++)n=this.nodes[i],n.x-n.shape.radius<s.lowestX&&(s.lowestX=n.x-n.shape.radius),n.y-n.shape.radius<s.lowestY&&(s.lowestY=n.y-n.shape.radius),n.x+n.shape.radius>s.highestX&&(s.highestX=n.x+n.shape.radius),n.y+n.shape.radius>s.highestY&&(s.highestY=n.y+n.shape.radius);const o=t/Math.abs(s.highestX-s.lowestX+i.RENDERER_ZOOM_TO_FIT_PADDING),a=r/Math.abs(s.highestY-s.lowestY+i.RENDERER_ZOOM_TO_FIT_PADDING),l=Math.min(o,a),h=-((s.highestX+s.lowestX)/2)*l+t/2,d=-((s.highestY+s.lowestY)/2)*l+r/2,u=l;this.zoomTo(h,d,u,e)}zoomToNode(e){const t=this.nodes.find((t=>t.id===e));if(t){const e=this.element.offsetWidth/2,i=this.element.offsetHeight/2,r=1.5,s=-t.x*r+e,n=-t.y*r+i;this.zoomTo(s,n,r)}}zoomTo(e,t,i,r=200){const s=Date.now(),n=this.stage.x,o=this.stage.y,a=this.stage.scale._x,l=()=>{setTimeout((()=>{const h=Date.now()-s,d=Math.min(h/r,1),u=n+(e-n)*d,c=o+(t-o)*d,p=a+(i-a)*d;this.stage.updateTransform({x:u,y:c,scaleX:p,scaleY:p}),this.render(),h<r&&l()}),1)};l()}setTransform(e,t,i){this.stage.updateTransform({x:-e+this.element.clientWidth/2,y:-t+this.element.clientHeight/2,scaleX:i,scaleY:i}),this.render()}viewportToLocalCoordinates(e,t){const i=this.stage.toLocal({x:e,y:t});return{x:i.x,y:i.y}}localToViewportCoordinates(e,t){const i=this.stage.toGlobal({x:e,y:t});return{x:i.x,y:i.y}}disableNodes(e){const t=new Set;this.nodes.filter((t=>e(t))).forEach((e=>{e.rendererInternals.isDisabled=!0,t.add(e.id)})),this.edges.forEach((e=>{(t.has(e.sourceNode)||t.has(e.targetNode))&&(e.rendererInternals.isDisabled=!0)})),this.render()}clearAllDisabledStatuses(){this.nodes.forEach((e=>{e.rendererInternals.isDisabled=!1})),this.edges.forEach((e=>{e.rendererInternals.isDisabled=!1})),this.render()}async exportToPng(){const e=this.stage.getChildIndex(this.backdrop);this.stage.removeChild(this.backdrop),$a.shared.cull(this.stage,{x:-25e3,y:-25e3,width:5e4,height:5e4});try{const e=await this.renderer.extract.base64(this.stage),t=document.createElement("a");t.download="graph",t.href=e,t.click()}catch{console.error("Graph is too large")}$a.shared.cull(this.stage,this.renderer.screen),this.stage.addChildAt(this.backdrop,e)}dismount(){this.resizeObserver.unobserve(this.element)}calculateIntersection(e,t,i){const r=t.x-e.x,s=t.y-e.y;let n=t.shape.radius;if("rectangle"===t.shape.id){if(Math.abs(s/r)<=t.shape.height/t.shape.width){const e=s/(r/(t.shape.width/2));n=Math.sqrt(Math.pow(t.shape.width/2,2)+e*e)}else{const e=r/(s/(t.shape.height/2));n=Math.sqrt(Math.pow(t.shape.height/2,2)+e*e)}}const o=Math.sqrt(r*r+s*s),a=(o-(n+i))/o;return{x:r*a+e.x,y:s*a+e.y}}computeLabelAngle(e,t){const i=e.x-t.x,r=e.y-t.y;let s=Math.atan2(r,i)*(180/Math.PI);return s+=180,s>90&&s<270&&(s-=180),s}computeCurvePoint(e,t,i){const r=Math.floor((i.index-i.total%2)/2)+1,s=i.total%2*15;let n=0;switch(r){case 1:n=20+s;break;case 2:n=45+s}const o=t.x-e.x,a=t.y-e.y,l=e.x+o/2,h=e.y+a/2,d=-a,u=o,c=n/Math.sqrt(d*d+u*u),p={x:d*c,y:u*c};return e.index<t.index&&(p.x=-p.x,p.y=-p.y),i.index%2!=0&&(p.x=-p.x,p.y=-p.y),{x:l+p.x,y:h+p.y}}computeRadian(e){(e%=360)<0&&(e+=360);let t=2*Math.PI*e/360;return t<0&&(t+=2*Math.PI),t}computeSelfEdgePath(e,t,i=0){const r=360/t.total,s=Math.min(60,r),n=this.computeRadian(r*t.index),o=this.computeRadian(r*t.index+s),a=Math.cos(n)*(e.shape.radius+i),l=Math.sin(n)*(e.shape.radius+i),h=Math.cos(o)*(e.shape.radius+i),d=Math.sin(o)*(e.shape.radius+i),u=(a+h)/2*5,c=(l+d)/2*5;return{start:{x:e.x+a,y:e.y+l},end:{x:e.x+h,y:e.y+d},curvePoint:{x:e.x+u,y:e.y+c},label:{x:e.x+.8*u,y:e.y+.8*c}}}render(){this.nodes.forEach((e=>{var t,i,r,s;const{x:n,y:o}=e;e.rendererInternals.container.position=new K(n,o),this.stage.scale._x<.3?((null==(t=e.rendererInternals)?void 0:t.text)&&(e.rendererInternals.text.renderable=!1),(null==(i=e.rendererInternals)?void 0:i.icon)&&(e.rendererInternals.icon.renderable=!1)):((null==(r=e.rendererInternals)?void 0:r.text)&&(e.rendererInternals.text.renderable=!0),(null==(s=e.rendererInternals)?void 0:s.icon)&&(e.rendererInternals.icon.renderable=!0)),e.rendererInternals.isDisabled?(e.rendererInternals.node.alpha=.2,e.rendererInternals.node.interactive=!1):(e.rendererInternals.node.alpha=1,e.rendererInternals.node.interactive=!0)})),this.edges.forEach((e=>{var t,r,s,n,o,a,l,h;if(this.stage.scale._x<.1)return e.rendererInternals.line.renderable=!1,e.rendererInternals.markerSource.renderable=!1,e.rendererInternals.markerTarget.renderable=!1,void(e.rendererInternals.text&&(e.rendererInternals.text.renderable=!1));e.rendererInternals.line.renderable=!0,e.rendererInternals.markerSource.renderable=!0,e.rendererInternals.markerTarget.renderable=!0,e.rendererInternals.text&&(e.rendererInternals.text.renderable=!0);const d=e.rendererInternals.source,u=e.rendererInternals.target,c=e.rendererInternals.line;let p,g,f,m;if(c.clear(),c.alpha=1,d===u){const t=this.computeSelfEdgePath(d,e.rendererInternals.edgeCounter,this.LINE_MARGIN_PX);f=t.curvePoint,p=t.start,g=t.end,m=t.label,c.moveTo(p.x,p.y),c.quadraticCurveTo(f.x,f.y,g.x,g.y)}else if("taxi"===this.lineType){let i;if(e.rendererInternals.edgeCounter.total>1){p=this.calculateIntersection(u,d,this.LINE_MARGIN_PX),g=this.calculateIntersection(d,u,this.LINE_MARGIN_PX);const t=(g.y-p.y)/e.rendererInternals.edgeCounter.total;i=p.y+t*e.rendererInternals.edgeCounter.index+t/2,f={x:p.x+(g.x-p.x)/2,y:i}}else f=this.computeCurvePoint(d,u,e.rendererInternals.edgeCounter),p=this.calculateIntersection(f,d,this.LINE_MARGIN_PX),g=this.calculateIntersection(f,u,this.LINE_MARGIN_PX),i=p.y+(g.y-p.y)/2;if(m={x:(p.x+g.x)/2,y:i},null==(t=e.rendererOptions)?void 0:t.dotted){const e=new jc(c);e.moveTo(p.x,p.y),e.lineTo(p.x,i),e.lineTo(g.x,i),e.lineTo(g.x,g.y)}else c.moveTo(p.x,p.y),c.lineTo(p.x,i),c.lineTo(g.x,i),c.lineTo(g.x,g.y)}else if("cubicbezier"===this.lineType)f=this.computeCurvePoint(d,u,e.rendererInternals.edgeCounter),p=this.calculateIntersection(f,d,this.LINE_MARGIN_PX),g=this.calculateIntersection(f,u,this.LINE_MARGIN_PX),m={x:(p.x+g.x)/2,y:(p.y+g.y)/2},c.moveTo(p.x,p.y),c.bezierCurveTo((p.x+g.x)/2,p.y,(p.x+g.x)/2,g.y,g.x,g.y);else if("orthogonal"===this.lineType){const t=e.source.shape.width?e.source.shape.width:2*e.source.shape.radius,i=e.source.shape.height?e.source.shape.height:2*e.source.shape.radius,o=e.target.shape.width?e.target.shape.width:2*e.target.shape.radius,a=e.target.shape.height?e.target.shape.height:2*e.target.shape.radius,l=null==(r=e.rendererOptions)?void 0:r.sourceEdgePosition,h=null==(s=e.rendererOptions)?void 0:s.targetEdgePosition,d={pointA:{shape:{left:e.source.x-t/2-this.LINE_MARGIN_PX/2,top:e.source.y-i/2-this.LINE_MARGIN_PX/2,width:t+this.LINE_MARGIN_PX,height:i+this.LINE_MARGIN_PX},side:l,distance:.5},pointB:{shape:{left:e.target.x-o/2-this.LINE_MARGIN_PX/2,top:e.target.y-a/2-this.LINE_MARGIN_PX/2,width:o+this.LINE_MARGIN_PX,height:a+this.LINE_MARGIN_PX},side:h,distance:.5},shapeMargin:this.LINE_MARGIN_PX,globalBoundsMargin:100,globalBounds:{left:-this.sceneSize/2,top:-this.sceneSize/2,width:this.sceneSize,height:this.sceneSize}},u=(new Wc).route(d);if(!u.length)return;const{x:_,y:y}=u.shift(),x=u[u.length-1];if(p={x:_,y:y},g={x:x.x,y:x.y},m={x:(p.x+g.x)/2,y:(p.y+g.y)/2},f={...m,source:d.pointA.side,target:d.pointB.side},null==(n=e.rendererOptions)?void 0:n.dotted){const e=new jc(c);e.moveTo(_,y),u.forEach((t=>e.lineTo(t.x,t.y)))}else c.moveTo(_,y),u.forEach((e=>c.lineTo(e.x,e.y)))}else if(f=this.computeCurvePoint(d,u,e.rendererInternals.edgeCounter),p=this.calculateIntersection(f,d,this.LINE_MARGIN_PX),g=this.calculateIntersection(f,u,this.LINE_MARGIN_PX),m={x:(p.x+g.x)/2,y:(p.y+g.y)/2},(null==(o=e.rendererOptions)?void 0:o.dotted)&&e.rendererInternals.edgeCounter.total<=1){const e=new jc(c);e.moveTo(p.x,p.y),e.lineTo(g.x,g.y)}else c.moveTo(p.x,p.y),e.rendererInternals.edgeCounter.total>1?c.quadraticCurveTo(f.x,f.y,g.x,g.y):c.lineTo(g.x,g.y);if("taxi"===this.lineType&&d!==u){const t=e.rendererInternals.markerTarget;t.angle=u.y>d.y?90:270,t.position=new K(g.x,g.y);const i=e.rendererInternals.markerSource;i.angle=d.y>u.y?90:270,i.position=new K(p.x,p.y)}else if("orthogonal"===this.lineType&&d!==u){const t=e.rendererInternals.markerTarget;t.angle="left"===f.target?0:"top"===f.target?90:"right"===f.target?180:270,t.position=new K(g.x,g.y);const i=e.rendererInternals.markerSource;i.angle="left"===f.source?0:"top"===f.source?90:"right"===f.source?180:270,i.position=new K(p.x,p.y)}else{const t=e.rendererInternals.markerTarget;t.rotation=Math.atan2(u.y-f.y,u.x-f.x),t.position=new K(g.x,g.y);const i=e.rendererInternals.markerSource;i.rotation=Math.atan2(d.y-f.y,d.x-f.x),i.position=new K(p.x,p.y)}if((null==(a=e.rendererOptions)?void 0:a.dotted)&&(e.rendererInternals.edgeCounter.total>1||"cubicbezier"===this.lineType)){const t=new jc(c);c.stroke({width:i.RENDERER_EDGE_WIDTH,color:this.getHexColor((null==(l=e.rendererOptions)?void 0:l.color)||i.DEFAULT_RENDERER_EDGE_COLOR),...t.getDirectionalTexture(p.x,p.y,g.x,g.y)})}else c.stroke({width:i.RENDERER_EDGE_WIDTH,color:this.getHexColor((null==(h=e.rendererOptions)?void 0:h.color)||i.DEFAULT_RENDERER_EDGE_COLOR)});const _=e.rendererInternals.text;_&&(e.sourceNode===e.targetNode?_.position=new K(m.x,m.y):_.position=new K((m.x+f.x)/2,(f.y+m.y)/2),"line"===this.lineType&&this.rotateEdgeLabels?_.angle=this.computeLabelAngle(d,u):_.angle=0,_.renderable=!(this.stage.scale._x<.3)),e.rendererInternals.isDisabled?(e.rendererInternals.line.alpha=.2,e.rendererInternals.markerSource.alpha=.2,e.rendererInternals.markerTarget.alpha=.2,e.rendererInternals.text&&(e.rendererInternals.text.alpha=.2),e.rendererInternals.text&&(e.rendererInternals.text.interactive=!1)):(e.rendererInternals.line.alpha=1,e.rendererInternals.markerSource.alpha=1,e.rendererInternals.markerTarget.alpha=1,e.rendererInternals.text&&(e.rendererInternals.text.alpha=1),e.rendererInternals.text&&(e.rendererInternals.text.interactive=!0))})),$a.shared.cull(this.stage,this.renderer.screen),requestAnimationFrame((()=>this.renderer.render(this.stage)))}}class $c{constructor(e,t=[],i=[],r={}){this.WebGLRenderer=new Kc(e,t,i,r)}async initialize(){await this.WebGLRenderer.initialize()}on(e,t){this.WebGLRenderer.on(e,t)}toggleLasso(e){this.WebGLRenderer.toggleLasso(e)}toggleSelectNodes(e,t=null){this.WebGLRenderer.toggleSelectNodes(e,t)}toggleSelectEdges(e,t=null){this.WebGLRenderer.toggleSelectEdges(e,t)}async updateNodesAndEdges(e,t){await this.WebGLRenderer.updateNodesAndEdges(e,t)}isNodeSelected(e){return this.WebGLRenderer.isNodeSelected(e)}isEdgeSelected(e){return this.WebGLRenderer.isEdgeSelected(e)}clearAllNodeSelections(){this.WebGLRenderer.clearAllNodeSelections()}clearAllEdgeSelections(){this.WebGLRenderer.clearAllEdgeSelections()}clearAllSelections(){this.WebGLRenderer.clearAllSelections()}setLineType(e){this.WebGLRenderer.setLineType(e)}zoomToFit(e){this.WebGLRenderer.zoomToFit(e)}zoomToNode(e){this.WebGLRenderer.zoomToNode(e)}setTransform(e,t,i){this.WebGLRenderer.setTransform(e,t,i)}viewportToLocalCoordinates(e,t){return this.WebGLRenderer.viewportToLocalCoordinates(e,t)}localToViewportCoordinates(e,t){return this.WebGLRenderer.localToViewportCoordinates(e,t)}disableNodes(e){this.WebGLRenderer.disableNodes(e)}clearAllDisabledStatuses(){this.WebGLRenderer.clearAllDisabledStatuses()}async exportToPng(){return await this.WebGLRenderer.exportToPng()}dismount(){this.WebGLRenderer.dismount()}render(){this.WebGLRenderer.render()}}const qc=Object.freeze(Object.defineProperty({__proto__:null,DataManager:s,Layout:r,LayoutComponents:R,Loop:e,Renderer:$c,Trassel:l,colors:["#ed4242","#f87213","#f39e08","#f39c0a","#82ca12","#0fb97f","#0fb780","#0fb8a4","#07b4d3","#0fa2e7","#3981f4","#6364f0","#895bf4","#d745ed","#ea4698","#f23e5d","#627189"],initializeNodesAndEdges:a},Symbol.toStringTag,{value:"Module"})),Zc={templates:{nodes:[{id:"Cited Works",template:{rendererOptions:{backgroundColor:"#0fa2e7"}}},{id:"Citing Patents",template:{rendererOptions:{backgroundColor:"#f87213"}}}]},nodes:JSON.parse('[{"id":"Structural basis of PROTAC cooperative recognition for selective protein degradation.","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"The influence of rough lipopolysaccharide structure on molecular interactions with mammalian antimicrobial peptides","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"New Synthetic Routes to Triazolo-benzodiazepine Analogues: Expanding the Scope of the Bump-and-Hole Approach for Selective Bromo and Extra-Terminal (BET) Bromodomain Inhibition.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Cyclic and Macrocyclic Peptides as Chemical Tools To Recognise Protein Surfaces and Probe Protein-Protein Interactions.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"8-Substituted Pyrido[3,4-d]pyrimidin-4(3H)-one Derivatives As Potent, Cell Permeable, KDM4 (JMJD2) and KDM5 (JARID1) Histone Lysine Demethylase Inhibitors.","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Discovery of Type II Inhibitors of TGFβ-Activated Kinase 1 (TAK1) and Mitogen-Activated Protein Kinase Kinase Kinase Kinase 2 (MAP4K2)","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"SIK2 regulates CRTCs, HDAC4 and glucose uptake in adipocytes","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Metabotropic Glutamate Receptor 5 Negative Allosteric Modulators: Discovery of 2-Chloro-4-[1-(4-fluorophenyl)-2,5-dimethyl-1H-imidazol-4-ylethynyl]pyridine (Basimglurant, RO4917523), a Promising Novel Medicine for Psychiatric Diseases","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Nrf2 regulates ROS production by mitochondria and NADPH oxidase.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The clinically approved drugs dasatinib and bosutinib induce anti-inflammatory macrophages by inhibiting the salt-inducible kinases","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"New Monocyclic, Bicyclic, and Tricyclic Ethynylcyanodienones as Activators of the Keap1/Nrf2/ARE Pathway and Inhibitors of Inducible Nitric Oxide Synthase","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Palmitoylation of the Na/Ca exchanger cytoplasmic loop controls its inactivation and internalization during stress signaling","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Molecular Cloning and Functional Characterization of Components of the Capsule Biosynthesis Complex of Neisseria meningitidis Serogroup A TOWARD IN VITRO VACCINE PRODUCTION","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","template":"Cited Works","radius":7,"citing_patents_count":7},{"id":"An unexpected twist to the activation of IKKβ: TAK1 primes IKKβ for activation by autophosphorylation","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Crystallographic analysis of Neisseria meningitidis PorB extracellular loops potentially implicated in TLR2 recognition","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The LKB1-salt-inducible kinase pathway functions as a key gluconeogenic suppressor in the liver","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Characterization of VPS34-IN1, a selective inhibitor of Vps34, reveals that the phosphatidylinositol 3-phosphate-binding SGK3 protein kinase is a downstream target of class III phosphoinositide 3-kinase","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","template":"Cited Works","radius":6,"citing_patents_count":6},{"id":"Carnosic acid stimulates glucose uptake in skeletal muscle cells via a PME-1/PP2A/PKB signalling axis","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Kv1.3 inhibitors have differential effects on glucose uptake and AMPK activity in skeletal muscle cell lines and mouse ex vivo skeletal muscle","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Restoration of CFTR function in patients with cystic fibrosis carrying the F508del-CFTR mutation","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Parkin is activated by PINK1-dependent phosphorylation of ubiquitin at Ser65","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"Substrate recognition by the cell surface palmitoyl transferase DHHC5.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Dysregulation of ubiquitin homeostasis and β-catenin signaling promote spinal muscular atrophy","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Structure-Guided Design and Optimization of Small Molecules Targeting the Protein–Protein Interaction between the von Hippel–Lindau (VHL) E3 Ubiquitin Ligase and the Hypoxia Inducible Factor (HIF) Alpha Subunit with in Vitro Nanomolar Affinities","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"The Nrf2 regulatory network provides an interface between redox and intermediary metabolism","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Characterization of WZ4003 and HTH-01-015 as selective inhibitors of the LKB1-tumour-suppressor-activated NUAK kinases","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","template":"Cited Works","radius":6,"citing_patents_count":6},{"id":"Structure-activity relationship studies of pyrrolone antimalarial agents","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"The Concise Guide to Pharmacology 2013/14.: The Concise Guide to Pharmacology 2013/14: G Protein-Coupled Receptors","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Elevated SGK1 predicts resistance of breast cancer cells to Akt inhibitors","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Metabolism of inflammation limited by AMPK and pseudo-starvation","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Nrf2 impacts cellular bioenergetics by controlling substrate availability for mitochondrial respiration","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The anti-inflammatory compound BAY 11-7082 is a potent inhibitor of Protein Tyrosine Phosphatases","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"BslA is a self-assembling bacterial hydrophobin that coats the Bacillus subtilis biofilm","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Investigation of acyclic uridine amide and 5′-amido nucleoside analogues as potential inhibitors of the Plasmodium falciparum dUTPase","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Discovery and structure-activity relationships of pyrrolone antimalarials","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"De Novo Design of Protein Kinase Inhibitors by in Silico Identification of Hinge Region-Binding Fragments","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Comprehensive characterization and optimization of anti-LRRK2 (leucine-rich repeat kinase 2) monoclonal antibodies","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"From On-Target to Off-Target Activity: Identification and Optimisation of Trypanosoma brucei GSK3 Inhibitors and Their Characterisation as Anti-Trypanosoma brucei Drug Discovery Lead Molecules","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"HIF-independent role of prolyl hydroxylases in the cellular response to amino acids","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","template":"Cited Works","radius":11,"citing_patents_count":11},{"id":"A novel shogaol analog suppresses cancer cell invasion and inflammation, and displays cytoprotective effects through modulation of NF-κB and Nrf2-Keap1 signaling pathways","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"X-ray Crystal Structure of ERK5 (MAPK7) in Complex with a Specific Inhibitor","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"The endosome-lysosome pathway and information generation in the immune system.","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"GSK2578215A; a potent and highly selective 2-arylmethyloxy-5-substitutent-N-arylbenzamide LRRK2 kinase inhibitor.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Structure of the TatC core of the twin-arginine protein transport system","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The Ancient Drug Salicylate Directly Activates AMP-Activated Protein Kinase","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Application of a novel highly sensitive activity-based probe for detection of cathepsin G","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Analysis of the role of Nrf2 in the expression of liver proteins in mice using two-dimensional gel-based proteomics","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"PINK1 is activated by mitochondrial membrane potential depolarization and stimulates Parkin E3 ligase activity by phosphorylating Serine 65","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Synthesis, Chemical Reactivity as Michael Acceptors, and Biological Potency of Monocyclic Cyanoenones, Novel and Highly Potent Anti-inflammatory and Cytoprotective Agents(1)","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","template":"Cited Works","radius":5,"citing_patents_count":5},{"id":"Mitogen-activated protein kinase-activated protein kinase 2 (MAPKAP-K2) as an antiinflammatory target: discovery and in vivo activity of selective pyrazolo[1,5-a]pyrimidine inhibitors using a focused library and structure-based optimization approach.","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Chemical Proteomic Analysis Reveals the Drugability of the Kinome of Trypanosoma brucei","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Avirulence Protein 3a (AVR3a) from the Potato Pathogen Phytophthora infestans Forms Homodimers through Its Predicted Translocation Region and Does Not Specifically Bind Phospholipids","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"NEDD8 overexpression results in neddylation of ubiquitin substrates by the ubiquitin pathway.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Kinome-wide Selectivity Profiling of ATP-competitive Mammalian Target of Rapamycin (mTOR) Inhibitors and Characterization of Their Binding Kinetics","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The ubiquitin E1 enzyme Ube1 mediates NEDD8 activation under diverse stress conditions","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Acinetobacter baumannii FolD ligand complexes – potent inhibitors of folate metabolism and a re‐evaluation of the structure of LY374571","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Aurora kinase inhibitors: Progress towards the clinic","template":"Cited Works","radius":12,"citing_patents_count":12},{"id":"The AMPK-related kinase SIK2 is regulated by cAMP via phosphorylation at Ser(358) in adipocytes","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Synergy of Peptide and Sugar in O-GlcNAcase Substrate Recognition","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Discovery of potent and selective covalent inhibitors of JNK","template":"Cited Works","radius":6,"citing_patents_count":6},{"id":"Phosphorylation of FOXO3a on Ser-7 by p38 Promotes Its Nuclear Localization in Response to Doxorubicin","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","template":"Cited Works","radius":6,"citing_patents_count":6},{"id":"Synthesis and structure-activity relationships of a novel series of pyrimidines as potent inhibitors of TBK1/IKKε kinases.","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"Peptide inhibitors of the Keap1-Nrf2 protein-protein interaction","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Small molecules that bind the Mdm2 RING stabilize and activate p53","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","template":"Cited Works","radius":29,"citing_patents_count":29},{"id":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","template":"Cited Works","radius":11,"citing_patents_count":11},{"id":"Changes in the ratio of free NEDD8 to ubiquitin triggers NEDDylation by ubiquitin enzymes","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Fragment-based discovery of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors.","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"A multifunctional protease inhibitor to regulate endolysosomal function.","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Design, Synthesis, and Structure−Activity Relationship Exploration of 1-Substituted 4-Aroyl-3-hydroxy-5-phenyl-1H-pyrrol-2(5H)-one Analogues as Inhibitors of the Annexin A2−S100A10 Protein Interaction","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"4-benzimidazolyl-3-phenylbutanoic acids as novel PIF-pocket-targeting allosteric inhibitors of protein kinase PKCζ.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Optimisation of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"Design, Synthesis and Biological Evaluation of Novel Inhibitors of Trypanosoma brucei Pteridine Reductase 1","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The inhibitory effect of phospholemman on the sodium pump requires its palmitoylation.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"SCF/β-TrCP promotes glycogen synthase kinase 3-dependent degradation of the Nrf2 transcription factor in a keap1-independent manner","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Immunosuppressive but Non-LasR-Inducing Analogues of the Pseudomonas aeruginosa Quorum-Sensing Molecule N-(3-Oxododecanoyl)-L-homoserine Lactone","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Absolute SILAC-Compatible Expression Strain Allows Sumo-2 Copy Number Determination in Clinical Samples","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Collateral sensitivity of multidrug-resistant cells to the orphan drug tiopronin.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","template":"Cited Works","radius":11,"citing_patents_count":11},{"id":"ATP site-directed inhibitors of protein kinase CK2: an update.","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Identification of Inhibitors of the Leishmania cdc2-Related Protein Kinase CRK3","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Polyubiquitin binding to optineurin is required for optimal activation of TANK-binding kinase 1 and production of interferon β.","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"Substrate and Product Analogues as Human O-Glcnac Transferase Inhibitors.","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"The cytoprotective role of the Keap1–Nrf2 pathway","template":"Cited Works","radius":7,"citing_patents_count":7},{"id":"Design, synthesis and biological evaluation of 6-pyridylmethylaminopurines as CDK inhibitors","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Analgesic omega-Conotoxins CVIE and CVIF Selectively and Voltage-Dependently Block Recombinant and Native N-Type Calcium Channels (vol 77, pg 139, 2010)","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"NF-κB controls energy homeostasis and metabolic adaptation by upregulating mitochondrial respiration","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"Development of 18F-fluorinatable dendrons and their application to cancer cell targeting","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"The specificities of small molecule inhibitors of the TGFß and BMP pathways","template":"Cited Works","radius":3,"citing_patents_count":3},{"id":"Catalysis by the nucleolytic ribozymes","template":"Cited Works","radius":5,"citing_patents_count":5},{"id":"Characterization of GSK2334470, a novel and highly specific inhibitor of PDK1","template":"Cited Works","radius":2,"citing_patents_count":2},{"id":"N1-Benzyl substituted cambinol analogues as isozyme selective inhibitors of the sirtuin family of protein deacetylases","template":"Cited Works","radius":4,"citing_patents_count":4},{"id":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","template":"Cited Works","radius":7,"citing_patents_count":7},{"id":"Optimisation of the Anti-Trypanosoma brucei Activity of the Opioid Agonist U50488","template":"Cited Works","radius":1,"citing_patents_count":1},{"id":"109-294-662-661-65X","template":"Citing Patents"},{"id":"074-937-457-594-345","template":"Citing Patents"},{"id":"081-355-367-506-27X","template":"Citing Patents"},{"id":"048-634-530-447-798","template":"Citing Patents"},{"id":"137-231-469-269-151","template":"Citing Patents"},{"id":"031-072-815-607-16X","template":"Citing Patents"},{"id":"105-312-070-982-098","template":"Citing Patents"},{"id":"018-515-082-074-296","template":"Citing Patents"},{"id":"027-228-373-793-594","template":"Citing Patents"},{"id":"016-712-604-622-721","template":"Citing Patents"},{"id":"086-316-087-480-933","template":"Citing Patents"},{"id":"118-309-833-112-117","template":"Citing Patents"},{"id":"134-672-819-080-83X","template":"Citing Patents"},{"id":"036-789-224-520-054","template":"Citing Patents"},{"id":"106-594-488-484-12X","template":"Citing Patents"},{"id":"125-726-727-125-409","template":"Citing Patents"},{"id":"161-487-188-181-03X","template":"Citing Patents"},{"id":"076-538-237-089-675","template":"Citing Patents"},{"id":"051-324-518-696-462","template":"Citing Patents"},{"id":"198-017-973-913-570","template":"Citing Patents"},{"id":"156-653-831-632-101","template":"Citing Patents"},{"id":"178-739-712-688-618","template":"Citing Patents"},{"id":"131-486-498-702-07X","template":"Citing Patents"},{"id":"010-031-167-075-106","template":"Citing Patents"},{"id":"119-453-428-180-987","template":"Citing Patents"},{"id":"153-595-914-216-97X","template":"Citing Patents"},{"id":"148-353-591-913-750","template":"Citing Patents"},{"id":"019-827-938-996-490","template":"Citing Patents"},{"id":"184-646-935-269-773","template":"Citing Patents"},{"id":"186-230-275-872-748","template":"Citing Patents"},{"id":"165-291-395-706-725","template":"Citing Patents"},{"id":"047-113-007-956-15X","template":"Citing Patents"},{"id":"089-019-916-582-397","template":"Citing Patents"},{"id":"136-000-598-663-919","template":"Citing Patents"},{"id":"051-072-189-723-758","template":"Citing Patents"},{"id":"040-766-915-457-886","template":"Citing Patents"},{"id":"141-482-415-400-338","template":"Citing Patents"},{"id":"149-129-599-518-595","template":"Citing Patents"},{"id":"156-286-485-464-499","template":"Citing Patents"},{"id":"001-353-214-346-040","template":"Citing Patents"},{"id":"118-479-143-842-720","template":"Citing Patents"},{"id":"007-641-959-106-118","template":"Citing Patents"},{"id":"189-040-066-278-226","template":"Citing Patents"},{"id":"026-244-336-682-442","template":"Citing Patents"},{"id":"168-286-254-597-740","template":"Citing Patents"},{"id":"109-916-358-959-05X","template":"Citing Patents"},{"id":"002-458-268-309-533","template":"Citing Patents"},{"id":"038-310-729-099-192","template":"Citing Patents"},{"id":"179-033-965-606-598","template":"Citing Patents"},{"id":"113-229-447-433-64X","template":"Citing Patents"},{"id":"077-771-399-719-227","template":"Citing Patents"},{"id":"183-966-651-664-305","template":"Citing Patents"},{"id":"013-467-292-050-692","template":"Citing Patents"},{"id":"079-314-054-163-947","template":"Citing Patents"},{"id":"110-082-309-221-187","template":"Citing Patents"},{"id":"128-382-566-327-896","template":"Citing Patents"},{"id":"143-543-676-408-839","template":"Citing Patents"},{"id":"005-743-260-244-802","template":"Citing Patents"},{"id":"026-638-223-054-804","template":"Citing Patents"},{"id":"048-208-660-423-215","template":"Citing Patents"},{"id":"159-658-602-048-982","template":"Citing Patents"},{"id":"077-811-145-153-079","template":"Citing Patents"},{"id":"170-781-236-728-970","template":"Citing Patents"},{"id":"144-284-594-583-951","template":"Citing Patents"},{"id":"139-409-891-293-77X","template":"Citing Patents"},{"id":"081-017-751-048-013","template":"Citing Patents"},{"id":"114-963-910-586-828","template":"Citing Patents"},{"id":"162-513-842-046-362","template":"Citing Patents"},{"id":"188-803-921-043-695","template":"Citing Patents"},{"id":"191-147-881-232-285","template":"Citing Patents"},{"id":"081-817-015-173-962","template":"Citing Patents"},{"id":"106-530-060-683-82X","template":"Citing Patents"},{"id":"133-935-409-400-672","template":"Citing Patents"},{"id":"046-588-899-387-353","template":"Citing Patents"},{"id":"049-222-171-973-678","template":"Citing Patents"},{"id":"074-598-665-914-143","template":"Citing Patents"},{"id":"190-195-697-065-907","template":"Citing Patents"},{"id":"031-461-589-086-771","template":"Citing Patents"},{"id":"167-851-091-520-257","template":"Citing Patents"},{"id":"151-760-923-304-502","template":"Citing Patents"},{"id":"097-019-537-894-104","template":"Citing Patents"},{"id":"170-696-774-214-700","template":"Citing Patents"},{"id":"084-807-525-209-072","template":"Citing Patents"},{"id":"044-648-704-787-12X","template":"Citing Patents"},{"id":"150-822-190-827-131","template":"Citing Patents"},{"id":"051-919-508-851-10X","template":"Citing Patents"},{"id":"036-251-116-198-69X","template":"Citing Patents"},{"id":"149-946-446-737-586","template":"Citing Patents"},{"id":"075-397-286-033-085","template":"Citing Patents"},{"id":"028-992-308-265-357","template":"Citing Patents"},{"id":"044-207-676-689-405","template":"Citing Patents"},{"id":"030-350-713-791-200","template":"Citing Patents"},{"id":"093-997-239-092-949","template":"Citing Patents"},{"id":"046-345-437-716-689","template":"Citing Patents"},{"id":"146-411-731-640-871","template":"Citing Patents"},{"id":"000-266-572-036-366","template":"Citing Patents"},{"id":"186-389-876-954-313","template":"Citing Patents"},{"id":"168-483-508-794-377","template":"Citing Patents"},{"id":"029-748-240-628-036","template":"Citing Patents"},{"id":"184-507-509-452-559","template":"Citing Patents"},{"id":"069-961-069-943-549","template":"Citing Patents"},{"id":"017-777-392-752-199","template":"Citing Patents"},{"id":"000-150-893-948-804","template":"Citing Patents"},{"id":"027-437-502-794-894","template":"Citing Patents"},{"id":"074-789-039-135-70X","template":"Citing Patents"},{"id":"063-617-165-524-327","template":"Citing Patents"},{"id":"019-872-586-012-269","template":"Citing Patents"},{"id":"103-648-347-913-447","template":"Citing Patents"},{"id":"007-245-406-573-328","template":"Citing Patents"},{"id":"008-337-248-044-723","template":"Citing Patents"},{"id":"197-071-041-313-103","template":"Citing Patents"},{"id":"098-538-513-984-747","template":"Citing Patents"},{"id":"019-125-805-246-964","template":"Citing Patents"},{"id":"172-064-016-145-117","template":"Citing Patents"},{"id":"007-417-942-335-284","template":"Citing Patents"},{"id":"005-947-025-410-764","template":"Citing Patents"},{"id":"116-404-026-640-450","template":"Citing Patents"},{"id":"090-437-295-781-023","template":"Citing Patents"},{"id":"197-158-559-918-854","template":"Citing Patents"},{"id":"076-225-263-850-117","template":"Citing Patents"},{"id":"049-199-509-181-561","template":"Citing Patents"},{"id":"179-045-041-176-506","template":"Citing Patents"},{"id":"004-301-778-674-378","template":"Citing Patents"},{"id":"111-313-231-732-367","template":"Citing Patents"},{"id":"092-197-031-561-353","template":"Citing Patents"},{"id":"192-019-786-423-841","template":"Citing Patents"},{"id":"076-608-180-638-59X","template":"Citing Patents"},{"id":"175-263-797-963-040","template":"Citing Patents"},{"id":"141-694-167-791-759","template":"Citing Patents"},{"id":"081-203-444-563-604","template":"Citing Patents"},{"id":"125-348-249-762-351","template":"Citing Patents"},{"id":"125-850-986-196-787","template":"Citing Patents"},{"id":"119-397-162-706-860","template":"Citing Patents"},{"id":"133-023-408-974-285","template":"Citing Patents"},{"id":"039-847-299-166-952","template":"Citing Patents"},{"id":"076-641-402-312-988","template":"Citing Patents"},{"id":"102-485-198-725-150","template":"Citing Patents"},{"id":"168-829-456-947-639","template":"Citing Patents"},{"id":"098-813-369-162-741","template":"Citing Patents"},{"id":"023-180-369-416-862","template":"Citing Patents"},{"id":"189-473-046-734-005","template":"Citing Patents"},{"id":"019-633-684-883-828","template":"Citing Patents"},{"id":"174-501-376-407-235","template":"Citing Patents"},{"id":"129-062-448-949-030","template":"Citing Patents"},{"id":"162-916-741-322-002","template":"Citing Patents"},{"id":"080-026-305-809-343","template":"Citing Patents"},{"id":"016-698-167-713-829","template":"Citing Patents"},{"id":"091-325-080-234-401","template":"Citing Patents"},{"id":"032-206-614-235-635","template":"Citing Patents"},{"id":"143-271-017-351-983","template":"Citing Patents"},{"id":"169-312-245-869-778","template":"Citing Patents"},{"id":"089-818-979-077-305","template":"Citing Patents"},{"id":"187-517-157-601-239","template":"Citing Patents"},{"id":"111-583-988-147-450","template":"Citing Patents"},{"id":"058-026-435-099-506","template":"Citing Patents"},{"id":"153-651-762-444-327","template":"Citing Patents"},{"id":"159-766-711-047-610","template":"Citing Patents"},{"id":"058-933-099-316-100","template":"Citing Patents"},{"id":"023-452-662-674-373","template":"Citing Patents"},{"id":"047-432-030-246-04X","template":"Citing Patents"},{"id":"139-008-712-602-518","template":"Citing Patents"},{"id":"137-720-748-139-162","template":"Citing Patents"},{"id":"192-136-893-476-749","template":"Citing Patents"},{"id":"172-890-893-515-719","template":"Citing Patents"},{"id":"104-472-615-006-481","template":"Citing Patents"},{"id":"097-374-332-908-898","template":"Citing Patents"},{"id":"034-416-075-094-770","template":"Citing Patents"},{"id":"127-642-274-375-054","template":"Citing Patents"},{"id":"036-708-909-192-156","template":"Citing Patents"},{"id":"193-863-590-855-263","template":"Citing Patents"},{"id":"150-028-859-997-047","template":"Citing Patents"},{"id":"132-394-716-226-832","template":"Citing Patents"},{"id":"131-238-819-455-784","template":"Citing Patents"},{"id":"155-402-461-387-483","template":"Citing Patents"},{"id":"040-389-070-176-191","template":"Citing Patents"},{"id":"076-478-479-475-120","template":"Citing Patents"},{"id":"034-190-802-321-708","template":"Citing Patents"},{"id":"130-316-719-983-242","template":"Citing Patents"},{"id":"036-668-261-470-040","template":"Citing Patents"},{"id":"183-767-289-461-131","template":"Citing Patents"},{"id":"107-556-164-321-147","template":"Citing Patents"},{"id":"066-190-726-252-149","template":"Citing Patents"},{"id":"140-900-012-438-14X","template":"Citing Patents"},{"id":"058-438-690-312-096","template":"Citing Patents"},{"id":"004-889-112-130-518","template":"Citing Patents"},{"id":"193-040-307-473-220","template":"Citing Patents"},{"id":"188-718-220-131-362","template":"Citing Patents"},{"id":"087-577-350-425-176","template":"Citing Patents"},{"id":"191-670-060-004-126","template":"Citing Patents"},{"id":"041-699-843-843-567","template":"Citing Patents"},{"id":"180-366-233-781-99X","template":"Citing Patents"},{"id":"122-739-962-072-793","template":"Citing Patents"},{"id":"109-274-898-147-341","template":"Citing Patents"},{"id":"124-179-501-005-870","template":"Citing Patents"},{"id":"008-694-981-426-172","template":"Citing Patents"},{"id":"109-611-546-954-080","template":"Citing Patents"},{"id":"004-378-254-734-355","template":"Citing Patents"},{"id":"133-997-520-845-569","template":"Citing Patents"},{"id":"115-381-943-359-61X","template":"Citing Patents"},{"id":"022-078-711-389-998","template":"Citing Patents"},{"id":"132-854-391-972-865","template":"Citing Patents"},{"id":"171-143-110-884-468","template":"Citing Patents"},{"id":"003-946-199-636-328","template":"Citing Patents"},{"id":"009-649-401-227-606","template":"Citing Patents"},{"id":"170-042-571-881-121","template":"Citing Patents"},{"id":"033-301-273-471-462","template":"Citing Patents"},{"id":"040-826-560-477-838","template":"Citing Patents"},{"id":"135-293-472-746-415","template":"Citing Patents"},{"id":"153-999-081-812-523","template":"Citing Patents"},{"id":"000-498-778-953-787","template":"Citing Patents"},{"id":"085-065-777-135-758","template":"Citing Patents"},{"id":"152-366-692-522-975","template":"Citing Patents"},{"id":"167-869-142-610-582","template":"Citing Patents"},{"id":"191-676-336-200-724","template":"Citing Patents"},{"id":"056-387-403-639-935","template":"Citing Patents"},{"id":"066-841-401-628-941","template":"Citing Patents"},{"id":"069-503-782-573-055","template":"Citing Patents"},{"id":"028-137-796-142-577","template":"Citing Patents"},{"id":"197-678-301-596-236","template":"Citing Patents"},{"id":"147-466-934-435-143","template":"Citing Patents"},{"id":"114-647-123-099-321","template":"Citing Patents"},{"id":"058-829-130-504-901","template":"Citing Patents"},{"id":"169-953-034-717-264","template":"Citing Patents"},{"id":"028-012-588-449-727","template":"Citing Patents"},{"id":"038-839-140-589-623","template":"Citing Patents"},{"id":"194-924-906-201-593","template":"Citing Patents"},{"id":"195-611-964-620-410","template":"Citing Patents"},{"id":"025-014-524-538-421","template":"Citing Patents"},{"id":"120-667-268-642-909","template":"Citing Patents"},{"id":"163-117-320-460-138","template":"Citing Patents"},{"id":"191-290-593-697-506","template":"Citing Patents"},{"id":"118-339-847-530-982","template":"Citing Patents"},{"id":"073-318-370-112-877","template":"Citing Patents"},{"id":"113-828-920-381-078","template":"Citing Patents"},{"id":"048-983-957-537-421","template":"Citing Patents"},{"id":"073-531-962-083-670","template":"Citing Patents"}]'),edges:JSON.parse('[{"sourceNode":"Structural basis of PROTAC cooperative recognition for selective protein degradation.","targetNode":"109-294-662-661-65X","value":2},{"sourceNode":"Structural basis of PROTAC cooperative recognition for selective protein degradation.","targetNode":"074-937-457-594-345","value":2},{"sourceNode":"The influence of rough lipopolysaccharide structure on molecular interactions with mammalian antimicrobial peptides","targetNode":"081-355-367-506-27X","value":2},{"sourceNode":"New Synthetic Routes to Triazolo-benzodiazepine Analogues: Expanding the Scope of the Bump-and-Hole Approach for Selective Bromo and Extra-Terminal (BET) Bromodomain Inhibition.","targetNode":"048-634-530-447-798","value":2},{"sourceNode":"Cyclic and Macrocyclic Peptides as Chemical Tools To Recognise Protein Surfaces and Probe Protein-Protein Interactions.","targetNode":"137-231-469-269-151","value":2},{"sourceNode":"8-Substituted Pyrido[3,4-d]pyrimidin-4(3H)-one Derivatives As Potent, Cell Permeable, KDM4 (JMJD2) and KDM5 (JARID1) Histone Lysine Demethylase Inhibitors.","targetNode":"031-072-815-607-16X","value":2},{"sourceNode":"8-Substituted Pyrido[3,4-d]pyrimidin-4(3H)-one Derivatives As Potent, Cell Permeable, KDM4 (JMJD2) and KDM5 (JARID1) Histone Lysine Demethylase Inhibitors.","targetNode":"105-312-070-982-098","value":2},{"sourceNode":"8-Substituted Pyrido[3,4-d]pyrimidin-4(3H)-one Derivatives As Potent, Cell Permeable, KDM4 (JMJD2) and KDM5 (JARID1) Histone Lysine Demethylase Inhibitors.","targetNode":"018-515-082-074-296","value":2},{"sourceNode":"Discovery of Type II Inhibitors of TGFβ-Activated Kinase 1 (TAK1) and Mitogen-Activated Protein Kinase Kinase Kinase Kinase 2 (MAP4K2)","targetNode":"027-228-373-793-594","value":2},{"sourceNode":"SIK2 regulates CRTCs, HDAC4 and glucose uptake in adipocytes","targetNode":"016-712-604-622-721","value":2},{"sourceNode":"Metabotropic Glutamate Receptor 5 Negative Allosteric Modulators: Discovery of 2-Chloro-4-[1-(4-fluorophenyl)-2,5-dimethyl-1H-imidazol-4-ylethynyl]pyridine (Basimglurant, RO4917523), a Promising Novel Medicine for Psychiatric Diseases","targetNode":"086-316-087-480-933","value":2},{"sourceNode":"Nrf2 regulates ROS production by mitochondria and NADPH oxidase.","targetNode":"118-309-833-112-117","value":2},{"sourceNode":"The clinically approved drugs dasatinib and bosutinib induce anti-inflammatory macrophages by inhibiting the salt-inducible kinases","targetNode":"134-672-819-080-83X","value":2},{"sourceNode":"New Monocyclic, Bicyclic, and Tricyclic Ethynylcyanodienones as Activators of the Keap1/Nrf2/ARE Pathway and Inhibitors of Inducible Nitric Oxide Synthase","targetNode":"036-789-224-520-054","value":2},{"sourceNode":"Palmitoylation of the Na/Ca exchanger cytoplasmic loop controls its inactivation and internalization during stress signaling","targetNode":"106-594-488-484-12X","value":2},{"sourceNode":"Molecular Cloning and Functional Characterization of Components of the Capsule Biosynthesis Complex of Neisseria meningitidis Serogroup A TOWARD IN VITRO VACCINE PRODUCTION","targetNode":"125-726-727-125-409","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"161-487-188-181-03X","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"076-538-237-089-675","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"051-324-518-696-462","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"198-017-973-913-570","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"156-653-831-632-101","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"178-739-712-688-618","value":2},{"sourceNode":"A bump-and-hole approach to engineer controlled selectivity of BET bromodomain chemical probes","targetNode":"048-634-530-447-798","value":2},{"sourceNode":"An unexpected twist to the activation of IKKβ: TAK1 primes IKKβ for activation by autophosphorylation","targetNode":"131-486-498-702-07X","value":2},{"sourceNode":"An unexpected twist to the activation of IKKβ: TAK1 primes IKKβ for activation by autophosphorylation","targetNode":"010-031-167-075-106","value":2},{"sourceNode":"Crystallographic analysis of Neisseria meningitidis PorB extracellular loops potentially implicated in TLR2 recognition","targetNode":"119-453-428-180-987","value":2},{"sourceNode":"The LKB1-salt-inducible kinase pathway functions as a key gluconeogenic suppressor in the liver","targetNode":"016-712-604-622-721","value":2},{"sourceNode":"Characterization of VPS34-IN1, a selective inhibitor of Vps34, reveals that the phosphatidylinositol 3-phosphate-binding SGK3 protein kinase is a downstream target of class III phosphoinositide 3-kinase","targetNode":"153-595-914-216-97X","value":2},{"sourceNode":"Characterization of VPS34-IN1, a selective inhibitor of Vps34, reveals that the phosphatidylinositol 3-phosphate-binding SGK3 protein kinase is a downstream target of class III phosphoinositide 3-kinase","targetNode":"148-353-591-913-750","value":2},{"sourceNode":"Characterization of VPS34-IN1, a selective inhibitor of Vps34, reveals that the phosphatidylinositol 3-phosphate-binding SGK3 protein kinase is a downstream target of class III phosphoinositide 3-kinase","targetNode":"019-827-938-996-490","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"184-646-935-269-773","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"186-230-275-872-748","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"165-291-395-706-725","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"047-113-007-956-15X","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"089-019-916-582-397","value":2},{"sourceNode":"3-(2-oxoethylidene)indolin-2-one derivatives activate Nrf2 and inhibit NF-κB: potential candidates for chemoprevention.","targetNode":"136-000-598-663-919","value":2},{"sourceNode":"Carnosic acid stimulates glucose uptake in skeletal muscle cells via a PME-1/PP2A/PKB signalling axis","targetNode":"051-072-189-723-758","value":2},{"sourceNode":"Kv1.3 inhibitors have differential effects on glucose uptake and AMPK activity in skeletal muscle cell lines and mouse ex vivo skeletal muscle","targetNode":"040-766-915-457-886","value":2},{"sourceNode":"Kv1.3 inhibitors have differential effects on glucose uptake and AMPK activity in skeletal muscle cell lines and mouse ex vivo skeletal muscle","targetNode":"141-482-415-400-338","value":2},{"sourceNode":"Restoration of CFTR function in patients with cystic fibrosis carrying the F508del-CFTR mutation","targetNode":"149-129-599-518-595","value":2},{"sourceNode":"Restoration of CFTR function in patients with cystic fibrosis carrying the F508del-CFTR mutation","targetNode":"156-286-485-464-499","value":2},{"sourceNode":"Parkin is activated by PINK1-dependent phosphorylation of ubiquitin at Ser65","targetNode":"001-353-214-346-040","value":2},{"sourceNode":"Parkin is activated by PINK1-dependent phosphorylation of ubiquitin at Ser65","targetNode":"118-479-143-842-720","value":2},{"sourceNode":"Parkin is activated by PINK1-dependent phosphorylation of ubiquitin at Ser65","targetNode":"007-641-959-106-118","value":2},{"sourceNode":"Parkin is activated by PINK1-dependent phosphorylation of ubiquitin at Ser65","targetNode":"189-040-066-278-226","value":2},{"sourceNode":"Substrate recognition by the cell surface palmitoyl transferase DHHC5.","targetNode":"106-594-488-484-12X","value":2},{"sourceNode":"Dysregulation of ubiquitin homeostasis and β-catenin signaling promote spinal muscular atrophy","targetNode":"026-244-336-682-442","value":2},{"sourceNode":"Structure-Guided Design and Optimization of Small Molecules Targeting the Protein–Protein Interaction between the von Hippel–Lindau (VHL) E3 Ubiquitin Ligase and the Hypoxia Inducible Factor (HIF) Alpha Subunit with in Vitro Nanomolar Affinities","targetNode":"074-937-457-594-345","value":2},{"sourceNode":"Structure-Guided Design and Optimization of Small Molecules Targeting the Protein–Protein Interaction between the von Hippel–Lindau (VHL) E3 Ubiquitin Ligase and the Hypoxia Inducible Factor (HIF) Alpha Subunit with in Vitro Nanomolar Affinities","targetNode":"168-286-254-597-740","value":2},{"sourceNode":"The Nrf2 regulatory network provides an interface between redox and intermediary metabolism","targetNode":"109-916-358-959-05X","value":2},{"sourceNode":"Characterization of WZ4003 and HTH-01-015 as selective inhibitors of the LKB1-tumour-suppressor-activated NUAK kinases","targetNode":"002-458-268-309-533","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"038-310-729-099-192","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"179-033-965-606-598","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"113-229-447-433-64X","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"077-771-399-719-227","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"183-966-651-664-305","value":2},{"sourceNode":"Synthesis of vitamin D3 analogues with A-ring modifications to directly measure vitamin D levels in biological samples","targetNode":"013-467-292-050-692","value":2},{"sourceNode":"Structure-activity relationship studies of pyrrolone antimalarial agents","targetNode":"079-314-054-163-947","value":2},{"sourceNode":"Structure-activity relationship studies of pyrrolone antimalarial agents","targetNode":"110-082-309-221-187","value":2},{"sourceNode":"The Concise Guide to Pharmacology 2013/14.: The Concise Guide to Pharmacology 2013/14: G Protein-Coupled Receptors","targetNode":"128-382-566-327-896","value":2},{"sourceNode":"The Concise Guide to Pharmacology 2013/14.: The Concise Guide to Pharmacology 2013/14: G Protein-Coupled Receptors","targetNode":"143-543-676-408-839","value":2},{"sourceNode":"Elevated SGK1 predicts resistance of breast cancer cells to Akt inhibitors","targetNode":"005-743-260-244-802","value":2},{"sourceNode":"Metabolism of inflammation limited by AMPK and pseudo-starvation","targetNode":"026-638-223-054-804","value":2},{"sourceNode":"Nrf2 impacts cellular bioenergetics by controlling substrate availability for mitochondrial respiration","targetNode":"048-208-660-423-215","value":2},{"sourceNode":"The anti-inflammatory compound BAY 11-7082 is a potent inhibitor of Protein Tyrosine Phosphatases","targetNode":"159-658-602-048-982","value":2},{"sourceNode":"BslA is a self-assembling bacterial hydrophobin that coats the Bacillus subtilis biofilm","targetNode":"077-811-145-153-079","value":2},{"sourceNode":"BslA is a self-assembling bacterial hydrophobin that coats the Bacillus subtilis biofilm","targetNode":"170-781-236-728-970","value":2},{"sourceNode":"BslA is a self-assembling bacterial hydrophobin that coats the Bacillus subtilis biofilm","targetNode":"144-284-594-583-951","value":2},{"sourceNode":"Investigation of acyclic uridine amide and 5′-amido nucleoside analogues as potential inhibitors of the Plasmodium falciparum dUTPase","targetNode":"139-409-891-293-77X","value":2},{"sourceNode":"Discovery and structure-activity relationships of pyrrolone antimalarials","targetNode":"110-082-309-221-187","value":2},{"sourceNode":"De Novo Design of Protein Kinase Inhibitors by in Silico Identification of Hinge Region-Binding Fragments","targetNode":"081-017-751-048-013","value":2},{"sourceNode":"De Novo Design of Protein Kinase Inhibitors by in Silico Identification of Hinge Region-Binding Fragments","targetNode":"114-963-910-586-828","value":2},{"sourceNode":"De Novo Design of Protein Kinase Inhibitors by in Silico Identification of Hinge Region-Binding Fragments","targetNode":"162-513-842-046-362","value":2},{"sourceNode":"Comprehensive characterization and optimization of anti-LRRK2 (leucine-rich repeat kinase 2) monoclonal antibodies","targetNode":"188-803-921-043-695","value":2},{"sourceNode":"From On-Target to Off-Target Activity: Identification and Optimisation of Trypanosoma brucei GSK3 Inhibitors and Their Characterisation as Anti-Trypanosoma brucei Drug Discovery Lead Molecules","targetNode":"191-147-881-232-285","value":2},{"sourceNode":"From On-Target to Off-Target Activity: Identification and Optimisation of Trypanosoma brucei GSK3 Inhibitors and Their Characterisation as Anti-Trypanosoma brucei Drug Discovery Lead Molecules","targetNode":"081-817-015-173-962","value":2},{"sourceNode":"HIF-independent role of prolyl hydroxylases in the cellular response to amino acids","targetNode":"106-530-060-683-82X","value":2},{"sourceNode":"HIF-independent role of prolyl hydroxylases in the cellular response to amino acids","targetNode":"133-935-409-400-672","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"046-588-899-387-353","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"051-324-518-696-462","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"161-487-188-181-03X","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"156-653-831-632-101","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"198-017-973-913-570","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"076-538-237-089-675","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"198-017-973-913-570","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"076-538-237-089-675","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"051-324-518-696-462","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"161-487-188-181-03X","value":2},{"sourceNode":"Structural determinants for ERK5 (MAPK7) and leucine rich repeat kinase 2 activities of benzo[e]pyrimido-[5,4-b]diazepine-6(11H)-ones","targetNode":"156-653-831-632-101","value":2},{"sourceNode":"A novel shogaol analog suppresses cancer cell invasion and inflammation, and displays cytoprotective effects through modulation of NF-κB and Nrf2-Keap1 signaling pathways","targetNode":"049-222-171-973-678","value":2},{"sourceNode":"A novel shogaol analog suppresses cancer cell invasion and inflammation, and displays cytoprotective effects through modulation of NF-κB and Nrf2-Keap1 signaling pathways","targetNode":"074-598-665-914-143","value":2},{"sourceNode":"X-ray Crystal Structure of ERK5 (MAPK7) in Complex with a Specific Inhibitor","targetNode":"161-487-188-181-03X","value":2},{"sourceNode":"X-ray Crystal Structure of ERK5 (MAPK7) in Complex with a Specific Inhibitor","targetNode":"156-653-831-632-101","value":2},{"sourceNode":"X-ray Crystal Structure of ERK5 (MAPK7) in Complex with a Specific Inhibitor","targetNode":"051-324-518-696-462","value":2},{"sourceNode":"The endosome-lysosome pathway and information generation in the immune system.","targetNode":"190-195-697-065-907","value":2},{"sourceNode":"The endosome-lysosome pathway and information generation in the immune system.","targetNode":"031-461-589-086-771","value":2},{"sourceNode":"GSK2578215A; a potent and highly selective 2-arylmethyloxy-5-substitutent-N-arylbenzamide LRRK2 kinase inhibitor.","targetNode":"167-851-091-520-257","value":2},{"sourceNode":"Structure of the TatC core of the twin-arginine protein transport system","targetNode":"151-760-923-304-502","value":2},{"sourceNode":"The Ancient Drug Salicylate Directly Activates AMP-Activated Protein Kinase","targetNode":"097-019-537-894-104","value":2},{"sourceNode":"The Ancient Drug Salicylate Directly Activates AMP-Activated Protein Kinase","targetNode":"170-696-774-214-700","value":2},{"sourceNode":"Application of a novel highly sensitive activity-based probe for detection of cathepsin G","targetNode":"084-807-525-209-072","value":2},{"sourceNode":"Analysis of the role of Nrf2 in the expression of liver proteins in mice using two-dimensional gel-based proteomics","targetNode":"044-648-704-787-12X","value":2},{"sourceNode":"PINK1 is activated by mitochondrial membrane potential depolarization and stimulates Parkin E3 ligase activity by phosphorylating Serine 65","targetNode":"001-353-214-346-040","value":2},{"sourceNode":"PINK1 is activated by mitochondrial membrane potential depolarization and stimulates Parkin E3 ligase activity by phosphorylating Serine 65","targetNode":"150-822-190-827-131","value":2},{"sourceNode":"PINK1 is activated by mitochondrial membrane potential depolarization and stimulates Parkin E3 ligase activity by phosphorylating Serine 65","targetNode":"051-919-508-851-10X","value":2},{"sourceNode":"Synthesis, Chemical Reactivity as Michael Acceptors, and Biological Potency of Monocyclic Cyanoenones, Novel and Highly Potent Anti-inflammatory and Cytoprotective Agents(1)","targetNode":"036-789-224-520-054","value":2},{"sourceNode":"Synthesis, Chemical Reactivity as Michael Acceptors, and Biological Potency of Monocyclic Cyanoenones, Novel and Highly Potent Anti-inflammatory and Cytoprotective Agents(1)","targetNode":"036-251-116-198-69X","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","targetNode":"149-946-446-737-586","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","targetNode":"075-397-286-033-085","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","targetNode":"028-992-308-265-357","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","targetNode":"044-207-676-689-405","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Trypanosoma brucei Trypanothione Synthetase Inhibitors","targetNode":"030-350-713-791-200","value":2},{"sourceNode":"Mitogen-activated protein kinase-activated protein kinase 2 (MAPKAP-K2) as an antiinflammatory target: discovery and in vivo activity of selective pyrazolo[1,5-a]pyrimidine inhibitors using a focused library and structure-based optimization approach.","targetNode":"093-997-239-092-949","value":2},{"sourceNode":"Mitogen-activated protein kinase-activated protein kinase 2 (MAPKAP-K2) as an antiinflammatory target: discovery and in vivo activity of selective pyrazolo[1,5-a]pyrimidine inhibitors using a focused library and structure-based optimization approach.","targetNode":"046-345-437-716-689","value":2},{"sourceNode":"Mitogen-activated protein kinase-activated protein kinase 2 (MAPKAP-K2) as an antiinflammatory target: discovery and in vivo activity of selective pyrazolo[1,5-a]pyrimidine inhibitors using a focused library and structure-based optimization approach.","targetNode":"146-411-731-640-871","value":2},{"sourceNode":"Chemical Proteomic Analysis Reveals the Drugability of the Kinome of Trypanosoma brucei","targetNode":"000-266-572-036-366","value":2},{"sourceNode":"Avirulence Protein 3a (AVR3a) from the Potato Pathogen Phytophthora infestans Forms Homodimers through Its Predicted Translocation Region and Does Not Specifically Bind Phospholipids","targetNode":"186-389-876-954-313","value":2},{"sourceNode":"NEDD8 overexpression results in neddylation of ubiquitin substrates by the ubiquitin pathway.","targetNode":"168-483-508-794-377","value":2},{"sourceNode":"Kinome-wide Selectivity Profiling of ATP-competitive Mammalian Target of Rapamycin (mTOR) Inhibitors and Characterization of Their Binding Kinetics","targetNode":"029-748-240-628-036","value":2},{"sourceNode":"The ubiquitin E1 enzyme Ube1 mediates NEDD8 activation under diverse stress conditions","targetNode":"184-507-509-452-559","value":2},{"sourceNode":"Acinetobacter baumannii FolD ligand complexes – potent inhibitors of folate metabolism and a re‐evaluation of the structure of LY374571","targetNode":"069-961-069-943-549","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"017-777-392-752-199","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"000-150-893-948-804","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"027-437-502-794-894","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"074-789-039-135-70X","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"063-617-165-524-327","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"019-872-586-012-269","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"103-648-347-913-447","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"007-245-406-573-328","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"027-437-502-794-894","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"008-337-248-044-723","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"197-071-041-313-103","value":2},{"sourceNode":"Aurora kinase inhibitors: Progress towards the clinic","targetNode":"098-538-513-984-747","value":2},{"sourceNode":"The AMPK-related kinase SIK2 is regulated by cAMP via phosphorylation at Ser(358) in adipocytes","targetNode":"019-125-805-246-964","value":2},{"sourceNode":"The AMPK-related kinase SIK2 is regulated by cAMP via phosphorylation at Ser(358) in adipocytes","targetNode":"172-064-016-145-117","value":2},{"sourceNode":"The AMPK-related kinase SIK2 is regulated by cAMP via phosphorylation at Ser(358) in adipocytes","targetNode":"007-417-942-335-284","value":2},{"sourceNode":"Synergy of Peptide and Sugar in O-GlcNAcase Substrate Recognition","targetNode":"005-947-025-410-764","value":2},{"sourceNode":"Synergy of Peptide and Sugar in O-GlcNAcase Substrate Recognition","targetNode":"116-404-026-640-450","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"090-437-295-781-023","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"197-158-559-918-854","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"076-225-263-850-117","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"049-199-509-181-561","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"179-045-041-176-506","value":2},{"sourceNode":"Discovery of potent and selective covalent inhibitors of JNK","targetNode":"004-301-778-674-378","value":2},{"sourceNode":"Phosphorylation of FOXO3a on Ser-7 by p38 Promotes Its Nuclear Localization in Response to Doxorubicin","targetNode":"111-313-231-732-367","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"092-197-031-561-353","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"192-019-786-423-841","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"192-019-786-423-841","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"076-608-180-638-59X","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"175-263-797-963-040","value":2},{"sourceNode":"AMPK: a nutrient and energy sensor that maintains energy homeostasis","targetNode":"092-197-031-561-353","value":2},{"sourceNode":"Synthesis and structure-activity relationships of a novel series of pyrimidines as potent inhibitors of TBK1/IKKε kinases.","targetNode":"141-694-167-791-759","value":2},{"sourceNode":"Synthesis and structure-activity relationships of a novel series of pyrimidines as potent inhibitors of TBK1/IKKε kinases.","targetNode":"081-203-444-563-604","value":2},{"sourceNode":"Synthesis and structure-activity relationships of a novel series of pyrimidines as potent inhibitors of TBK1/IKKε kinases.","targetNode":"125-348-249-762-351","value":2},{"sourceNode":"Synthesis and structure-activity relationships of a novel series of pyrimidines as potent inhibitors of TBK1/IKKε kinases.","targetNode":"125-850-986-196-787","value":2},{"sourceNode":"Peptide inhibitors of the Keap1-Nrf2 protein-protein interaction","targetNode":"119-397-162-706-860","value":2},{"sourceNode":"Small molecules that bind the Mdm2 RING stabilize and activate p53","targetNode":"133-023-408-974-285","value":2},{"sourceNode":"Small molecules that bind the Mdm2 RING stabilize and activate p53","targetNode":"039-847-299-166-952","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"076-641-402-312-988","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"102-485-198-725-150","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"168-829-456-947-639","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"098-813-369-162-741","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"023-180-369-416-862","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"189-473-046-734-005","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"019-633-684-883-828","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"174-501-376-407-235","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"129-062-448-949-030","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"162-916-741-322-002","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"080-026-305-809-343","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"016-698-167-713-829","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"091-325-080-234-401","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"032-206-614-235-635","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"143-271-017-351-983","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"169-312-245-869-778","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"089-818-979-077-305","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"187-517-157-601-239","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"111-583-988-147-450","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"058-026-435-099-506","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"153-651-762-444-327","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"159-766-711-047-610","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"058-933-099-316-100","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"023-452-662-674-373","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"047-432-030-246-04X","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"139-008-712-602-518","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"137-720-748-139-162","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"192-136-893-476-749","value":2},{"sourceNode":"Reduction in BACE1 decreases body weight, protects against diet-induced obesity and enhances insulin sensitivity in mice","targetNode":"172-890-893-515-719","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"104-472-615-006-481","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"097-374-332-908-898","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"034-416-075-094-770","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"127-642-274-375-054","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"036-708-909-192-156","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"193-863-590-855-263","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"150-028-859-997-047","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"034-416-075-094-770","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"097-374-332-908-898","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"104-472-615-006-481","value":2},{"sourceNode":"AMP-Activated Protein Kinase: A Target for Drugs both Ancient and Modern","targetNode":"132-394-716-226-832","value":2},{"sourceNode":"Changes in the ratio of free NEDD8 to ubiquitin triggers NEDDylation by ubiquitin enzymes","targetNode":"168-483-508-794-377","value":2},{"sourceNode":"Fragment-based discovery of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors.","targetNode":"131-238-819-455-784","value":2},{"sourceNode":"Fragment-based discovery of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors.","targetNode":"155-402-461-387-483","value":2},{"sourceNode":"Fragment-based discovery of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors.","targetNode":"040-389-070-176-191","value":2},{"sourceNode":"Fragment-based discovery of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors.","targetNode":"076-478-479-475-120","value":2},{"sourceNode":"A multifunctional protease inhibitor to regulate endolysosomal function.","targetNode":"031-461-589-086-771","value":2},{"sourceNode":"A multifunctional protease inhibitor to regulate endolysosomal function.","targetNode":"190-195-697-065-907","value":2},{"sourceNode":"Design, Synthesis, and Structure−Activity Relationship Exploration of 1-Substituted 4-Aroyl-3-hydroxy-5-phenyl-1H-pyrrol-2(5H)-one Analogues as Inhibitors of the Annexin A2−S100A10 Protein Interaction","targetNode":"034-190-802-321-708","value":2},{"sourceNode":"4-benzimidazolyl-3-phenylbutanoic acids as novel PIF-pocket-targeting allosteric inhibitors of protein kinase PKCζ.","targetNode":"130-316-719-983-242","value":2},{"sourceNode":"Optimisation of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors","targetNode":"076-478-479-475-120","value":2},{"sourceNode":"Optimisation of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors","targetNode":"040-389-070-176-191","value":2},{"sourceNode":"Optimisation of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors","targetNode":"036-668-261-470-040","value":2},{"sourceNode":"Optimisation of 6-substituted isoquinolin-1-amine based ROCK-I inhibitors","targetNode":"183-767-289-461-131","value":2},{"sourceNode":"Design, Synthesis and Biological Evaluation of Novel Inhibitors of Trypanosoma brucei Pteridine Reductase 1","targetNode":"107-556-164-321-147","value":2},{"sourceNode":"The inhibitory effect of phospholemman on the sodium pump requires its palmitoylation.","targetNode":"106-594-488-484-12X","value":2},{"sourceNode":"SCF/β-TrCP promotes glycogen synthase kinase 3-dependent degradation of the Nrf2 transcription factor in a keap1-independent manner","targetNode":"066-190-726-252-149","value":2},{"sourceNode":"Immunosuppressive but Non-LasR-Inducing Analogues of the Pseudomonas aeruginosa Quorum-Sensing Molecule N-(3-Oxododecanoyl)-L-homoserine Lactone","targetNode":"140-900-012-438-14X","value":2},{"sourceNode":"Absolute SILAC-Compatible Expression Strain Allows Sumo-2 Copy Number Determination in Clinical Samples","targetNode":"058-438-690-312-096","value":2},{"sourceNode":"Absolute SILAC-Compatible Expression Strain Allows Sumo-2 Copy Number Determination in Clinical Samples","targetNode":"004-889-112-130-518","value":2},{"sourceNode":"Collateral sensitivity of multidrug-resistant cells to the orphan drug tiopronin.","targetNode":"193-040-307-473-220","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"188-718-220-131-362","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"087-577-350-425-176","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"191-670-060-004-126","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"188-803-921-043-695","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"041-699-843-843-567","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"180-366-233-781-99X","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"156-653-831-632-101","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"051-324-518-696-462","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"161-487-188-181-03X","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"167-851-091-520-257","value":2},{"sourceNode":"Characterization of a selective inhibitor of the Parkinson\'s disease kinase LRRK2","targetNode":"122-739-962-072-793","value":2},{"sourceNode":"ATP site-directed inhibitors of protein kinase CK2: an update.","targetNode":"109-274-898-147-341","value":2},{"sourceNode":"Identification of Inhibitors of the Leishmania cdc2-Related Protein Kinase CRK3","targetNode":"124-179-501-005-870","value":2},{"sourceNode":"Identification of Inhibitors of the Leishmania cdc2-Related Protein Kinase CRK3","targetNode":"008-694-981-426-172","value":2},{"sourceNode":"Identification of Inhibitors of the Leishmania cdc2-Related Protein Kinase CRK3","targetNode":"109-611-546-954-080","value":2},{"sourceNode":"Polyubiquitin binding to optineurin is required for optimal activation of TANK-binding kinase 1 and production of interferon β.","targetNode":"004-378-254-734-355","value":2},{"sourceNode":"Polyubiquitin binding to optineurin is required for optimal activation of TANK-binding kinase 1 and production of interferon β.","targetNode":"133-997-520-845-569","value":2},{"sourceNode":"Substrate and Product Analogues as Human O-Glcnac Transferase Inhibitors.","targetNode":"115-381-943-359-61X","value":2},{"sourceNode":"Substrate and Product Analogues as Human O-Glcnac Transferase Inhibitors.","targetNode":"022-078-711-389-998","value":2},{"sourceNode":"Substrate and Product Analogues as Human O-Glcnac Transferase Inhibitors.","targetNode":"132-854-391-972-865","value":2},{"sourceNode":"Substrate and Product Analogues as Human O-Glcnac Transferase Inhibitors.","targetNode":"171-143-110-884-468","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"003-946-199-636-328","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"009-649-401-227-606","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"170-042-571-881-121","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"033-301-273-471-462","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"040-826-560-477-838","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"048-208-660-423-215","value":2},{"sourceNode":"The cytoprotective role of the Keap1–Nrf2 pathway","targetNode":"135-293-472-746-415","value":2},{"sourceNode":"Design, synthesis and biological evaluation of 6-pyridylmethylaminopurines as CDK inhibitors","targetNode":"153-999-081-812-523","value":2},{"sourceNode":"Design, synthesis and biological evaluation of 6-pyridylmethylaminopurines as CDK inhibitors","targetNode":"000-498-778-953-787","value":2},{"sourceNode":"Design, synthesis and biological evaluation of 6-pyridylmethylaminopurines as CDK inhibitors","targetNode":"085-065-777-135-758","value":2},{"sourceNode":"Analgesic omega-Conotoxins CVIE and CVIF Selectively and Voltage-Dependently Block Recombinant and Native N-Type Calcium Channels (vol 77, pg 139, 2010)","targetNode":"152-366-692-522-975","value":2},{"sourceNode":"Analgesic omega-Conotoxins CVIE and CVIF Selectively and Voltage-Dependently Block Recombinant and Native N-Type Calcium Channels (vol 77, pg 139, 2010)","targetNode":"167-869-142-610-582","value":2},{"sourceNode":"NF-κB controls energy homeostasis and metabolic adaptation by upregulating mitochondrial respiration","targetNode":"191-676-336-200-724","value":2},{"sourceNode":"Development of 18F-fluorinatable dendrons and their application to cancer cell targeting","targetNode":"056-387-403-639-935","value":2},{"sourceNode":"The specificities of small molecule inhibitors of the TGFß and BMP pathways","targetNode":"066-841-401-628-941","value":2},{"sourceNode":"The specificities of small molecule inhibitors of the TGFß and BMP pathways","targetNode":"069-503-782-573-055","value":2},{"sourceNode":"The specificities of small molecule inhibitors of the TGFß and BMP pathways","targetNode":"028-137-796-142-577","value":2},{"sourceNode":"Catalysis by the nucleolytic ribozymes","targetNode":"197-678-301-596-236","value":2},{"sourceNode":"Catalysis by the nucleolytic ribozymes","targetNode":"147-466-934-435-143","value":2},{"sourceNode":"Catalysis by the nucleolytic ribozymes","targetNode":"114-647-123-099-321","value":2},{"sourceNode":"Catalysis by the nucleolytic ribozymes","targetNode":"058-829-130-504-901","value":2},{"sourceNode":"Catalysis by the nucleolytic ribozymes","targetNode":"169-953-034-717-264","value":2},{"sourceNode":"Characterization of GSK2334470, a novel and highly specific inhibitor of PDK1","targetNode":"028-012-588-449-727","value":2},{"sourceNode":"Characterization of GSK2334470, a novel and highly specific inhibitor of PDK1","targetNode":"038-839-140-589-623","value":2},{"sourceNode":"N1-Benzyl substituted cambinol analogues as isozyme selective inhibitors of the sirtuin family of protein deacetylases","targetNode":"194-924-906-201-593","value":2},{"sourceNode":"N1-Benzyl substituted cambinol analogues as isozyme selective inhibitors of the sirtuin family of protein deacetylases","targetNode":"195-611-964-620-410","value":2},{"sourceNode":"N1-Benzyl substituted cambinol analogues as isozyme selective inhibitors of the sirtuin family of protein deacetylases","targetNode":"025-014-524-538-421","value":2},{"sourceNode":"N1-Benzyl substituted cambinol analogues as isozyme selective inhibitors of the sirtuin family of protein deacetylases","targetNode":"025-014-524-538-421","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"120-667-268-642-909","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"163-117-320-460-138","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"191-290-593-697-506","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"118-339-847-530-982","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"073-318-370-112-877","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"113-828-920-381-078","value":2},{"sourceNode":"AMP-activated protein kinase—an energy sensor that regulates all aspects of cell function","targetNode":"048-983-957-537-421","value":2},{"sourceNode":"Optimisation of the Anti-Trypanosoma brucei Activity of the Opioid Agonist U50488","targetNode":"073-531-962-083-670","value":2}]')},Jc={nodes:[{id:"external",template:{rendererOptions:{backgroundColor:"#00594E",textColor:"#ffffff"}}},{id:"thing",template:{shape:{id:"circle",radius:30},rendererOptions:{backgroundColor:"#00AE8D",textColor:"#ffffff"}}},{id:"class",template:{rendererOptions:{backgroundColor:"#ffffff",textColor:"#000000"}}},{id:"literal",template:{shape:{id:"rectangle",width:60,height:20},rendererOptions:{backgroundColor:"#9DD4CA",textColor:"#ffffff"}}},{id:"largeliteral",template:{shape:{id:"rectangle",width:160,height:40},rendererOptions:{backgroundColor:"#9DD4CA",textColor:"#ffffff"}}},{id:"equivalent",template:{rendererOptions:{backgroundColor:"#ffffff",textColor:"#000000"}}}],edges:[{id:"relation",template:{rendererOptions:{dotted:!0,labelTextColor:"#000000",labelBackgroundColor:"#E6E7E8",isInteractive:!0}}},{id:"attribute",template:{visibleDistance:120,rendererOptions:{labelTextColor:"#ffffff",labelBackgroundColor:"#7B868C",isInteractive:!0}}}]},Qc=[{id:"n0",rendererOptions:{label:"panda",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"},template:"external"},{id:"n1",rendererOptions:{label:"Thing"},template:"thing"},{id:"n2",rendererOptions:{label:"Person"},template:"equivalent"},{id:"n3",rendererOptions:{label:"A very very very very very very very very long name",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"},template:"largeliteral"},{id:"n4",rendererOptions:{label:"Literal"},template:"literal"},{id:"n5",rendererOptions:{label:"Literal"},template:"literal"},{id:"n6",rendererOptions:{label:"Literal"},template:"literal"},{id:"n7",rendererOptions:{label:"Literal"},template:"literal"},{id:"n8",rendererOptions:{label:"Literal"},template:"literal"},{id:"n9",rendererOptions:{label:"Literal"},template:"literal"},{id:"n10",rendererOptions:{label:"Spatial Thing"},template:"external"},{id:"n11",rendererOptions:{label:"Literal"},template:"literal"},{id:"n12",rendererOptions:{label:"Thing"},template:"thing"},{id:"n13",rendererOptions:{label:"Image"},template:"equivalent"},{id:"n14",rendererOptions:{label:"Thing"},template:"thing"},{id:"n15",rendererOptions:{label:"Document"},template:"equivalent"},{id:"n16",rendererOptions:{label:"PersonalProfileDocument"},template:"class"},{id:"n17",rendererOptions:{label:"Agent"},template:"equivalent"},{id:"n18",rendererOptions:{label:"Thing"},template:"thing"},{id:"n19",rendererOptions:{label:"Online Account"},template:"class"},{id:"n20",rendererOptions:{label:"Online Chat Account"},template:"class"},{id:"n21",rendererOptions:{label:"Online E-commerce account"},template:"class"},{id:"n22",rendererOptions:{label:"Online Gaming Account",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"},template:"class"},{id:"n23",rendererOptions:{label:"Literal"},template:"literal"},{id:"n24",rendererOptions:{label:"Literal"},template:"literal"},{id:"n25",rendererOptions:{label:"Literal"},template:"literal"},{id:"n26",rendererOptions:{label:"Literal"},template:"literal"},{id:"n27",rendererOptions:{label:"Literal"},template:"literal"},{id:"n28",rendererOptions:{label:"Literal"},template:"literal"},{id:"n29",rendererOptions:{label:"Thing"},template:"thing"},{id:"n30",rendererOptions:{label:"Group"},template:"class"},{id:"n31",rendererOptions:{label:"Project"},template:"class"},{id:"n32",rendererOptions:{label:"Literal"},template:"literal"},{id:"n33",rendererOptions:{label:"Organization"},template:"class"},{id:"n34",rendererOptions:{label:"Label Property"},template:"class"},{id:"n35",rendererOptions:{label:"Thing"},template:"thing"},{id:"n36",rendererOptions:{label:"Literal"},template:"literal"},{id:"n37",rendererOptions:{label:"Literal"},template:"literal"},{id:"n38",rendererOptions:{label:"Literal"},template:"literal"},{id:"n39",rendererOptions:{label:"Literal"},template:"literal"},{id:"n40",rendererOptions:{label:"Literal"},template:"literal"},{id:"n41",rendererOptions:{label:"Literal"},template:"literal"},{id:"n42",rendererOptions:{label:"Literal"},template:"literal"},{id:"n43",rendererOptions:{label:"Literal"},template:"literal"},{id:"n44",rendererOptions:{label:"Literal"},template:"literal"},{id:"n45",rendererOptions:{label:"Literal"},template:"literal"},{id:"n46",rendererOptions:{label:"Literal"},template:"literal"},{id:"n47",rendererOptions:{label:"DEFAULT NODE"}}],ep=[{sourceNode:"n0",targetNode:"n1",rendererOptions:{label:"focus"}},{sourceNode:"n2",targetNode:"n3",rendererOptions:{label:"lastName"},template:"attribute"},{sourceNode:"n2",targetNode:"n4",rendererOptions:{label:"geekcode"},template:"attribute"},{sourceNode:"n2",targetNode:"n5",rendererOptions:{label:"familyName"},template:"attribute"},{sourceNode:"n2",targetNode:"n4",rendererOptions:{label:"family_name"},template:"attribute"},{sourceNode:"n2",targetNode:"n6",rendererOptions:{label:"firstName"},template:"attribute"},{sourceNode:"n2",targetNode:"n7",rendererOptions:{label:"myersBriggs"},template:"attribute"},{sourceNode:"n2",targetNode:"n8",rendererOptions:{label:"plan"},template:"attribute"},{sourceNode:"n2",targetNode:"n9",rendererOptions:{label:"Surname"},template:"attribute"},{sourceNode:"n2",targetNode:"n10",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n10",targetNode:"n10",rendererOptions:{label:"basedNear"}},{sourceNode:"n17",targetNode:"n11",rendererOptions:{label:"jabber ID"},template:"attribute"},{sourceNode:"n2",targetNode:"n12",rendererOptions:{label:"past project"}},{sourceNode:"n2",targetNode:"n12",rendererOptions:{label:"current project"}},{sourceNode:"n2",targetNode:"n13",rendererOptions:{label:"image"}},{sourceNode:"n13",targetNode:"n13",rendererOptions:{label:"thumbnail"}},{sourceNode:"n13",targetNode:"n14",rendererOptions:{label:"depicts / depiction"}},{sourceNode:"n2",targetNode:"n15",rendererOptions:{label:"workplace homepage"}},{sourceNode:"n2",targetNode:"n15",rendererOptions:{label:"work info homepage"}},{sourceNode:"n2",targetNode:"n15",rendererOptions:{label:"publications"}},{sourceNode:"n2",targetNode:"n15",rendererOptions:{label:"schoolHomepage"}},{sourceNode:"n13",targetNode:"n15",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n16",targetNode:"n15",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n2",targetNode:"n2",rendererOptions:{label:"knows"}},{sourceNode:"n2",targetNode:"n17",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n17",targetNode:"n15",rendererOptions:{label:"interest"}},{sourceNode:"n17",targetNode:"n15",rendererOptions:{label:"tipjar"}},{sourceNode:"n17",targetNode:"n15",rendererOptions:{label:"weblog"}},{sourceNode:"n17",targetNode:"n15",rendererOptions:{label:"openid"}},{sourceNode:"n18",targetNode:"n15",rendererOptions:{label:"homepage"}},{sourceNode:"n18",targetNode:"n15",rendererOptions:{label:"page / topic"}},{sourceNode:"n18",targetNode:"n15",rendererOptions:{label:"is primary topic of / primary topic"}},{sourceNode:"n15",targetNode:"n42",rendererOptions:{label:"sha1sum (hex)"},template:"attribute"},{sourceNode:"n19",targetNode:"n15",rendererOptions:{label:"account service homepage"}},{sourceNode:"n20",targetNode:"n19",template:"relation",rendererOptions:{label:"Subclass of",markerSource:"arrow",markerTarget:"hollowArrow"}},{sourceNode:"n21",targetNode:"n19",template:"relation",rendererOptions:{label:"Subclass of",markerSource:"arrow",markerTarget:"hollowArrow"}},{sourceNode:"n22",targetNode:"n19",template:"relation",rendererOptions:{label:"Subclass of",markerSource:"arrow",markerTarget:"hollowArrow"}},{sourceNode:"n19",targetNode:"n32",rendererOptions:{label:"account name"},template:"attribute"},{sourceNode:"n30",targetNode:"n17",rendererOptions:{label:"member"}},{sourceNode:"n30",targetNode:"n17",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n17",targetNode:"n23",rendererOptions:{label:"age"},template:"attribute"},{sourceNode:"n17",targetNode:"n24",rendererOptions:{label:"birthday"},template:"attribute"},{sourceNode:"n17",targetNode:"n25",rendererOptions:{label:"gender"},template:"attribute"},{sourceNode:"n17",targetNode:"n26",rendererOptions:{label:"status"},template:"attribute"},{sourceNode:"n17",targetNode:"n27",rendererOptions:{label:"sha1sunm of a personal mailbox URI name"},template:"attribute"},{sourceNode:"n17",targetNode:"n28",rendererOptions:{label:"AIM chat ID"},template:"attribute"},{sourceNode:"n17",targetNode:"n43",rendererOptions:{label:"ICQ chat ID"},template:"attribute"},{sourceNode:"n17",targetNode:"n44",rendererOptions:{label:"Yahoo chat ID"},template:"attribute"},{sourceNode:"n17",targetNode:"n45",rendererOptions:{label:"MSN chat ID"},template:"attribute"},{sourceNode:"n17",targetNode:"n29",rendererOptions:{label:"made / maker"}},{sourceNode:"n17",targetNode:"n29",rendererOptions:{label:"personal mailbox"}},{sourceNode:"n17",targetNode:"n29",rendererOptions:{label:"topic_interest"}},{sourceNode:"n33",targetNode:"n17",template:"relation",rendererOptions:{label:"Subclass of"}},{sourceNode:"n17",targetNode:"n19",rendererOptions:{label:"account"}},{sourceNode:"n35",targetNode:"n35",rendererOptions:{label:"phone"}},{sourceNode:"n35",targetNode:"n35",rendererOptions:{label:"funded by"}},{sourceNode:"n35",targetNode:"n35",rendererOptions:{label:"Logo"}},{sourceNode:"n35",targetNode:"n35",rendererOptions:{label:"theme"}},{sourceNode:"n35",targetNode:"n36",rendererOptions:{label:"DNA checksum"},template:"attribute"},{sourceNode:"n35",targetNode:"n37",rendererOptions:{label:"Given name"},template:"attribute"},{sourceNode:"n35",targetNode:"n38",rendererOptions:{label:"nickname"},template:"attribute"},{sourceNode:"n17",targetNode:"n41",rendererOptions:{label:"Skype ID"},template:"attribute"},{sourceNode:"n35",targetNode:"n39",rendererOptions:{label:"title"},template:"attribute"},{sourceNode:"n35",targetNode:"n40",rendererOptions:{label:"name"},template:"attribute"},{sourceNode:"n17",targetNode:"n19",rendererOptions:{label:"account"}}],tp={nodes:[{id:"n0",shape:{id:"circle",radius:30},mass:1e3},{id:"n1",shape:{id:"circle",radius:50},mass:1e3,rendererOptions:{label:"Helloooooooooooooooooooooooooooooooo World",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"}},{id:"n2",shape:{id:"circle",radius:30},mass:1e3,rendererOptions:{label:"Hello World",backgroundColor:"#00AE8D",textColor:"#FFFFFF"}},{id:"n3",shape:{id:"circle",radius:30},mass:1e3,rendererOptions:{label:"Hello World",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"}},{id:"n4",shape:{id:"circle",radius:30},mass:1e3,rendererOptions:{label:"Hello World"}},{id:"n5",shape:{id:"circle",radius:30},mass:1e3,rendererOptions:{label:"Hello World"}},{id:"n6",shape:{id:"circle",radius:30},mass:1e3,rendererOptions:{label:"Hello World"}},{id:"n7",shape:{id:"circle",radius:30},mass:1e3},{id:"n8",shape:{id:"rectangle",width:200,height:70},mass:1e3,rendererOptions:{label:"Helloooooooooooooooooooooooooooooooooooooooooooo",shape:"rectangle",icon:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 16 16'><path fill='%237c7c7c' fill-rule='evenodd' d='M6.5 0a6.5 6.5 0 0 1 5.25 10.334l3.957 3.959a1 1 0 0 1-1.414 1.414l-3.96-3.957A6.5 6.5 0 1 1 6.5 0zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9z'/></svg>"}}],edges:[{sourceNode:"n0",targetNode:"n1",visibleDistance:100,rendererOptions:{color:"#00594E",label:"Hello World!!!!"}},{sourceNode:"n0",targetNode:"n2",visibleDistance:100},{sourceNode:"n1",targetNode:"n3",visibleDistance:100},{sourceNode:"n1",targetNode:"n4",visibleDistance:100},{sourceNode:"n2",targetNode:"n5",visibleDistance:100},{sourceNode:"n2",targetNode:"n6",visibleDistance:100},{sourceNode:"n6",targetNode:"n7",visibleDistance:100},{sourceNode:"n6",targetNode:"n7",visibleDistance:100},{sourceNode:"n7",targetNode:"n7",visibleDistance:100,rendererOptions:{labelBackgroundColor:"#00ffff",isInteractive:!0,color:"#00594E",label:"Hello World!!!!"}},{sourceNode:"n7",targetNode:"n7",visibleDistance:100,rendererOptions:{color:"#00594E",label:"Hello World!!!!"}},{sourceNode:"n0",targetNode:"n8",visibleDistance:100,rendererOptions:{isInteractive:!0,color:"#00594E",label:"Hello World!!!!"}}]},ip={templates:{nodes:[{id:1,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#ed4242"}}},{id:2,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#f87213"}}},{id:3,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#f39e08"}}},{id:4,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#f39c0a"}}},{id:5,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#82ca12"}}},{id:6,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#0fb97f"}}},{id:7,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#0fb780"}}},{id:8,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#0fb8a4"}}},{id:9,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#07b4d3"}}},{id:10,template:{rendererOptions:{textColor:"#ffffff",backgroundColor:"#0fa2e7"}}}],edges:[{id:1,template:{visibleDistance:400}}]},nodes:[{id:"Myriel",template:1},{id:"Napoleon",template:1},{id:"Mlle.Baptistine",template:1},{id:"Mme.Magloire",template:1},{id:"CountessdeLo",template:1},{id:"Geborand",template:1},{id:"Champtercier",template:1},{id:"Cravatte",template:1},{id:"Count",template:1},{id:"OldMan",template:1},{id:"Labarre",template:2},{id:"Valjean",template:2},{id:"Marguerite",template:3},{id:"Mme.deR",template:2},{id:"Isabeau",template:2},{id:"Gervais",template:2},{id:"Tholomyes",template:3},{id:"Listolier",template:3},{id:"Fameuil",template:3},{id:"Blacheville",template:3},{id:"Favourite",template:3},{id:"Dahlia",template:3},{id:"Zephine",template:3},{id:"Fantine",template:3},{id:"Mme.Thenardier",template:4},{id:"Thenardier",template:4},{id:"Cosette",template:5},{id:"Javert",template:4},{id:"Fauchelevent",template:0},{id:"Bamatabois",template:2},{id:"Perpetue",template:3},{id:"Simplice",template:2},{id:"Scaufflaire",template:2},{id:"Woman1",template:2},{id:"Judge",template:2},{id:"Champmathieu",template:2},{id:"Brevet",template:2},{id:"Chenildieu",template:2},{id:"Cochepaille",template:2},{id:"Pontmercy",template:4},{id:"Boulatruelle",template:6},{id:"Eponine",template:4},{id:"Anzelma",template:4},{id:"Woman2",template:5},{id:"MotherInnocent",template:0},{id:"Gribier",template:0},{id:"Jondrette",template:7},{id:"Mme.Burgon",template:7},{id:"Gavroche",template:8},{id:"Gillenormand",template:5},{id:"Magnon",template:5},{id:"Mlle.Gillenormand",template:5},{id:"Mme.Pontmercy",template:5},{id:"Mlle.Vaubois",template:5},{id:"Lt.Gillenormand",template:5},{id:"Marius",template:8},{id:"BaronessT",template:5},{id:"Mabeuf",template:8},{id:"Enjolras",template:8},{id:"Combeferre",template:8},{id:"Prouvaire",template:8},{id:"Feuilly",template:8},{id:"Courfeyrac",template:8},{id:"Bahorel",template:8},{id:"Bossuet",template:8},{id:"Joly",template:8},{id:"Grantaire",template:8},{id:"MotherPlutarch",template:9},{id:"Gueulemer",template:4},{id:"Babet",template:4},{id:"Claquesous",template:4},{id:"Montparnasse",template:4},{id:"Toussaint",template:5},{id:"Child1",template:10},{id:"Child2",template:10},{id:"Brujon",template:4},{id:"Mme.Hucheloup",template:8}],edges:JSON.parse('[{"template":1,"sourceNode":"Napoleon","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Mlle.Baptistine","targetNode":"Myriel","weight":8},{"template":1,"sourceNode":"Mme.Magloire","targetNode":"Myriel","weight":10},{"template":1,"sourceNode":"Mme.Magloire","targetNode":"Mlle.Baptistine","weight":6},{"template":1,"sourceNode":"CountessdeLo","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Geborand","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Champtercier","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Cravatte","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Count","targetNode":"Myriel","weight":2},{"template":1,"sourceNode":"OldMan","targetNode":"Myriel","weight":1},{"template":1,"sourceNode":"Valjean","targetNode":"Labarre","weight":1},{"template":1,"sourceNode":"Valjean","targetNode":"Mme.Magloire","weight":3},{"template":1,"sourceNode":"Valjean","targetNode":"Mlle.Baptistine","weight":3},{"template":1,"sourceNode":"Valjean","targetNode":"Myriel","weight":5},{"template":1,"sourceNode":"Marguerite","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Mme.deR","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Isabeau","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Gervais","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Listolier","targetNode":"Tholomyes","weight":4},{"template":1,"sourceNode":"Fameuil","targetNode":"Tholomyes","weight":4},{"template":1,"sourceNode":"Fameuil","targetNode":"Listolier","weight":4},{"template":1,"sourceNode":"Blacheville","targetNode":"Tholomyes","weight":4},{"template":1,"sourceNode":"Blacheville","targetNode":"Listolier","weight":4},{"template":1,"sourceNode":"Blacheville","targetNode":"Fameuil","weight":4},{"template":1,"sourceNode":"Favourite","targetNode":"Tholomyes","weight":3},{"template":1,"sourceNode":"Favourite","targetNode":"Listolier","weight":3},{"template":1,"sourceNode":"Favourite","targetNode":"Fameuil","weight":3},{"template":1,"sourceNode":"Favourite","targetNode":"Blacheville","weight":4},{"template":1,"sourceNode":"Dahlia","targetNode":"Tholomyes","weight":3},{"template":1,"sourceNode":"Dahlia","targetNode":"Listolier","weight":3},{"template":1,"sourceNode":"Dahlia","targetNode":"Fameuil","weight":3},{"template":1,"sourceNode":"Dahlia","targetNode":"Blacheville","weight":3},{"template":1,"sourceNode":"Dahlia","targetNode":"Favourite","weight":5},{"template":1,"sourceNode":"Zephine","targetNode":"Tholomyes","weight":3},{"template":1,"sourceNode":"Zephine","targetNode":"Listolier","weight":3},{"template":1,"sourceNode":"Zephine","targetNode":"Fameuil","weight":3},{"template":1,"sourceNode":"Zephine","targetNode":"Blacheville","weight":3},{"template":1,"sourceNode":"Zephine","targetNode":"Favourite","weight":4},{"template":1,"sourceNode":"Zephine","targetNode":"Dahlia","weight":4},{"template":1,"sourceNode":"Fantine","targetNode":"Tholomyes","weight":3},{"template":1,"sourceNode":"Fantine","targetNode":"Listolier","weight":3},{"template":1,"sourceNode":"Fantine","targetNode":"Fameuil","weight":3},{"template":1,"sourceNode":"Fantine","targetNode":"Blacheville","weight":3},{"template":1,"sourceNode":"Fantine","targetNode":"Favourite","weight":4},{"template":1,"sourceNode":"Fantine","targetNode":"Dahlia","weight":4},{"template":1,"sourceNode":"Fantine","targetNode":"Zephine","weight":4},{"template":1,"sourceNode":"Fantine","targetNode":"Marguerite","weight":2},{"template":1,"sourceNode":"Fantine","targetNode":"Valjean","weight":9},{"template":1,"sourceNode":"Mme.Thenardier","targetNode":"Fantine","weight":2},{"template":1,"sourceNode":"Mme.Thenardier","targetNode":"Valjean","weight":7},{"template":1,"sourceNode":"Thenardier","targetNode":"Mme.Thenardier","weight":13},{"template":1,"sourceNode":"Thenardier","targetNode":"Fantine","weight":1},{"template":1,"sourceNode":"Thenardier","targetNode":"Valjean","weight":12},{"template":1,"sourceNode":"Cosette","targetNode":"Mme.Thenardier","weight":4},{"template":1,"sourceNode":"Cosette","targetNode":"Valjean","weight":31},{"template":1,"sourceNode":"Cosette","targetNode":"Tholomyes","weight":1},{"template":1,"sourceNode":"Cosette","targetNode":"Thenardier","weight":1},{"template":1,"sourceNode":"Javert","targetNode":"Valjean","weight":17},{"template":1,"sourceNode":"Javert","targetNode":"Fantine","weight":5},{"template":1,"sourceNode":"Javert","targetNode":"Thenardier","weight":5},{"template":1,"sourceNode":"Javert","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Javert","targetNode":"Cosette","weight":1},{"template":1,"sourceNode":"Fauchelevent","targetNode":"Valjean","weight":8},{"template":1,"sourceNode":"Fauchelevent","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Bamatabois","targetNode":"Fantine","weight":1},{"template":1,"sourceNode":"Bamatabois","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Bamatabois","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Perpetue","targetNode":"Fantine","weight":1},{"template":1,"sourceNode":"Simplice","targetNode":"Perpetue","weight":2},{"template":1,"sourceNode":"Simplice","targetNode":"Valjean","weight":3},{"template":1,"sourceNode":"Simplice","targetNode":"Fantine","weight":2},{"template":1,"sourceNode":"Simplice","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Scaufflaire","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Woman1","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Woman1","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Judge","targetNode":"Valjean","weight":3},{"template":1,"sourceNode":"Judge","targetNode":"Bamatabois","weight":2},{"template":1,"sourceNode":"Champmathieu","targetNode":"Valjean","weight":3},{"template":1,"sourceNode":"Champmathieu","targetNode":"Judge","weight":3},{"template":1,"sourceNode":"Champmathieu","targetNode":"Bamatabois","weight":2},{"template":1,"sourceNode":"Brevet","targetNode":"Judge","weight":2},{"template":1,"sourceNode":"Brevet","targetNode":"Champmathieu","weight":2},{"template":1,"sourceNode":"Brevet","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Brevet","targetNode":"Bamatabois","weight":1},{"template":1,"sourceNode":"Chenildieu","targetNode":"Judge","weight":2},{"template":1,"sourceNode":"Chenildieu","targetNode":"Champmathieu","weight":2},{"template":1,"sourceNode":"Chenildieu","targetNode":"Brevet","weight":2},{"template":1,"sourceNode":"Chenildieu","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Chenildieu","targetNode":"Bamatabois","weight":1},{"template":1,"sourceNode":"Cochepaille","targetNode":"Judge","weight":2},{"template":1,"sourceNode":"Cochepaille","targetNode":"Champmathieu","weight":2},{"template":1,"sourceNode":"Cochepaille","targetNode":"Brevet","weight":2},{"template":1,"sourceNode":"Cochepaille","targetNode":"Chenildieu","weight":2},{"template":1,"sourceNode":"Cochepaille","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Cochepaille","targetNode":"Bamatabois","weight":1},{"template":1,"sourceNode":"Pontmercy","targetNode":"Thenardier","weight":1},{"template":1,"sourceNode":"Boulatruelle","targetNode":"Thenardier","weight":1},{"template":1,"sourceNode":"Eponine","targetNode":"Mme.Thenardier","weight":2},{"template":1,"sourceNode":"Eponine","targetNode":"Thenardier","weight":3},{"template":1,"sourceNode":"Anzelma","targetNode":"Eponine","weight":2},{"template":1,"sourceNode":"Anzelma","targetNode":"Thenardier","weight":2},{"template":1,"sourceNode":"Anzelma","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Woman2","targetNode":"Valjean","weight":3},{"template":1,"sourceNode":"Woman2","targetNode":"Cosette","weight":1},{"template":1,"sourceNode":"Woman2","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"MotherInnocent","targetNode":"Fauchelevent","weight":3},{"template":1,"sourceNode":"MotherInnocent","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Gribier","targetNode":"Fauchelevent","weight":2},{"template":1,"sourceNode":"Mme.Burgon","targetNode":"Jondrette","weight":1},{"template":1,"sourceNode":"Gavroche","targetNode":"Mme.Burgon","weight":2},{"template":1,"sourceNode":"Gavroche","targetNode":"Thenardier","weight":1},{"template":1,"sourceNode":"Gavroche","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Gavroche","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Gillenormand","targetNode":"Cosette","weight":3},{"template":1,"sourceNode":"Gillenormand","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Magnon","targetNode":"Gillenormand","weight":1},{"template":1,"sourceNode":"Magnon","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Mlle.Gillenormand","targetNode":"Gillenormand","weight":9},{"template":1,"sourceNode":"Mlle.Gillenormand","targetNode":"Cosette","weight":2},{"template":1,"sourceNode":"Mlle.Gillenormand","targetNode":"Valjean","weight":2},{"template":1,"sourceNode":"Mme.Pontmercy","targetNode":"Mlle.Gillenormand","weight":1},{"template":1,"sourceNode":"Mme.Pontmercy","targetNode":"Pontmercy","weight":1},{"template":1,"sourceNode":"Mlle.Vaubois","targetNode":"Mlle.Gillenormand","weight":1},{"template":1,"sourceNode":"Lt.Gillenormand","targetNode":"Mlle.Gillenormand","weight":2},{"template":1,"sourceNode":"Lt.Gillenormand","targetNode":"Gillenormand","weight":1},{"template":1,"sourceNode":"Lt.Gillenormand","targetNode":"Cosette","weight":1},{"template":1,"sourceNode":"Marius","targetNode":"Mlle.Gillenormand","weight":6},{"template":1,"sourceNode":"Marius","targetNode":"Gillenormand","weight":12},{"template":1,"sourceNode":"Marius","targetNode":"Pontmercy","weight":1},{"template":1,"sourceNode":"Marius","targetNode":"Lt.Gillenormand","weight":1},{"template":1,"sourceNode":"Marius","targetNode":"Cosette","weight":21},{"template":1,"sourceNode":"Marius","targetNode":"Valjean","weight":19},{"template":1,"sourceNode":"Marius","targetNode":"Tholomyes","weight":1},{"template":1,"sourceNode":"Marius","targetNode":"Thenardier","weight":2},{"template":1,"sourceNode":"Marius","targetNode":"Eponine","weight":5},{"template":1,"sourceNode":"Marius","targetNode":"Gavroche","weight":4},{"template":1,"sourceNode":"BaronessT","targetNode":"Gillenormand","weight":1},{"template":1,"sourceNode":"BaronessT","targetNode":"Marius","weight":1},{"template":1,"sourceNode":"Mabeuf","targetNode":"Marius","weight":1},{"template":1,"sourceNode":"Mabeuf","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Mabeuf","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Enjolras","targetNode":"Marius","weight":7},{"template":1,"sourceNode":"Enjolras","targetNode":"Gavroche","weight":7},{"template":1,"sourceNode":"Enjolras","targetNode":"Javert","weight":6},{"template":1,"sourceNode":"Enjolras","targetNode":"Mabeuf","weight":1},{"template":1,"sourceNode":"Enjolras","targetNode":"Valjean","weight":4},{"template":1,"sourceNode":"Combeferre","targetNode":"Enjolras","weight":15},{"template":1,"sourceNode":"Combeferre","targetNode":"Marius","weight":5},{"template":1,"sourceNode":"Combeferre","targetNode":"Gavroche","weight":6},{"template":1,"sourceNode":"Combeferre","targetNode":"Mabeuf","weight":2},{"template":1,"sourceNode":"Prouvaire","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Prouvaire","targetNode":"Enjolras","weight":4},{"template":1,"sourceNode":"Prouvaire","targetNode":"Combeferre","weight":2},{"template":1,"sourceNode":"Feuilly","targetNode":"Gavroche","weight":2},{"template":1,"sourceNode":"Feuilly","targetNode":"Enjolras","weight":6},{"template":1,"sourceNode":"Feuilly","targetNode":"Prouvaire","weight":2},{"template":1,"sourceNode":"Feuilly","targetNode":"Combeferre","weight":5},{"template":1,"sourceNode":"Feuilly","targetNode":"Mabeuf","weight":1},{"template":1,"sourceNode":"Feuilly","targetNode":"Marius","weight":1},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Marius","weight":9},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Enjolras","weight":17},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Combeferre","weight":13},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Gavroche","weight":7},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Mabeuf","weight":2},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Feuilly","weight":6},{"template":1,"sourceNode":"Courfeyrac","targetNode":"Prouvaire","weight":3},{"template":1,"sourceNode":"Bahorel","targetNode":"Combeferre","weight":5},{"template":1,"sourceNode":"Bahorel","targetNode":"Gavroche","weight":5},{"template":1,"sourceNode":"Bahorel","targetNode":"Courfeyrac","weight":6},{"template":1,"sourceNode":"Bahorel","targetNode":"Mabeuf","weight":2},{"template":1,"sourceNode":"Bahorel","targetNode":"Enjolras","weight":4},{"template":1,"sourceNode":"Bahorel","targetNode":"Feuilly","weight":3},{"template":1,"sourceNode":"Bahorel","targetNode":"Prouvaire","weight":2},{"template":1,"sourceNode":"Bahorel","targetNode":"Marius","weight":1},{"template":1,"sourceNode":"Bossuet","targetNode":"Marius","weight":5},{"template":1,"sourceNode":"Bossuet","targetNode":"Courfeyrac","weight":12},{"template":1,"sourceNode":"Bossuet","targetNode":"Gavroche","weight":5},{"template":1,"sourceNode":"Bossuet","targetNode":"Bahorel","weight":4},{"template":1,"sourceNode":"Bossuet","targetNode":"Enjolras","weight":10},{"template":1,"sourceNode":"Bossuet","targetNode":"Feuilly","weight":6},{"template":1,"sourceNode":"Bossuet","targetNode":"Prouvaire","weight":2},{"template":1,"sourceNode":"Bossuet","targetNode":"Combeferre","weight":9},{"template":1,"sourceNode":"Bossuet","targetNode":"Mabeuf","weight":1},{"template":1,"sourceNode":"Bossuet","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Joly","targetNode":"Bahorel","weight":5},{"template":1,"sourceNode":"Joly","targetNode":"Bossuet","weight":7},{"template":1,"sourceNode":"Joly","targetNode":"Gavroche","weight":3},{"template":1,"sourceNode":"Joly","targetNode":"Courfeyrac","weight":5},{"template":1,"sourceNode":"Joly","targetNode":"Enjolras","weight":5},{"template":1,"sourceNode":"Joly","targetNode":"Feuilly","weight":5},{"template":1,"sourceNode":"Joly","targetNode":"Prouvaire","weight":2},{"template":1,"sourceNode":"Joly","targetNode":"Combeferre","weight":5},{"template":1,"sourceNode":"Joly","targetNode":"Mabeuf","weight":1},{"template":1,"sourceNode":"Joly","targetNode":"Marius","weight":2},{"template":1,"sourceNode":"Grantaire","targetNode":"Bossuet","weight":3},{"template":1,"sourceNode":"Grantaire","targetNode":"Enjolras","weight":3},{"template":1,"sourceNode":"Grantaire","targetNode":"Combeferre","weight":1},{"template":1,"sourceNode":"Grantaire","targetNode":"Courfeyrac","weight":2},{"template":1,"sourceNode":"Grantaire","targetNode":"Joly","weight":2},{"template":1,"sourceNode":"Grantaire","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Grantaire","targetNode":"Bahorel","weight":1},{"template":1,"sourceNode":"Grantaire","targetNode":"Feuilly","weight":1},{"template":1,"sourceNode":"Grantaire","targetNode":"Prouvaire","weight":1},{"template":1,"sourceNode":"MotherPlutarch","targetNode":"Mabeuf","weight":3},{"template":1,"sourceNode":"Gueulemer","targetNode":"Thenardier","weight":5},{"template":1,"sourceNode":"Gueulemer","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Gueulemer","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Gueulemer","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Gueulemer","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Gueulemer","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Babet","targetNode":"Thenardier","weight":6},{"template":1,"sourceNode":"Babet","targetNode":"Gueulemer","weight":6},{"template":1,"sourceNode":"Babet","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Babet","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Babet","targetNode":"Javert","weight":2},{"template":1,"sourceNode":"Babet","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Babet","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Claquesous","targetNode":"Thenardier","weight":4},{"template":1,"sourceNode":"Claquesous","targetNode":"Babet","weight":4},{"template":1,"sourceNode":"Claquesous","targetNode":"Gueulemer","weight":4},{"template":1,"sourceNode":"Claquesous","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Claquesous","targetNode":"Mme.Thenardier","weight":1},{"template":1,"sourceNode":"Claquesous","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Claquesous","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Claquesous","targetNode":"Enjolras","weight":1},{"template":1,"sourceNode":"Montparnasse","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Montparnasse","targetNode":"Babet","weight":2},{"template":1,"sourceNode":"Montparnasse","targetNode":"Gueulemer","weight":2},{"template":1,"sourceNode":"Montparnasse","targetNode":"Claquesous","weight":2},{"template":1,"sourceNode":"Montparnasse","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Montparnasse","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Montparnasse","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Montparnasse","targetNode":"Thenardier","weight":1},{"template":1,"sourceNode":"Toussaint","targetNode":"Cosette","weight":2},{"template":1,"sourceNode":"Toussaint","targetNode":"Javert","weight":1},{"template":1,"sourceNode":"Toussaint","targetNode":"Valjean","weight":1},{"template":1,"sourceNode":"Child1","targetNode":"Gavroche","weight":2},{"template":1,"sourceNode":"Child2","targetNode":"Gavroche","weight":2},{"template":1,"sourceNode":"Child2","targetNode":"Child1","weight":3},{"template":1,"sourceNode":"Brujon","targetNode":"Babet","weight":3},{"template":1,"sourceNode":"Brujon","targetNode":"Gueulemer","weight":3},{"template":1,"sourceNode":"Brujon","targetNode":"Thenardier","weight":3},{"template":1,"sourceNode":"Brujon","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Brujon","targetNode":"Eponine","weight":1},{"template":1,"sourceNode":"Brujon","targetNode":"Claquesous","weight":1},{"template":1,"sourceNode":"Brujon","targetNode":"Montparnasse","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Bossuet","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Joly","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Grantaire","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Bahorel","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Courfeyrac","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Gavroche","weight":1},{"template":1,"sourceNode":"Mme.Hucheloup","targetNode":"Enjolras","weight":1}]')};window.Trassel=qc,window.addEventListener("load",(async()=>{let e,t=[],i=[];const r=new l(t,i,{templates:e,layout:{updateCap:1/0}}),s=new $c(document.querySelector(".graph"),r.getNodes(),r.getEdges(),{zoomControls:!0,contextMenuBuilder:e=>[{label:"Option A",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:()=>{}},"divider",{label:"Option B",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:[{label:"Option A",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:()=>{}},{label:"Option B",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:[{label:"Option A",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:()=>{}},{label:"Option B",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:()=>{}}]}]},{label:"Option C",icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-zoom-in'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E",action:()=>{}}]});await s.initialize();let n=!1,o=!1;const a=e=>{n=!!e.shiftKey,e.ctrlKey,o=!!e.altKey,o?s.toggleLasso(!0):s.toggleLasso(!1)};window.addEventListener("keydown",a),window.addEventListener("keyup",a),s.on("entitydragstart",(e=>{e.node.fx=e.node.x,e.node.fy=e.node.y})),s.on("entitydragmove",(e=>{r.setLayoutAlphaTarget(.1),r.setLayoutAlpha(.1),r.startLayoutLoop(),e.node.fx=e.position.x,e.node.fy=e.position.y})),s.on("entitydragend",(e=>{delete e.node.fx,delete e.node.fy,r.setLayoutAlphaTarget(0)})),s.on("entityclick",(e=>{n||s.clearAllSelections(),s.toggleSelectNodes([e.node])})),s.on("edgelabelclick",(e=>{n||s.clearAllSelections(),s.toggleSelectEdges([e.edge])})),s.on("backdropclick",(()=>{s.clearAllSelections()})),s.on("lassoupdate",(e=>{s.toggleSelectNodes([...e.addedNodes,...e.removedNodes]),s.toggleSelectEdges([...e.addedEdges,...e.removedEdges])})),r.addLayoutComponent("nbody",new S),r.addLayoutComponent("collide",new f),r.addLayoutComponent("x",new u({isHorizontal:!0})),r.addLayoutComponent("y",new u({isHorizontal:!1})),r.addLayoutComponent("link",new E),r.on("layoutupdate",(()=>{s.render()})),r.startLayoutLoop(),setTimeout((()=>{s.zoomToFit()}),1e3),document.querySelector(".graph").addEventListener("contextmenu",(e=>e.preventDefault()));const h=document.createElement("div");h.setAttribute("style","position:fixed;left:24px;top:24px;font-size:1rem;font-weight:bold;color:black;padding:16px;background-color:white;border-radius:8px;font-family:sans-serif;border:1px solid lightgray;"),h.innerHTML="0 FPS",document.body.appendChild(h);let d=Date.now(),y=null,x=0;setInterval((()=>{x++,(y=Date.now())-d>1e3&&(h.innerHTML=`${x} FPS`,x=0,d=y)}),0),window.updateGraphData=async n=>{if(r.getNodes().forEach((e=>(e.fx=null,e.fy=null))),"patents"===n)t=Zc.nodes,i=Zc.edges,e=Zc.templates;else if("foaf"===n)t=Qc,i=ep,e=Jc;else if("smallgraph"===n)t=tp.nodes,i=tp.edges,e=tp.templates;else if("lesmiserables"===n)t=ip.nodes,i=ip.edges,e=ip.templates;else if("snake"===n){t=[],i=[],e={};for(let e=0;e<2e3;e++)t.push({id:"n"+e,mass:1e3});for(let e=0;e<5e3;e++)i.push({sourceNode:"n"+Math.round(Math.abs(e/5)),targetNode:"n"+Math.round(Math.abs(e/5-1)),visibleDistance:100,rendererOptions:{label:"Hello World!!!!",labelTextColor:"#00594E"}})}else if("clusters"===n){t=[],i=[],e={};for(let e=0;e<1e3;e++)t.push({id:"n"+e,shape:{id:"circle",radius:50}}),i.push({sourceNode:"n"+Math.floor(Math.sqrt(e)),targetNode:"n"+e,visibleDistance:100,rendererOptions:{color:"#00594E",label:"Hello World!!!!"}})}else if("lattice"===n){const e=20;t=[],i=[];for(let i=0;i<e*e;i++)t.push({id:`n${i}`,shape:{id:"circle",radius:20},mass:500});for(let t=0;t<e;t++)for(let r=0;r<e;r++)t>0&&i.push({sourceNode:`n${(t-1)*e+r}`,targetNode:`n${t*e+r}`,visibleDistance:1,strength:2}),r>0&&i.push({sourceNode:"n"+(t*e+(r-1)),targetNode:`n${t*e+r}`,visibleDistance:1,strength:2})}r.stopLayoutLoop(),r.updateNodesAndEdges(t,i,e),await s.updateNodesAndEdges(t,i),r.setLayoutAlpha(1),r.startLayoutLoop()},window.updateGraphData("foaf"),window.searchGraph=e=>{s.clearAllDisabledStatuses(),s.disableNodes((t=>!t.id.includes(e)))},window.clearSearch=()=>{s.clearAllDisabledStatuses()},window.zoomToNode=e=>{s.zoomToNode(e)},window.zoomToFitGraph=()=>{s.zoomToFit()},window.updateLayoutGraph=e=>{r.stopLayoutLoop(),r.getNodes().forEach((e=>(e.fx=null,e.fy=null))),r.clearAllLayoutComponents(),"force"===e?(r.addLayoutComponent("nbody",new S),r.addLayoutComponent("collide",new f),r.addLayoutComponent("x",new u({isHorizontal:!0})),r.addLayoutComponent("y",new u({isHorizontal:!1})),r.addLayoutComponent("link",new E)):"force2"===e?r.addLayoutComponent("force",new P):"hierarchy"===e?r.addLayoutComponent("hierarchy",new T):"connection"===e?r.addLayoutComponent("connections",new M):"tree"===e?r.addLayoutComponent("tree",new A):"cluster"===e?(r.addLayoutComponent("nbody",new S),r.addLayoutComponent("collide",new f),r.addLayoutComponent("x",new u({isHorizontal:!0})),r.addLayoutComponent("y",new u({isHorizontal:!1})),r.addLayoutComponent("link",new E),r.addLayoutComponent("cluster",new g)):"fan"===e?r.addLayoutComponent("fan",new m):"grid"===e?(r.addLayoutComponent("nbody",new S),r.addLayoutComponent("collide",new f),r.addLayoutComponent("x",new u({isHorizontal:!0})),r.addLayoutComponent("y",new u({isHorizontal:!1})),r.addLayoutComponent("link",new E),r.addLayoutComponent("grid",new _)):"matrix"===e?r.addLayoutComponent("matrix",new C):"radial"===e&&(r.addLayoutComponent("nbody",new S),r.addLayoutComponent("collide",new f),r.addLayoutComponent("x",new u({isHorizontal:!0})),r.addLayoutComponent("y",new u({isHorizontal:!1})),r.addLayoutComponent("radial",new N)),r.setLayoutAlpha(1),r.startLayoutLoop()},window.updateLineTypeGraph=e=>{s.setLineType(e)},window.toggleBoundingForce=()=>{r.stopLayoutLoop(),r.hasLayoutComponent("bounding")?r.removeLayoutComponent("bounding"):r.addLayoutComponent("bounding",new c({width:1500,height:1500})),r.setLayoutAlpha(1),r.startLayoutLoop()},window.toggleCenterForce=()=>{r.stopLayoutLoop(),r.hasLayoutComponent("Center")?r.removeLayoutComponent("Center"):r.addLayoutComponent("Center",new p),r.setLayoutAlpha(1),r.startLayoutLoop()},window.exportToPng=()=>{s.exportToPng()}})),G.add(Zi),G.mixin(Xt,{accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_renderId:-1}),G.add($r),G.add(qr),G.add(nl),G.mixin(Xt,ol),G.add(zu),G.add(Kn),G.add(Xu),G.add(ec),G.add(tc),G.add(Rc),G.add(Ac),G.add(xc),G.add(Nc),G.add(wc),G.add(uc),G.add(sc),G.add(hl),G.add(al);const rp=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),sp=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));
